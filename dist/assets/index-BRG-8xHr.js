(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const o of r.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function e(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerPolicy&&(r.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?r.credentials="include":s.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(s){if(s.ep)return;s.ep=!0;const r=e(s);fetch(s.href,r)}})();const Gy=()=>{};var qu={};const qf=function(n){const t=[];let e=0;for(let i=0;i<n.length;i++){let s=n.charCodeAt(i);s<128?t[e++]=s:s<2048?(t[e++]=s>>6|192,t[e++]=s&63|128):(s&64512)===55296&&i+1<n.length&&(n.charCodeAt(i+1)&64512)===56320?(s=65536+((s&1023)<<10)+(n.charCodeAt(++i)&1023),t[e++]=s>>18|240,t[e++]=s>>12&63|128,t[e++]=s>>6&63|128,t[e++]=s&63|128):(t[e++]=s>>12|224,t[e++]=s>>6&63|128,t[e++]=s&63|128)}return t},Ky=function(n){const t=[];let e=0,i=0;for(;e<n.length;){const s=n[e++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=n[e++];t[i++]=String.fromCharCode((s&31)<<6|r&63)}else if(s>239&&s<365){const r=n[e++],o=n[e++],a=n[e++],l=((s&7)<<18|(r&63)<<12|(o&63)<<6|a&63)-65536;t[i++]=String.fromCharCode(55296+(l>>10)),t[i++]=String.fromCharCode(56320+(l&1023))}else{const r=n[e++],o=n[e++];t[i++]=String.fromCharCode((s&15)<<12|(r&63)<<6|o&63)}}return t.join("")},Gf={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:typeof atob=="function",encodeByteArray(n,t){if(!Array.isArray(n))throw Error("encodeByteArray takes an array as a parameter");this.init_();const e=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let s=0;s<n.length;s+=3){const r=n[s],o=s+1<n.length,a=o?n[s+1]:0,l=s+2<n.length,u=l?n[s+2]:0,h=r>>2,d=(r&3)<<4|a>>4;let p=(a&15)<<2|u>>6,m=u&63;l||(m=64,o||(p=64)),i.push(e[h],e[d],e[p],e[m])}return i.join("")},encodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(n):this.encodeByteArray(qf(n),t)},decodeString(n,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(n):Ky(this.decodeStringToByteArray(n,t))},decodeStringToByteArray(n,t){this.init_();const e=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let s=0;s<n.length;){const r=e[n.charAt(s++)],a=s<n.length?e[n.charAt(s)]:0;++s;const u=s<n.length?e[n.charAt(s)]:64;++s;const d=s<n.length?e[n.charAt(s)]:64;if(++s,r==null||a==null||u==null||d==null)throw new Yy;const p=r<<2|a>>4;if(i.push(p),u!==64){const m=a<<4&240|u>>2;if(i.push(m),d!==64){const b=u<<6&192|d;i.push(b)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let n=0;n<this.ENCODED_VALS.length;n++)this.byteToCharMap_[n]=this.ENCODED_VALS.charAt(n),this.charToByteMap_[this.byteToCharMap_[n]]=n,this.byteToCharMapWebSafe_[n]=this.ENCODED_VALS_WEBSAFE.charAt(n),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[n]]=n,n>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(n)]=n,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(n)]=n)}}};class Yy extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const Xy=function(n){const t=qf(n);return Gf.encodeByteArray(t,!0)},Zr=function(n){return Xy(n).replace(/\./g,"")},Kf=function(n){try{return Gf.decodeString(n,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function Qy(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("Unable to locate global object.")}const Jy=()=>Qy().__FIREBASE_DEFAULTS__,Zy=()=>{if(typeof process>"u"||typeof qu>"u")return;const n=qu.__FIREBASE_DEFAULTS__;if(n)return JSON.parse(n)},t_=()=>{if(typeof document>"u")return;let n;try{n=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch{return}const t=n&&Kf(n[1]);return t&&JSON.parse(t)},Co=()=>{try{return Gy()||Jy()||Zy()||t_()}catch(n){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${n}`);return}},Yf=n=>Co()?.emulatorHosts?.[n],e_=n=>{const t=Yf(n);if(!t)return;const e=t.lastIndexOf(":");if(e<=0||e+1===t.length)throw new Error(`Invalid host ${t} with no separate hostname and port!`);const i=parseInt(t.substring(e+1),10);return t[0]==="["?[t.substring(1,e-1),i]:[t.substring(0,e),i]},Xf=()=>Co()?.config,Qf=n=>Co()?.[`_${n}`];class n_{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}wrapCallback(t){return(e,i)=>{e?this.reject(e):this.resolve(i),typeof t=="function"&&(this.promise.catch(()=>{}),t.length===1?t(e):t(e,i))}}}function Oi(n){try{return(n.startsWith("http://")||n.startsWith("https://")?new URL(n).hostname:n).endsWith(".cloudworkstations.dev")}catch{return!1}}async function Jf(n){return(await fetch(n,{credentials:"include"})).ok}function i_(n,t){if(n.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const e={alg:"none",type:"JWT"},i=t||"demo-project",s=n.iat||0,r=n.sub||n.user_id;if(!r)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o={iss:`https://securetoken.google.com/${i}`,aud:i,iat:s,exp:s+3600,auth_time:s,sub:r,user_id:r,firebase:{sign_in_provider:"custom",identities:{}},...n};return[Zr(JSON.stringify(e)),Zr(JSON.stringify(o)),""].join(".")}const ys={};function s_(){const n={prod:[],emulator:[]};for(const t of Object.keys(ys))ys[t]?n.emulator.push(t):n.prod.push(t);return n}function r_(n){let t=document.getElementById(n),e=!1;return t||(t=document.createElement("div"),t.setAttribute("id",n),e=!0),{created:e,element:t}}let Gu=!1;function Zf(n,t){if(typeof window>"u"||typeof document>"u"||!Oi(window.location.host)||ys[n]===t||ys[n]||Gu)return;ys[n]=t;function e(p){return`__firebase__banner__${p}`}const i="__firebase__banner",r=s_().prod.length>0;function o(){const p=document.getElementById(i);p&&p.remove()}function a(p){p.style.display="flex",p.style.background="#7faaf0",p.style.position="fixed",p.style.bottom="5px",p.style.left="5px",p.style.padding=".5em",p.style.borderRadius="5px",p.style.alignItems="center"}function l(p,m){p.setAttribute("width","24"),p.setAttribute("id",m),p.setAttribute("height","24"),p.setAttribute("viewBox","0 0 24 24"),p.setAttribute("fill","none"),p.style.marginLeft="-6px"}function u(){const p=document.createElement("span");return p.style.cursor="pointer",p.style.marginLeft="16px",p.style.fontSize="24px",p.innerHTML=" &times;",p.onclick=()=>{Gu=!0,o()},p}function h(p,m){p.setAttribute("id",m),p.innerText="Learn more",p.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",p.setAttribute("target","__blank"),p.style.paddingLeft="5px",p.style.textDecoration="underline"}function d(){const p=r_(i),m=e("text"),b=document.getElementById(m)||document.createElement("span"),v=e("learnmore"),E=document.getElementById(v)||document.createElement("a"),C=e("preprendIcon"),P=document.getElementById(C)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(p.created){const k=p.element;a(k),h(E,v);const M=u();l(P,C),k.append(P,b,E,M),document.body.appendChild(k)}r?(b.innerText="Preview backend disconnected.",P.innerHTML=`<g clip-path="url(#clip0_6013_33858)">
<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6013_33858">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`):(P.innerHTML=`<g clip-path="url(#clip0_6083_34804)">
<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>
</g>
<defs>
<clipPath id="clip0_6083_34804">
<rect width="24" height="24" fill="white"/>
</clipPath>
</defs>`,b.innerText="Preview backend running in this workspace."),b.setAttribute("id",m)}document.readyState==="loading"?window.addEventListener("DOMContentLoaded",d):d()}function Wt(){return typeof navigator<"u"&&typeof navigator.userAgent=="string"?navigator.userAgent:""}function o_(){return typeof window<"u"&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(Wt())}function a_(){const n=Co()?.forceEnvironment;if(n==="node")return!0;if(n==="browser")return!1;try{return Object.prototype.toString.call(global.process)==="[object process]"}catch{return!1}}function l_(){return typeof navigator<"u"&&navigator.userAgent==="Cloudflare-Workers"}function c_(){const n=typeof chrome=="object"?chrome.runtime:typeof browser=="object"?browser.runtime:void 0;return typeof n=="object"&&n.id!==void 0}function u_(){return typeof navigator=="object"&&navigator.product==="ReactNative"}function h_(){const n=Wt();return n.indexOf("MSIE ")>=0||n.indexOf("Trident/")>=0}function d_(){return!a_()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function f_(){try{return typeof indexedDB=="object"}catch{return!1}}function p_(){return new Promise((n,t)=>{try{let e=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),e||self.indexedDB.deleteDatabase(i),n(!0)},s.onupgradeneeded=()=>{e=!1},s.onerror=()=>{t(s.error?.message||"")}}catch(e){t(e)}})}const g_="FirebaseError";class je extends Error{constructor(t,e,i){super(e),this.code=t,this.customData=i,this.name=g_,Object.setPrototypeOf(this,je.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,Ys.prototype.create)}}class Ys{constructor(t,e,i){this.service=t,this.serviceName=e,this.errors=i}create(t,...e){const i=e[0]||{},s=`${this.service}/${t}`,r=this.errors[t],o=r?m_(r,i):"Error",a=`${this.serviceName}: ${o} (${s}).`;return new je(s,a,i)}}function m_(n,t){return n.replace(y_,(e,i)=>{const s=t[i];return s!=null?String(s):`<${i}?>`})}const y_=/\{\$([^}]+)}/g;function __(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}function qn(n,t){if(n===t)return!0;const e=Object.keys(n),i=Object.keys(t);for(const s of e){if(!i.includes(s))return!1;const r=n[s],o=t[s];if(Ku(r)&&Ku(o)){if(!qn(r,o))return!1}else if(r!==o)return!1}for(const s of i)if(!e.includes(s))return!1;return!0}function Ku(n){return n!==null&&typeof n=="object"}function Xs(n){const t=[];for(const[e,i]of Object.entries(n))Array.isArray(i)?i.forEach(s=>{t.push(encodeURIComponent(e)+"="+encodeURIComponent(s))}):t.push(encodeURIComponent(e)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function b_(n,t){const e=new v_(n,t);return e.subscribe.bind(e)}class v_{constructor(t,e){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(()=>{t(this)}).catch(i=>{this.error(i)})}next(t){this.forEachObserver(e=>{e.next(t)})}error(t){this.forEachObserver(e=>{e.error(t)}),this.close(t)}complete(){this.forEachObserver(t=>{t.complete()}),this.close()}subscribe(t,e,i){let s;if(t===void 0&&e===void 0&&i===void 0)throw new Error("Missing Observer.");w_(t,["next","error","complete"])?s=t:s={next:t,error:e,complete:i},s.next===void 0&&(s.next=wa),s.error===void 0&&(s.error=wa),s.complete===void 0&&(s.complete=wa);const r=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?s.error(this.finalError):s.complete()}catch{}}),this.observers.push(s),r}unsubscribeOne(t){this.observers===void 0||this.observers[t]===void 0||(delete this.observers[t],this.observerCount-=1,this.observerCount===0&&this.onNoObservers!==void 0&&this.onNoObservers(this))}forEachObserver(t){if(!this.finalized)for(let e=0;e<this.observers.length;e++)this.sendOne(e,t)}sendOne(t,e){this.task.then(()=>{if(this.observers!==void 0&&this.observers[t]!==void 0)try{e(this.observers[t])}catch(i){typeof console<"u"&&console.error&&console.error(i)}})}close(t){this.finalized||(this.finalized=!0,t!==void 0&&(this.finalError=t),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function w_(n,t){if(typeof n!="object"||n===null)return!1;for(const e of t)if(e in n&&typeof n[e]=="function")return!0;return!1}function wa(){}function Yt(n){return n&&n._delegate?n._delegate:n}class Gn{constructor(t,e,i){this.name=t,this.instanceFactory=e,this.type=i,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const Ln="[DEFAULT]";class E_{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const i=new n_;if(this.instancesDeferred.set(e,i),this.isInitialized(e)||this.shouldAutoInitialize())try{const s=this.getOrInitializeService({instanceIdentifier:e});s&&i.resolve(s)}catch{}}return this.instancesDeferred.get(e).promise}getImmediate(t){const e=this.normalizeInstanceIdentifier(t?.identifier),i=t?.optional??!1;if(this.isInitialized(e)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:e})}catch(s){if(i)return null;throw s}else{if(i)return null;throw Error(`Service ${this.name} is not available`)}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,!!this.shouldAutoInitialize()){if(x_(t))try{this.getOrInitializeService({instanceIdentifier:Ln})}catch{}for(const[e,i]of this.instancesDeferred.entries()){const s=this.normalizeInstanceIdentifier(e);try{const r=this.getOrInitializeService({instanceIdentifier:s});i.resolve(r)}catch{}}}}clearInstance(t=Ln){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...t.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return this.component!=null}isInitialized(t=Ln){return this.instances.has(t)}getOptions(t=Ln){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,i=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(i))throw Error(`${this.name}(${i}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const s=this.getOrInitializeService({instanceIdentifier:i,options:e});for(const[r,o]of this.instancesDeferred.entries()){const a=this.normalizeInstanceIdentifier(r);i===a&&o.resolve(s)}return s}onInit(t,e){const i=this.normalizeInstanceIdentifier(e),s=this.onInitCallbacks.get(i)??new Set;s.add(t),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&t(r,i),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const i=this.onInitCallbacks.get(e);if(i)for(const s of i)try{s(t,e)}catch{}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let i=this.instances.get(t);if(!i&&this.component&&(i=this.component.instanceFactory(this.container,{instanceIdentifier:T_(t),options:e}),this.instances.set(t,i),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(i,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,i)}catch{}return i||null}normalizeInstanceIdentifier(t=Ln){return this.component?this.component.multipleInstances?t:Ln:t}shouldAutoInitialize(){return!!this.component&&this.component.instantiationMode!=="EXPLICIT"}}function T_(n){return n===Ln?void 0:n}function x_(n){return n.instantiationMode==="EAGER"}class I_{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new E_(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}var X;(function(n){n[n.DEBUG=0]="DEBUG",n[n.VERBOSE=1]="VERBOSE",n[n.INFO=2]="INFO",n[n.WARN=3]="WARN",n[n.ERROR=4]="ERROR",n[n.SILENT=5]="SILENT"})(X||(X={}));const A_={debug:X.DEBUG,verbose:X.VERBOSE,info:X.INFO,warn:X.WARN,error:X.ERROR,silent:X.SILENT},S_=X.INFO,C_={[X.DEBUG]:"log",[X.VERBOSE]:"log",[X.INFO]:"info",[X.WARN]:"warn",[X.ERROR]:"error"},P_=(n,t,...e)=>{if(t<n.logLevel)return;const i=new Date().toISOString(),s=C_[t];if(s)console[s](`[${i}]  ${n.name}:`,...e);else throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class Bl{constructor(t){this.name=t,this._logLevel=S_,this._logHandler=P_,this._userLogHandler=null}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in X))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel=typeof t=="string"?A_[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if(typeof t!="function")throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,X.DEBUG,...t),this._logHandler(this,X.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,X.VERBOSE,...t),this._logHandler(this,X.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,X.INFO,...t),this._logHandler(this,X.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,X.WARN,...t),this._logHandler(this,X.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,X.ERROR,...t),this._logHandler(this,X.ERROR,...t)}}const R_=(n,t)=>t.some(e=>n instanceof e);let Yu,Xu;function k_(){return Yu||(Yu=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function D_(){return Xu||(Xu=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}const tp=new WeakMap,nl=new WeakMap,ep=new WeakMap,Ea=new WeakMap,Ul=new WeakMap;function M_(n){const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("success",r),n.removeEventListener("error",o)},r=()=>{e(un(n.result)),s()},o=()=>{i(n.error),s()};n.addEventListener("success",r),n.addEventListener("error",o)});return t.then(e=>{e instanceof IDBCursor&&tp.set(e,n)}).catch(()=>{}),Ul.set(t,n),t}function O_(n){if(nl.has(n))return;const t=new Promise((e,i)=>{const s=()=>{n.removeEventListener("complete",r),n.removeEventListener("error",o),n.removeEventListener("abort",o)},r=()=>{e(),s()},o=()=>{i(n.error||new DOMException("AbortError","AbortError")),s()};n.addEventListener("complete",r),n.addEventListener("error",o),n.addEventListener("abort",o)});nl.set(n,t)}let il={get(n,t,e){if(n instanceof IDBTransaction){if(t==="done")return nl.get(n);if(t==="objectStoreNames")return n.objectStoreNames||ep.get(n);if(t==="store")return e.objectStoreNames[1]?void 0:e.objectStore(e.objectStoreNames[0])}return un(n[t])},set(n,t,e){return n[t]=e,!0},has(n,t){return n instanceof IDBTransaction&&(t==="done"||t==="store")?!0:t in n}};function V_(n){il=n(il)}function L_(n){return n===IDBDatabase.prototype.transaction&&!("objectStoreNames"in IDBTransaction.prototype)?function(t,...e){const i=n.call(Ta(this),t,...e);return ep.set(i,t.sort?t.sort():[t]),un(i)}:D_().includes(n)?function(...t){return n.apply(Ta(this),t),un(tp.get(this))}:function(...t){return un(n.apply(Ta(this),t))}}function N_(n){return typeof n=="function"?L_(n):(n instanceof IDBTransaction&&O_(n),R_(n,k_())?new Proxy(n,il):n)}function un(n){if(n instanceof IDBRequest)return M_(n);if(Ea.has(n))return Ea.get(n);const t=N_(n);return t!==n&&(Ea.set(n,t),Ul.set(t,n)),t}const Ta=n=>Ul.get(n);function F_(n,t,{blocked:e,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(n,t),a=un(o);return i&&o.addEventListener("upgradeneeded",l=>{i(un(o.result),l.oldVersion,l.newVersion,un(o.transaction),l)}),e&&o.addEventListener("blocked",l=>e(l.oldVersion,l.newVersion,l)),a.then(l=>{r&&l.addEventListener("close",()=>r()),s&&l.addEventListener("versionchange",u=>s(u.oldVersion,u.newVersion,u))}).catch(()=>{}),a}const B_=["get","getKey","getAll","getAllKeys","count"],U_=["put","add","delete","clear"],xa=new Map;function Qu(n,t){if(!(n instanceof IDBDatabase&&!(t in n)&&typeof t=="string"))return;if(xa.get(t))return xa.get(t);const e=t.replace(/FromIndex$/,""),i=t!==e,s=U_.includes(e);if(!(e in(i?IDBIndex:IDBObjectStore).prototype)||!(s||B_.includes(e)))return;const r=async function(o,...a){const l=this.transaction(o,s?"readwrite":"readonly");let u=l.store;return i&&(u=u.index(a.shift())),(await Promise.all([u[e](...a),s&&l.done]))[0]};return xa.set(t,r),r}V_(n=>({...n,get:(t,e,i)=>Qu(t,e)||n.get(t,e,i),has:(t,e)=>!!Qu(t,e)||n.has(t,e)}));class z_{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map(e=>{if($_(e)){const i=e.getImmediate();return`${i.library}/${i.version}`}else return null}).filter(e=>e).join(" ")}}function $_(n){return n.getComponent()?.type==="VERSION"}const sl="@firebase/app",Ju="0.14.6";const Be=new Bl("@firebase/app"),j_="@firebase/app-compat",H_="@firebase/analytics-compat",W_="@firebase/analytics",q_="@firebase/app-check-compat",G_="@firebase/app-check",K_="@firebase/auth",Y_="@firebase/auth-compat",X_="@firebase/database",Q_="@firebase/data-connect",J_="@firebase/database-compat",Z_="@firebase/functions",tb="@firebase/functions-compat",eb="@firebase/installations",nb="@firebase/installations-compat",ib="@firebase/messaging",sb="@firebase/messaging-compat",rb="@firebase/performance",ob="@firebase/performance-compat",ab="@firebase/remote-config",lb="@firebase/remote-config-compat",cb="@firebase/storage",ub="@firebase/storage-compat",hb="@firebase/firestore",db="@firebase/ai",fb="@firebase/firestore-compat",pb="firebase",gb="12.6.0";const rl="[DEFAULT]",mb={[sl]:"fire-core",[j_]:"fire-core-compat",[W_]:"fire-analytics",[H_]:"fire-analytics-compat",[G_]:"fire-app-check",[q_]:"fire-app-check-compat",[K_]:"fire-auth",[Y_]:"fire-auth-compat",[X_]:"fire-rtdb",[Q_]:"fire-data-connect",[J_]:"fire-rtdb-compat",[Z_]:"fire-fn",[tb]:"fire-fn-compat",[eb]:"fire-iid",[nb]:"fire-iid-compat",[ib]:"fire-fcm",[sb]:"fire-fcm-compat",[rb]:"fire-perf",[ob]:"fire-perf-compat",[ab]:"fire-rc",[lb]:"fire-rc-compat",[cb]:"fire-gcs",[ub]:"fire-gcs-compat",[hb]:"fire-fst",[fb]:"fire-fst-compat",[db]:"fire-vertex","fire-js":"fire-js",[pb]:"fire-js-all"};const to=new Map,yb=new Map,ol=new Map;function Zu(n,t){try{n.container.addComponent(t)}catch(e){Be.debug(`Component ${t.name} failed to register with FirebaseApp ${n.name}`,e)}}function Ei(n){const t=n.name;if(ol.has(t))return Be.debug(`There were multiple attempts to register component ${t}.`),!1;ol.set(t,n);for(const e of to.values())Zu(e,n);for(const e of yb.values())Zu(e,n);return!0}function zl(n,t){const e=n.container.getProvider("heartbeat").getImmediate({optional:!0});return e&&e.triggerHeartbeat(),n.container.getProvider(t)}function oe(n){return n==null?!1:n.settings!==void 0}const _b={"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."},hn=new Ys("app","Firebase",_b);class bb{constructor(t,e,i){this._isDeleted=!1,this._options={...t},this._config={...e},this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=i,this.container.addComponent(new Gn("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw hn.create("app-deleted",{appName:this._name})}}const Vi=gb;function np(n,t={}){let e=n;typeof t!="object"&&(t={name:t});const i={name:rl,automaticDataCollectionEnabled:!0,...t},s=i.name;if(typeof s!="string"||!s)throw hn.create("bad-app-name",{appName:String(s)});if(e||(e=Xf()),!e)throw hn.create("no-options");const r=to.get(s);if(r){if(qn(e,r.options)&&qn(i,r.config))return r;throw hn.create("duplicate-app",{appName:s})}const o=new I_(s);for(const l of ol.values())o.addComponent(l);const a=new bb(e,i,o);return to.set(s,a),a}function ip(n=rl){const t=to.get(n);if(!t&&n===rl&&Xf())return np();if(!t)throw hn.create("no-app",{appName:n});return t}function dn(n,t,e){let i=mb[n]??n;e&&(i+=`-${e}`);const s=i.match(/\s|\//),r=t.match(/\s|\//);if(s||r){const o=[`Unable to register library "${i}" with version "${t}":`];s&&o.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&r&&o.push("and"),r&&o.push(`version name "${t}" contains illegal characters (whitespace or "/")`),Be.warn(o.join(" "));return}Ei(new Gn(`${i}-version`,()=>({library:i,version:t}),"VERSION"))}const vb="firebase-heartbeat-database",wb=1,Rs="firebase-heartbeat-store";let Ia=null;function sp(){return Ia||(Ia=F_(vb,wb,{upgrade:(n,t)=>{switch(t){case 0:try{n.createObjectStore(Rs)}catch(e){console.warn(e)}}}}).catch(n=>{throw hn.create("idb-open",{originalErrorMessage:n.message})})),Ia}async function Eb(n){try{const e=(await sp()).transaction(Rs),i=await e.objectStore(Rs).get(rp(n));return await e.done,i}catch(t){if(t instanceof je)Be.warn(t.message);else{const e=hn.create("idb-get",{originalErrorMessage:t?.message});Be.warn(e.message)}}}async function th(n,t){try{const i=(await sp()).transaction(Rs,"readwrite");await i.objectStore(Rs).put(t,rp(n)),await i.done}catch(e){if(e instanceof je)Be.warn(e.message);else{const i=hn.create("idb-set",{originalErrorMessage:e?.message});Be.warn(i.message)}}}function rp(n){return`${n.name}!${n.options.appId}`}const Tb=1024,xb=30;class Ib{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new Sb(e),this._heartbeatsCachePromise=this._storage.read().then(i=>(this._heartbeatsCache=i,i))}async triggerHeartbeat(){try{const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),i=eh();if(this._heartbeatsCache?.heartbeats==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null)||this._heartbeatsCache.lastSentHeartbeatDate===i||this._heartbeatsCache.heartbeats.some(s=>s.date===i))return;if(this._heartbeatsCache.heartbeats.push({date:i,agent:e}),this._heartbeatsCache.heartbeats.length>xb){const s=Cb(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(s,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(t){Be.warn(t)}}async getHeartbeatsHeader(){try{if(this._heartbeatsCache===null&&await this._heartbeatsCachePromise,this._heartbeatsCache?.heartbeats==null||this._heartbeatsCache.heartbeats.length===0)return"";const t=eh(),{heartbeatsToSend:e,unsentEntries:i}=Ab(this._heartbeatsCache.heartbeats),s=Zr(JSON.stringify({version:2,heartbeats:e}));return this._heartbeatsCache.lastSentHeartbeatDate=t,i.length>0?(this._heartbeatsCache.heartbeats=i,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}catch(t){return Be.warn(t),""}}}function eh(){return new Date().toISOString().substring(0,10)}function Ab(n,t=Tb){const e=[];let i=n.slice();for(const s of n){const r=e.find(o=>o.agent===s.agent);if(r){if(r.dates.push(s.date),nh(e)>t){r.dates.pop();break}}else if(e.push({agent:s.agent,dates:[s.date]}),nh(e)>t){e.pop();break}i=i.slice(1)}return{heartbeatsToSend:e,unsentEntries:i}}class Sb{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return f_()?p_().then(()=>!0).catch(()=>!1):!1}async read(){if(await this._canUseIndexedDBPromise){const e=await Eb(this.app);return e?.heartbeats?e:{heartbeats:[]}}else return{heartbeats:[]}}async overwrite(t){if(await this._canUseIndexedDBPromise){const i=await this.read();return th(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:t.heartbeats})}else return}async add(t){if(await this._canUseIndexedDBPromise){const i=await this.read();return th(this.app,{lastSentHeartbeatDate:t.lastSentHeartbeatDate??i.lastSentHeartbeatDate,heartbeats:[...i.heartbeats,...t.heartbeats]})}else return}}function nh(n){return Zr(JSON.stringify({version:2,heartbeats:n})).length}function Cb(n){if(n.length===0)return-1;let t=0,e=n[0].date;for(let i=1;i<n.length;i++)n[i].date<e&&(e=n[i].date,t=i);return t}function Pb(n){Ei(new Gn("platform-logger",t=>new z_(t),"PRIVATE")),Ei(new Gn("heartbeat",t=>new Ib(t),"PRIVATE")),dn(sl,Ju,n),dn(sl,Ju,"esm2020"),dn("fire-js","")}Pb("");function op(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}}const Rb=op,ap=new Ys("auth","Firebase",op());const eo=new Bl("@firebase/auth");function kb(n,...t){eo.logLevel<=X.WARN&&eo.warn(`Auth (${Vi}): ${n}`,...t)}function Ur(n,...t){eo.logLevel<=X.ERROR&&eo.error(`Auth (${Vi}): ${n}`,...t)}function xe(n,...t){throw jl(n,...t)}function ue(n,...t){return jl(n,...t)}function $l(n,t,e){const i={...Rb(),[t]:e};return new Ys("auth","Firebase",i).create(t,{appName:n.name})}function zn(n){return $l(n,"operation-not-supported-in-this-environment","Operations that alter the current user are not supported in conjunction with FirebaseServerApp")}function Db(n,t,e){const i=e;if(!(t instanceof i))throw i.name!==t.constructor.name&&xe(n,"argument-error"),$l(n,"argument-error",`Type of ${t.constructor.name} does not match expected instance.Did you pass a reference from a different Auth SDK?`)}function jl(n,...t){if(typeof n!="string"){const e=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=n.name),n._errorFactory.create(e,...i)}return ap.create(n,...t)}function j(n,t,...e){if(!n)throw jl(t,...e)}function Oe(n){const t="INTERNAL ASSERTION FAILED: "+n;throw Ur(t),new Error(t)}function Ue(n,t){n||Oe(t)}function al(){return typeof self<"u"&&self.location?.href||""}function Mb(){return ih()==="http:"||ih()==="https:"}function ih(){return typeof self<"u"&&self.location?.protocol||null}function Ob(){return typeof navigator<"u"&&navigator&&"onLine"in navigator&&typeof navigator.onLine=="boolean"&&(Mb()||c_()||"connection"in navigator)?navigator.onLine:!0}function Vb(){if(typeof navigator>"u")return null;const n=navigator;return n.languages&&n.languages[0]||n.language||null}class Qs{constructor(t,e){this.shortDelay=t,this.longDelay=e,Ue(e>t,"Short delay should be less than long delay!"),this.isMobile=o_()||u_()}get(){return Ob()?this.isMobile?this.longDelay:this.shortDelay:Math.min(5e3,this.shortDelay)}}function Hl(n,t){Ue(n.emulator,"Emulator should always be set here");const{url:e}=n.emulator;return t?`${e}${t.startsWith("/")?t.slice(1):t}`:e}class lp{static initialize(t,e,i){this.fetchImpl=t,e&&(this.headersImpl=e),i&&(this.responseImpl=i)}static fetch(){if(this.fetchImpl)return this.fetchImpl;if(typeof self<"u"&&"fetch"in self)return self.fetch;if(typeof globalThis<"u"&&globalThis.fetch)return globalThis.fetch;if(typeof fetch<"u")return fetch;Oe("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){if(this.headersImpl)return this.headersImpl;if(typeof self<"u"&&"Headers"in self)return self.Headers;if(typeof globalThis<"u"&&globalThis.Headers)return globalThis.Headers;if(typeof Headers<"u")return Headers;Oe("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){if(this.responseImpl)return this.responseImpl;if(typeof self<"u"&&"Response"in self)return self.Response;if(typeof globalThis<"u"&&globalThis.Response)return globalThis.Response;if(typeof Response<"u")return Response;Oe("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Lb={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"missing-password",INVALID_LOGIN_CREDENTIALS:"invalid-credential",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",PASSWORD_DOES_NOT_MEET_REQUIREMENTS:"password-does-not-meet-requirements",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error",RECAPTCHA_NOT_ENABLED:"recaptcha-not-enabled",MISSING_RECAPTCHA_TOKEN:"missing-recaptcha-token",INVALID_RECAPTCHA_TOKEN:"invalid-recaptcha-token",INVALID_RECAPTCHA_ACTION:"invalid-recaptcha-action",MISSING_CLIENT_TYPE:"missing-client-type",MISSING_RECAPTCHA_VERSION:"missing-recaptcha-version",INVALID_RECAPTCHA_VERSION:"invalid-recaptcha-version",INVALID_REQ_TYPE:"invalid-req-type"};const Nb=["/v1/accounts:signInWithCustomToken","/v1/accounts:signInWithEmailLink","/v1/accounts:signInWithIdp","/v1/accounts:signInWithPassword","/v1/accounts:signInWithPhoneNumber","/v1/token"],Fb=new Qs(3e4,6e4);function Wl(n,t){return n.tenantId&&!t.tenantId?{...t,tenantId:n.tenantId}:t}async function Li(n,t,e,i,s={}){return cp(n,s,async()=>{let r={},o={};i&&(t==="GET"?o=i:r={body:JSON.stringify(i)});const a=Xs({key:n.config.apiKey,...o}).slice(1),l=await n._getAdditionalHeaders();l["Content-Type"]="application/json",n.languageCode&&(l["X-Firebase-Locale"]=n.languageCode);const u={method:t,headers:l,...r};return l_()||(u.referrerPolicy="no-referrer"),n.emulatorConfig&&Oi(n.emulatorConfig.host)&&(u.credentials="include"),lp.fetch()(await up(n,n.config.apiHost,e,a),u)})}async function cp(n,t,e){n._canInitEmulator=!1;const i={...Lb,...t};try{const s=new Ub(n),r=await Promise.race([e(),s.promise]);s.clearNetworkTimeout();const o=await r.json();if("needConfirmation"in o)throw wr(n,"account-exists-with-different-credential",o);if(r.ok&&!("errorMessage"in o))return o;{const a=r.ok?o.errorMessage:o.error.message,[l,u]=a.split(" : ");if(l==="FEDERATED_USER_ID_ALREADY_LINKED")throw wr(n,"credential-already-in-use",o);if(l==="EMAIL_EXISTS")throw wr(n,"email-already-in-use",o);if(l==="USER_DISABLED")throw wr(n,"user-disabled",o);const h=i[l]||l.toLowerCase().replace(/[_\s]+/g,"-");if(u)throw $l(n,h,u);xe(n,h)}}catch(s){if(s instanceof je)throw s;xe(n,"network-request-failed",{message:String(s)})}}async function Bb(n,t,e,i,s={}){const r=await Li(n,t,e,i,s);return"mfaPendingCredential"in r&&xe(n,"multi-factor-auth-required",{_serverResponse:r}),r}async function up(n,t,e,i){const s=`${t}${e}?${i}`,r=n,o=r.config.emulator?Hl(n.config,s):`${n.config.apiScheme}://${s}`;return Nb.includes(e)&&(await r._persistenceManagerAvailable,r._getPersistenceType()==="COOKIE")?r._getPersistence()._getFinalTarget(o).toString():o}class Ub{clearNetworkTimeout(){clearTimeout(this.timer)}constructor(t){this.auth=t,this.timer=null,this.promise=new Promise((e,i)=>{this.timer=setTimeout(()=>i(ue(this.auth,"network-request-failed")),Fb.get())})}}function wr(n,t,e){const i={appName:n.name};e.email&&(i.email=e.email),e.phoneNumber&&(i.phoneNumber=e.phoneNumber);const s=ue(n,t,i);return s.customData._tokenResponse=e,s}async function zb(n,t){return Li(n,"POST","/v1/accounts:delete",t)}async function no(n,t){return Li(n,"POST","/v1/accounts:lookup",t)}function _s(n){if(n)try{const t=new Date(Number(n));if(!isNaN(t.getTime()))return t.toUTCString()}catch{}}async function $b(n,t=!1){const e=Yt(n),i=await e.getIdToken(t),s=ql(i);j(s&&s.exp&&s.auth_time&&s.iat,e.auth,"internal-error");const r=typeof s.firebase=="object"?s.firebase:void 0,o=r?.sign_in_provider;return{claims:s,token:i,authTime:_s(Aa(s.auth_time)),issuedAtTime:_s(Aa(s.iat)),expirationTime:_s(Aa(s.exp)),signInProvider:o||null,signInSecondFactor:r?.sign_in_second_factor||null}}function Aa(n){return Number(n)*1e3}function ql(n){const[t,e,i]=n.split(".");if(t===void 0||e===void 0||i===void 0)return Ur("JWT malformed, contained fewer than 3 sections"),null;try{const s=Kf(e);return s?JSON.parse(s):(Ur("Failed to decode base64 JWT payload"),null)}catch(s){return Ur("Caught error parsing JWT payload as JSON",s?.toString()),null}}function sh(n){const t=ql(n);return j(t,"internal-error"),j(typeof t.exp<"u","internal-error"),j(typeof t.iat<"u","internal-error"),Number(t.exp)-Number(t.iat)}async function ks(n,t,e=!1){if(e)return t;try{return await t}catch(i){throw i instanceof je&&jb(i)&&n.auth.currentUser===n&&await n.auth.signOut(),i}}function jb({code:n}){return n==="auth/user-disabled"||n==="auth/user-token-expired"}class Hb{constructor(t){this.user=t,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,this.timerId!==null&&clearTimeout(this.timerId))}getInterval(t){if(t){const e=this.errorBackoff;return this.errorBackoff=Math.min(this.errorBackoff*2,96e4),e}else{this.errorBackoff=3e4;const i=(this.user.stsTokenManager.expirationTime??0)-Date.now()-3e5;return Math.max(0,i)}}schedule(t=!1){if(!this.isRunning)return;const e=this.getInterval(t);this.timerId=setTimeout(async()=>{await this.iteration()},e)}async iteration(){try{await this.user.getIdToken(!0)}catch(t){t?.code==="auth/network-request-failed"&&this.schedule(!0);return}this.schedule()}}class ll{constructor(t,e){this.createdAt=t,this.lastLoginAt=e,this._initializeTime()}_initializeTime(){this.lastSignInTime=_s(this.lastLoginAt),this.creationTime=_s(this.createdAt)}_copy(t){this.createdAt=t.createdAt,this.lastLoginAt=t.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function io(n){const t=n.auth,e=await n.getIdToken(),i=await ks(n,no(t,{idToken:e}));j(i?.users.length,t,"internal-error");const s=i.users[0];n._notifyReloadListener(s);const r=s.providerUserInfo?.length?hp(s.providerUserInfo):[],o=qb(n.providerData,r),a=n.isAnonymous,l=!(n.email&&s.passwordHash)&&!o?.length,u=a?l:!1,h={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:o,metadata:new ll(s.createdAt,s.lastLoginAt),isAnonymous:u};Object.assign(n,h)}async function Wb(n){const t=Yt(n);await io(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}function qb(n,t){return[...n.filter(i=>!t.some(s=>s.providerId===i.providerId)),...t]}function hp(n){return n.map(({providerId:t,...e})=>({providerId:t,uid:e.rawId||"",displayName:e.displayName||null,email:e.email||null,phoneNumber:e.phoneNumber||null,photoURL:e.photoUrl||null}))}async function Gb(n,t){const e=await cp(n,{},async()=>{const i=Xs({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:s,apiKey:r}=n.config,o=await up(n,s,"/v1/token",`key=${r}`),a=await n._getAdditionalHeaders();a["Content-Type"]="application/x-www-form-urlencoded";const l={method:"POST",headers:a,body:i};return n.emulatorConfig&&Oi(n.emulatorConfig.host)&&(l.credentials="include"),lp.fetch()(o,l)});return{accessToken:e.access_token,expiresIn:e.expires_in,refreshToken:e.refresh_token}}async function Kb(n,t){return Li(n,"POST","/v2/accounts:revokeToken",Wl(n,t))}class pi{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(t){j(t.idToken,"internal-error"),j(typeof t.idToken<"u","internal-error"),j(typeof t.refreshToken<"u","internal-error");const e="expiresIn"in t&&typeof t.expiresIn<"u"?Number(t.expiresIn):sh(t.idToken);this.updateTokensAndExpiration(t.idToken,t.refreshToken,e)}updateFromIdToken(t){j(t.length!==0,"internal-error");const e=sh(t);this.updateTokensAndExpiration(t,null,e)}async getToken(t,e=!1){return!e&&this.accessToken&&!this.isExpired?this.accessToken:(j(this.refreshToken,t,"user-token-expired"),this.refreshToken?(await this.refresh(t,this.refreshToken),this.accessToken):null)}clearRefreshToken(){this.refreshToken=null}async refresh(t,e){const{accessToken:i,refreshToken:s,expiresIn:r}=await Gb(t,e);this.updateTokensAndExpiration(i,s,Number(r))}updateTokensAndExpiration(t,e,i){this.refreshToken=e||null,this.accessToken=t||null,this.expirationTime=Date.now()+i*1e3}static fromJSON(t,e){const{refreshToken:i,accessToken:s,expirationTime:r}=e,o=new pi;return i&&(j(typeof i=="string","internal-error",{appName:t}),o.refreshToken=i),s&&(j(typeof s=="string","internal-error",{appName:t}),o.accessToken=s),r&&(j(typeof r=="number","internal-error",{appName:t}),o.expirationTime=r),o}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(t){this.accessToken=t.accessToken,this.refreshToken=t.refreshToken,this.expirationTime=t.expirationTime}_clone(){return Object.assign(new pi,this.toJSON())}_performRefresh(){return Oe("not implemented")}}function Je(n,t){j(typeof n=="string"||typeof n>"u","internal-error",{appName:t})}class ae{constructor({uid:t,auth:e,stsTokenManager:i,...s}){this.providerId="firebase",this.proactiveRefresh=new Hb(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=e,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new ll(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(t){const e=await ks(this,this.stsTokenManager.getToken(this.auth,t));return j(e,this.auth,"internal-error"),this.accessToken!==e&&(this.accessToken=e,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),e}getIdTokenResult(t){return $b(this,t)}reload(){return Wb(this)}_assign(t){this!==t&&(j(this.uid===t.uid,this.auth,"internal-error"),this.displayName=t.displayName,this.photoURL=t.photoURL,this.email=t.email,this.emailVerified=t.emailVerified,this.phoneNumber=t.phoneNumber,this.isAnonymous=t.isAnonymous,this.tenantId=t.tenantId,this.providerData=t.providerData.map(e=>({...e})),this.metadata._copy(t.metadata),this.stsTokenManager._assign(t.stsTokenManager))}_clone(t){const e=new ae({...this,auth:t,stsTokenManager:this.stsTokenManager._clone()});return e.metadata._copy(this.metadata),e}_onReload(t){j(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=t,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(t){this.reloadListener?this.reloadListener(t):this.reloadUserInfo=t}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(t,e=!1){let i=!1;t.idToken&&t.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(t),i=!0),e&&await io(this),await this.auth._persistUserIfCurrent(this),i&&this.auth._notifyListenersIfCurrent(this)}async delete(){if(oe(this.auth.app))return Promise.reject(zn(this.auth));const t=await this.getIdToken();return await ks(this,zb(this.auth,{idToken:t})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return{uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map(t=>({...t})),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId,...this.metadata.toJSON(),apiKey:this.auth.config.apiKey,appName:this.auth.name}}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(t,e){const i=e.displayName??void 0,s=e.email??void 0,r=e.phoneNumber??void 0,o=e.photoURL??void 0,a=e.tenantId??void 0,l=e._redirectEventId??void 0,u=e.createdAt??void 0,h=e.lastLoginAt??void 0,{uid:d,emailVerified:p,isAnonymous:m,providerData:b,stsTokenManager:v}=e;j(d&&v,t,"internal-error");const E=pi.fromJSON(this.name,v);j(typeof d=="string",t,"internal-error"),Je(i,t.name),Je(s,t.name),j(typeof p=="boolean",t,"internal-error"),j(typeof m=="boolean",t,"internal-error"),Je(r,t.name),Je(o,t.name),Je(a,t.name),Je(l,t.name),Je(u,t.name),Je(h,t.name);const C=new ae({uid:d,auth:t,email:s,emailVerified:p,displayName:i,isAnonymous:m,photoURL:o,phoneNumber:r,tenantId:a,stsTokenManager:E,createdAt:u,lastLoginAt:h});return b&&Array.isArray(b)&&(C.providerData=b.map(P=>({...P}))),l&&(C._redirectEventId=l),C}static async _fromIdTokenResponse(t,e,i=!1){const s=new pi;s.updateFromServerResponse(e);const r=new ae({uid:e.localId,auth:t,stsTokenManager:s,isAnonymous:i});return await io(r),r}static async _fromGetAccountInfoResponse(t,e,i){const s=e.users[0];j(s.localId!==void 0,"internal-error");const r=s.providerUserInfo!==void 0?hp(s.providerUserInfo):[],o=!(s.email&&s.passwordHash)&&!r?.length,a=new pi;a.updateFromIdToken(i);const l=new ae({uid:s.localId,auth:t,stsTokenManager:a,isAnonymous:o}),u={uid:s.localId,displayName:s.displayName||null,photoURL:s.photoUrl||null,email:s.email||null,emailVerified:s.emailVerified||!1,phoneNumber:s.phoneNumber||null,tenantId:s.tenantId||null,providerData:r,metadata:new ll(s.createdAt,s.lastLoginAt),isAnonymous:!(s.email&&s.passwordHash)&&!r?.length};return Object.assign(l,u),l}}const rh=new Map;function Ve(n){Ue(n instanceof Function,"Expected a class definition");let t=rh.get(n);return t?(Ue(t instanceof n,"Instance stored in cache mismatched with class"),t):(t=new n,rh.set(n,t),t)}class dp{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(t,e){this.storage[t]=e}async _get(t){const e=this.storage[t];return e===void 0?null:e}async _remove(t){delete this.storage[t]}_addListener(t,e){}_removeListener(t,e){}}dp.type="NONE";const oh=dp;function zr(n,t,e){return`firebase:${n}:${t}:${e}`}class gi{constructor(t,e,i){this.persistence=t,this.auth=e,this.userKey=i;const{config:s,name:r}=this.auth;this.fullUserKey=zr(this.userKey,s.apiKey,r),this.fullPersistenceKey=zr("persistence",s.apiKey,r),this.boundEventHandler=e._onStorageEvent.bind(e),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(t){return this.persistence._set(this.fullUserKey,t.toJSON())}async getCurrentUser(){const t=await this.persistence._get(this.fullUserKey);if(!t)return null;if(typeof t=="string"){const e=await no(this.auth,{idToken:t}).catch(()=>{});return e?ae._fromGetAccountInfoResponse(this.auth,e,t):null}return ae._fromJSON(this.auth,t)}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(t){if(this.persistence===t)return;const e=await this.getCurrentUser();if(await this.removeCurrentUser(),this.persistence=t,e)return this.setCurrentUser(e)}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(t,e,i="authUser"){if(!e.length)return new gi(Ve(oh),t,i);const s=(await Promise.all(e.map(async u=>{if(await u._isAvailable())return u}))).filter(u=>u);let r=s[0]||Ve(oh);const o=zr(i,t.config.apiKey,t.name);let a=null;for(const u of e)try{const h=await u._get(o);if(h){let d;if(typeof h=="string"){const p=await no(t,{idToken:h}).catch(()=>{});if(!p)break;d=await ae._fromGetAccountInfoResponse(t,p,h)}else d=ae._fromJSON(t,h);u!==r&&(a=d),r=u;break}}catch{}const l=s.filter(u=>u._shouldAllowMigration);return!r._shouldAllowMigration||!l.length?new gi(r,t,i):(r=l[0],a&&await r._set(o,a.toJSON()),await Promise.all(e.map(async u=>{if(u!==r)try{await u._remove(o)}catch{}})),new gi(r,t,i))}}function ah(n){const t=n.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(mp(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(fp(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(_p(t))return"Blackberry";if(bp(t))return"Webos";if(pp(t))return"Safari";if((t.includes("chrome/")||gp(t))&&!t.includes("edge/"))return"Chrome";if(yp(t))return"Android";{const e=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,i=n.match(e);if(i?.length===2)return i[1]}return"Other"}function fp(n=Wt()){return/firefox\//i.test(n)}function pp(n=Wt()){const t=n.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function gp(n=Wt()){return/crios\//i.test(n)}function mp(n=Wt()){return/iemobile/i.test(n)}function yp(n=Wt()){return/android/i.test(n)}function _p(n=Wt()){return/blackberry/i.test(n)}function bp(n=Wt()){return/webos/i.test(n)}function Gl(n=Wt()){return/iphone|ipad|ipod/i.test(n)||/macintosh/i.test(n)&&/mobile/i.test(n)}function Yb(n=Wt()){return Gl(n)&&!!window.navigator?.standalone}function Xb(){return h_()&&document.documentMode===10}function vp(n=Wt()){return Gl(n)||yp(n)||bp(n)||_p(n)||/windows phone/i.test(n)||mp(n)}function wp(n,t=[]){let e;switch(n){case"Browser":e=ah(Wt());break;case"Worker":e=`${ah(Wt())}-${n}`;break;default:e=n}const i=t.length?t.join(","):"FirebaseCore-web";return`${e}/JsCore/${Vi}/${i}`}class Qb{constructor(t){this.auth=t,this.queue=[]}pushCallback(t,e){const i=r=>new Promise((o,a)=>{try{const l=t(r);o(l)}catch(l){a(l)}});i.onAbort=e,this.queue.push(i);const s=this.queue.length-1;return()=>{this.queue[s]=()=>Promise.resolve()}}async runMiddleware(t){if(this.auth.currentUser===t)return;const e=[];try{for(const i of this.queue)await i(t),i.onAbort&&e.push(i.onAbort)}catch(i){e.reverse();for(const s of e)try{s()}catch{}throw this.auth._errorFactory.create("login-blocked",{originalMessage:i?.message})}}}async function Jb(n,t={}){return Li(n,"GET","/v2/passwordPolicy",Wl(n,t))}const Zb=6;class tv{constructor(t){const e=t.customStrengthOptions;this.customStrengthOptions={},this.customStrengthOptions.minPasswordLength=e.minPasswordLength??Zb,e.maxPasswordLength&&(this.customStrengthOptions.maxPasswordLength=e.maxPasswordLength),e.containsLowercaseCharacter!==void 0&&(this.customStrengthOptions.containsLowercaseLetter=e.containsLowercaseCharacter),e.containsUppercaseCharacter!==void 0&&(this.customStrengthOptions.containsUppercaseLetter=e.containsUppercaseCharacter),e.containsNumericCharacter!==void 0&&(this.customStrengthOptions.containsNumericCharacter=e.containsNumericCharacter),e.containsNonAlphanumericCharacter!==void 0&&(this.customStrengthOptions.containsNonAlphanumericCharacter=e.containsNonAlphanumericCharacter),this.enforcementState=t.enforcementState,this.enforcementState==="ENFORCEMENT_STATE_UNSPECIFIED"&&(this.enforcementState="OFF"),this.allowedNonAlphanumericCharacters=t.allowedNonAlphanumericCharacters?.join("")??"",this.forceUpgradeOnSignin=t.forceUpgradeOnSignin??!1,this.schemaVersion=t.schemaVersion}validatePassword(t){const e={isValid:!0,passwordPolicy:this};return this.validatePasswordLengthOptions(t,e),this.validatePasswordCharacterOptions(t,e),e.isValid&&(e.isValid=e.meetsMinPasswordLength??!0),e.isValid&&(e.isValid=e.meetsMaxPasswordLength??!0),e.isValid&&(e.isValid=e.containsLowercaseLetter??!0),e.isValid&&(e.isValid=e.containsUppercaseLetter??!0),e.isValid&&(e.isValid=e.containsNumericCharacter??!0),e.isValid&&(e.isValid=e.containsNonAlphanumericCharacter??!0),e}validatePasswordLengthOptions(t,e){const i=this.customStrengthOptions.minPasswordLength,s=this.customStrengthOptions.maxPasswordLength;i&&(e.meetsMinPasswordLength=t.length>=i),s&&(e.meetsMaxPasswordLength=t.length<=s)}validatePasswordCharacterOptions(t,e){this.updatePasswordCharacterOptionsStatuses(e,!1,!1,!1,!1);let i;for(let s=0;s<t.length;s++)i=t.charAt(s),this.updatePasswordCharacterOptionsStatuses(e,i>="a"&&i<="z",i>="A"&&i<="Z",i>="0"&&i<="9",this.allowedNonAlphanumericCharacters.includes(i))}updatePasswordCharacterOptionsStatuses(t,e,i,s,r){this.customStrengthOptions.containsLowercaseLetter&&(t.containsLowercaseLetter||(t.containsLowercaseLetter=e)),this.customStrengthOptions.containsUppercaseLetter&&(t.containsUppercaseLetter||(t.containsUppercaseLetter=i)),this.customStrengthOptions.containsNumericCharacter&&(t.containsNumericCharacter||(t.containsNumericCharacter=s)),this.customStrengthOptions.containsNonAlphanumericCharacter&&(t.containsNonAlphanumericCharacter||(t.containsNonAlphanumericCharacter=r))}}class ev{constructor(t,e,i,s){this.app=t,this.heartbeatServiceProvider=e,this.appCheckServiceProvider=i,this.config=s,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new lh(this),this.idTokenSubscription=new lh(this),this.beforeStateQueue=new Qb(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION=1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=ap,this._agentRecaptchaConfig=null,this._tenantRecaptchaConfigs={},this._projectPasswordPolicy=null,this._tenantPasswordPolicies={},this._resolvePersistenceManagerAvailable=void 0,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=t.name,this.clientVersion=s.sdkClientVersion,this._persistenceManagerAvailable=new Promise(r=>this._resolvePersistenceManagerAvailable=r)}_initializeWithPersistence(t,e){return e&&(this._popupRedirectResolver=Ve(e)),this._initializationPromise=this.queue(async()=>{if(!this._deleted&&(this.persistenceManager=await gi.create(this,t),this._resolvePersistenceManagerAvailable?.(),!this._deleted)){if(this._popupRedirectResolver?._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch{}await this.initializeCurrentUser(e),this.lastNotifiedUid=this.currentUser?.uid||null,!this._deleted&&(this._isInitialized=!0)}}),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const t=await this.assertedPersistence.getCurrentUser();if(!(!this.currentUser&&!t)){if(this.currentUser&&t&&this.currentUser.uid===t.uid){this._currentUser._assign(t),await this.currentUser.getIdToken();return}await this._updateCurrentUser(t,!0)}}async initializeCurrentUserFromIdToken(t){try{const e=await no(this,{idToken:t}),i=await ae._fromGetAccountInfoResponse(this,e,t);await this.directlySetCurrentUser(i)}catch(e){console.warn("FirebaseServerApp could not login user with provided authIdToken: ",e),await this.directlySetCurrentUser(null)}}async initializeCurrentUser(t){if(oe(this.app)){const r=this.app.settings.authIdToken;return r?new Promise(o=>{setTimeout(()=>this.initializeCurrentUserFromIdToken(r).then(o,o))}):this.directlySetCurrentUser(null)}const e=await this.assertedPersistence.getCurrentUser();let i=e,s=!1;if(t&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const r=this.redirectUser?._redirectEventId,o=i?._redirectEventId,a=await this.tryRedirectSignIn(t);(!r||r===o)&&a?.user&&(i=a.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(r){i=e,this._popupRedirectResolver._overrideRedirectResult(this,()=>Promise.reject(r))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return j(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(t){let e=null;try{e=await this._popupRedirectResolver._completeRedirectFn(this,t,!0)}catch{await this._setRedirectUser(null)}return e}async reloadAndSetCurrentUserOrClear(t){try{await io(t)}catch(e){if(e?.code!=="auth/network-request-failed")return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(t)}useDeviceLanguage(){this.languageCode=Vb()}async _delete(){this._deleted=!0}async updateCurrentUser(t){if(oe(this.app))return Promise.reject(zn(this));const e=t?Yt(t):null;return e&&j(e.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(e&&e._clone(this))}async _updateCurrentUser(t,e=!1){if(!this._deleted)return t&&j(this.tenantId===t.tenantId,this,"tenant-id-mismatch"),e||await this.beforeStateQueue.runMiddleware(t),this.queue(async()=>{await this.directlySetCurrentUser(t),this.notifyAuthListeners()})}async signOut(){return oe(this.app)?Promise.reject(zn(this)):(await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0))}setPersistence(t){return oe(this.app)?Promise.reject(zn(this)):this.queue(async()=>{await this.assertedPersistence.setPersistence(Ve(t))})}_getRecaptchaConfig(){return this.tenantId==null?this._agentRecaptchaConfig:this._tenantRecaptchaConfigs[this.tenantId]}async validatePassword(t){this._getPasswordPolicyInternal()||await this._updatePasswordPolicy();const e=this._getPasswordPolicyInternal();return e.schemaVersion!==this.EXPECTED_PASSWORD_POLICY_SCHEMA_VERSION?Promise.reject(this._errorFactory.create("unsupported-password-policy-schema-version",{})):e.validatePassword(t)}_getPasswordPolicyInternal(){return this.tenantId===null?this._projectPasswordPolicy:this._tenantPasswordPolicies[this.tenantId]}async _updatePasswordPolicy(){const t=await Jb(this),e=new tv(t);this.tenantId===null?this._projectPasswordPolicy=e:this._tenantPasswordPolicies[this.tenantId]=e}_getPersistenceType(){return this.assertedPersistence.persistence.type}_getPersistence(){return this.assertedPersistence.persistence}_updateErrorMap(t){this._errorFactory=new Ys("auth","Firebase",t())}onAuthStateChanged(t,e,i){return this.registerStateListener(this.authStateSubscription,t,e,i)}beforeAuthStateChanged(t,e){return this.beforeStateQueue.pushCallback(t,e)}onIdTokenChanged(t,e,i){return this.registerStateListener(this.idTokenSubscription,t,e,i)}authStateReady(){return new Promise((t,e)=>{if(this.currentUser)t();else{const i=this.onAuthStateChanged(()=>{i(),t()},e)}})}async revokeAccessToken(t){if(this.currentUser){const e=await this.currentUser.getIdToken(),i={providerId:"apple.com",tokenType:"ACCESS_TOKEN",token:t,idToken:e};this.tenantId!=null&&(i.tenantId=this.tenantId),await Kb(this,i)}}toJSON(){return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:this._currentUser?.toJSON()}}async _setRedirectUser(t,e){const i=await this.getOrInitRedirectPersistenceManager(e);return t===null?i.removeCurrentUser():i.setCurrentUser(t)}async getOrInitRedirectPersistenceManager(t){if(!this.redirectPersistenceManager){const e=t&&Ve(t)||this._popupRedirectResolver;j(e,this,"argument-error"),this.redirectPersistenceManager=await gi.create(this,[Ve(e._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(t){return this._isInitialized&&await this.queue(async()=>{}),this._currentUser?._redirectEventId===t?this._currentUser:this.redirectUser?._redirectEventId===t?this.redirectUser:null}async _persistUserIfCurrent(t){if(t===this.currentUser)return this.queue(async()=>this.directlySetCurrentUser(t))}_notifyListenersIfCurrent(t){t===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const t=this.currentUser?.uid??null;this.lastNotifiedUid!==t&&(this.lastNotifiedUid=t,this.authStateSubscription.next(this.currentUser))}registerStateListener(t,e,i,s){if(this._deleted)return()=>{};const r=typeof e=="function"?e:e.next.bind(e);let o=!1;const a=this._isInitialized?Promise.resolve():this._initializationPromise;if(j(a,this,"internal-error"),a.then(()=>{o||r(this.currentUser)}),typeof e=="function"){const l=t.addObserver(e,i,s);return()=>{o=!0,l()}}else{const l=t.addObserver(e);return()=>{o=!0,l()}}}async directlySetCurrentUser(t){this.currentUser&&this.currentUser!==t&&this._currentUser._stopProactiveRefresh(),t&&this.isProactiveRefreshEnabled&&t._startProactiveRefresh(),this.currentUser=t,t?await this.assertedPersistence.setCurrentUser(t):await this.assertedPersistence.removeCurrentUser()}queue(t){return this.operations=this.operations.then(t,t),this.operations}get assertedPersistence(){return j(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(t){!t||this.frameworks.includes(t)||(this.frameworks.push(t),this.frameworks.sort(),this.clientVersion=wp(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const e=await this.heartbeatServiceProvider.getImmediate({optional:!0})?.getHeartbeatsHeader();e&&(t["X-Firebase-Client"]=e);const i=await this._getAppCheckToken();return i&&(t["X-Firebase-AppCheck"]=i),t}async _getAppCheckToken(){if(oe(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const t=await this.appCheckServiceProvider.getImmediate({optional:!0})?.getToken();return t?.error&&kb(`Error while retrieving App Check token: ${t.error}`),t?.token}}function Po(n){return Yt(n)}class lh{constructor(t){this.auth=t,this.observer=null,this.addObserver=b_(e=>this.observer=e)}get next(){return j(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}let Kl={async loadJS(){throw new Error("Unable to load external scripts")},recaptchaV2Script:"",recaptchaEnterpriseScript:"",gapiScript:""};function nv(n){Kl=n}function iv(n){return Kl.loadJS(n)}function sv(){return Kl.gapiScript}function rv(n){return`__${n}${Math.floor(Math.random()*1e6)}`}function ov(n,t){const e=zl(n,"auth");if(e.isInitialized()){const s=e.getImmediate(),r=e.getOptions();if(qn(r,t??{}))return s;xe(s,"already-initialized")}return e.initialize({options:t})}function av(n,t){const e=t?.persistence||[],i=(Array.isArray(e)?e:[e]).map(Ve);t?.errorMap&&n._updateErrorMap(t.errorMap),n._initializeWithPersistence(i,t?.popupRedirectResolver)}function lv(n,t,e){const i=Po(n);j(/^https?:\/\//.test(t),i,"invalid-emulator-scheme");const s=!1,r=Ep(t),{host:o,port:a}=cv(t),l=a===null?"":`:${a}`,u={url:`${r}//${o}${l}/`},h=Object.freeze({host:o,port:a,protocol:r.replace(":",""),options:Object.freeze({disableWarnings:s})});if(!i._canInitEmulator){j(i.config.emulator&&i.emulatorConfig,i,"emulator-config-failed"),j(qn(u,i.config.emulator)&&qn(h,i.emulatorConfig),i,"emulator-config-failed");return}i.config.emulator=u,i.emulatorConfig=h,i.settings.appVerificationDisabledForTesting=!0,Oi(o)?(Jf(`${r}//${o}${l}`),Zf("Auth",!0)):uv()}function Ep(n){const t=n.indexOf(":");return t<0?"":n.substr(0,t+1)}function cv(n){const t=Ep(n),e=/(\/\/)?([^?#/]+)/.exec(n.substr(t.length));if(!e)return{host:"",port:null};const i=e[2].split("@").pop()||"",s=/^(\[[^\]]+\])(:|$)/.exec(i);if(s){const r=s[1];return{host:r,port:ch(i.substr(r.length+1))}}else{const[r,o]=i.split(":");return{host:r,port:ch(o)}}}function ch(n){if(!n)return null;const t=Number(n);return isNaN(t)?null:t}function uv(){function n(){const t=document.createElement("p"),e=t.style;t.innerText="Running in emulator mode. Do not use with production credentials.",e.position="fixed",e.width="100%",e.backgroundColor="#ffffff",e.border=".1em solid #000000",e.color="#b50000",e.bottom="0px",e.left="0px",e.margin="0px",e.zIndex="10000",e.textAlign="center",t.classList.add("firebase-emulator-warning"),document.body.appendChild(t)}typeof console<"u"&&typeof console.info=="function"&&console.info("WARNING: You are using the Auth Emulator, which is intended for local testing only.  Do not use with production credentials."),typeof window<"u"&&typeof document<"u"&&(document.readyState==="loading"?window.addEventListener("DOMContentLoaded",n):n())}class Tp{constructor(t,e){this.providerId=t,this.signInMethod=e}toJSON(){return Oe("not implemented")}_getIdTokenResponse(t){return Oe("not implemented")}_linkToIdToken(t,e){return Oe("not implemented")}_getReauthenticationResolver(t){return Oe("not implemented")}}async function mi(n,t){return Bb(n,"POST","/v1/accounts:signInWithIdp",Wl(n,t))}const hv="http://localhost";class Kn extends Tp{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(t){const e=new Kn(t.providerId,t.signInMethod);return t.idToken||t.accessToken?(t.idToken&&(e.idToken=t.idToken),t.accessToken&&(e.accessToken=t.accessToken),t.nonce&&!t.pendingToken&&(e.nonce=t.nonce),t.pendingToken&&(e.pendingToken=t.pendingToken)):t.oauthToken&&t.oauthTokenSecret?(e.accessToken=t.oauthToken,e.secret=t.oauthTokenSecret):xe("argument-error"),e}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(t){const e=typeof t=="string"?JSON.parse(t):t,{providerId:i,signInMethod:s,...r}=e;if(!i||!s)return null;const o=new Kn(i,s);return o.idToken=r.idToken||void 0,o.accessToken=r.accessToken||void 0,o.secret=r.secret,o.nonce=r.nonce,o.pendingToken=r.pendingToken||null,o}_getIdTokenResponse(t){const e=this.buildRequest();return mi(t,e)}_linkToIdToken(t,e){const i=this.buildRequest();return i.idToken=e,mi(t,i)}_getReauthenticationResolver(t){const e=this.buildRequest();return e.autoCreate=!1,mi(t,e)}buildRequest(){const t={requestUri:hv,returnSecureToken:!0};if(this.pendingToken)t.pendingToken=this.pendingToken;else{const e={};this.idToken&&(e.id_token=this.idToken),this.accessToken&&(e.access_token=this.accessToken),this.secret&&(e.oauth_token_secret=this.secret),e.providerId=this.providerId,this.nonce&&!this.pendingToken&&(e.nonce=this.nonce),t.postBody=Xs(e)}return t}}class Yl{constructor(t){this.providerId=t,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(t){this.defaultLanguageCode=t}setCustomParameters(t){return this.customParameters=t,this}getCustomParameters(){return this.customParameters}}class Js extends Yl{constructor(){super(...arguments),this.scopes=[]}addScope(t){return this.scopes.includes(t)||this.scopes.push(t),this}getScopes(){return[...this.scopes]}}class en extends Js{constructor(){super("facebook.com")}static credential(t){return Kn._fromParams({providerId:en.PROVIDER_ID,signInMethod:en.FACEBOOK_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return en.credentialFromTaggedObject(t)}static credentialFromError(t){return en.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return en.credential(t.oauthAccessToken)}catch{return null}}}en.FACEBOOK_SIGN_IN_METHOD="facebook.com";en.PROVIDER_ID="facebook.com";class Me extends Js{constructor(){super("google.com"),this.addScope("profile")}static credential(t,e){return Kn._fromParams({providerId:Me.PROVIDER_ID,signInMethod:Me.GOOGLE_SIGN_IN_METHOD,idToken:t,accessToken:e})}static credentialFromResult(t){return Me.credentialFromTaggedObject(t)}static credentialFromError(t){return Me.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthIdToken:e,oauthAccessToken:i}=t;if(!e&&!i)return null;try{return Me.credential(e,i)}catch{return null}}}Me.GOOGLE_SIGN_IN_METHOD="google.com";Me.PROVIDER_ID="google.com";class nn extends Js{constructor(){super("github.com")}static credential(t){return Kn._fromParams({providerId:nn.PROVIDER_ID,signInMethod:nn.GITHUB_SIGN_IN_METHOD,accessToken:t})}static credentialFromResult(t){return nn.credentialFromTaggedObject(t)}static credentialFromError(t){return nn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t||!("oauthAccessToken"in t)||!t.oauthAccessToken)return null;try{return nn.credential(t.oauthAccessToken)}catch{return null}}}nn.GITHUB_SIGN_IN_METHOD="github.com";nn.PROVIDER_ID="github.com";class sn extends Js{constructor(){super("twitter.com")}static credential(t,e){return Kn._fromParams({providerId:sn.PROVIDER_ID,signInMethod:sn.TWITTER_SIGN_IN_METHOD,oauthToken:t,oauthTokenSecret:e})}static credentialFromResult(t){return sn.credentialFromTaggedObject(t)}static credentialFromError(t){return sn.credentialFromTaggedObject(t.customData||{})}static credentialFromTaggedObject({_tokenResponse:t}){if(!t)return null;const{oauthAccessToken:e,oauthTokenSecret:i}=t;if(!e||!i)return null;try{return sn.credential(e,i)}catch{return null}}}sn.TWITTER_SIGN_IN_METHOD="twitter.com";sn.PROVIDER_ID="twitter.com";class Ti{constructor(t){this.user=t.user,this.providerId=t.providerId,this._tokenResponse=t._tokenResponse,this.operationType=t.operationType}static async _fromIdTokenResponse(t,e,i,s=!1){const r=await ae._fromIdTokenResponse(t,i,s),o=uh(i);return new Ti({user:r,providerId:o,_tokenResponse:i,operationType:e})}static async _forOperation(t,e,i){await t._updateTokensIfNecessary(i,!0);const s=uh(i);return new Ti({user:t,providerId:s,_tokenResponse:i,operationType:e})}}function uh(n){return n.providerId?n.providerId:"phoneNumber"in n?"phone":null}class so extends je{constructor(t,e,i,s){super(e.code,e.message),this.operationType=i,this.user=s,Object.setPrototypeOf(this,so.prototype),this.customData={appName:t.name,tenantId:t.tenantId??void 0,_serverResponse:e.customData._serverResponse,operationType:i}}static _fromErrorAndOperation(t,e,i,s){return new so(t,e,i,s)}}function xp(n,t,e,i){return(t==="reauthenticate"?e._getReauthenticationResolver(n):e._getIdTokenResponse(n)).catch(r=>{throw r.code==="auth/multi-factor-auth-required"?so._fromErrorAndOperation(n,r,t,i):r})}async function dv(n,t,e=!1){const i=await ks(n,t._linkToIdToken(n.auth,await n.getIdToken()),e);return Ti._forOperation(n,"link",i)}async function fv(n,t,e=!1){const{auth:i}=n;if(oe(i.app))return Promise.reject(zn(i));const s="reauthenticate";try{const r=await ks(n,xp(i,s,t,n),e);j(r.idToken,i,"internal-error");const o=ql(r.idToken);j(o,i,"internal-error");const{sub:a}=o;return j(n.uid===a,i,"user-mismatch"),Ti._forOperation(n,s,r)}catch(r){throw r?.code==="auth/user-not-found"&&xe(i,"user-mismatch"),r}}async function pv(n,t,e=!1){if(oe(n.app))return Promise.reject(zn(n));const i="signIn",s=await xp(n,i,t),r=await Ti._fromIdTokenResponse(n,i,s);return e||await n._updateCurrentUser(r.user),r}function gv(n,t,e,i){return Yt(n).onIdTokenChanged(t,e,i)}function mv(n,t,e){return Yt(n).beforeAuthStateChanged(t,e)}function yv(n,t,e,i){return Yt(n).onAuthStateChanged(t,e,i)}function _v(n){return Yt(n).signOut()}const ro="__sak";class Ip{constructor(t,e){this.storageRetriever=t,this.type=e}_isAvailable(){try{return this.storage?(this.storage.setItem(ro,"1"),this.storage.removeItem(ro),Promise.resolve(!0)):Promise.resolve(!1)}catch{return Promise.resolve(!1)}}_set(t,e){return this.storage.setItem(t,JSON.stringify(e)),Promise.resolve()}_get(t){const e=this.storage.getItem(t);return Promise.resolve(e?JSON.parse(e):null)}_remove(t){return this.storage.removeItem(t),Promise.resolve()}get storage(){return this.storageRetriever()}}const bv=1e3,vv=10;class Ap extends Ip{constructor(){super(()=>window.localStorage,"LOCAL"),this.boundEventHandler=(t,e)=>this.onStorageEvent(t,e),this.listeners={},this.localCache={},this.pollTimer=null,this.fallbackToPolling=vp(),this._shouldAllowMigration=!0}forAllChangedKeys(t){for(const e of Object.keys(this.listeners)){const i=this.storage.getItem(e),s=this.localCache[e];i!==s&&t(e,s,i)}}onStorageEvent(t,e=!1){if(!t.key){this.forAllChangedKeys((o,a,l)=>{this.notifyListeners(o,l)});return}const i=t.key;e?this.detachListener():this.stopPolling();const s=()=>{const o=this.storage.getItem(i);!e&&this.localCache[i]===o||this.notifyListeners(i,o)},r=this.storage.getItem(i);Xb()&&r!==t.newValue&&t.newValue!==t.oldValue?setTimeout(s,vv):s()}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(e&&JSON.parse(e))}startPolling(){this.stopPolling(),this.pollTimer=setInterval(()=>{this.forAllChangedKeys((t,e,i)=>{this.onStorageEvent(new StorageEvent("storage",{key:t,oldValue:e,newValue:i}),!0)})},bv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(t,e){Object.keys(this.listeners).length===0&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[t]||(this.listeners[t]=new Set,this.localCache[t]=this.storage.getItem(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&(this.detachListener(),this.stopPolling())}async _set(t,e){await super._set(t,e),this.localCache[t]=JSON.stringify(e)}async _get(t){const e=await super._get(t);return this.localCache[t]=JSON.stringify(e),e}async _remove(t){await super._remove(t),delete this.localCache[t]}}Ap.type="LOCAL";const wv=Ap;class Sp extends Ip{constructor(){super(()=>window.sessionStorage,"SESSION")}_addListener(t,e){}_removeListener(t,e){}}Sp.type="SESSION";const Cp=Sp;function Ev(n){return Promise.all(n.map(async t=>{try{return{fulfilled:!0,value:await t}}catch(e){return{fulfilled:!1,reason:e}}}))}class Ro{constructor(t){this.eventTarget=t,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(t){const e=this.receivers.find(s=>s.isListeningto(t));if(e)return e;const i=new Ro(t);return this.receivers.push(i),i}isListeningto(t){return this.eventTarget===t}async handleEvent(t){const e=t,{eventId:i,eventType:s,data:r}=e.data,o=this.handlersMap[s];if(!o?.size)return;e.ports[0].postMessage({status:"ack",eventId:i,eventType:s});const a=Array.from(o).map(async u=>u(e.origin,r)),l=await Ev(a);e.ports[0].postMessage({status:"done",eventId:i,eventType:s,response:l})}_subscribe(t,e){Object.keys(this.handlersMap).length===0&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[t]||(this.handlersMap[t]=new Set),this.handlersMap[t].add(e)}_unsubscribe(t,e){this.handlersMap[t]&&e&&this.handlersMap[t].delete(e),(!e||this.handlersMap[t].size===0)&&delete this.handlersMap[t],Object.keys(this.handlersMap).length===0&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}Ro.receivers=[];function Xl(n="",t=10){let e="";for(let i=0;i<t;i++)e+=Math.floor(Math.random()*10);return n+e}class Tv{constructor(t){this.target=t,this.handlers=new Set}removeMessageHandler(t){t.messageChannel&&(t.messageChannel.port1.removeEventListener("message",t.onMessage),t.messageChannel.port1.close()),this.handlers.delete(t)}async _send(t,e,i=50){const s=typeof MessageChannel<"u"?new MessageChannel:null;if(!s)throw new Error("connection_unavailable");let r,o;return new Promise((a,l)=>{const u=Xl("",20);s.port1.start();const h=setTimeout(()=>{l(new Error("unsupported_event"))},i);o={messageChannel:s,onMessage(d){const p=d;if(p.data.eventId===u)switch(p.data.status){case"ack":clearTimeout(h),r=setTimeout(()=>{l(new Error("timeout"))},3e3);break;case"done":clearTimeout(r),a(p.data.response);break;default:clearTimeout(h),clearTimeout(r),l(new Error("invalid_response"));break}}},this.handlers.add(o),s.port1.addEventListener("message",o.onMessage),this.target.postMessage({eventType:t,eventId:u,data:e},[s.port2])}).finally(()=>{o&&this.removeMessageHandler(o)})}}function ye(){return window}function xv(n){ye().location.href=n}function Pp(){return typeof ye().WorkerGlobalScope<"u"&&typeof ye().importScripts=="function"}async function Iv(){if(!navigator?.serviceWorker)return null;try{return(await navigator.serviceWorker.ready).active}catch{return null}}function Av(){return navigator?.serviceWorker?.controller||null}function Sv(){return Pp()?self:null}const Rp="firebaseLocalStorageDb",Cv=1,oo="firebaseLocalStorage",kp="fbase_key";class Zs{constructor(t){this.request=t}toPromise(){return new Promise((t,e)=>{this.request.addEventListener("success",()=>{t(this.request.result)}),this.request.addEventListener("error",()=>{e(this.request.error)})})}}function ko(n,t){return n.transaction([oo],t?"readwrite":"readonly").objectStore(oo)}function Pv(){const n=indexedDB.deleteDatabase(Rp);return new Zs(n).toPromise()}function cl(){const n=indexedDB.open(Rp,Cv);return new Promise((t,e)=>{n.addEventListener("error",()=>{e(n.error)}),n.addEventListener("upgradeneeded",()=>{const i=n.result;try{i.createObjectStore(oo,{keyPath:kp})}catch(s){e(s)}}),n.addEventListener("success",async()=>{const i=n.result;i.objectStoreNames.contains(oo)?t(i):(i.close(),await Pv(),t(await cl()))})})}async function hh(n,t,e){const i=ko(n,!0).put({[kp]:t,value:e});return new Zs(i).toPromise()}async function Rv(n,t){const e=ko(n,!1).get(t),i=await new Zs(e).toPromise();return i===void 0?null:i.value}function dh(n,t){const e=ko(n,!0).delete(t);return new Zs(e).toPromise()}const kv=800,Dv=3;class Dp{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then(()=>{},()=>{})}async _openDb(){return this.db?this.db:(this.db=await cl(),this.db)}async _withRetries(t){let e=0;for(;;)try{const i=await this._openDb();return await t(i)}catch(i){if(e++>Dv)throw i;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return Pp()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Ro._getInstance(Sv()),this.receiver._subscribe("keyChanged",async(t,e)=>({keyProcessed:(await this._poll()).includes(e.key)})),this.receiver._subscribe("ping",async(t,e)=>["keyChanged"])}async initializeSender(){if(this.activeServiceWorker=await Iv(),!this.activeServiceWorker)return;this.sender=new Tv(this.activeServiceWorker);const t=await this.sender._send("ping",{},800);t&&t[0]?.fulfilled&&t[0]?.value.includes("keyChanged")&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(t){if(!(!this.sender||!this.activeServiceWorker||Av()!==this.activeServiceWorker))try{await this.sender._send("keyChanged",{key:t},this.serviceWorkerReceiverAvailable?800:50)}catch{}}async _isAvailable(){try{if(!indexedDB)return!1;const t=await cl();return await hh(t,ro,"1"),await dh(t,ro),!0}catch{}return!1}async _withPendingWrite(t){this.pendingWrites++;try{await t()}finally{this.pendingWrites--}}async _set(t,e){return this._withPendingWrite(async()=>(await this._withRetries(i=>hh(i,t,e)),this.localCache[t]=e,this.notifyServiceWorker(t)))}async _get(t){const e=await this._withRetries(i=>Rv(i,t));return this.localCache[t]=e,e}async _remove(t){return this._withPendingWrite(async()=>(await this._withRetries(e=>dh(e,t)),delete this.localCache[t],this.notifyServiceWorker(t)))}async _poll(){const t=await this._withRetries(s=>{const r=ko(s,!1).getAll();return new Zs(r).toPromise()});if(!t)return[];if(this.pendingWrites!==0)return[];const e=[],i=new Set;if(t.length!==0)for(const{fbase_key:s,value:r}of t)i.add(s),JSON.stringify(this.localCache[s])!==JSON.stringify(r)&&(this.notifyListeners(s,r),e.push(s));for(const s of Object.keys(this.localCache))this.localCache[s]&&!i.has(s)&&(this.notifyListeners(s,null),e.push(s));return e}notifyListeners(t,e){this.localCache[t]=e;const i=this.listeners[t];if(i)for(const s of Array.from(i))s(e)}startPolling(){this.stopPolling(),this.pollTimer=setInterval(async()=>this._poll(),kv)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(t,e){Object.keys(this.listeners).length===0&&this.startPolling(),this.listeners[t]||(this.listeners[t]=new Set,this._get(t)),this.listeners[t].add(e)}_removeListener(t,e){this.listeners[t]&&(this.listeners[t].delete(e),this.listeners[t].size===0&&delete this.listeners[t]),Object.keys(this.listeners).length===0&&this.stopPolling()}}Dp.type="LOCAL";const Mv=Dp;new Qs(3e4,6e4);function Mp(n,t){return t?Ve(t):(j(n._popupRedirectResolver,n,"argument-error"),n._popupRedirectResolver)}class Ql extends Tp{constructor(t){super("custom","custom"),this.params=t}_getIdTokenResponse(t){return mi(t,this._buildIdpRequest())}_linkToIdToken(t,e){return mi(t,this._buildIdpRequest(e))}_getReauthenticationResolver(t){return mi(t,this._buildIdpRequest())}_buildIdpRequest(t){const e={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return t&&(e.idToken=t),e}}function Ov(n){return pv(n.auth,new Ql(n),n.bypassAuthState)}function Vv(n){const{auth:t,user:e}=n;return j(e,t,"internal-error"),fv(e,new Ql(n),n.bypassAuthState)}async function Lv(n){const{auth:t,user:e}=n;return j(e,t,"internal-error"),dv(e,new Ql(n),n.bypassAuthState)}class Op{constructor(t,e,i,s,r=!1){this.auth=t,this.resolver=i,this.user=s,this.bypassAuthState=r,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(e)?e:[e]}execute(){return new Promise(async(t,e)=>{this.pendingPromise={resolve:t,reject:e};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(i){this.reject(i)}})}async onAuthEvent(t){const{urlResponse:e,sessionId:i,postBody:s,tenantId:r,error:o,type:a}=t;if(o){this.reject(o);return}const l={auth:this.auth,requestUri:e,sessionId:i,tenantId:r||void 0,postBody:s||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(a)(l))}catch(u){this.reject(u)}}onError(t){this.reject(t)}getIdpTask(t){switch(t){case"signInViaPopup":case"signInViaRedirect":return Ov;case"linkViaPopup":case"linkViaRedirect":return Lv;case"reauthViaPopup":case"reauthViaRedirect":return Vv;default:xe(this.auth,"internal-error")}}resolve(t){Ue(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(t),this.unregisterAndCleanUp()}reject(t){Ue(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(t),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const Nv=new Qs(2e3,1e4);async function Fv(n,t,e){if(oe(n.app))return Promise.reject(ue(n,"operation-not-supported-in-this-environment"));const i=Po(n);Db(n,t,Yl);const s=Mp(i,e);return new Bn(i,"signInViaPopup",t,s).executeNotNull()}class Bn extends Op{constructor(t,e,i,s,r){super(t,e,s,r),this.provider=i,this.authWindow=null,this.pollId=null,Bn.currentPopupAction&&Bn.currentPopupAction.cancel(),Bn.currentPopupAction=this}async executeNotNull(){const t=await this.execute();return j(t,this.auth,"internal-error"),t}async onExecution(){Ue(this.filter.length===1,"Popup operations only handle one event");const t=Xl();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],t),this.authWindow.associatedEvent=t,this.resolver._originValidation(this.auth).catch(e=>{this.reject(e)}),this.resolver._isIframeWebStorageSupported(this.auth,e=>{e||this.reject(ue(this.auth,"web-storage-unsupported"))}),this.pollUserCancellation()}get eventId(){return this.authWindow?.associatedEvent||null}cancel(){this.reject(ue(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,Bn.currentPopupAction=null}pollUserCancellation(){const t=()=>{if(this.authWindow?.window?.closed){this.pollId=window.setTimeout(()=>{this.pollId=null,this.reject(ue(this.auth,"popup-closed-by-user"))},8e3);return}this.pollId=window.setTimeout(t,Nv.get())};t()}}Bn.currentPopupAction=null;const Bv="pendingRedirect",$r=new Map;class Uv extends Op{constructor(t,e,i=!1){super(t,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],e,void 0,i),this.eventId=null}async execute(){let t=$r.get(this.auth._key());if(!t){try{const i=await zv(this.resolver,this.auth)?await super.execute():null;t=()=>Promise.resolve(i)}catch(e){t=()=>Promise.reject(e)}$r.set(this.auth._key(),t)}return this.bypassAuthState||$r.set(this.auth._key(),()=>Promise.resolve(null)),t()}async onAuthEvent(t){if(t.type==="signInViaRedirect")return super.onAuthEvent(t);if(t.type==="unknown"){this.resolve(null);return}if(t.eventId){const e=await this.auth._redirectUserForId(t.eventId);if(e)return this.user=e,super.onAuthEvent(t);this.resolve(null)}}async onExecution(){}cleanUp(){}}async function zv(n,t){const e=Hv(t),i=jv(n);if(!await i._isAvailable())return!1;const s=await i._get(e)==="true";return await i._remove(e),s}function $v(n,t){$r.set(n._key(),t)}function jv(n){return Ve(n._redirectPersistence)}function Hv(n){return zr(Bv,n.config.apiKey,n.name)}async function Wv(n,t,e=!1){if(oe(n.app))return Promise.reject(zn(n));const i=Po(n),s=Mp(i,t),o=await new Uv(i,s,e).execute();return o&&!e&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}const qv=600*1e3;class Gv{constructor(t){this.auth=t,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(t){this.consumers.add(t),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,t)&&(this.sendToConsumer(this.queuedRedirectEvent,t),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(t){this.consumers.delete(t)}onEvent(t){if(this.hasEventBeenHandled(t))return!1;let e=!1;return this.consumers.forEach(i=>{this.isEventForConsumer(t,i)&&(e=!0,this.sendToConsumer(t,i),this.saveEventToCache(t))}),this.hasHandledPotentialRedirect||!Kv(t)||(this.hasHandledPotentialRedirect=!0,e||(this.queuedRedirectEvent=t,e=!0)),e}sendToConsumer(t,e){if(t.error&&!Vp(t)){const i=t.error.code?.split("auth/")[1]||"internal-error";e.onError(ue(this.auth,i))}else e.onAuthEvent(t)}isEventForConsumer(t,e){const i=e.eventId===null||!!t.eventId&&t.eventId===e.eventId;return e.filter.includes(t.type)&&i}hasEventBeenHandled(t){return Date.now()-this.lastProcessedEventTime>=qv&&this.cachedEventUids.clear(),this.cachedEventUids.has(fh(t))}saveEventToCache(t){this.cachedEventUids.add(fh(t)),this.lastProcessedEventTime=Date.now()}}function fh(n){return[n.type,n.eventId,n.sessionId,n.tenantId].filter(t=>t).join("-")}function Vp({type:n,error:t}){return n==="unknown"&&t?.code==="auth/no-auth-event"}function Kv(n){switch(n.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return Vp(n);default:return!1}}async function Yv(n,t={}){return Li(n,"GET","/v1/projects",t)}const Xv=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,Qv=/^https?/;async function Jv(n){if(n.config.emulator)return;const{authorizedDomains:t}=await Yv(n);for(const e of t)try{if(Zv(e))return}catch{}xe(n,"unauthorized-domain")}function Zv(n){const t=al(),{protocol:e,hostname:i}=new URL(t);if(n.startsWith("chrome-extension://")){const o=new URL(n);return o.hostname===""&&i===""?e==="chrome-extension:"&&n.replace("chrome-extension://","")===t.replace("chrome-extension://",""):e==="chrome-extension:"&&o.hostname===i}if(!Qv.test(e))return!1;if(Xv.test(n))return i===n;const s=n.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const t0=new Qs(3e4,6e4);function ph(){const n=ye().___jsl;if(n?.H){for(const t of Object.keys(n.H))if(n.H[t].r=n.H[t].r||[],n.H[t].L=n.H[t].L||[],n.H[t].r=[...n.H[t].L],n.CP)for(let e=0;e<n.CP.length;e++)n.CP[e]=null}}function e0(n){return new Promise((t,e)=>{function i(){ph(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ph(),e(ue(n,"network-request-failed"))},timeout:t0.get()})}if(ye().gapi?.iframes?.Iframe)t(gapi.iframes.getContext());else if(ye().gapi?.load)i();else{const s=rv("iframefcb");return ye()[s]=()=>{gapi.load?i():e(ue(n,"network-request-failed"))},iv(`${sv()}?onload=${s}`).catch(r=>e(r))}}).catch(t=>{throw jr=null,t})}let jr=null;function n0(n){return jr=jr||e0(n),jr}const i0=new Qs(5e3,15e3),s0="__/auth/iframe",r0="emulator/auth/iframe",o0={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},a0=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function l0(n){const t=n.config;j(t.authDomain,n,"auth-domain-config-required");const e=t.emulator?Hl(t,r0):`https://${n.config.authDomain}/${s0}`,i={apiKey:t.apiKey,appName:n.name,v:Vi},s=a0.get(n.config.apiHost);s&&(i.eid=s);const r=n._getFrameworks();return r.length&&(i.fw=r.join(",")),`${e}?${Xs(i).slice(1)}`}async function c0(n){const t=await n0(n),e=ye().gapi;return j(e,n,"internal-error"),t.open({where:document.body,url:l0(n),messageHandlersFilter:e.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:o0,dontclear:!0},i=>new Promise(async(s,r)=>{await i.restyle({setHideOnLeave:!1});const o=ue(n,"network-request-failed"),a=ye().setTimeout(()=>{r(o)},i0.get());function l(){ye().clearTimeout(a),s(i)}i.ping(l).then(l,()=>{r(o)})}))}const u0={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},h0=500,d0=600,f0="_blank",p0="http://localhost";class gh{constructor(t){this.window=t,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch{}}}function g0(n,t,e,i=h0,s=d0){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const l={...u0,width:i.toString(),height:s.toString(),top:r,left:o},u=Wt().toLowerCase();e&&(a=gp(u)?f0:e),fp(u)&&(t=t||p0,l.scrollbars="yes");const h=Object.entries(l).reduce((p,[m,b])=>`${p}${m}=${b},`,"");if(Yb(u)&&a!=="_self")return m0(t||"",a),new gh(null);const d=window.open(t||"",a,h);j(d,n,"popup-blocked");try{d.focus()}catch{}return new gh(d)}function m0(n,t){const e=document.createElement("a");e.href=n,e.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),e.dispatchEvent(i)}const y0="__/auth/handler",_0="emulator/auth/handler",b0=encodeURIComponent("fac");async function mh(n,t,e,i,s,r){j(n.config.authDomain,n,"auth-domain-config-required"),j(n.config.apiKey,n,"invalid-api-key");const o={apiKey:n.config.apiKey,appName:n.name,authType:e,redirectUrl:i,v:Vi,eventId:s};if(t instanceof Yl){t.setDefaultLanguage(n.languageCode),o.providerId=t.providerId||"",__(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[h,d]of Object.entries({}))o[h]=d}if(t instanceof Js){const h=t.getScopes().filter(d=>d!=="");h.length>0&&(o.scopes=h.join(","))}n.tenantId&&(o.tid=n.tenantId);const a=o;for(const h of Object.keys(a))a[h]===void 0&&delete a[h];const l=await n._getAppCheckToken(),u=l?`#${b0}=${encodeURIComponent(l)}`:"";return`${v0(n)}?${Xs(a).slice(1)}${u}`}function v0({config:n}){return n.emulator?Hl(n,_0):`https://${n.authDomain}/${y0}`}const Sa="webStorageSupport";class w0{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Cp,this._completeRedirectFn=Wv,this._overrideRedirectResult=$v}async _openPopup(t,e,i,s){Ue(this.eventManagers[t._key()]?.manager,"_initialize() not called before _openPopup()");const r=await mh(t,e,i,al(),s);return g0(t,r,Xl())}async _openRedirect(t,e,i,s){await this._originValidation(t);const r=await mh(t,e,i,al(),s);return xv(r),new Promise(()=>{})}_initialize(t){const e=t._key();if(this.eventManagers[e]){const{manager:s,promise:r}=this.eventManagers[e];return s?Promise.resolve(s):(Ue(r,"If manager is not set, promise should be"),r)}const i=this.initAndGetManager(t);return this.eventManagers[e]={promise:i},i.catch(()=>{delete this.eventManagers[e]}),i}async initAndGetManager(t){const e=await c0(t),i=new Gv(t);return e.register("authEvent",s=>(j(s?.authEvent,t,"invalid-auth-event"),{status:i.onEvent(s.authEvent)?"ACK":"ERROR"}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[t._key()]={manager:i},this.iframes[t._key()]=e,i}_isIframeWebStorageSupported(t,e){this.iframes[t._key()].send(Sa,{type:Sa},s=>{const r=s?.[0]?.[Sa];r!==void 0&&e(!!r),xe(t,"internal-error")},gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(t){const e=t._key();return this.originValidationPromises[e]||(this.originValidationPromises[e]=Jv(t)),this.originValidationPromises[e]}get _shouldInitProactively(){return vp()||pp()||Gl()}}const E0=w0;var yh="@firebase/auth",_h="1.12.0";class T0{constructor(t){this.auth=t,this.internalListeners=new Map}getUid(){return this.assertAuthConfigured(),this.auth.currentUser?.uid||null}async getToken(t){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(t)}:null}addAuthTokenListener(t){if(this.assertAuthConfigured(),this.internalListeners.has(t))return;const e=this.auth.onIdTokenChanged(i=>{t(i?.stsTokenManager.accessToken||null)});this.internalListeners.set(t,e),this.updateProactiveRefresh()}removeAuthTokenListener(t){this.assertAuthConfigured();const e=this.internalListeners.get(t);e&&(this.internalListeners.delete(t),e(),this.updateProactiveRefresh())}assertAuthConfigured(){j(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}function x0(n){switch(n){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";case"WebExtension":return"web-extension";default:return}}function I0(n){Ei(new Gn("auth",(t,{options:e})=>{const i=t.getProvider("app").getImmediate(),s=t.getProvider("heartbeat"),r=t.getProvider("app-check-internal"),{apiKey:o,authDomain:a}=i.options;j(o&&!o.includes(":"),"invalid-api-key",{appName:i.name});const l={apiKey:o,authDomain:a,clientPlatform:n,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:wp(n)},u=new ev(i,s,r,l);return av(u,e),u},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((t,e,i)=>{t.getProvider("auth-internal").initialize()})),Ei(new Gn("auth-internal",t=>{const e=Po(t.getProvider("auth").getImmediate());return(i=>new T0(i))(e)},"PRIVATE").setInstantiationMode("EXPLICIT")),dn(yh,_h,x0(n)),dn(yh,_h,"esm2020")}const A0=300,S0=Qf("authIdTokenMaxAge")||A0;let bh=null;const C0=n=>async t=>{const e=t&&await t.getIdTokenResult(),i=e&&(new Date().getTime()-Date.parse(e.issuedAtTime))/1e3;if(i&&i>S0)return;const s=e?.token;bh!==s&&(bh=s,await fetch(n,{method:s?"POST":"DELETE",headers:s?{Authorization:`Bearer ${s}`}:{}}))};function P0(n=ip()){const t=zl(n,"auth");if(t.isInitialized())return t.getImmediate();const e=ov(n,{popupRedirectResolver:E0,persistence:[Mv,wv,Cp]}),i=Qf("authTokenSyncURL");if(i&&typeof isSecureContext=="boolean"&&isSecureContext){const r=new URL(i,location.origin);if(location.origin===r.origin){const o=C0(r.toString());mv(e,o,()=>o(e.currentUser)),gv(e,a=>o(a))}}const s=Yf("auth");return s&&lv(e,`http://${s}`),e}function R0(){return document.getElementsByTagName("head")?.[0]??document}nv({loadJS(n){return new Promise((t,e)=>{const i=document.createElement("script");i.setAttribute("src",n),i.onload=t,i.onerror=s=>{const r=ue("internal-error");r.customData=s,e(r)},i.type="text/javascript",i.charset="UTF-8",R0().appendChild(i)})},gapiScript:"https://apis.google.com/js/api.js",recaptchaV2Script:"https://www.google.com/recaptcha/api.js",recaptchaEnterpriseScript:"https://www.google.com/recaptcha/enterprise.js?render="});I0("Browser");var k0="firebase",D0="12.7.0";dn(k0,D0,"app");const M0={apiKey:"AIzaSyDVv71HjjFISxoTssbFWZSM8X4vM-Pl85Y",authDomain:"meus-investimentos-2.firebaseapp.com",projectId:"meus-investimentos-2",storageBucket:"meus-investimentos-2.firebasestorage.app",messagingSenderId:"346586661580",appId:"1:346586661580:web:063ccc9e14ca1602bef869"},Lp=np(M0),Jl=P0(Lp),O0=new Me;async function V0(){try{return(await Fv(Jl,O0)).user}catch(n){throw console.error("Login failed:",n),n}}async function L0(){try{await _v(Jl)}catch(n){console.error("Logout failed:",n)}}function N0(n){return yv(Jl,n)}var vh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var fn,Np;(function(){var n;function t(w,y){function T(){}T.prototype=y.prototype,w.F=y.prototype,w.prototype=new T,w.prototype.constructor=w,w.D=function(A,x,S){for(var I=Array(arguments.length-2),nt=2;nt<arguments.length;nt++)I[nt-2]=arguments[nt];return y.prototype[x].apply(A,I)}}function e(){this.blockSize=-1}function i(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}t(i,e),i.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0};function s(w,y,T){T||(T=0);const A=Array(16);if(typeof y=="string")for(var x=0;x<16;++x)A[x]=y.charCodeAt(T++)|y.charCodeAt(T++)<<8|y.charCodeAt(T++)<<16|y.charCodeAt(T++)<<24;else for(x=0;x<16;++x)A[x]=y[T++]|y[T++]<<8|y[T++]<<16|y[T++]<<24;y=w.g[0],T=w.g[1],x=w.g[2];let S=w.g[3],I;I=y+(S^T&(x^S))+A[0]+3614090360&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(x^y&(T^x))+A[1]+3905402710&4294967295,S=y+(I<<12&4294967295|I>>>20),I=x+(T^S&(y^T))+A[2]+606105819&4294967295,x=S+(I<<17&4294967295|I>>>15),I=T+(y^x&(S^y))+A[3]+3250441966&4294967295,T=x+(I<<22&4294967295|I>>>10),I=y+(S^T&(x^S))+A[4]+4118548399&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(x^y&(T^x))+A[5]+1200080426&4294967295,S=y+(I<<12&4294967295|I>>>20),I=x+(T^S&(y^T))+A[6]+2821735955&4294967295,x=S+(I<<17&4294967295|I>>>15),I=T+(y^x&(S^y))+A[7]+4249261313&4294967295,T=x+(I<<22&4294967295|I>>>10),I=y+(S^T&(x^S))+A[8]+1770035416&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(x^y&(T^x))+A[9]+2336552879&4294967295,S=y+(I<<12&4294967295|I>>>20),I=x+(T^S&(y^T))+A[10]+4294925233&4294967295,x=S+(I<<17&4294967295|I>>>15),I=T+(y^x&(S^y))+A[11]+2304563134&4294967295,T=x+(I<<22&4294967295|I>>>10),I=y+(S^T&(x^S))+A[12]+1804603682&4294967295,y=T+(I<<7&4294967295|I>>>25),I=S+(x^y&(T^x))+A[13]+4254626195&4294967295,S=y+(I<<12&4294967295|I>>>20),I=x+(T^S&(y^T))+A[14]+2792965006&4294967295,x=S+(I<<17&4294967295|I>>>15),I=T+(y^x&(S^y))+A[15]+1236535329&4294967295,T=x+(I<<22&4294967295|I>>>10),I=y+(x^S&(T^x))+A[1]+4129170786&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^x&(y^T))+A[6]+3225465664&4294967295,S=y+(I<<9&4294967295|I>>>23),I=x+(y^T&(S^y))+A[11]+643717713&4294967295,x=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(x^S))+A[0]+3921069994&4294967295,T=x+(I<<20&4294967295|I>>>12),I=y+(x^S&(T^x))+A[5]+3593408605&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^x&(y^T))+A[10]+38016083&4294967295,S=y+(I<<9&4294967295|I>>>23),I=x+(y^T&(S^y))+A[15]+3634488961&4294967295,x=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(x^S))+A[4]+3889429448&4294967295,T=x+(I<<20&4294967295|I>>>12),I=y+(x^S&(T^x))+A[9]+568446438&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^x&(y^T))+A[14]+3275163606&4294967295,S=y+(I<<9&4294967295|I>>>23),I=x+(y^T&(S^y))+A[3]+4107603335&4294967295,x=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(x^S))+A[8]+1163531501&4294967295,T=x+(I<<20&4294967295|I>>>12),I=y+(x^S&(T^x))+A[13]+2850285829&4294967295,y=T+(I<<5&4294967295|I>>>27),I=S+(T^x&(y^T))+A[2]+4243563512&4294967295,S=y+(I<<9&4294967295|I>>>23),I=x+(y^T&(S^y))+A[7]+1735328473&4294967295,x=S+(I<<14&4294967295|I>>>18),I=T+(S^y&(x^S))+A[12]+2368359562&4294967295,T=x+(I<<20&4294967295|I>>>12),I=y+(T^x^S)+A[5]+4294588738&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^x)+A[8]+2272392833&4294967295,S=y+(I<<11&4294967295|I>>>21),I=x+(S^y^T)+A[11]+1839030562&4294967295,x=S+(I<<16&4294967295|I>>>16),I=T+(x^S^y)+A[14]+4259657740&4294967295,T=x+(I<<23&4294967295|I>>>9),I=y+(T^x^S)+A[1]+2763975236&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^x)+A[4]+1272893353&4294967295,S=y+(I<<11&4294967295|I>>>21),I=x+(S^y^T)+A[7]+4139469664&4294967295,x=S+(I<<16&4294967295|I>>>16),I=T+(x^S^y)+A[10]+3200236656&4294967295,T=x+(I<<23&4294967295|I>>>9),I=y+(T^x^S)+A[13]+681279174&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^x)+A[0]+3936430074&4294967295,S=y+(I<<11&4294967295|I>>>21),I=x+(S^y^T)+A[3]+3572445317&4294967295,x=S+(I<<16&4294967295|I>>>16),I=T+(x^S^y)+A[6]+76029189&4294967295,T=x+(I<<23&4294967295|I>>>9),I=y+(T^x^S)+A[9]+3654602809&4294967295,y=T+(I<<4&4294967295|I>>>28),I=S+(y^T^x)+A[12]+3873151461&4294967295,S=y+(I<<11&4294967295|I>>>21),I=x+(S^y^T)+A[15]+530742520&4294967295,x=S+(I<<16&4294967295|I>>>16),I=T+(x^S^y)+A[2]+3299628645&4294967295,T=x+(I<<23&4294967295|I>>>9),I=y+(x^(T|~S))+A[0]+4096336452&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~x))+A[7]+1126891415&4294967295,S=y+(I<<10&4294967295|I>>>22),I=x+(y^(S|~T))+A[14]+2878612391&4294967295,x=S+(I<<15&4294967295|I>>>17),I=T+(S^(x|~y))+A[5]+4237533241&4294967295,T=x+(I<<21&4294967295|I>>>11),I=y+(x^(T|~S))+A[12]+1700485571&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~x))+A[3]+2399980690&4294967295,S=y+(I<<10&4294967295|I>>>22),I=x+(y^(S|~T))+A[10]+4293915773&4294967295,x=S+(I<<15&4294967295|I>>>17),I=T+(S^(x|~y))+A[1]+2240044497&4294967295,T=x+(I<<21&4294967295|I>>>11),I=y+(x^(T|~S))+A[8]+1873313359&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~x))+A[15]+4264355552&4294967295,S=y+(I<<10&4294967295|I>>>22),I=x+(y^(S|~T))+A[6]+2734768916&4294967295,x=S+(I<<15&4294967295|I>>>17),I=T+(S^(x|~y))+A[13]+1309151649&4294967295,T=x+(I<<21&4294967295|I>>>11),I=y+(x^(T|~S))+A[4]+4149444226&4294967295,y=T+(I<<6&4294967295|I>>>26),I=S+(T^(y|~x))+A[11]+3174756917&4294967295,S=y+(I<<10&4294967295|I>>>22),I=x+(y^(S|~T))+A[2]+718787259&4294967295,x=S+(I<<15&4294967295|I>>>17),I=T+(S^(x|~y))+A[9]+3951481745&4294967295,w.g[0]=w.g[0]+y&4294967295,w.g[1]=w.g[1]+(x+(I<<21&4294967295|I>>>11))&4294967295,w.g[2]=w.g[2]+x&4294967295,w.g[3]=w.g[3]+S&4294967295}i.prototype.v=function(w,y){y===void 0&&(y=w.length);const T=y-this.blockSize,A=this.C;let x=this.h,S=0;for(;S<y;){if(x==0)for(;S<=T;)s(this,w,S),S+=this.blockSize;if(typeof w=="string"){for(;S<y;)if(A[x++]=w.charCodeAt(S++),x==this.blockSize){s(this,A),x=0;break}}else for(;S<y;)if(A[x++]=w[S++],x==this.blockSize){s(this,A),x=0;break}}this.h=x,this.o+=y},i.prototype.A=function(){var w=Array((this.h<56?this.blockSize:this.blockSize*2)-this.h);w[0]=128;for(var y=1;y<w.length-8;++y)w[y]=0;y=this.o*8;for(var T=w.length-8;T<w.length;++T)w[T]=y&255,y/=256;for(this.v(w),w=Array(16),y=0,T=0;T<4;++T)for(let A=0;A<32;A+=8)w[y++]=this.g[T]>>>A&255;return w};function r(w,y){var T=a;return Object.prototype.hasOwnProperty.call(T,w)?T[w]:T[w]=y(w)}function o(w,y){this.h=y;const T=[];let A=!0;for(let x=w.length-1;x>=0;x--){const S=w[x]|0;A&&S==y||(T[x]=S,A=!1)}this.g=T}var a={};function l(w){return-128<=w&&w<128?r(w,function(y){return new o([y|0],y<0?-1:0)}):new o([w|0],w<0?-1:0)}function u(w){if(isNaN(w)||!isFinite(w))return d;if(w<0)return E(u(-w));const y=[];let T=1;for(let A=0;w>=T;A++)y[A]=w/T|0,T*=4294967296;return new o(y,0)}function h(w,y){if(w.length==0)throw Error("number format error: empty string");if(y=y||10,y<2||36<y)throw Error("radix out of range: "+y);if(w.charAt(0)=="-")return E(h(w.substring(1),y));if(w.indexOf("-")>=0)throw Error('number format error: interior "-" character');const T=u(Math.pow(y,8));let A=d;for(let S=0;S<w.length;S+=8){var x=Math.min(8,w.length-S);const I=parseInt(w.substring(S,S+x),y);x<8?(x=u(Math.pow(y,x)),A=A.j(x).add(u(I))):(A=A.j(T),A=A.add(u(I)))}return A}var d=l(0),p=l(1),m=l(16777216);n=o.prototype,n.m=function(){if(v(this))return-E(this).m();let w=0,y=1;for(let T=0;T<this.g.length;T++){const A=this.i(T);w+=(A>=0?A:4294967296+A)*y,y*=4294967296}return w},n.toString=function(w){if(w=w||10,w<2||36<w)throw Error("radix out of range: "+w);if(b(this))return"0";if(v(this))return"-"+E(this).toString(w);const y=u(Math.pow(w,6));var T=this;let A="";for(;;){const x=M(T,y).g;T=C(T,x.j(y));let S=((T.g.length>0?T.g[0]:T.h)>>>0).toString(w);if(T=x,b(T))return S+A;for(;S.length<6;)S="0"+S;A=S+A}},n.i=function(w){return w<0?0:w<this.g.length?this.g[w]:this.h};function b(w){if(w.h!=0)return!1;for(let y=0;y<w.g.length;y++)if(w.g[y]!=0)return!1;return!0}function v(w){return w.h==-1}n.l=function(w){return w=C(this,w),v(w)?-1:b(w)?0:1};function E(w){const y=w.g.length,T=[];for(let A=0;A<y;A++)T[A]=~w.g[A];return new o(T,~w.h).add(p)}n.abs=function(){return v(this)?E(this):this},n.add=function(w){const y=Math.max(this.g.length,w.g.length),T=[];let A=0;for(let x=0;x<=y;x++){let S=A+(this.i(x)&65535)+(w.i(x)&65535),I=(S>>>16)+(this.i(x)>>>16)+(w.i(x)>>>16);A=I>>>16,S&=65535,I&=65535,T[x]=I<<16|S}return new o(T,T[T.length-1]&-2147483648?-1:0)};function C(w,y){return w.add(E(y))}n.j=function(w){if(b(this)||b(w))return d;if(v(this))return v(w)?E(this).j(E(w)):E(E(this).j(w));if(v(w))return E(this.j(E(w)));if(this.l(m)<0&&w.l(m)<0)return u(this.m()*w.m());const y=this.g.length+w.g.length,T=[];for(var A=0;A<2*y;A++)T[A]=0;for(A=0;A<this.g.length;A++)for(let x=0;x<w.g.length;x++){const S=this.i(A)>>>16,I=this.i(A)&65535,nt=w.i(x)>>>16,K=w.i(x)&65535;T[2*A+2*x]+=I*K,P(T,2*A+2*x),T[2*A+2*x+1]+=S*K,P(T,2*A+2*x+1),T[2*A+2*x+1]+=I*nt,P(T,2*A+2*x+1),T[2*A+2*x+2]+=S*nt,P(T,2*A+2*x+2)}for(w=0;w<y;w++)T[w]=T[2*w+1]<<16|T[2*w];for(w=y;w<2*y;w++)T[w]=0;return new o(T,0)};function P(w,y){for(;(w[y]&65535)!=w[y];)w[y+1]+=w[y]>>>16,w[y]&=65535,y++}function k(w,y){this.g=w,this.h=y}function M(w,y){if(b(y))throw Error("division by zero");if(b(w))return new k(d,d);if(v(w))return y=M(E(w),y),new k(E(y.g),E(y.h));if(v(y))return y=M(w,E(y)),new k(E(y.g),y.h);if(w.g.length>30){if(v(w)||v(y))throw Error("slowDivide_ only works with positive integers.");for(var T=p,A=y;A.l(w)<=0;)T=O(T),A=O(A);var x=N(T,1),S=N(A,1);for(A=N(A,2),T=N(T,2);!b(A);){var I=S.add(A);I.l(w)<=0&&(x=x.add(T),S=I),A=N(A,1),T=N(T,1)}return y=C(w,x.j(y)),new k(x,y)}for(x=d;w.l(y)>=0;){for(T=Math.max(1,Math.floor(w.m()/y.m())),A=Math.ceil(Math.log(T)/Math.LN2),A=A<=48?1:Math.pow(2,A-48),S=u(T),I=S.j(y);v(I)||I.l(w)>0;)T-=A,S=u(T),I=S.j(y);b(S)&&(S=p),x=x.add(S),w=C(w,I)}return new k(x,w)}n.B=function(w){return M(this,w).h},n.and=function(w){const y=Math.max(this.g.length,w.g.length),T=[];for(let A=0;A<y;A++)T[A]=this.i(A)&w.i(A);return new o(T,this.h&w.h)},n.or=function(w){const y=Math.max(this.g.length,w.g.length),T=[];for(let A=0;A<y;A++)T[A]=this.i(A)|w.i(A);return new o(T,this.h|w.h)},n.xor=function(w){const y=Math.max(this.g.length,w.g.length),T=[];for(let A=0;A<y;A++)T[A]=this.i(A)^w.i(A);return new o(T,this.h^w.h)};function O(w){const y=w.g.length+1,T=[];for(let A=0;A<y;A++)T[A]=w.i(A)<<1|w.i(A-1)>>>31;return new o(T,w.h)}function N(w,y){const T=y>>5;y%=32;const A=w.g.length-T,x=[];for(let S=0;S<A;S++)x[S]=y>0?w.i(S+T)>>>y|w.i(S+T+1)<<32-y:w.i(S+T);return new o(x,w.h)}i.prototype.digest=i.prototype.A,i.prototype.reset=i.prototype.u,i.prototype.update=i.prototype.v,Np=i,o.prototype.add=o.prototype.add,o.prototype.multiply=o.prototype.j,o.prototype.modulo=o.prototype.B,o.prototype.compare=o.prototype.l,o.prototype.toNumber=o.prototype.m,o.prototype.toString=o.prototype.toString,o.prototype.getBits=o.prototype.i,o.fromNumber=u,o.fromString=h,fn=o}).apply(typeof vh<"u"?vh:typeof self<"u"?self:typeof window<"u"?window:{});var Er=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};var Fp,cs,Bp,Hr,ul,Up,zp,$p;(function(){var n,t=Object.defineProperty;function e(c){c=[typeof globalThis=="object"&&globalThis,c,typeof window=="object"&&window,typeof self=="object"&&self,typeof Er=="object"&&Er];for(var f=0;f<c.length;++f){var g=c[f];if(g&&g.Math==Math)return g}throw Error("Cannot find global object")}var i=e(this);function s(c,f){if(f)t:{var g=i;c=c.split(".");for(var _=0;_<c.length-1;_++){var R=c[_];if(!(R in g))break t;g=g[R]}c=c[c.length-1],_=g[c],f=f(_),f!=_&&f!=null&&t(g,c,{configurable:!0,writable:!0,value:f})}}s("Symbol.dispose",function(c){return c||Symbol("Symbol.dispose")}),s("Array.prototype.values",function(c){return c||function(){return this[Symbol.iterator]()}}),s("Object.entries",function(c){return c||function(f){var g=[],_;for(_ in f)Object.prototype.hasOwnProperty.call(f,_)&&g.push([_,f[_]]);return g}});var r=r||{},o=this||self;function a(c){var f=typeof c;return f=="object"&&c!=null||f=="function"}function l(c,f,g){return c.call.apply(c.bind,arguments)}function u(c,f,g){return u=l,u.apply(null,arguments)}function h(c,f){var g=Array.prototype.slice.call(arguments,1);return function(){var _=g.slice();return _.push.apply(_,arguments),c.apply(this,_)}}function d(c,f){function g(){}g.prototype=f.prototype,c.Z=f.prototype,c.prototype=new g,c.prototype.constructor=c,c.Ob=function(_,R,D){for(var F=Array(arguments.length-2),G=2;G<arguments.length;G++)F[G-2]=arguments[G];return f.prototype[R].apply(_,F)}}var p=typeof AsyncContext<"u"&&typeof AsyncContext.Snapshot=="function"?c=>c&&AsyncContext.Snapshot.wrap(c):c=>c;function m(c){const f=c.length;if(f>0){const g=Array(f);for(let _=0;_<f;_++)g[_]=c[_];return g}return[]}function b(c,f){for(let _=1;_<arguments.length;_++){const R=arguments[_];var g=typeof R;if(g=g!="object"?g:R?Array.isArray(R)?"array":g:"null",g=="array"||g=="object"&&typeof R.length=="number"){g=c.length||0;const D=R.length||0;c.length=g+D;for(let F=0;F<D;F++)c[g+F]=R[F]}else c.push(R)}}class v{constructor(f,g){this.i=f,this.j=g,this.h=0,this.g=null}get(){let f;return this.h>0?(this.h--,f=this.g,this.g=f.next,f.next=null):f=this.i(),f}}function E(c){o.setTimeout(()=>{throw c},0)}function C(){var c=w;let f=null;return c.g&&(f=c.g,c.g=c.g.next,c.g||(c.h=null),f.next=null),f}class P{constructor(){this.h=this.g=null}add(f,g){const _=k.get();_.set(f,g),this.h?this.h.next=_:this.g=_,this.h=_}}var k=new v(()=>new M,c=>c.reset());class M{constructor(){this.next=this.g=this.h=null}set(f,g){this.h=f,this.g=g,this.next=null}reset(){this.next=this.g=this.h=null}}let O,N=!1,w=new P,y=()=>{const c=Promise.resolve(void 0);O=()=>{c.then(T)}};function T(){for(var c;c=C();){try{c.h.call(c.g)}catch(g){E(g)}var f=k;f.j(c),f.h<100&&(f.h++,c.next=f.g,f.g=c)}N=!1}function A(){this.u=this.u,this.C=this.C}A.prototype.u=!1,A.prototype.dispose=function(){this.u||(this.u=!0,this.N())},A.prototype[Symbol.dispose]=function(){this.dispose()},A.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()};function x(c,f){this.type=c,this.g=this.target=f,this.defaultPrevented=!1}x.prototype.h=function(){this.defaultPrevented=!0};var S=(function(){if(!o.addEventListener||!Object.defineProperty)return!1;var c=!1,f=Object.defineProperty({},"passive",{get:function(){c=!0}});try{const g=()=>{};o.addEventListener("test",g,f),o.removeEventListener("test",g,f)}catch{}return c})();function I(c){return/^[\s\xa0]*$/.test(c)}function nt(c,f){x.call(this,c?c.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,c&&this.init(c,f)}d(nt,x),nt.prototype.init=function(c,f){const g=this.type=c.type,_=c.changedTouches&&c.changedTouches.length?c.changedTouches[0]:null;this.target=c.target||c.srcElement,this.g=f,f=c.relatedTarget,f||(g=="mouseover"?f=c.fromElement:g=="mouseout"&&(f=c.toElement)),this.relatedTarget=f,_?(this.clientX=_.clientX!==void 0?_.clientX:_.pageX,this.clientY=_.clientY!==void 0?_.clientY:_.pageY,this.screenX=_.screenX||0,this.screenY=_.screenY||0):(this.clientX=c.clientX!==void 0?c.clientX:c.pageX,this.clientY=c.clientY!==void 0?c.clientY:c.pageY,this.screenX=c.screenX||0,this.screenY=c.screenY||0),this.button=c.button,this.key=c.key||"",this.ctrlKey=c.ctrlKey,this.altKey=c.altKey,this.shiftKey=c.shiftKey,this.metaKey=c.metaKey,this.pointerId=c.pointerId||0,this.pointerType=c.pointerType,this.state=c.state,this.i=c,c.defaultPrevented&&nt.Z.h.call(this)},nt.prototype.h=function(){nt.Z.h.call(this);const c=this.i;c.preventDefault?c.preventDefault():c.returnValue=!1};var K="closure_listenable_"+(Math.random()*1e6|0),ot=0;function ut(c,f,g,_,R){this.listener=c,this.proxy=null,this.src=f,this.type=g,this.capture=!!_,this.ha=R,this.key=++ot,this.da=this.fa=!1}function Rt(c){c.da=!0,c.listener=null,c.proxy=null,c.src=null,c.ha=null}function it(c,f,g){for(const _ in c)f.call(g,c[_],_,c)}function Et(c,f){for(const g in c)f.call(void 0,c[g],g,c)}function yt(c){const f={};for(const g in c)f[g]=c[g];return f}const Ae="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function We(c,f){let g,_;for(let R=1;R<arguments.length;R++){_=arguments[R];for(g in _)c[g]=_[g];for(let D=0;D<Ae.length;D++)g=Ae[D],Object.prototype.hasOwnProperty.call(_,g)&&(c[g]=_[g])}}function ee(c){this.src=c,this.g={},this.h=0}ee.prototype.add=function(c,f,g,_,R){const D=c.toString();c=this.g[D],c||(c=this.g[D]=[],this.h++);const F=re(c,f,_,R);return F>-1?(f=c[F],g||(f.fa=!1)):(f=new ut(f,this.src,D,!!_,R),f.fa=g,c.push(f)),f};function Se(c,f){const g=f.type;if(g in c.g){var _=c.g[g],R=Array.prototype.indexOf.call(_,f,void 0),D;(D=R>=0)&&Array.prototype.splice.call(_,R,1),D&&(Rt(f),c.g[g].length==0&&(delete c.g[g],c.h--))}}function re(c,f,g,_){for(let R=0;R<c.length;++R){const D=c[R];if(!D.da&&D.listener==f&&D.capture==!!g&&D.ha==_)return R}return-1}var Zo="closure_lm_"+(Math.random()*1e6|0),ta={};function Kc(c,f,g,_,R){if(Array.isArray(f)){for(let D=0;D<f.length;D++)Kc(c,f[D],g,_,R);return null}return g=Qc(g),c&&c[K]?c.J(f,g,a(_)?!!_.capture:!1,R):_y(c,f,g,!1,_,R)}function _y(c,f,g,_,R,D){if(!f)throw Error("Invalid event type");const F=a(R)?!!R.capture:!!R;let G=na(c);if(G||(c[Zo]=G=new ee(c)),g=G.add(f,g,_,F,D),g.proxy)return g;if(_=by(),g.proxy=_,_.src=c,_.listener=g,c.addEventListener)S||(R=F),R===void 0&&(R=!1),c.addEventListener(f.toString(),_,R);else if(c.attachEvent)c.attachEvent(Xc(f.toString()),_);else if(c.addListener&&c.removeListener)c.addListener(_);else throw Error("addEventListener and attachEvent are unavailable.");return g}function by(){function c(g){return f.call(c.src,c.listener,g)}const f=vy;return c}function Yc(c,f,g,_,R){if(Array.isArray(f))for(var D=0;D<f.length;D++)Yc(c,f[D],g,_,R);else _=a(_)?!!_.capture:!!_,g=Qc(g),c&&c[K]?(c=c.i,D=String(f).toString(),D in c.g&&(f=c.g[D],g=re(f,g,_,R),g>-1&&(Rt(f[g]),Array.prototype.splice.call(f,g,1),f.length==0&&(delete c.g[D],c.h--)))):c&&(c=na(c))&&(f=c.g[f.toString()],c=-1,f&&(c=re(f,g,_,R)),(g=c>-1?f[c]:null)&&ea(g))}function ea(c){if(typeof c!="number"&&c&&!c.da){var f=c.src;if(f&&f[K])Se(f.i,c);else{var g=c.type,_=c.proxy;f.removeEventListener?f.removeEventListener(g,_,c.capture):f.detachEvent?f.detachEvent(Xc(g),_):f.addListener&&f.removeListener&&f.removeListener(_),(g=na(f))?(Se(g,c),g.h==0&&(g.src=null,f[Zo]=null)):Rt(c)}}}function Xc(c){return c in ta?ta[c]:ta[c]="on"+c}function vy(c,f){if(c.da)c=!0;else{f=new nt(f,this);const g=c.listener,_=c.ha||c.src;c.fa&&ea(c),c=g.call(_,f)}return c}function na(c){return c=c[Zo],c instanceof ee?c:null}var ia="__closure_events_fn_"+(Math.random()*1e9>>>0);function Qc(c){return typeof c=="function"?c:(c[ia]||(c[ia]=function(f){return c.handleEvent(f)}),c[ia])}function Nt(){A.call(this),this.i=new ee(this),this.M=this,this.G=null}d(Nt,A),Nt.prototype[K]=!0,Nt.prototype.removeEventListener=function(c,f,g,_){Yc(this,c,f,g,_)};function Gt(c,f){var g,_=c.G;if(_)for(g=[];_;_=_.G)g.push(_);if(c=c.M,_=f.type||f,typeof f=="string")f=new x(f,c);else if(f instanceof x)f.target=f.target||c;else{var R=f;f=new x(_,c),We(f,R)}R=!0;let D,F;if(g)for(F=g.length-1;F>=0;F--)D=f.g=g[F],R=cr(D,_,!0,f)&&R;if(D=f.g=c,R=cr(D,_,!0,f)&&R,R=cr(D,_,!1,f)&&R,g)for(F=0;F<g.length;F++)D=f.g=g[F],R=cr(D,_,!1,f)&&R}Nt.prototype.N=function(){if(Nt.Z.N.call(this),this.i){var c=this.i;for(const f in c.g){const g=c.g[f];for(let _=0;_<g.length;_++)Rt(g[_]);delete c.g[f],c.h--}}this.G=null},Nt.prototype.J=function(c,f,g,_){return this.i.add(String(c),f,!1,g,_)},Nt.prototype.K=function(c,f,g,_){return this.i.add(String(c),f,!0,g,_)};function cr(c,f,g,_){if(f=c.i.g[String(f)],!f)return!0;f=f.concat();let R=!0;for(let D=0;D<f.length;++D){const F=f[D];if(F&&!F.da&&F.capture==g){const G=F.listener,At=F.ha||F.src;F.fa&&Se(c.i,F),R=G.call(At,_)!==!1&&R}}return R&&!_.defaultPrevented}function wy(c,f){if(typeof c!="function")if(c&&typeof c.handleEvent=="function")c=u(c.handleEvent,c);else throw Error("Invalid listener argument");return Number(f)>2147483647?-1:o.setTimeout(c,f||0)}function Jc(c){c.g=wy(()=>{c.g=null,c.i&&(c.i=!1,Jc(c))},c.l);const f=c.h;c.h=null,c.m.apply(null,f)}class Ey extends A{constructor(f,g){super(),this.m=f,this.l=g,this.h=null,this.i=!1,this.g=null}j(f){this.h=arguments,this.g?this.i=!0:Jc(this)}N(){super.N(),this.g&&(o.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function $i(c){A.call(this),this.h=c,this.g={}}d($i,A);var Zc=[];function tu(c){it(c.g,function(f,g){this.g.hasOwnProperty(g)&&ea(f)},c),c.g={}}$i.prototype.N=function(){$i.Z.N.call(this),tu(this)},$i.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var sa=o.JSON.stringify,Ty=o.JSON.parse,xy=class{stringify(c){return o.JSON.stringify(c,void 0)}parse(c){return o.JSON.parse(c,void 0)}};function eu(){}function nu(){}var ji={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function ra(){x.call(this,"d")}d(ra,x);function oa(){x.call(this,"c")}d(oa,x);var Sn={},iu=null;function ur(){return iu=iu||new Nt}Sn.Ia="serverreachability";function su(c){x.call(this,Sn.Ia,c)}d(su,x);function Hi(c){const f=ur();Gt(f,new su(f))}Sn.STAT_EVENT="statevent";function ru(c,f){x.call(this,Sn.STAT_EVENT,c),this.stat=f}d(ru,x);function Kt(c){const f=ur();Gt(f,new ru(f,c))}Sn.Ja="timingevent";function ou(c,f){x.call(this,Sn.Ja,c),this.size=f}d(ou,x);function Wi(c,f){if(typeof c!="function")throw Error("Fn must not be null and must be a function");return o.setTimeout(function(){c()},f)}function qi(){this.g=!0}qi.prototype.ua=function(){this.g=!1};function Iy(c,f,g,_,R,D){c.info(function(){if(c.g)if(D){var F="",G=D.split("&");for(let at=0;at<G.length;at++){var At=G[at].split("=");if(At.length>1){const kt=At[0];At=At[1];const fe=kt.split("_");F=fe.length>=2&&fe[1]=="type"?F+(kt+"="+At+"&"):F+(kt+"=redacted&")}}}else F=null;else F=D;return"XMLHTTP REQ ("+_+") [attempt "+R+"]: "+f+`
`+g+`
`+F})}function Ay(c,f,g,_,R,D,F){c.info(function(){return"XMLHTTP RESP ("+_+") [ attempt "+R+"]: "+f+`
`+g+`
`+D+" "+F})}function ri(c,f,g,_){c.info(function(){return"XMLHTTP TEXT ("+f+"): "+Cy(c,g)+(_?" "+_:"")})}function Sy(c,f){c.info(function(){return"TIMEOUT: "+f})}qi.prototype.info=function(){};function Cy(c,f){if(!c.g)return f;if(!f)return null;try{const D=JSON.parse(f);if(D){for(c=0;c<D.length;c++)if(Array.isArray(D[c])){var g=D[c];if(!(g.length<2)){var _=g[1];if(Array.isArray(_)&&!(_.length<1)){var R=_[0];if(R!="noop"&&R!="stop"&&R!="close")for(let F=1;F<_.length;F++)_[F]=""}}}}return sa(D)}catch{return f}}var hr={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},au={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"},lu;function aa(){}d(aa,eu),aa.prototype.g=function(){return new XMLHttpRequest},lu=new aa;function Gi(c){return encodeURIComponent(String(c))}function Py(c){var f=1;c=c.split(":");const g=[];for(;f>0&&c.length;)g.push(c.shift()),f--;return c.length&&g.push(c.join(":")),g}function qe(c,f,g,_){this.j=c,this.i=f,this.l=g,this.S=_||1,this.V=new $i(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new cu}function cu(){this.i=null,this.g="",this.h=!1}var uu={},la={};function ca(c,f,g){c.M=1,c.A=fr(de(f)),c.u=g,c.R=!0,hu(c,null)}function hu(c,f){c.F=Date.now(),dr(c),c.B=de(c.A);var g=c.B,_=c.S;Array.isArray(_)||(_=[String(_)]),xu(g.i,"t",_),c.C=0,g=c.j.L,c.h=new cu,c.g=$u(c.j,g?f:null,!c.u),c.P>0&&(c.O=new Ey(u(c.Y,c,c.g),c.P)),f=c.V,g=c.g,_=c.ba;var R="readystatechange";Array.isArray(R)||(R&&(Zc[0]=R.toString()),R=Zc);for(let D=0;D<R.length;D++){const F=Kc(g,R[D],_||f.handleEvent,!1,f.h||f);if(!F)break;f.g[F.key]=F}f=c.J?yt(c.J):{},c.u?(c.v||(c.v="POST"),f["Content-Type"]="application/x-www-form-urlencoded",c.g.ea(c.B,c.v,c.u,f)):(c.v="GET",c.g.ea(c.B,c.v,null,f)),Hi(),Iy(c.i,c.v,c.B,c.l,c.S,c.u)}qe.prototype.ba=function(c){c=c.target;const f=this.O;f&&Ye(c)==3?f.j():this.Y(c)},qe.prototype.Y=function(c){try{if(c==this.g)t:{const G=Ye(this.g),At=this.g.ya(),at=this.g.ca();if(!(G<3)&&(G!=3||this.g&&(this.h.h||this.g.la()||ku(this.g)))){this.K||G!=4||At==7||(At==8||at<=0?Hi(3):Hi(2)),ua(this);var f=this.g.ca();this.X=f;var g=Ry(this);if(this.o=f==200,Ay(this.i,this.v,this.B,this.l,this.S,G,f),this.o){if(this.U&&!this.L){e:{if(this.g){var _,R=this.g;if((_=R.g?R.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!I(_)){var D=_;break e}}D=null}if(c=D)ri(this.i,this.l,c,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,ha(this,c);else{this.o=!1,this.m=3,Kt(12),Cn(this),Ki(this);break t}}if(this.R){c=!0;let kt;for(;!this.K&&this.C<g.length;)if(kt=ky(this,g),kt==la){G==4&&(this.m=4,Kt(14),c=!1),ri(this.i,this.l,null,"[Incomplete Response]");break}else if(kt==uu){this.m=4,Kt(15),ri(this.i,this.l,g,"[Invalid Chunk]"),c=!1;break}else ri(this.i,this.l,kt,null),ha(this,kt);if(du(this)&&this.C!=0&&(this.h.g=this.h.g.slice(this.C),this.C=0),G!=4||g.length!=0||this.h.h||(this.m=1,Kt(16),c=!1),this.o=this.o&&c,!c)ri(this.i,this.l,g,"[Invalid Chunked Response]"),Cn(this),Ki(this);else if(g.length>0&&!this.W){this.W=!0;var F=this.j;F.g==this&&F.aa&&!F.P&&(F.j.info("Great, no buffering proxy detected. Bytes received: "+g.length),ba(F),F.P=!0,Kt(11))}}else ri(this.i,this.l,g,null),ha(this,g);G==4&&Cn(this),this.o&&!this.K&&(G==4?Fu(this.j,this):(this.o=!1,dr(this)))}else Wy(this.g),f==400&&g.indexOf("Unknown SID")>0?(this.m=3,Kt(12)):(this.m=0,Kt(13)),Cn(this),Ki(this)}}}catch{}};function Ry(c){if(!du(c))return c.g.la();const f=ku(c.g);if(f==="")return"";let g="";const _=f.length,R=Ye(c.g)==4;if(!c.h.i){if(typeof TextDecoder>"u")return Cn(c),Ki(c),"";c.h.i=new o.TextDecoder}for(let D=0;D<_;D++)c.h.h=!0,g+=c.h.i.decode(f[D],{stream:!(R&&D==_-1)});return f.length=0,c.h.g+=g,c.C=0,c.h.g}function du(c){return c.g?c.v=="GET"&&c.M!=2&&c.j.Aa:!1}function ky(c,f){var g=c.C,_=f.indexOf(`
`,g);return _==-1?la:(g=Number(f.substring(g,_)),isNaN(g)?uu:(_+=1,_+g>f.length?la:(f=f.slice(_,_+g),c.C=_+g,f)))}qe.prototype.cancel=function(){this.K=!0,Cn(this)};function dr(c){c.T=Date.now()+c.H,fu(c,c.H)}function fu(c,f){if(c.D!=null)throw Error("WatchDog timer not null");c.D=Wi(u(c.aa,c),f)}function ua(c){c.D&&(o.clearTimeout(c.D),c.D=null)}qe.prototype.aa=function(){this.D=null;const c=Date.now();c-this.T>=0?(Sy(this.i,this.B),this.M!=2&&(Hi(),Kt(17)),Cn(this),this.m=2,Ki(this)):fu(this,this.T-c)};function Ki(c){c.j.I==0||c.K||Fu(c.j,c)}function Cn(c){ua(c);var f=c.O;f&&typeof f.dispose=="function"&&f.dispose(),c.O=null,tu(c.V),c.g&&(f=c.g,c.g=null,f.abort(),f.dispose())}function ha(c,f){try{var g=c.j;if(g.I!=0&&(g.g==c||da(g.h,c))){if(!c.L&&da(g.h,c)&&g.I==3){try{var _=g.Ba.g.parse(f)}catch{_=null}if(Array.isArray(_)&&_.length==3){var R=_;if(R[0]==0){t:if(!g.v){if(g.g)if(g.g.F+3e3<c.F)_r(g),mr(g);else break t;_a(g),Kt(18)}}else g.xa=R[1],0<g.xa-g.K&&R[2]<37500&&g.F&&g.A==0&&!g.C&&(g.C=Wi(u(g.Va,g),6e3));mu(g.h)<=1&&g.ta&&(g.ta=void 0)}else Rn(g,11)}else if((c.L||g.g==c)&&_r(g),!I(f))for(R=g.Ba.g.parse(f),f=0;f<R.length;f++){let at=R[f];const kt=at[0];if(!(kt<=g.K))if(g.K=kt,at=at[1],g.I==2)if(at[0]=="c"){g.M=at[1],g.ba=at[2];const fe=at[3];fe!=null&&(g.ka=fe,g.j.info("VER="+g.ka));const kn=at[4];kn!=null&&(g.za=kn,g.j.info("SVER="+g.za));const Xe=at[5];Xe!=null&&typeof Xe=="number"&&Xe>0&&(_=1.5*Xe,g.O=_,g.j.info("backChannelRequestTimeoutMs_="+_)),_=g;const Qe=c.g;if(Qe){const vr=Qe.g?Qe.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(vr){var D=_.h;D.g||vr.indexOf("spdy")==-1&&vr.indexOf("quic")==-1&&vr.indexOf("h2")==-1||(D.j=D.l,D.g=new Set,D.h&&(fa(D,D.h),D.h=null))}if(_.G){const va=Qe.g?Qe.g.getResponseHeader("X-HTTP-Session-Id"):null;va&&(_.wa=va,ht(_.J,_.G,va))}}g.I=3,g.l&&g.l.ra(),g.aa&&(g.T=Date.now()-c.F,g.j.info("Handshake RTT: "+g.T+"ms")),_=g;var F=c;if(_.na=zu(_,_.L?_.ba:null,_.W),F.L){yu(_.h,F);var G=F,At=_.O;At&&(G.H=At),G.D&&(ua(G),dr(G)),_.g=F}else Lu(_);g.i.length>0&&yr(g)}else at[0]!="stop"&&at[0]!="close"||Rn(g,7);else g.I==3&&(at[0]=="stop"||at[0]=="close"?at[0]=="stop"?Rn(g,7):ya(g):at[0]!="noop"&&g.l&&g.l.qa(at),g.A=0)}}Hi(4)}catch{}}var Dy=class{constructor(c,f){this.g=c,this.map=f}};function pu(c){this.l=c||10,o.PerformanceNavigationTiming?(c=o.performance.getEntriesByType("navigation"),c=c.length>0&&(c[0].nextHopProtocol=="hq"||c[0].nextHopProtocol=="h2")):c=!!(o.chrome&&o.chrome.loadTimes&&o.chrome.loadTimes()&&o.chrome.loadTimes().wasFetchedViaSpdy),this.j=c?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function gu(c){return c.h?!0:c.g?c.g.size>=c.j:!1}function mu(c){return c.h?1:c.g?c.g.size:0}function da(c,f){return c.h?c.h==f:c.g?c.g.has(f):!1}function fa(c,f){c.g?c.g.add(f):c.h=f}function yu(c,f){c.h&&c.h==f?c.h=null:c.g&&c.g.has(f)&&c.g.delete(f)}pu.prototype.cancel=function(){if(this.i=_u(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(const c of this.g.values())c.cancel();this.g.clear()}};function _u(c){if(c.h!=null)return c.i.concat(c.h.G);if(c.g!=null&&c.g.size!==0){let f=c.i;for(const g of c.g.values())f=f.concat(g.G);return f}return m(c.i)}var bu=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function My(c,f){if(c){c=c.split("&");for(let g=0;g<c.length;g++){const _=c[g].indexOf("=");let R,D=null;_>=0?(R=c[g].substring(0,_),D=c[g].substring(_+1)):R=c[g],f(R,D?decodeURIComponent(D.replace(/\+/g," ")):"")}}}function Ge(c){this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1;let f;c instanceof Ge?(this.l=c.l,Yi(this,c.j),this.o=c.o,this.g=c.g,Xi(this,c.u),this.h=c.h,pa(this,Iu(c.i)),this.m=c.m):c&&(f=String(c).match(bu))?(this.l=!1,Yi(this,f[1]||"",!0),this.o=Qi(f[2]||""),this.g=Qi(f[3]||"",!0),Xi(this,f[4]),this.h=Qi(f[5]||"",!0),pa(this,f[6]||"",!0),this.m=Qi(f[7]||"")):(this.l=!1,this.i=new Zi(null,this.l))}Ge.prototype.toString=function(){const c=[];var f=this.j;f&&c.push(Ji(f,vu,!0),":");var g=this.g;return(g||f=="file")&&(c.push("//"),(f=this.o)&&c.push(Ji(f,vu,!0),"@"),c.push(Gi(g).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),g=this.u,g!=null&&c.push(":",String(g))),(g=this.h)&&(this.g&&g.charAt(0)!="/"&&c.push("/"),c.push(Ji(g,g.charAt(0)=="/"?Ly:Vy,!0))),(g=this.i.toString())&&c.push("?",g),(g=this.m)&&c.push("#",Ji(g,Fy)),c.join("")},Ge.prototype.resolve=function(c){const f=de(this);let g=!!c.j;g?Yi(f,c.j):g=!!c.o,g?f.o=c.o:g=!!c.g,g?f.g=c.g:g=c.u!=null;var _=c.h;if(g)Xi(f,c.u);else if(g=!!c.h){if(_.charAt(0)!="/")if(this.g&&!this.h)_="/"+_;else{var R=f.h.lastIndexOf("/");R!=-1&&(_=f.h.slice(0,R+1)+_)}if(R=_,R==".."||R==".")_="";else if(R.indexOf("./")!=-1||R.indexOf("/.")!=-1){_=R.lastIndexOf("/",0)==0,R=R.split("/");const D=[];for(let F=0;F<R.length;){const G=R[F++];G=="."?_&&F==R.length&&D.push(""):G==".."?((D.length>1||D.length==1&&D[0]!="")&&D.pop(),_&&F==R.length&&D.push("")):(D.push(G),_=!0)}_=D.join("/")}else _=R}return g?f.h=_:g=c.i.toString()!=="",g?pa(f,Iu(c.i)):g=!!c.m,g&&(f.m=c.m),f};function de(c){return new Ge(c)}function Yi(c,f,g){c.j=g?Qi(f,!0):f,c.j&&(c.j=c.j.replace(/:$/,""))}function Xi(c,f){if(f){if(f=Number(f),isNaN(f)||f<0)throw Error("Bad port number "+f);c.u=f}else c.u=null}function pa(c,f,g){f instanceof Zi?(c.i=f,By(c.i,c.l)):(g||(f=Ji(f,Ny)),c.i=new Zi(f,c.l))}function ht(c,f,g){c.i.set(f,g)}function fr(c){return ht(c,"zx",Math.floor(Math.random()*2147483648).toString(36)+Math.abs(Math.floor(Math.random()*2147483648)^Date.now()).toString(36)),c}function Qi(c,f){return c?f?decodeURI(c.replace(/%25/g,"%2525")):decodeURIComponent(c):""}function Ji(c,f,g){return typeof c=="string"?(c=encodeURI(c).replace(f,Oy),g&&(c=c.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),c):null}function Oy(c){return c=c.charCodeAt(0),"%"+(c>>4&15).toString(16)+(c&15).toString(16)}var vu=/[#\/\?@]/g,Vy=/[#\?:]/g,Ly=/[#\?]/g,Ny=/[#\?@]/g,Fy=/#/g;function Zi(c,f){this.h=this.g=null,this.i=c||null,this.j=!!f}function Pn(c){c.g||(c.g=new Map,c.h=0,c.i&&My(c.i,function(f,g){c.add(decodeURIComponent(f.replace(/\+/g," ")),g)}))}n=Zi.prototype,n.add=function(c,f){Pn(this),this.i=null,c=oi(this,c);let g=this.g.get(c);return g||this.g.set(c,g=[]),g.push(f),this.h+=1,this};function wu(c,f){Pn(c),f=oi(c,f),c.g.has(f)&&(c.i=null,c.h-=c.g.get(f).length,c.g.delete(f))}function Eu(c,f){return Pn(c),f=oi(c,f),c.g.has(f)}n.forEach=function(c,f){Pn(this),this.g.forEach(function(g,_){g.forEach(function(R){c.call(f,R,_,this)},this)},this)};function Tu(c,f){Pn(c);let g=[];if(typeof f=="string")Eu(c,f)&&(g=g.concat(c.g.get(oi(c,f))));else for(c=Array.from(c.g.values()),f=0;f<c.length;f++)g=g.concat(c[f]);return g}n.set=function(c,f){return Pn(this),this.i=null,c=oi(this,c),Eu(this,c)&&(this.h-=this.g.get(c).length),this.g.set(c,[f]),this.h+=1,this},n.get=function(c,f){return c?(c=Tu(this,c),c.length>0?String(c[0]):f):f};function xu(c,f,g){wu(c,f),g.length>0&&(c.i=null,c.g.set(oi(c,f),m(g)),c.h+=g.length)}n.toString=function(){if(this.i)return this.i;if(!this.g)return"";const c=[],f=Array.from(this.g.keys());for(let _=0;_<f.length;_++){var g=f[_];const R=Gi(g);g=Tu(this,g);for(let D=0;D<g.length;D++){let F=R;g[D]!==""&&(F+="="+Gi(g[D])),c.push(F)}}return this.i=c.join("&")};function Iu(c){const f=new Zi;return f.i=c.i,c.g&&(f.g=new Map(c.g),f.h=c.h),f}function oi(c,f){return f=String(f),c.j&&(f=f.toLowerCase()),f}function By(c,f){f&&!c.j&&(Pn(c),c.i=null,c.g.forEach(function(g,_){const R=_.toLowerCase();_!=R&&(wu(this,_),xu(this,R,g))},c)),c.j=f}function Uy(c,f){const g=new qi;if(o.Image){const _=new Image;_.onload=h(Ke,g,"TestLoadImage: loaded",!0,f,_),_.onerror=h(Ke,g,"TestLoadImage: error",!1,f,_),_.onabort=h(Ke,g,"TestLoadImage: abort",!1,f,_),_.ontimeout=h(Ke,g,"TestLoadImage: timeout",!1,f,_),o.setTimeout(function(){_.ontimeout&&_.ontimeout()},1e4),_.src=c}else f(!1)}function zy(c,f){const g=new qi,_=new AbortController,R=setTimeout(()=>{_.abort(),Ke(g,"TestPingServer: timeout",!1,f)},1e4);fetch(c,{signal:_.signal}).then(D=>{clearTimeout(R),D.ok?Ke(g,"TestPingServer: ok",!0,f):Ke(g,"TestPingServer: server error",!1,f)}).catch(()=>{clearTimeout(R),Ke(g,"TestPingServer: error",!1,f)})}function Ke(c,f,g,_,R){try{R&&(R.onload=null,R.onerror=null,R.onabort=null,R.ontimeout=null),_(g)}catch{}}function $y(){this.g=new xy}function ga(c){this.i=c.Sb||null,this.h=c.ab||!1}d(ga,eu),ga.prototype.g=function(){return new pr(this.i,this.h)};function pr(c,f){Nt.call(this),this.H=c,this.o=f,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}d(pr,Nt),n=pr.prototype,n.open=function(c,f){if(this.readyState!=0)throw this.abort(),Error("Error reopening a connection");this.F=c,this.D=f,this.readyState=1,es(this)},n.send=function(c){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const f={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};c&&(f.body=c),(this.H||o).fetch(new Request(this.D,f)).then(this.Pa.bind(this),this.ga.bind(this))},n.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&this.readyState!=4&&(this.g=!1,ts(this)),this.readyState=0},n.Pa=function(c){if(this.g&&(this.l=c,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=c.headers,this.readyState=2,es(this)),this.g&&(this.readyState=3,es(this),this.g)))if(this.responseType==="arraybuffer")c.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if(typeof o.ReadableStream<"u"&&"body"in c){if(this.j=c.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Au(this)}else c.text().then(this.Oa.bind(this),this.ga.bind(this))};function Au(c){c.j.read().then(c.Ma.bind(c)).catch(c.ga.bind(c))}n.Ma=function(c){if(this.g){if(this.o&&c.value)this.response.push(c.value);else if(!this.o){var f=c.value?c.value:new Uint8Array(0);(f=this.B.decode(f,{stream:!c.done}))&&(this.response=this.responseText+=f)}c.done?ts(this):es(this),this.readyState==3&&Au(this)}},n.Oa=function(c){this.g&&(this.response=this.responseText=c,ts(this))},n.Na=function(c){this.g&&(this.response=c,ts(this))},n.ga=function(){this.g&&ts(this)};function ts(c){c.readyState=4,c.l=null,c.j=null,c.B=null,es(c)}n.setRequestHeader=function(c,f){this.A.append(c,f)},n.getResponseHeader=function(c){return this.h&&this.h.get(c.toLowerCase())||""},n.getAllResponseHeaders=function(){if(!this.h)return"";const c=[],f=this.h.entries();for(var g=f.next();!g.done;)g=g.value,c.push(g[0]+": "+g[1]),g=f.next();return c.join(`\r
`)};function es(c){c.onreadystatechange&&c.onreadystatechange.call(c)}Object.defineProperty(pr.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(c){this.m=c?"include":"same-origin"}});function Su(c){let f="";return it(c,function(g,_){f+=_,f+=":",f+=g,f+=`\r
`}),f}function ma(c,f,g){t:{for(_ in g){var _=!1;break t}_=!0}_||(g=Su(g),typeof c=="string"?g!=null&&Gi(g):ht(c,f,g))}function _t(c){Nt.call(this),this.headers=new Map,this.L=c||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}d(_t,Nt);var jy=/^https?$/i,Hy=["POST","PUT"];n=_t.prototype,n.Fa=function(c){this.H=c},n.ea=function(c,f,g,_){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+c);f=f?f.toUpperCase():"GET",this.D=c,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():lu.g(),this.g.onreadystatechange=p(u(this.Ca,this));try{this.B=!0,this.g.open(f,String(c),!0),this.B=!1}catch(D){Cu(this,D);return}if(c=g||"",g=new Map(this.headers),_)if(Object.getPrototypeOf(_)===Object.prototype)for(var R in _)g.set(R,_[R]);else if(typeof _.keys=="function"&&typeof _.get=="function")for(const D of _.keys())g.set(D,_.get(D));else throw Error("Unknown input type for opt_headers: "+String(_));_=Array.from(g.keys()).find(D=>D.toLowerCase()=="content-type"),R=o.FormData&&c instanceof o.FormData,!(Array.prototype.indexOf.call(Hy,f,void 0)>=0)||_||R||g.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[D,F]of g)this.g.setRequestHeader(D,F);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(c),this.v=!1}catch(D){Cu(this,D)}};function Cu(c,f){c.h=!1,c.g&&(c.j=!0,c.g.abort(),c.j=!1),c.l=f,c.o=5,Pu(c),gr(c)}function Pu(c){c.A||(c.A=!0,Gt(c,"complete"),Gt(c,"error"))}n.abort=function(c){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=c||7,Gt(this,"complete"),Gt(this,"abort"),gr(this))},n.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),gr(this,!0)),_t.Z.N.call(this)},n.Ca=function(){this.u||(this.B||this.v||this.j?Ru(this):this.Xa())},n.Xa=function(){Ru(this)};function Ru(c){if(c.h&&typeof r<"u"){if(c.v&&Ye(c)==4)setTimeout(c.Ca.bind(c),0);else if(Gt(c,"readystatechange"),Ye(c)==4){c.h=!1;try{const D=c.ca();t:switch(D){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var f=!0;break t;default:f=!1}var g;if(!(g=f)){var _;if(_=D===0){let F=String(c.D).match(bu)[1]||null;!F&&o.self&&o.self.location&&(F=o.self.location.protocol.slice(0,-1)),_=!jy.test(F?F.toLowerCase():"")}g=_}if(g)Gt(c,"complete"),Gt(c,"success");else{c.o=6;try{var R=Ye(c)>2?c.g.statusText:""}catch{R=""}c.l=R+" ["+c.ca()+"]",Pu(c)}}finally{gr(c)}}}}function gr(c,f){if(c.g){c.m&&(clearTimeout(c.m),c.m=null);const g=c.g;c.g=null,f||Gt(c,"ready");try{g.onreadystatechange=null}catch{}}}n.isActive=function(){return!!this.g};function Ye(c){return c.g?c.g.readyState:0}n.ca=function(){try{return Ye(this)>2?this.g.status:-1}catch{return-1}},n.la=function(){try{return this.g?this.g.responseText:""}catch{return""}},n.La=function(c){if(this.g){var f=this.g.responseText;return c&&f.indexOf(c)==0&&(f=f.substring(c.length)),Ty(f)}};function ku(c){try{if(!c.g)return null;if("response"in c.g)return c.g.response;switch(c.F){case"":case"text":return c.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in c.g)return c.g.mozResponseArrayBuffer}return null}catch{return null}}function Wy(c){const f={};c=(c.g&&Ye(c)>=2&&c.g.getAllResponseHeaders()||"").split(`\r
`);for(let _=0;_<c.length;_++){if(I(c[_]))continue;var g=Py(c[_]);const R=g[0];if(g=g[1],typeof g!="string")continue;g=g.trim();const D=f[R]||[];f[R]=D,D.push(g)}Et(f,function(_){return _.join(", ")})}n.ya=function(){return this.o},n.Ha=function(){return typeof this.l=="string"?this.l:String(this.l)};function ns(c,f,g){return g&&g.internalChannelParams&&g.internalChannelParams[c]||f}function Du(c){this.za=0,this.i=[],this.j=new qi,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=ns("failFast",!1,c),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=ns("baseRetryDelayMs",5e3,c),this.Za=ns("retryDelaySeedMs",1e4,c),this.Ta=ns("forwardChannelMaxRetries",2,c),this.va=ns("forwardChannelRequestTimeoutMs",2e4,c),this.ma=c&&c.xmlHttpFactory||void 0,this.Ua=c&&c.Rb||void 0,this.Aa=c&&c.useFetchStreams||!1,this.O=void 0,this.L=c&&c.supportsCrossDomainXhr||!1,this.M="",this.h=new pu(c&&c.concurrentRequestLimit),this.Ba=new $y,this.S=c&&c.fastHandshake||!1,this.R=c&&c.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=c&&c.Pb||!1,c&&c.ua&&this.j.ua(),c&&c.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&c&&c.detectBufferingProxy||!1,this.ia=void 0,c&&c.longPollingTimeout&&c.longPollingTimeout>0&&(this.ia=c.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}n=Du.prototype,n.ka=8,n.I=1,n.connect=function(c,f,g,_){Kt(0),this.W=c,this.H=f||{},g&&_!==void 0&&(this.H.OSID=g,this.H.OAID=_),this.F=this.X,this.J=zu(this,null,this.W),yr(this)};function ya(c){if(Mu(c),c.I==3){var f=c.V++,g=de(c.J);if(ht(g,"SID",c.M),ht(g,"RID",f),ht(g,"TYPE","terminate"),is(c,g),f=new qe(c,c.j,f),f.M=2,f.A=fr(de(g)),g=!1,o.navigator&&o.navigator.sendBeacon)try{g=o.navigator.sendBeacon(f.A.toString(),"")}catch{}!g&&o.Image&&(new Image().src=f.A,g=!0),g||(f.g=$u(f.j,null),f.g.ea(f.A)),f.F=Date.now(),dr(f)}Uu(c)}function mr(c){c.g&&(ba(c),c.g.cancel(),c.g=null)}function Mu(c){mr(c),c.v&&(o.clearTimeout(c.v),c.v=null),_r(c),c.h.cancel(),c.m&&(typeof c.m=="number"&&o.clearTimeout(c.m),c.m=null)}function yr(c){if(!gu(c.h)&&!c.m){c.m=!0;var f=c.Ea;O||y(),N||(O(),N=!0),w.add(f,c),c.D=0}}function qy(c,f){return mu(c.h)>=c.h.j-(c.m?1:0)?!1:c.m?(c.i=f.G.concat(c.i),!0):c.I==1||c.I==2||c.D>=(c.Sa?0:c.Ta)?!1:(c.m=Wi(u(c.Ea,c,f),Bu(c,c.D)),c.D++,!0)}n.Ea=function(c){if(this.m)if(this.m=null,this.I==1){if(!c){this.V=Math.floor(Math.random()*1e5),c=this.V++;const R=new qe(this,this.j,c);let D=this.o;if(this.U&&(D?(D=yt(D),We(D,this.U)):D=this.U),this.u!==null||this.R||(R.J=D,D=null),this.S)t:{for(var f=0,g=0;g<this.i.length;g++){e:{var _=this.i[g];if("__data__"in _.map&&(_=_.map.__data__,typeof _=="string")){_=_.length;break e}_=void 0}if(_===void 0)break;if(f+=_,f>4096){f=g;break t}if(f===4096||g===this.i.length-1){f=g+1;break t}}f=1e3}else f=1e3;f=Vu(this,R,f),g=de(this.J),ht(g,"RID",c),ht(g,"CVER",22),this.G&&ht(g,"X-HTTP-Session-Id",this.G),is(this,g),D&&(this.R?f="headers="+Gi(Su(D))+"&"+f:this.u&&ma(g,this.u,D)),fa(this.h,R),this.Ra&&ht(g,"TYPE","init"),this.S?(ht(g,"$req",f),ht(g,"SID","null"),R.U=!0,ca(R,g,null)):ca(R,g,f),this.I=2}}else this.I==3&&(c?Ou(this,c):this.i.length==0||gu(this.h)||Ou(this))};function Ou(c,f){var g;f?g=f.l:g=c.V++;const _=de(c.J);ht(_,"SID",c.M),ht(_,"RID",g),ht(_,"AID",c.K),is(c,_),c.u&&c.o&&ma(_,c.u,c.o),g=new qe(c,c.j,g,c.D+1),c.u===null&&(g.J=c.o),f&&(c.i=f.G.concat(c.i)),f=Vu(c,g,1e3),g.H=Math.round(c.va*.5)+Math.round(c.va*.5*Math.random()),fa(c.h,g),ca(g,_,f)}function is(c,f){c.H&&it(c.H,function(g,_){ht(f,_,g)}),c.l&&it({},function(g,_){ht(f,_,g)})}function Vu(c,f,g){g=Math.min(c.i.length,g);const _=c.l?u(c.l.Ka,c.l,c):null;t:{var R=c.i;let G=-1;for(;;){const At=["count="+g];G==-1?g>0?(G=R[0].g,At.push("ofs="+G)):G=0:At.push("ofs="+G);let at=!0;for(let kt=0;kt<g;kt++){var D=R[kt].g;const fe=R[kt].map;if(D-=G,D<0)G=Math.max(0,R[kt].g-100),at=!1;else try{D="req"+D+"_"||"";try{var F=fe instanceof Map?fe:Object.entries(fe);for(const[kn,Xe]of F){let Qe=Xe;a(Xe)&&(Qe=sa(Xe)),At.push(D+kn+"="+encodeURIComponent(Qe))}}catch(kn){throw At.push(D+"type="+encodeURIComponent("_badmap")),kn}}catch{_&&_(fe)}}if(at){F=At.join("&");break t}}F=void 0}return c=c.i.splice(0,g),f.G=c,F}function Lu(c){if(!c.g&&!c.v){c.Y=1;var f=c.Da;O||y(),N||(O(),N=!0),w.add(f,c),c.A=0}}function _a(c){return c.g||c.v||c.A>=3?!1:(c.Y++,c.v=Wi(u(c.Da,c),Bu(c,c.A)),c.A++,!0)}n.Da=function(){if(this.v=null,Nu(this),this.aa&&!(this.P||this.g==null||this.T<=0)){var c=4*this.T;this.j.info("BP detection timer enabled: "+c),this.B=Wi(u(this.Wa,this),c)}},n.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,Kt(10),mr(this),Nu(this))};function ba(c){c.B!=null&&(o.clearTimeout(c.B),c.B=null)}function Nu(c){c.g=new qe(c,c.j,"rpc",c.Y),c.u===null&&(c.g.J=c.o),c.g.P=0;var f=de(c.na);ht(f,"RID","rpc"),ht(f,"SID",c.M),ht(f,"AID",c.K),ht(f,"CI",c.F?"0":"1"),!c.F&&c.ia&&ht(f,"TO",c.ia),ht(f,"TYPE","xmlhttp"),is(c,f),c.u&&c.o&&ma(f,c.u,c.o),c.O&&(c.g.H=c.O);var g=c.g;c=c.ba,g.M=1,g.A=fr(de(f)),g.u=null,g.R=!0,hu(g,c)}n.Va=function(){this.C!=null&&(this.C=null,mr(this),_a(this),Kt(19))};function _r(c){c.C!=null&&(o.clearTimeout(c.C),c.C=null)}function Fu(c,f){var g=null;if(c.g==f){_r(c),ba(c),c.g=null;var _=2}else if(da(c.h,f))g=f.G,yu(c.h,f),_=1;else return;if(c.I!=0){if(f.o)if(_==1){g=f.u?f.u.length:0,f=Date.now()-f.F;var R=c.D;_=ur(),Gt(_,new ou(_,g)),yr(c)}else Lu(c);else if(R=f.m,R==3||R==0&&f.X>0||!(_==1&&qy(c,f)||_==2&&_a(c)))switch(g&&g.length>0&&(f=c.h,f.i=f.i.concat(g)),R){case 1:Rn(c,5);break;case 4:Rn(c,10);break;case 3:Rn(c,6);break;default:Rn(c,2)}}}function Bu(c,f){let g=c.Qa+Math.floor(Math.random()*c.Za);return c.isActive()||(g*=2),g*f}function Rn(c,f){if(c.j.info("Error code "+f),f==2){var g=u(c.bb,c),_=c.Ua;const R=!_;_=new Ge(_||"//www.google.com/images/cleardot.gif"),o.location&&o.location.protocol=="http"||Yi(_,"https"),fr(_),R?Uy(_.toString(),g):zy(_.toString(),g)}else Kt(2);c.I=0,c.l&&c.l.pa(f),Uu(c),Mu(c)}n.bb=function(c){c?(this.j.info("Successfully pinged google.com"),Kt(2)):(this.j.info("Failed to ping google.com"),Kt(1))};function Uu(c){if(c.I=0,c.ja=[],c.l){const f=_u(c.h);(f.length!=0||c.i.length!=0)&&(b(c.ja,f),b(c.ja,c.i),c.h.i.length=0,m(c.i),c.i.length=0),c.l.oa()}}function zu(c,f,g){var _=g instanceof Ge?de(g):new Ge(g);if(_.g!="")f&&(_.g=f+"."+_.g),Xi(_,_.u);else{var R=o.location;_=R.protocol,f=f?f+"."+R.hostname:R.hostname,R=+R.port;const D=new Ge(null);_&&Yi(D,_),f&&(D.g=f),R&&Xi(D,R),g&&(D.h=g),_=D}return g=c.G,f=c.wa,g&&f&&ht(_,g,f),ht(_,"VER",c.ka),is(c,_),_}function $u(c,f,g){if(f&&!c.L)throw Error("Can't create secondary domain capable XhrIo object.");return f=c.Aa&&!c.ma?new _t(new ga({ab:g})):new _t(c.ma),f.Fa(c.L),f}n.isActive=function(){return!!this.l&&this.l.isActive(this)};function ju(){}n=ju.prototype,n.ra=function(){},n.qa=function(){},n.pa=function(){},n.oa=function(){},n.isActive=function(){return!0},n.Ka=function(){};function br(){}br.prototype.g=function(c,f){return new Zt(c,f)};function Zt(c,f){Nt.call(this),this.g=new Du(f),this.l=c,this.h=f&&f.messageUrlParams||null,c=f&&f.messageHeaders||null,f&&f.clientProtocolHeaderRequired&&(c?c["X-Client-Protocol"]="webchannel":c={"X-Client-Protocol":"webchannel"}),this.g.o=c,c=f&&f.initMessageHeaders||null,f&&f.messageContentType&&(c?c["X-WebChannel-Content-Type"]=f.messageContentType:c={"X-WebChannel-Content-Type":f.messageContentType}),f&&f.sa&&(c?c["X-WebChannel-Client-Profile"]=f.sa:c={"X-WebChannel-Client-Profile":f.sa}),this.g.U=c,(c=f&&f.Qb)&&!I(c)&&(this.g.u=c),this.A=f&&f.supportsCrossDomainXhr||!1,this.v=f&&f.sendRawJson||!1,(f=f&&f.httpSessionIdParam)&&!I(f)&&(this.g.G=f,c=this.h,c!==null&&f in c&&(c=this.h,f in c&&delete c[f])),this.j=new ai(this)}d(Zt,Nt),Zt.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},Zt.prototype.close=function(){ya(this.g)},Zt.prototype.o=function(c){var f=this.g;if(typeof c=="string"){var g={};g.__data__=c,c=g}else this.v&&(g={},g.__data__=sa(c),c=g);f.i.push(new Dy(f.Ya++,c)),f.I==3&&yr(f)},Zt.prototype.N=function(){this.g.l=null,delete this.j,ya(this.g),delete this.g,Zt.Z.N.call(this)};function Hu(c){ra.call(this),c.__headers__&&(this.headers=c.__headers__,this.statusCode=c.__status__,delete c.__headers__,delete c.__status__);var f=c.__sm__;if(f){t:{for(const g in f){c=g;break t}c=void 0}(this.i=c)&&(c=this.i,f=f!==null&&c in f?f[c]:void 0),this.data=f}else this.data=c}d(Hu,ra);function Wu(){oa.call(this),this.status=1}d(Wu,oa);function ai(c){this.g=c}d(ai,ju),ai.prototype.ra=function(){Gt(this.g,"a")},ai.prototype.qa=function(c){Gt(this.g,new Hu(c))},ai.prototype.pa=function(c){Gt(this.g,new Wu)},ai.prototype.oa=function(){Gt(this.g,"b")},br.prototype.createWebChannel=br.prototype.g,Zt.prototype.send=Zt.prototype.o,Zt.prototype.open=Zt.prototype.m,Zt.prototype.close=Zt.prototype.close,$p=function(){return new br},zp=function(){return ur()},Up=Sn,ul={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},hr.NO_ERROR=0,hr.TIMEOUT=8,hr.HTTP_ERROR=6,Hr=hr,au.COMPLETE="complete",Bp=au,nu.EventType=ji,ji.OPEN="a",ji.CLOSE="b",ji.ERROR="c",ji.MESSAGE="d",Nt.prototype.listen=Nt.prototype.J,cs=nu,_t.prototype.listenOnce=_t.prototype.K,_t.prototype.getLastError=_t.prototype.Ha,_t.prototype.getLastErrorCode=_t.prototype.ya,_t.prototype.getStatus=_t.prototype.ca,_t.prototype.getResponseJson=_t.prototype.La,_t.prototype.getResponseText=_t.prototype.la,_t.prototype.send=_t.prototype.ea,_t.prototype.setWithCredentials=_t.prototype.Fa,Fp=_t}).apply(typeof Er<"u"?Er:typeof self<"u"?self:typeof window<"u"?window:{});const wh="@firebase/firestore",Eh="4.9.3";class Ut{constructor(t){this.uid=t}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Ut.UNAUTHENTICATED=new Ut(null),Ut.GOOGLE_CREDENTIALS=new Ut("google-credentials-uid"),Ut.FIRST_PARTY=new Ut("first-party-uid"),Ut.MOCK_USER=new Ut("mock-user");let Ni="12.7.0";const Yn=new Bl("@firebase/firestore");function ui(){return Yn.logLevel}function B(n,...t){if(Yn.logLevel<=X.DEBUG){const e=t.map(Zl);Yn.debug(`Firestore (${Ni}): ${n}`,...e)}}function ze(n,...t){if(Yn.logLevel<=X.ERROR){const e=t.map(Zl);Yn.error(`Firestore (${Ni}): ${n}`,...e)}}function xi(n,...t){if(Yn.logLevel<=X.WARN){const e=t.map(Zl);Yn.warn(`Firestore (${Ni}): ${n}`,...e)}}function Zl(n){if(typeof n=="string")return n;try{return(function(e){return JSON.stringify(e)})(n)}catch{return n}}function $(n,t,e){let i="Unexpected state";typeof t=="string"?i=t:e=t,jp(n,i,e)}function jp(n,t,e){let i=`FIRESTORE (${Ni}) INTERNAL ASSERTION FAILED: ${t} (ID: ${n.toString(16)})`;if(e!==void 0)try{i+=" CONTEXT: "+JSON.stringify(e)}catch{i+=" CONTEXT: "+e}throw ze(i),new Error(i)}function st(n,t,e,i){let s="Unexpected state";typeof e=="string"?s=e:i=e,n||jp(t,s,i)}function q(n,t){return n}const V={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class U extends je{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class $n{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Hp{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class F0{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Ut.UNAUTHENTICATED)))}shutdown(){}}class B0{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class U0{constructor(t){this.t=t,this.currentUser=Ut.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){st(this.o===void 0,42304);let i=this.i;const s=l=>this.i!==i?(i=this.i,e(l)):Promise.resolve();let r=new $n;this.o=()=>{this.i++,this.currentUser=this.u(),r.resolve(),r=new $n,t.enqueueRetryable((()=>s(this.currentUser)))};const o=()=>{const l=r;t.enqueueRetryable((async()=>{await l.promise,await s(this.currentUser)}))},a=l=>{B("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.o&&(this.auth.addAuthTokenListener(this.o),o())};this.t.onInit((l=>a(l))),setTimeout((()=>{if(!this.auth){const l=this.t.getImmediate({optional:!0});l?a(l):(B("FirebaseAuthCredentialsProvider","Auth not yet detected"),r.resolve(),r=new $n)}}),0),o()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((i=>this.i!==t?(B("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):i?(st(typeof i.accessToken=="string",31837,{l:i}),new Hp(i.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const t=this.auth&&this.auth.getUid();return st(t===null||typeof t=="string",2055,{h:t}),new Ut(t)}}class z0{constructor(t,e,i){this.P=t,this.T=e,this.I=i,this.type="FirstParty",this.user=Ut.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const t=this.R();return t&&this.A.set("Authorization",t),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class $0{constructor(t,e,i){this.P=t,this.T=e,this.I=i}getToken(){return Promise.resolve(new z0(this.P,this.T,this.I))}start(t,e){t.enqueueRetryable((()=>e(Ut.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class Th{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class j0{constructor(t,e){this.V=e,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,oe(t)&&t.settings.appCheckToken&&(this.p=t.settings.appCheckToken)}start(t,e){st(this.o===void 0,3512);const i=r=>{r.error!=null&&B("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${r.error.message}`);const o=r.token!==this.m;return this.m=r.token,B("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?e(r.token):Promise.resolve()};this.o=r=>{t.enqueueRetryable((()=>i(r)))};const s=r=>{B("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=r,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit((r=>s(r))),setTimeout((()=>{if(!this.appCheck){const r=this.V.getImmediate({optional:!0});r?s(r):B("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){if(this.p)return Promise.resolve(new Th(this.p));const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((e=>e?(st(typeof e.token=="string",44558,{tokenResult:e}),this.m=e.token,new Th(e.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function H0(n){const t=typeof self<"u"&&(self.crypto||self.msCrypto),e=new Uint8Array(n);if(t&&typeof t.getRandomValues=="function")t.getRandomValues(e);else for(let i=0;i<n;i++)e[i]=Math.floor(256*Math.random());return e}class tc{static newId(){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=62*Math.floor(4.129032258064516);let i="";for(;i.length<20;){const s=H0(40);for(let r=0;r<s.length;++r)i.length<20&&s[r]<e&&(i+=t.charAt(s[r]%62))}return i}}function Q(n,t){return n<t?-1:n>t?1:0}function hl(n,t){const e=Math.min(n.length,t.length);for(let i=0;i<e;i++){const s=n.charAt(i),r=t.charAt(i);if(s!==r)return Ca(s)===Ca(r)?Q(s,r):Ca(s)?1:-1}return Q(n.length,t.length)}const W0=55296,q0=57343;function Ca(n){const t=n.charCodeAt(0);return t>=W0&&t<=q0}function Ii(n,t,e){return n.length===t.length&&n.every(((i,s)=>e(i,t[s])))}const xh="__name__";class me{constructor(t,e,i){e===void 0?e=0:e>t.length&&$(637,{offset:e,range:t.length}),i===void 0?i=t.length-e:i>t.length-e&&$(1746,{length:i,range:t.length-e}),this.segments=t,this.offset=e,this.len=i}get length(){return this.len}isEqual(t){return me.comparator(this,t)===0}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof me?t.forEach((i=>{e.push(i)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=t===void 0?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return this.length===0}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,i=this.limit();e<i;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const i=Math.min(t.length,e.length);for(let s=0;s<i;s++){const r=me.compareSegments(t.get(s),e.get(s));if(r!==0)return r}return Q(t.length,e.length)}static compareSegments(t,e){const i=me.isNumericId(t),s=me.isNumericId(e);return i&&!s?-1:!i&&s?1:i&&s?me.extractNumericId(t).compare(me.extractNumericId(e)):hl(t,e)}static isNumericId(t){return t.startsWith("__id")&&t.endsWith("__")}static extractNumericId(t){return fn.fromString(t.substring(4,t.length-2))}}class ct extends me{construct(t,e,i){return new ct(t,e,i)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const i of t){if(i.indexOf("//")>=0)throw new U(V.INVALID_ARGUMENT,`Invalid segment (${i}). Paths must not contain // in them.`);e.push(...i.split("/").filter((s=>s.length>0)))}return new ct(e)}static emptyPath(){return new ct([])}}const G0=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class Vt extends me{construct(t,e,i){return new Vt(t,e,i)}static isValidIdentifier(t){return G0.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),Vt.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===xh}static keyField(){return new Vt([xh])}static fromServerFormat(t){const e=[];let i="",s=0;const r=()=>{if(i.length===0)throw new U(V.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(i),i=""};let o=!1;for(;s<t.length;){const a=t[s];if(a==="\\"){if(s+1===t.length)throw new U(V.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const l=t[s+1];if(l!=="\\"&&l!=="."&&l!=="`")throw new U(V.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);i+=l,s+=2}else a==="`"?(o=!o,s++):a!=="."||o?(i+=a,s++):(r(),s++)}if(r(),o)throw new U(V.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new Vt(e)}static emptyPath(){return new Vt([])}}class z{constructor(t){this.path=t}static fromPath(t){return new z(ct.fromString(t))}static fromName(t){return new z(ct.fromString(t).popFirst(5))}static empty(){return new z(ct.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return t!==null&&ct.comparator(this.path,t.path)===0}toString(){return this.path.toString()}static comparator(t,e){return ct.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new z(new ct(t.slice()))}}function Wp(n,t,e){if(!e)throw new U(V.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${t}.`)}function K0(n,t,e,i){if(t===!0&&i===!0)throw new U(V.INVALID_ARGUMENT,`${n} and ${e} cannot be used together.`)}function Ih(n){if(!z.isDocumentKey(n))throw new U(V.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function Ah(n){if(z.isDocumentKey(n))throw new U(V.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function qp(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Do(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{const t=(function(i){return i.constructor?i.constructor.name:null})(n);return t?`a custom ${t} object`:"an object"}}return typeof n=="function"?"a function":$(12329,{type:typeof n})}function yi(n,t){if("_delegate"in n&&(n=n._delegate),!(n instanceof t)){if(t.name===n.constructor.name)throw new U(V.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const e=Do(n);throw new U(V.INVALID_ARGUMENT,`Expected type '${t.name}', but it was: ${e}`)}}return n}function It(n,t){const e={typeString:n};return t&&(e.value=t),e}function tr(n,t){if(!qp(n))throw new U(V.INVALID_ARGUMENT,"JSON must be an object");let e;for(const i in t)if(t[i]){const s=t[i].typeString,r="value"in t[i]?{value:t[i].value}:void 0;if(!(i in n)){e=`JSON missing required field: '${i}'`;break}const o=n[i];if(s&&typeof o!==s){e=`JSON field '${i}' must be a ${s}.`;break}if(r!==void 0&&o!==r.value){e=`Expected '${i}' field to equal '${r.value}'`;break}}if(e)throw new U(V.INVALID_ARGUMENT,e);return!0}const Sh=-62135596800,Ch=1e6;class dt{static now(){return dt.fromMillis(Date.now())}static fromDate(t){return dt.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),i=Math.floor((t-1e3*e)*Ch);return new dt(e,i)}constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new U(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new U(V.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<Sh)throw new U(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new U(V.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/Ch}_compareTo(t){return this.seconds===t.seconds?Q(this.nanoseconds,t.nanoseconds):Q(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:dt._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(t){if(tr(t,dt._jsonSchema))return new dt(t.seconds,t.nanoseconds)}valueOf(){const t=this.seconds-Sh;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}dt._jsonSchemaVersion="firestore/timestamp/1.0",dt._jsonSchema={type:It("string",dt._jsonSchemaVersion),seconds:It("number"),nanoseconds:It("number")};class H{static fromTimestamp(t){return new H(t)}static min(){return new H(new dt(0,0))}static max(){return new H(new dt(253402300799,999999999))}constructor(t){this.timestamp=t}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const Ds=-1;function Y0(n,t){const e=n.toTimestamp().seconds,i=n.toTimestamp().nanoseconds+1,s=H.fromTimestamp(i===1e9?new dt(e+1,0):new dt(e,i));return new mn(s,z.empty(),t)}function X0(n){return new mn(n.readTime,n.key,Ds)}class mn{constructor(t,e,i){this.readTime=t,this.documentKey=e,this.largestBatchId=i}static min(){return new mn(H.min(),z.empty(),Ds)}static max(){return new mn(H.max(),z.empty(),Ds)}}function Q0(n,t){let e=n.readTime.compareTo(t.readTime);return e!==0?e:(e=z.comparator(n.documentKey,t.documentKey),e!==0?e:Q(n.largestBatchId,t.largestBatchId))}const J0="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Z0{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Fi(n){if(n.code!==V.FAILED_PRECONDITION||n.message!==J0)throw n;B("LocalStore","Unexpectedly lost primary lease")}class L{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)}),(e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&$(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new L(((i,s)=>{this.nextCallback=r=>{this.wrapSuccess(t,r).next(i,s)},this.catchCallback=r=>{this.wrapFailure(e,r).next(i,s)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof L?e:L.resolve(e)}catch(e){return L.reject(e)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):L.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):L.reject(e)}static resolve(t){return new L(((e,i)=>{e(t)}))}static reject(t){return new L(((e,i)=>{i(t)}))}static waitFor(t){return new L(((e,i)=>{let s=0,r=0,o=!1;t.forEach((a=>{++s,a.next((()=>{++r,o&&r===s&&e()}),(l=>i(l)))})),o=!0,r===s&&e()}))}static or(t){let e=L.resolve(!1);for(const i of t)e=e.next((s=>s?L.resolve(s):i()));return e}static forEach(t,e){const i=[];return t.forEach(((s,r)=>{i.push(e.call(this,s,r))})),this.waitFor(i)}static mapArray(t,e){return new L(((i,s)=>{const r=t.length,o=new Array(r);let a=0;for(let l=0;l<r;l++){const u=l;e(t[u]).next((h=>{o[u]=h,++a,a===r&&i(o)}),(h=>s(h)))}}))}static doWhile(t,e){return new L(((i,s)=>{const r=()=>{t()===!0?e().next((()=>{r()}),s):i()};r()}))}}function tw(n){const t=n.match(/Android ([\d.]+)/i),e=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(e)}function Bi(n){return n.name==="IndexedDbTransactionError"}class Mo{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=i=>this.ae(i),this.ue=i=>e.writeSequenceNumber(i))}ae(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.ue&&this.ue(t),t}}Mo.ce=-1;const ec=-1;function Oo(n){return n==null}function ao(n){return n===0&&1/n==-1/0}function ew(n){return typeof n=="number"&&Number.isInteger(n)&&!ao(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}const Gp="";function nw(n){let t="";for(let e=0;e<n.length;e++)t.length>0&&(t=Ph(t)),t=iw(n.get(e),t);return Ph(t)}function iw(n,t){let e=t;const i=n.length;for(let s=0;s<i;s++){const r=n.charAt(s);switch(r){case"\0":e+="";break;case Gp:e+="";break;default:e+=r}}return e}function Ph(n){return n+Gp+""}function Rh(n){let t=0;for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t++;return t}function ti(n,t){for(const e in n)Object.prototype.hasOwnProperty.call(n,e)&&t(e,n[e])}function Kp(n){for(const t in n)if(Object.prototype.hasOwnProperty.call(n,t))return!1;return!0}class mt{constructor(t,e){this.comparator=t,this.root=e||Ot.EMPTY}insert(t,e){return new mt(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ot.BLACK,null,null))}remove(t){return new mt(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ot.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const i=this.comparator(t,e.key);if(i===0)return e.value;i<0?e=e.left:i>0&&(e=e.right)}return null}indexOf(t){let e=0,i=this.root;for(;!i.isEmpty();){const s=this.comparator(t,i.key);if(s===0)return e+i.left.size;s<0?i=i.left:(e+=i.left.size+1,i=i.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,i)=>(t(e,i),!1)))}toString(){const t=[];return this.inorderTraversal(((e,i)=>(t.push(`${e}:${i}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Tr(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Tr(this.root,t,this.comparator,!1)}getReverseIterator(){return new Tr(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Tr(this.root,t,this.comparator,!0)}}class Tr{constructor(t,e,i,s){this.isReverse=s,this.nodeStack=[];let r=1;for(;!t.isEmpty();)if(r=e?i(t.key,e):1,e&&s&&(r*=-1),r<0)t=this.isReverse?t.left:t.right;else{if(r===0){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ot{constructor(t,e,i,s,r){this.key=t,this.value=e,this.color=i??Ot.RED,this.left=s??Ot.EMPTY,this.right=r??Ot.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,i,s,r){return new Ot(t??this.key,e??this.value,i??this.color,s??this.left,r??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,i){let s=this;const r=i(t,s.key);return s=r<0?s.copy(null,null,null,s.left.insert(t,e,i),null):r===0?s.copy(null,e,null,null,null):s.copy(null,null,null,null,s.right.insert(t,e,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return Ot.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let i,s=this;if(e(t,s.key)<0)s.left.isEmpty()||s.left.isRed()||s.left.left.isRed()||(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,e),null);else{if(s.left.isRed()&&(s=s.rotateRight()),s.right.isEmpty()||s.right.isRed()||s.right.left.isRed()||(s=s.moveRedRight()),e(t,s.key)===0){if(s.right.isEmpty())return Ot.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,e))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ot.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ot.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw $(43730,{key:this.key,value:this.value});if(this.right.isRed())throw $(14113,{key:this.key,value:this.value});const t=this.left.check();if(t!==this.right.check())throw $(27949);return t+(this.isRed()?0:1)}}Ot.EMPTY=null,Ot.RED=!0,Ot.BLACK=!1;Ot.EMPTY=new class{constructor(){this.size=0}get key(){throw $(57766)}get value(){throw $(16141)}get color(){throw $(16727)}get left(){throw $(29726)}get right(){throw $(36894)}copy(t,e,i,s,r){return this}insert(t,e,i){return new Ot(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Pt{constructor(t){this.comparator=t,this.data=new mt(this.comparator)}has(t){return this.data.get(t)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,i)=>(t(e),!1)))}forEachInRange(t,e){const i=this.data.getIteratorFrom(t[0]);for(;i.hasNext();){const s=i.getNext();if(this.comparator(s.key,t[1])>=0)return;e(s.key)}}forEachWhile(t,e){let i;for(i=e!==void 0?this.data.getIteratorFrom(e):this.data.getIterator();i.hasNext();)if(!t(i.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new kh(this.data.getIterator())}getIteratorFrom(t){return new kh(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((i=>{e=e.add(i)})),e}isEqual(t){if(!(t instanceof Pt)||this.size!==t.size)return!1;const e=this.data.getIterator(),i=t.data.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=i.getNext().key;if(this.comparator(s,r)!==0)return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Pt(this.comparator);return e.data=t,e}}class kh{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class le{constructor(t){this.fields=t,t.sort(Vt.comparator)}static empty(){return new le([])}unionWith(t){let e=new Pt(Vt.comparator);for(const i of this.fields)e=e.add(i);for(const i of t)e=e.add(i);return new le(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return Ii(this.fields,t.fields,((e,i)=>e.isEqual(i)))}}class Yp extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Lt{constructor(t){this.binaryString=t}static fromBase64String(t){const e=(function(s){try{return atob(s)}catch(r){throw typeof DOMException<"u"&&r instanceof DOMException?new Yp("Invalid base64 string: "+r):r}})(t);return new Lt(e)}static fromUint8Array(t){const e=(function(s){let r="";for(let o=0;o<s.length;++o)r+=String.fromCharCode(s[o]);return r})(t);return new Lt(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return(function(e){return btoa(e)})(this.binaryString)}toUint8Array(){return(function(e){const i=new Uint8Array(e.length);for(let s=0;s<e.length;s++)i[s]=e.charCodeAt(s);return i})(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return Q(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Lt.EMPTY_BYTE_STRING=new Lt("");const sw=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function yn(n){if(st(!!n,39018),typeof n=="string"){let t=0;const e=sw.exec(n);if(st(!!e,46558,{timestamp:n}),e[1]){let s=e[1];s=(s+"000000000").substr(0,9),t=Number(s)}const i=new Date(n);return{seconds:Math.floor(i.getTime()/1e3),nanos:t}}return{seconds:vt(n.seconds),nanos:vt(n.nanos)}}function vt(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function _n(n){return typeof n=="string"?Lt.fromBase64String(n):Lt.fromUint8Array(n)}const Xp="server_timestamp",Qp="__type__",Jp="__previous_value__",Zp="__local_write_time__";function nc(n){return(n?.mapValue?.fields||{})[Qp]?.stringValue===Xp}function Vo(n){const t=n.mapValue.fields[Jp];return nc(t)?Vo(t):t}function Ms(n){const t=yn(n.mapValue.fields[Zp].timestampValue);return new dt(t.seconds,t.nanos)}class rw{constructor(t,e,i,s,r,o,a,l,u,h){this.databaseId=t,this.appId=e,this.persistenceKey=i,this.host=s,this.ssl=r,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=u,this.isUsingEmulator=h}}const lo="(default)";class Os{constructor(t,e){this.projectId=t,this.database=e||lo}static empty(){return new Os("","")}get isDefaultDatabase(){return this.database===lo}isEqual(t){return t instanceof Os&&t.projectId===this.projectId&&t.database===this.database}}const tg="__type__",ow="__max__",xr={mapValue:{}},eg="__vector__",co="value";function bn(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?nc(n)?4:lw(n)?9007199254740991:aw(n)?10:11:$(28295,{value:n})}function Ie(n,t){if(n===t)return!0;const e=bn(n);if(e!==bn(t))return!1;switch(e){case 0:case 9007199254740991:return!0;case 1:return n.booleanValue===t.booleanValue;case 4:return Ms(n).isEqual(Ms(t));case 3:return(function(s,r){if(typeof s.timestampValue=="string"&&typeof r.timestampValue=="string"&&s.timestampValue.length===r.timestampValue.length)return s.timestampValue===r.timestampValue;const o=yn(s.timestampValue),a=yn(r.timestampValue);return o.seconds===a.seconds&&o.nanos===a.nanos})(n,t);case 5:return n.stringValue===t.stringValue;case 6:return(function(s,r){return _n(s.bytesValue).isEqual(_n(r.bytesValue))})(n,t);case 7:return n.referenceValue===t.referenceValue;case 8:return(function(s,r){return vt(s.geoPointValue.latitude)===vt(r.geoPointValue.latitude)&&vt(s.geoPointValue.longitude)===vt(r.geoPointValue.longitude)})(n,t);case 2:return(function(s,r){if("integerValue"in s&&"integerValue"in r)return vt(s.integerValue)===vt(r.integerValue);if("doubleValue"in s&&"doubleValue"in r){const o=vt(s.doubleValue),a=vt(r.doubleValue);return o===a?ao(o)===ao(a):isNaN(o)&&isNaN(a)}return!1})(n,t);case 9:return Ii(n.arrayValue.values||[],t.arrayValue.values||[],Ie);case 10:case 11:return(function(s,r){const o=s.mapValue.fields||{},a=r.mapValue.fields||{};if(Rh(o)!==Rh(a))return!1;for(const l in o)if(o.hasOwnProperty(l)&&(a[l]===void 0||!Ie(o[l],a[l])))return!1;return!0})(n,t);default:return $(52216,{left:n})}}function Vs(n,t){return(n.values||[]).find((e=>Ie(e,t)))!==void 0}function Ai(n,t){if(n===t)return 0;const e=bn(n),i=bn(t);if(e!==i)return Q(e,i);switch(e){case 0:case 9007199254740991:return 0;case 1:return Q(n.booleanValue,t.booleanValue);case 2:return(function(r,o){const a=vt(r.integerValue||r.doubleValue),l=vt(o.integerValue||o.doubleValue);return a<l?-1:a>l?1:a===l?0:isNaN(a)?isNaN(l)?0:-1:1})(n,t);case 3:return Dh(n.timestampValue,t.timestampValue);case 4:return Dh(Ms(n),Ms(t));case 5:return hl(n.stringValue,t.stringValue);case 6:return(function(r,o){const a=_n(r),l=_n(o);return a.compareTo(l)})(n.bytesValue,t.bytesValue);case 7:return(function(r,o){const a=r.split("/"),l=o.split("/");for(let u=0;u<a.length&&u<l.length;u++){const h=Q(a[u],l[u]);if(h!==0)return h}return Q(a.length,l.length)})(n.referenceValue,t.referenceValue);case 8:return(function(r,o){const a=Q(vt(r.latitude),vt(o.latitude));return a!==0?a:Q(vt(r.longitude),vt(o.longitude))})(n.geoPointValue,t.geoPointValue);case 9:return Mh(n.arrayValue,t.arrayValue);case 10:return(function(r,o){const a=r.fields||{},l=o.fields||{},u=a[co]?.arrayValue,h=l[co]?.arrayValue,d=Q(u?.values?.length||0,h?.values?.length||0);return d!==0?d:Mh(u,h)})(n.mapValue,t.mapValue);case 11:return(function(r,o){if(r===xr.mapValue&&o===xr.mapValue)return 0;if(r===xr.mapValue)return 1;if(o===xr.mapValue)return-1;const a=r.fields||{},l=Object.keys(a),u=o.fields||{},h=Object.keys(u);l.sort(),h.sort();for(let d=0;d<l.length&&d<h.length;++d){const p=hl(l[d],h[d]);if(p!==0)return p;const m=Ai(a[l[d]],u[h[d]]);if(m!==0)return m}return Q(l.length,h.length)})(n.mapValue,t.mapValue);default:throw $(23264,{he:e})}}function Dh(n,t){if(typeof n=="string"&&typeof t=="string"&&n.length===t.length)return Q(n,t);const e=yn(n),i=yn(t),s=Q(e.seconds,i.seconds);return s!==0?s:Q(e.nanos,i.nanos)}function Mh(n,t){const e=n.values||[],i=t.values||[];for(let s=0;s<e.length&&s<i.length;++s){const r=Ai(e[s],i[s]);if(r)return r}return Q(e.length,i.length)}function Si(n){return dl(n)}function dl(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?(function(e){const i=yn(e);return`time(${i.seconds},${i.nanos})`})(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?(function(e){return _n(e).toBase64()})(n.bytesValue):"referenceValue"in n?(function(e){return z.fromName(e).toString()})(n.referenceValue):"geoPointValue"in n?(function(e){return`geo(${e.latitude},${e.longitude})`})(n.geoPointValue):"arrayValue"in n?(function(e){let i="[",s=!0;for(const r of e.values||[])s?s=!1:i+=",",i+=dl(r);return i+"]"})(n.arrayValue):"mapValue"in n?(function(e){const i=Object.keys(e.fields||{}).sort();let s="{",r=!0;for(const o of i)r?r=!1:s+=",",s+=`${o}:${dl(e.fields[o])}`;return s+"}"})(n.mapValue):$(61005,{value:n})}function Wr(n){switch(bn(n)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Vo(n);return t?16+Wr(t):16;case 5:return 2*n.stringValue.length;case 6:return _n(n.bytesValue).approximateByteSize();case 7:return n.referenceValue.length;case 9:return(function(i){return(i.values||[]).reduce(((s,r)=>s+Wr(r)),0)})(n.arrayValue);case 10:case 11:return(function(i){let s=0;return ti(i.fields,((r,o)=>{s+=r.length+Wr(o)})),s})(n.mapValue);default:throw $(13486,{value:n})}}function Oh(n,t){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${t.path.canonicalString()}`}}function fl(n){return!!n&&"integerValue"in n}function ic(n){return!!n&&"arrayValue"in n}function Vh(n){return!!n&&"nullValue"in n}function Lh(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function qr(n){return!!n&&"mapValue"in n}function aw(n){return(n?.mapValue?.fields||{})[tg]?.stringValue===eg}function bs(n){if(n.geoPointValue)return{geoPointValue:{...n.geoPointValue}};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:{...n.timestampValue}};if(n.mapValue){const t={mapValue:{fields:{}}};return ti(n.mapValue.fields,((e,i)=>t.mapValue.fields[e]=bs(i))),t}if(n.arrayValue){const t={arrayValue:{values:[]}};for(let e=0;e<(n.arrayValue.values||[]).length;++e)t.arrayValue.values[e]=bs(n.arrayValue.values[e]);return t}return{...n}}function lw(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===ow}class ie{constructor(t){this.value=t}static empty(){return new ie({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let i=0;i<t.length-1;++i)if(e=(e.mapValue.fields||{})[t.get(i)],!qr(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=bs(e)}setAll(t){let e=Vt.emptyPath(),i={},s=[];t.forEach(((o,a)=>{if(!e.isImmediateParentOf(a)){const l=this.getFieldsMap(e);this.applyChanges(l,i,s),i={},s=[],e=a.popLast()}o?i[a.lastSegment()]=bs(o):s.push(a.lastSegment())}));const r=this.getFieldsMap(e);this.applyChanges(r,i,s)}delete(t){const e=this.field(t.popLast());qr(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return Ie(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let i=0;i<t.length;++i){let s=e.mapValue.fields[t.get(i)];qr(s)&&s.mapValue.fields||(s={mapValue:{fields:{}}},e.mapValue.fields[t.get(i)]=s),e=s}return e.mapValue.fields}applyChanges(t,e,i){ti(e,((s,r)=>t[s]=r));for(const s of i)delete t[s]}clone(){return new ie(bs(this.value))}}function ng(n){const t=[];return ti(n.fields,((e,i)=>{const s=new Vt([e]);if(qr(i)){const r=ng(i.mapValue).fields;if(r.length===0)t.push(s);else for(const o of r)t.push(s.child(o))}else t.push(s)})),new le(t)}class $t{constructor(t,e,i,s,r,o,a){this.key=t,this.documentType=e,this.version=i,this.readTime=s,this.createTime=r,this.data=o,this.documentState=a}static newInvalidDocument(t){return new $t(t,0,H.min(),H.min(),H.min(),ie.empty(),0)}static newFoundDocument(t,e,i,s){return new $t(t,1,e,H.min(),i,s,0)}static newNoDocument(t,e){return new $t(t,2,e,H.min(),H.min(),ie.empty(),0)}static newUnknownDocument(t,e){return new $t(t,3,e,H.min(),H.min(),ie.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(H.min())||this.documentType!==2&&this.documentType!==0||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=ie.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=ie.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=H.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(t){return t instanceof $t&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new $t(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class uo{constructor(t,e){this.position=t,this.inclusive=e}}function Nh(n,t,e){let i=0;for(let s=0;s<n.position.length;s++){const r=t[s],o=n.position[s];if(r.field.isKeyField()?i=z.comparator(z.fromName(o.referenceValue),e.key):i=Ai(o,e.data.field(r.field)),r.dir==="desc"&&(i*=-1),i!==0)break}return i}function Fh(n,t){if(n===null)return t===null;if(t===null||n.inclusive!==t.inclusive||n.position.length!==t.position.length)return!1;for(let e=0;e<n.position.length;e++)if(!Ie(n.position[e],t.position[e]))return!1;return!0}class ho{constructor(t,e="asc"){this.field=t,this.dir=e}}function cw(n,t){return n.dir===t.dir&&n.field.isEqual(t.field)}class ig{}class xt extends ig{constructor(t,e,i){super(),this.field=t,this.op=e,this.value=i}static create(t,e,i){return t.isKeyField()?e==="in"||e==="not-in"?this.createKeyFieldInFilter(t,e,i):new hw(t,e,i):e==="array-contains"?new pw(t,i):e==="in"?new gw(t,i):e==="not-in"?new mw(t,i):e==="array-contains-any"?new yw(t,i):new xt(t,e,i)}static createKeyFieldInFilter(t,e,i){return e==="in"?new dw(t,i):new fw(t,i)}matches(t){const e=t.data.field(this.field);return this.op==="!="?e!==null&&e.nullValue===void 0&&this.matchesComparison(Ai(e,this.value)):e!==null&&bn(this.value)===bn(e)&&this.matchesComparison(Ai(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return t===0;case"!=":return t!==0;case">":return t>0;case">=":return t>=0;default:return $(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class he extends ig{constructor(t,e){super(),this.filters=t,this.op=e,this.Pe=null}static create(t,e){return new he(t,e)}matches(t){return sg(this)?this.filters.find((e=>!e.matches(t)))===void 0:this.filters.find((e=>e.matches(t)))!==void 0}getFlattenedFilters(){return this.Pe!==null||(this.Pe=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function sg(n){return n.op==="and"}function rg(n){return uw(n)&&sg(n)}function uw(n){for(const t of n.filters)if(t instanceof he)return!1;return!0}function pl(n){if(n instanceof xt)return n.field.canonicalString()+n.op.toString()+Si(n.value);if(rg(n))return n.filters.map((t=>pl(t))).join(",");{const t=n.filters.map((e=>pl(e))).join(",");return`${n.op}(${t})`}}function og(n,t){return n instanceof xt?(function(i,s){return s instanceof xt&&i.op===s.op&&i.field.isEqual(s.field)&&Ie(i.value,s.value)})(n,t):n instanceof he?(function(i,s){return s instanceof he&&i.op===s.op&&i.filters.length===s.filters.length?i.filters.reduce(((r,o,a)=>r&&og(o,s.filters[a])),!0):!1})(n,t):void $(19439)}function ag(n){return n instanceof xt?(function(e){return`${e.field.canonicalString()} ${e.op} ${Si(e.value)}`})(n):n instanceof he?(function(e){return e.op.toString()+" {"+e.getFilters().map(ag).join(" ,")+"}"})(n):"Filter"}class hw extends xt{constructor(t,e,i){super(t,e,i),this.key=z.fromName(i.referenceValue)}matches(t){const e=z.comparator(t.key,this.key);return this.matchesComparison(e)}}class dw extends xt{constructor(t,e){super(t,"in",e),this.keys=lg("in",e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class fw extends xt{constructor(t,e){super(t,"not-in",e),this.keys=lg("not-in",e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function lg(n,t){return(t.arrayValue?.values||[]).map((e=>z.fromName(e.referenceValue)))}class pw extends xt{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ic(e)&&Vs(e.arrayValue,this.value)}}class gw extends xt{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return e!==null&&Vs(this.value.arrayValue,e)}}class mw extends xt{constructor(t,e){super(t,"not-in",e)}matches(t){if(Vs(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return e!==null&&e.nullValue===void 0&&!Vs(this.value.arrayValue,e)}}class yw extends xt{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ic(e)||!e.arrayValue.values)&&e.arrayValue.values.some((i=>Vs(this.value.arrayValue,i)))}}class _w{constructor(t,e=null,i=[],s=[],r=null,o=null,a=null){this.path=t,this.collectionGroup=e,this.orderBy=i,this.filters=s,this.limit=r,this.startAt=o,this.endAt=a,this.Te=null}}function Bh(n,t=null,e=[],i=[],s=null,r=null,o=null){return new _w(n,t,e,i,s,r,o)}function sc(n){const t=q(n);if(t.Te===null){let e=t.path.canonicalString();t.collectionGroup!==null&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map((i=>pl(i))).join(","),e+="|ob:",e+=t.orderBy.map((i=>(function(r){return r.field.canonicalString()+r.dir})(i))).join(","),Oo(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((i=>Si(i))).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((i=>Si(i))).join(",")),t.Te=e}return t.Te}function rc(n,t){if(n.limit!==t.limit||n.orderBy.length!==t.orderBy.length)return!1;for(let e=0;e<n.orderBy.length;e++)if(!cw(n.orderBy[e],t.orderBy[e]))return!1;if(n.filters.length!==t.filters.length)return!1;for(let e=0;e<n.filters.length;e++)if(!og(n.filters[e],t.filters[e]))return!1;return n.collectionGroup===t.collectionGroup&&!!n.path.isEqual(t.path)&&!!Fh(n.startAt,t.startAt)&&Fh(n.endAt,t.endAt)}function gl(n){return z.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}class er{constructor(t,e=null,i=[],s=[],r=null,o="F",a=null,l=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=i,this.filters=s,this.limit=r,this.limitType=o,this.startAt=a,this.endAt=l,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function bw(n,t,e,i,s,r,o,a){return new er(n,t,e,i,s,r,o,a)}function oc(n){return new er(n)}function Uh(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function cg(n){return n.collectionGroup!==null}function vs(n){const t=q(n);if(t.Ie===null){t.Ie=[];const e=new Set;for(const r of t.explicitOrderBy)t.Ie.push(r),e.add(r.field.canonicalString());const i=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc";(function(o){let a=new Pt(Vt.comparator);return o.filters.forEach((l=>{l.getFlattenedFilters().forEach((u=>{u.isInequality()&&(a=a.add(u.field))}))})),a})(t).forEach((r=>{e.has(r.canonicalString())||r.isKeyField()||t.Ie.push(new ho(r,i))})),e.has(Vt.keyField().canonicalString())||t.Ie.push(new ho(Vt.keyField(),i))}return t.Ie}function _e(n){const t=q(n);return t.Ee||(t.Ee=vw(t,vs(n))),t.Ee}function vw(n,t){if(n.limitType==="F")return Bh(n.path,n.collectionGroup,t,n.filters,n.limit,n.startAt,n.endAt);{t=t.map((s=>{const r=s.dir==="desc"?"asc":"desc";return new ho(s.field,r)}));const e=n.endAt?new uo(n.endAt.position,n.endAt.inclusive):null,i=n.startAt?new uo(n.startAt.position,n.startAt.inclusive):null;return Bh(n.path,n.collectionGroup,t,n.filters,n.limit,e,i)}}function ml(n,t){const e=n.filters.concat([t]);return new er(n.path,n.collectionGroup,n.explicitOrderBy.slice(),e,n.limit,n.limitType,n.startAt,n.endAt)}function yl(n,t,e){return new er(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),t,e,n.startAt,n.endAt)}function Lo(n,t){return rc(_e(n),_e(t))&&n.limitType===t.limitType}function ug(n){return`${sc(_e(n))}|lt:${n.limitType}`}function hi(n){return`Query(target=${(function(e){let i=e.path.canonicalString();return e.collectionGroup!==null&&(i+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(i+=`, filters: [${e.filters.map((s=>ag(s))).join(", ")}]`),Oo(e.limit)||(i+=", limit: "+e.limit),e.orderBy.length>0&&(i+=`, orderBy: [${e.orderBy.map((s=>(function(o){return`${o.field.canonicalString()} (${o.dir})`})(s))).join(", ")}]`),e.startAt&&(i+=", startAt: ",i+=e.startAt.inclusive?"b:":"a:",i+=e.startAt.position.map((s=>Si(s))).join(",")),e.endAt&&(i+=", endAt: ",i+=e.endAt.inclusive?"a:":"b:",i+=e.endAt.position.map((s=>Si(s))).join(",")),`Target(${i})`})(_e(n))}; limitType=${n.limitType})`}function No(n,t){return t.isFoundDocument()&&(function(i,s){const r=s.key.path;return i.collectionGroup!==null?s.key.hasCollectionId(i.collectionGroup)&&i.path.isPrefixOf(r):z.isDocumentKey(i.path)?i.path.isEqual(r):i.path.isImmediateParentOf(r)})(n,t)&&(function(i,s){for(const r of vs(i))if(!r.field.isKeyField()&&s.data.field(r.field)===null)return!1;return!0})(n,t)&&(function(i,s){for(const r of i.filters)if(!r.matches(s))return!1;return!0})(n,t)&&(function(i,s){return!(i.startAt&&!(function(o,a,l){const u=Nh(o,a,l);return o.inclusive?u<=0:u<0})(i.startAt,vs(i),s)||i.endAt&&!(function(o,a,l){const u=Nh(o,a,l);return o.inclusive?u>=0:u>0})(i.endAt,vs(i),s))})(n,t)}function ww(n){return n.collectionGroup||(n.path.length%2==1?n.path.lastSegment():n.path.get(n.path.length-2))}function hg(n){return(t,e)=>{let i=!1;for(const s of vs(n)){const r=Ew(s,t,e);if(r!==0)return r;i=i||s.field.isKeyField()}return 0}}function Ew(n,t,e){const i=n.field.isKeyField()?z.comparator(t.key,e.key):(function(r,o,a){const l=o.data.field(r),u=a.data.field(r);return l!==null&&u!==null?Ai(l,u):$(42886)})(n.field,t,e);switch(n.dir){case"asc":return i;case"desc":return-1*i;default:return $(19790,{direction:n.dir})}}class ei{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i!==void 0){for(const[s,r]of i)if(this.equalsFn(s,t))return r}}has(t){return this.get(t)!==void 0}set(t,e){const i=this.mapKeyFn(t),s=this.inner[i];if(s===void 0)return this.inner[i]=[[t,e]],void this.innerSize++;for(let r=0;r<s.length;r++)if(this.equalsFn(s[r][0],t))return void(s[r]=[t,e]);s.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),i=this.inner[e];if(i===void 0)return!1;for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],t))return i.length===1?delete this.inner[e]:i.splice(s,1),this.innerSize--,!0;return!1}forEach(t){ti(this.inner,((e,i)=>{for(const[s,r]of i)t(s,r)}))}isEmpty(){return Kp(this.inner)}size(){return this.innerSize}}const Tw=new mt(z.comparator);function $e(){return Tw}const dg=new mt(z.comparator);function us(...n){let t=dg;for(const e of n)t=t.insert(e.key,e);return t}function fg(n){let t=dg;return n.forEach(((e,i)=>t=t.insert(e,i.overlayedDocument))),t}function Un(){return ws()}function pg(){return ws()}function ws(){return new ei((n=>n.toString()),((n,t)=>n.isEqual(t)))}const xw=new mt(z.comparator),Iw=new Pt(z.comparator);function J(...n){let t=Iw;for(const e of n)t=t.add(e);return t}const Aw=new Pt(Q);function Sw(){return Aw}function ac(n,t){if(n.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:ao(t)?"-0":t}}function gg(n){return{integerValue:""+n}}function Cw(n,t){return ew(t)?gg(t):ac(n,t)}class Fo{constructor(){this._=void 0}}function Pw(n,t,e){return n instanceof fo?(function(s,r){const o={fields:{[Qp]:{stringValue:Xp},[Zp]:{timestampValue:{seconds:s.seconds,nanos:s.nanoseconds}}}};return r&&nc(r)&&(r=Vo(r)),r&&(o.fields[Jp]=r),{mapValue:o}})(e,t):n instanceof Ls?yg(n,t):n instanceof Ns?_g(n,t):(function(s,r){const o=mg(s,r),a=zh(o)+zh(s.Ae);return fl(o)&&fl(s.Ae)?gg(a):ac(s.serializer,a)})(n,t)}function Rw(n,t,e){return n instanceof Ls?yg(n,t):n instanceof Ns?_g(n,t):e}function mg(n,t){return n instanceof po?(function(i){return fl(i)||(function(r){return!!r&&"doubleValue"in r})(i)})(t)?t:{integerValue:0}:null}class fo extends Fo{}class Ls extends Fo{constructor(t){super(),this.elements=t}}function yg(n,t){const e=bg(t);for(const i of n.elements)e.some((s=>Ie(s,i)))||e.push(i);return{arrayValue:{values:e}}}class Ns extends Fo{constructor(t){super(),this.elements=t}}function _g(n,t){let e=bg(t);for(const i of n.elements)e=e.filter((s=>!Ie(s,i)));return{arrayValue:{values:e}}}class po extends Fo{constructor(t,e){super(),this.serializer=t,this.Ae=e}}function zh(n){return vt(n.integerValue||n.doubleValue)}function bg(n){return ic(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}function kw(n,t){return n.field.isEqual(t.field)&&(function(i,s){return i instanceof Ls&&s instanceof Ls||i instanceof Ns&&s instanceof Ns?Ii(i.elements,s.elements,Ie):i instanceof po&&s instanceof po?Ie(i.Ae,s.Ae):i instanceof fo&&s instanceof fo})(n.transform,t.transform)}class Dw{constructor(t,e){this.version=t,this.transformResults=e}}class be{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new be}static exists(t){return new be(void 0,t)}static updateTime(t){return new be(t)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Gr(n,t){return n.updateTime!==void 0?t.isFoundDocument()&&t.version.isEqual(n.updateTime):n.exists===void 0||n.exists===t.isFoundDocument()}class Bo{}function vg(n,t){if(!n.hasLocalMutations||t&&t.fields.length===0)return null;if(t===null)return n.isNoDocument()?new lc(n.key,be.none()):new nr(n.key,n.data,be.none());{const e=n.data,i=ie.empty();let s=new Pt(Vt.comparator);for(let r of t.fields)if(!s.has(r)){let o=e.field(r);o===null&&r.length>1&&(r=r.popLast(),o=e.field(r)),o===null?i.delete(r):i.set(r,o),s=s.add(r)}return new ni(n.key,i,new le(s.toArray()),be.none())}}function Mw(n,t,e){n instanceof nr?(function(s,r,o){const a=s.value.clone(),l=jh(s.fieldTransforms,r,o.transformResults);a.setAll(l),r.convertToFoundDocument(o.version,a).setHasCommittedMutations()})(n,t,e):n instanceof ni?(function(s,r,o){if(!Gr(s.precondition,r))return void r.convertToUnknownDocument(o.version);const a=jh(s.fieldTransforms,r,o.transformResults),l=r.data;l.setAll(wg(s)),l.setAll(a),r.convertToFoundDocument(o.version,l).setHasCommittedMutations()})(n,t,e):(function(s,r,o){r.convertToNoDocument(o.version).setHasCommittedMutations()})(0,t,e)}function Es(n,t,e,i){return n instanceof nr?(function(r,o,a,l){if(!Gr(r.precondition,o))return a;const u=r.value.clone(),h=Hh(r.fieldTransforms,l,o);return u.setAll(h),o.convertToFoundDocument(o.version,u).setHasLocalMutations(),null})(n,t,e,i):n instanceof ni?(function(r,o,a,l){if(!Gr(r.precondition,o))return a;const u=Hh(r.fieldTransforms,l,o),h=o.data;return h.setAll(wg(r)),h.setAll(u),o.convertToFoundDocument(o.version,h).setHasLocalMutations(),a===null?null:a.unionWith(r.fieldMask.fields).unionWith(r.fieldTransforms.map((d=>d.field)))})(n,t,e,i):(function(r,o,a){return Gr(r.precondition,o)?(o.convertToNoDocument(o.version).setHasLocalMutations(),null):a})(n,t,e)}function Ow(n,t){let e=null;for(const i of n.fieldTransforms){const s=t.data.field(i.field),r=mg(i.transform,s||null);r!=null&&(e===null&&(e=ie.empty()),e.set(i.field,r))}return e||null}function $h(n,t){return n.type===t.type&&!!n.key.isEqual(t.key)&&!!n.precondition.isEqual(t.precondition)&&!!(function(i,s){return i===void 0&&s===void 0||!(!i||!s)&&Ii(i,s,((r,o)=>kw(r,o)))})(n.fieldTransforms,t.fieldTransforms)&&(n.type===0?n.value.isEqual(t.value):n.type!==1||n.data.isEqual(t.data)&&n.fieldMask.isEqual(t.fieldMask))}class nr extends Bo{constructor(t,e,i,s=[]){super(),this.key=t,this.value=e,this.precondition=i,this.fieldTransforms=s,this.type=0}getFieldMask(){return null}}class ni extends Bo{constructor(t,e,i,s,r=[]){super(),this.key=t,this.data=e,this.fieldMask=i,this.precondition=s,this.fieldTransforms=r,this.type=1}getFieldMask(){return this.fieldMask}}function wg(n){const t=new Map;return n.fieldMask.fields.forEach((e=>{if(!e.isEmpty()){const i=n.data.field(e);t.set(e,i)}})),t}function jh(n,t,e){const i=new Map;st(n.length===e.length,32656,{Re:e.length,Ve:n.length});for(let s=0;s<e.length;s++){const r=n[s],o=r.transform,a=t.data.field(r.field);i.set(r.field,Rw(o,a,e[s]))}return i}function Hh(n,t,e){const i=new Map;for(const s of n){const r=s.transform,o=e.data.field(s.field);i.set(s.field,Pw(r,o,t))}return i}class lc extends Bo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Vw extends Bo{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Lw{constructor(t,e,i,s){this.batchId=t,this.localWriteTime=e,this.baseMutations=i,this.mutations=s}applyToRemoteDocument(t,e){const i=e.mutationResults;for(let s=0;s<this.mutations.length;s++){const r=this.mutations[s];r.key.isEqual(t.key)&&Mw(r,t,i[s])}}applyToLocalView(t,e){for(const i of this.baseMutations)i.key.isEqual(t.key)&&(e=Es(i,t,e,this.localWriteTime));for(const i of this.mutations)i.key.isEqual(t.key)&&(e=Es(i,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const i=pg();return this.mutations.forEach((s=>{const r=t.get(s.key),o=r.overlayedDocument;let a=this.applyToLocalView(o,r.mutatedFields);a=e.has(s.key)?null:a;const l=vg(o,a);l!==null&&i.set(s.key,l),o.isValidDocument()||o.convertToNoDocument(H.min())})),i}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),J())}isEqual(t){return this.batchId===t.batchId&&Ii(this.mutations,t.mutations,((e,i)=>$h(e,i)))&&Ii(this.baseMutations,t.baseMutations,((e,i)=>$h(e,i)))}}class cc{constructor(t,e,i,s){this.batch=t,this.commitVersion=e,this.mutationResults=i,this.docVersions=s}static from(t,e,i){st(t.mutations.length===i.length,58842,{me:t.mutations.length,fe:i.length});let s=(function(){return xw})();const r=t.mutations;for(let o=0;o<r.length;o++)s=s.insert(r[o].key,i[o].version);return new cc(t,e,i,s)}}class Nw{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return t!==null&&this.mutation===t.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}}class Fw{constructor(t,e){this.count=t,this.unchangedNames=e}}var Tt,tt;function Bw(n){switch(n){case V.OK:return $(64938);case V.CANCELLED:case V.UNKNOWN:case V.DEADLINE_EXCEEDED:case V.RESOURCE_EXHAUSTED:case V.INTERNAL:case V.UNAVAILABLE:case V.UNAUTHENTICATED:return!1;case V.INVALID_ARGUMENT:case V.NOT_FOUND:case V.ALREADY_EXISTS:case V.PERMISSION_DENIED:case V.FAILED_PRECONDITION:case V.ABORTED:case V.OUT_OF_RANGE:case V.UNIMPLEMENTED:case V.DATA_LOSS:return!0;default:return $(15467,{code:n})}}function Eg(n){if(n===void 0)return ze("GRPC error has no .code"),V.UNKNOWN;switch(n){case Tt.OK:return V.OK;case Tt.CANCELLED:return V.CANCELLED;case Tt.UNKNOWN:return V.UNKNOWN;case Tt.DEADLINE_EXCEEDED:return V.DEADLINE_EXCEEDED;case Tt.RESOURCE_EXHAUSTED:return V.RESOURCE_EXHAUSTED;case Tt.INTERNAL:return V.INTERNAL;case Tt.UNAVAILABLE:return V.UNAVAILABLE;case Tt.UNAUTHENTICATED:return V.UNAUTHENTICATED;case Tt.INVALID_ARGUMENT:return V.INVALID_ARGUMENT;case Tt.NOT_FOUND:return V.NOT_FOUND;case Tt.ALREADY_EXISTS:return V.ALREADY_EXISTS;case Tt.PERMISSION_DENIED:return V.PERMISSION_DENIED;case Tt.FAILED_PRECONDITION:return V.FAILED_PRECONDITION;case Tt.ABORTED:return V.ABORTED;case Tt.OUT_OF_RANGE:return V.OUT_OF_RANGE;case Tt.UNIMPLEMENTED:return V.UNIMPLEMENTED;case Tt.DATA_LOSS:return V.DATA_LOSS;default:return $(39323,{code:n})}}(tt=Tt||(Tt={}))[tt.OK=0]="OK",tt[tt.CANCELLED=1]="CANCELLED",tt[tt.UNKNOWN=2]="UNKNOWN",tt[tt.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",tt[tt.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",tt[tt.NOT_FOUND=5]="NOT_FOUND",tt[tt.ALREADY_EXISTS=6]="ALREADY_EXISTS",tt[tt.PERMISSION_DENIED=7]="PERMISSION_DENIED",tt[tt.UNAUTHENTICATED=16]="UNAUTHENTICATED",tt[tt.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",tt[tt.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",tt[tt.ABORTED=10]="ABORTED",tt[tt.OUT_OF_RANGE=11]="OUT_OF_RANGE",tt[tt.UNIMPLEMENTED=12]="UNIMPLEMENTED",tt[tt.INTERNAL=13]="INTERNAL",tt[tt.UNAVAILABLE=14]="UNAVAILABLE",tt[tt.DATA_LOSS=15]="DATA_LOSS";function Uw(){return new TextEncoder}const zw=new fn([4294967295,4294967295],0);function Wh(n){const t=Uw().encode(n),e=new Np;return e.update(t),new Uint8Array(e.digest())}function qh(n){const t=new DataView(n.buffer),e=t.getUint32(0,!0),i=t.getUint32(4,!0),s=t.getUint32(8,!0),r=t.getUint32(12,!0);return[new fn([e,i],0),new fn([s,r],0)]}class uc{constructor(t,e,i){if(this.bitmap=t,this.padding=e,this.hashCount=i,e<0||e>=8)throw new hs(`Invalid padding: ${e}`);if(i<0)throw new hs(`Invalid hash count: ${i}`);if(t.length>0&&this.hashCount===0)throw new hs(`Invalid hash count: ${i}`);if(t.length===0&&e!==0)throw new hs(`Invalid padding when bitmap length is 0: ${e}`);this.ge=8*t.length-e,this.pe=fn.fromNumber(this.ge)}ye(t,e,i){let s=t.add(e.multiply(fn.fromNumber(i)));return s.compare(zw)===1&&(s=new fn([s.getBits(0),s.getBits(1)],0)),s.modulo(this.pe).toNumber()}we(t){return!!(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(this.ge===0)return!1;const e=Wh(t),[i,s]=qh(e);for(let r=0;r<this.hashCount;r++){const o=this.ye(i,s,r);if(!this.we(o))return!1}return!0}static create(t,e,i){const s=t%8==0?0:8-t%8,r=new Uint8Array(Math.ceil(t/8)),o=new uc(r,s,e);return i.forEach((a=>o.insert(a))),o}insert(t){if(this.ge===0)return;const e=Wh(t),[i,s]=qh(e);for(let r=0;r<this.hashCount;r++){const o=this.ye(i,s,r);this.Se(o)}}Se(t){const e=Math.floor(t/8),i=t%8;this.bitmap[e]|=1<<i}}class hs extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Uo{constructor(t,e,i,s,r){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=i,this.documentUpdates=s,this.resolvedLimboDocuments=r}static createSynthesizedRemoteEventForCurrentChange(t,e,i){const s=new Map;return s.set(t,ir.createSynthesizedTargetChangeForCurrentChange(t,e,i)),new Uo(H.min(),s,new mt(Q),$e(),J())}}class ir{constructor(t,e,i,s,r){this.resumeToken=t,this.current=e,this.addedDocuments=i,this.modifiedDocuments=s,this.removedDocuments=r}static createSynthesizedTargetChangeForCurrentChange(t,e,i){return new ir(i,e,J(),J(),J())}}class Kr{constructor(t,e,i,s){this.be=t,this.removedTargetIds=e,this.key=i,this.De=s}}class Tg{constructor(t,e){this.targetId=t,this.Ce=e}}class xg{constructor(t,e,i=Lt.EMPTY_BYTE_STRING,s=null){this.state=t,this.targetIds=e,this.resumeToken=i,this.cause=s}}class Gh{constructor(){this.ve=0,this.Fe=Kh(),this.Me=Lt.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return this.ve!==0}get Be(){return this.Oe}Le(t){t.approximateByteSize()>0&&(this.Oe=!0,this.Me=t)}ke(){let t=J(),e=J(),i=J();return this.Fe.forEach(((s,r)=>{switch(r){case 0:t=t.add(s);break;case 2:e=e.add(s);break;case 1:i=i.add(s);break;default:$(38017,{changeType:r})}})),new ir(this.Me,this.xe,t,e,i)}qe(){this.Oe=!1,this.Fe=Kh()}Qe(t,e){this.Oe=!0,this.Fe=this.Fe.insert(t,e)}$e(t){this.Oe=!0,this.Fe=this.Fe.remove(t)}Ue(){this.ve+=1}Ke(){this.ve-=1,st(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class $w{constructor(t){this.Ge=t,this.ze=new Map,this.je=$e(),this.Je=Ir(),this.He=Ir(),this.Ye=new mt(Q)}Ze(t){for(const e of t.be)t.De&&t.De.isFoundDocument()?this.Xe(e,t.De):this.et(e,t.key,t.De);for(const e of t.removedTargetIds)this.et(e,t.key,t.De)}tt(t){this.forEachTarget(t,(e=>{const i=this.nt(e);switch(t.state){case 0:this.rt(e)&&i.Le(t.resumeToken);break;case 1:i.Ke(),i.Ne||i.qe(),i.Le(t.resumeToken);break;case 2:i.Ke(),i.Ne||this.removeTarget(e);break;case 3:this.rt(e)&&(i.We(),i.Le(t.resumeToken));break;case 4:this.rt(e)&&(this.it(e),i.Le(t.resumeToken));break;default:$(56790,{state:t.state})}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ze.forEach(((i,s)=>{this.rt(s)&&e(s)}))}st(t){const e=t.targetId,i=t.Ce.count,s=this.ot(e);if(s){const r=s.target;if(gl(r))if(i===0){const o=new z(r.path);this.et(e,o,$t.newNoDocument(o,H.min()))}else st(i===1,20013,{expectedCount:i});else{const o=this._t(e);if(o!==i){const a=this.ut(t),l=a?this.ct(a,t,o):1;if(l!==0){this.it(e);const u=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(e,u)}}}}}ut(t){const e=t.Ce.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:i="",padding:s=0},hashCount:r=0}=e;let o,a;try{o=_n(i).toUint8Array()}catch(l){if(l instanceof Yp)return xi("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}try{a=new uc(o,s,r)}catch(l){return xi(l instanceof hs?"BloomFilter error: ":"Applying bloom filter failed: ",l),null}return a.ge===0?null:a}ct(t,e,i){return e.Ce.count===i-this.Pt(t,e.targetId)?0:2}Pt(t,e){const i=this.Ge.getRemoteKeysForTarget(e);let s=0;return i.forEach((r=>{const o=this.Ge.ht(),a=`projects/${o.projectId}/databases/${o.database}/documents/${r.path.canonicalString()}`;t.mightContain(a)||(this.et(e,r,null),s++)})),s}Tt(t){const e=new Map;this.ze.forEach(((r,o)=>{const a=this.ot(o);if(a){if(r.current&&gl(a.target)){const l=new z(a.target.path);this.It(l).has(o)||this.Et(o,l)||this.et(o,l,$t.newNoDocument(l,t))}r.Be&&(e.set(o,r.ke()),r.qe())}}));let i=J();this.He.forEach(((r,o)=>{let a=!0;o.forEachWhile((l=>{const u=this.ot(l);return!u||u.purpose==="TargetPurposeLimboResolution"||(a=!1,!1)})),a&&(i=i.add(r))})),this.je.forEach(((r,o)=>o.setReadTime(t)));const s=new Uo(t,e,this.Ye,this.je,i);return this.je=$e(),this.Je=Ir(),this.He=Ir(),this.Ye=new mt(Q),s}Xe(t,e){if(!this.rt(t))return;const i=this.Et(t,e.key)?2:0;this.nt(t).Qe(e.key,i),this.je=this.je.insert(e.key,e),this.Je=this.Je.insert(e.key,this.It(e.key).add(t)),this.He=this.He.insert(e.key,this.dt(e.key).add(t))}et(t,e,i){if(!this.rt(t))return;const s=this.nt(t);this.Et(t,e)?s.Qe(e,1):s.$e(e),this.He=this.He.insert(e,this.dt(e).delete(t)),this.He=this.He.insert(e,this.dt(e).add(t)),i&&(this.je=this.je.insert(e,i))}removeTarget(t){this.ze.delete(t)}_t(t){const e=this.nt(t).ke();return this.Ge.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Ue(t){this.nt(t).Ue()}nt(t){let e=this.ze.get(t);return e||(e=new Gh,this.ze.set(t,e)),e}dt(t){let e=this.He.get(t);return e||(e=new Pt(Q),this.He=this.He.insert(t,e)),e}It(t){let e=this.Je.get(t);return e||(e=new Pt(Q),this.Je=this.Je.insert(t,e)),e}rt(t){const e=this.ot(t)!==null;return e||B("WatchChangeAggregator","Detected inactive target",t),e}ot(t){const e=this.ze.get(t);return e&&e.Ne?null:this.Ge.At(t)}it(t){this.ze.set(t,new Gh),this.Ge.getRemoteKeysForTarget(t).forEach((e=>{this.et(t,e,null)}))}Et(t,e){return this.Ge.getRemoteKeysForTarget(t).has(e)}}function Ir(){return new mt(z.comparator)}function Kh(){return new mt(z.comparator)}const jw={asc:"ASCENDING",desc:"DESCENDING"},Hw={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Ww={and:"AND",or:"OR"};class qw{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function _l(n,t){return n.useProto3Json||Oo(t)?t:{value:t}}function go(n,t){return n.useProto3Json?`${new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+t.nanoseconds).slice(-9)}Z`:{seconds:""+t.seconds,nanos:t.nanoseconds}}function Ig(n,t){return n.useProto3Json?t.toBase64():t.toUint8Array()}function Gw(n,t){return go(n,t.toTimestamp())}function ve(n){return st(!!n,49232),H.fromTimestamp((function(e){const i=yn(e);return new dt(i.seconds,i.nanos)})(n))}function hc(n,t){return bl(n,t).canonicalString()}function bl(n,t){const e=(function(s){return new ct(["projects",s.projectId,"databases",s.database])})(n).child("documents");return t===void 0?e:e.child(t)}function Ag(n){const t=ct.fromString(n);return st(kg(t),10190,{key:t.toString()}),t}function vl(n,t){return hc(n.databaseId,t.path)}function Pa(n,t){const e=Ag(t);if(e.get(1)!==n.databaseId.projectId)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+e.get(1)+" vs "+n.databaseId.projectId);if(e.get(3)!==n.databaseId.database)throw new U(V.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+e.get(3)+" vs "+n.databaseId.database);return new z(Cg(e))}function Sg(n,t){return hc(n.databaseId,t)}function Kw(n){const t=Ag(n);return t.length===4?ct.emptyPath():Cg(t)}function wl(n){return new ct(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function Cg(n){return st(n.length>4&&n.get(4)==="documents",29091,{key:n.toString()}),n.popFirst(5)}function Yh(n,t,e){return{name:vl(n,t),fields:e.value.mapValue.fields}}function Yw(n,t){let e;if("targetChange"in t){t.targetChange;const i=(function(u){return u==="NO_CHANGE"?0:u==="ADD"?1:u==="REMOVE"?2:u==="CURRENT"?3:u==="RESET"?4:$(39313,{state:u})})(t.targetChange.targetChangeType||"NO_CHANGE"),s=t.targetChange.targetIds||[],r=(function(u,h){return u.useProto3Json?(st(h===void 0||typeof h=="string",58123),Lt.fromBase64String(h||"")):(st(h===void 0||h instanceof Buffer||h instanceof Uint8Array,16193),Lt.fromUint8Array(h||new Uint8Array))})(n,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&(function(u){const h=u.code===void 0?V.UNKNOWN:Eg(u.code);return new U(h,u.message||"")})(o);e=new xg(i,s,r,a||null)}else if("documentChange"in t){t.documentChange;const i=t.documentChange;i.document,i.document.name,i.document.updateTime;const s=Pa(n,i.document.name),r=ve(i.document.updateTime),o=i.document.createTime?ve(i.document.createTime):H.min(),a=new ie({mapValue:{fields:i.document.fields}}),l=$t.newFoundDocument(s,r,o,a),u=i.targetIds||[],h=i.removedTargetIds||[];e=new Kr(u,h,l.key,l)}else if("documentDelete"in t){t.documentDelete;const i=t.documentDelete;i.document;const s=Pa(n,i.document),r=i.readTime?ve(i.readTime):H.min(),o=$t.newNoDocument(s,r),a=i.removedTargetIds||[];e=new Kr([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const i=t.documentRemove;i.document;const s=Pa(n,i.document),r=i.removedTargetIds||[];e=new Kr([],r,s,null)}else{if(!("filter"in t))return $(11601,{Rt:t});{t.filter;const i=t.filter;i.targetId;const{count:s=0,unchangedNames:r}=i,o=new Fw(s,r),a=i.targetId;e=new Tg(a,o)}}return e}function Xw(n,t){let e;if(t instanceof nr)e={update:Yh(n,t.key,t.value)};else if(t instanceof lc)e={delete:vl(n,t.key)};else if(t instanceof ni)e={update:Yh(n,t.key,t.data),updateMask:rE(t.fieldMask)};else{if(!(t instanceof Vw))return $(16599,{Vt:t.type});e={verify:vl(n,t.key)}}return t.fieldTransforms.length>0&&(e.updateTransforms=t.fieldTransforms.map((i=>(function(r,o){const a=o.transform;if(a instanceof fo)return{fieldPath:o.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(a instanceof Ls)return{fieldPath:o.field.canonicalString(),appendMissingElements:{values:a.elements}};if(a instanceof Ns)return{fieldPath:o.field.canonicalString(),removeAllFromArray:{values:a.elements}};if(a instanceof po)return{fieldPath:o.field.canonicalString(),increment:a.Ae};throw $(20930,{transform:o.transform})})(0,i)))),t.precondition.isNone||(e.currentDocument=(function(s,r){return r.updateTime!==void 0?{updateTime:Gw(s,r.updateTime)}:r.exists!==void 0?{exists:r.exists}:$(27497)})(n,t.precondition)),e}function Qw(n,t){return n&&n.length>0?(st(t!==void 0,14353),n.map((e=>(function(s,r){let o=s.updateTime?ve(s.updateTime):ve(r);return o.isEqual(H.min())&&(o=ve(r)),new Dw(o,s.transformResults||[])})(e,t)))):[]}function Jw(n,t){return{documents:[Sg(n,t.path)]}}function Zw(n,t){const e={structuredQuery:{}},i=t.path;let s;t.collectionGroup!==null?(s=i,e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(s=i.popLast(),e.structuredQuery.from=[{collectionId:i.lastSegment()}]),e.parent=Sg(n,s);const r=(function(u){if(u.length!==0)return Rg(he.create(u,"and"))})(t.filters);r&&(e.structuredQuery.where=r);const o=(function(u){if(u.length!==0)return u.map((h=>(function(p){return{field:di(p.field),direction:nE(p.dir)}})(h)))})(t.orderBy);o&&(e.structuredQuery.orderBy=o);const a=_l(n,t.limit);return a!==null&&(e.structuredQuery.limit=a),t.startAt&&(e.structuredQuery.startAt=(function(u){return{before:u.inclusive,values:u.position}})(t.startAt)),t.endAt&&(e.structuredQuery.endAt=(function(u){return{before:!u.inclusive,values:u.position}})(t.endAt)),{ft:e,parent:s}}function tE(n){let t=Kw(n.parent);const e=n.structuredQuery,i=e.from?e.from.length:0;let s=null;if(i>0){st(i===1,65062);const h=e.from[0];h.allDescendants?s=h.collectionId:t=t.child(h.collectionId)}let r=[];e.where&&(r=(function(d){const p=Pg(d);return p instanceof he&&rg(p)?p.getFilters():[p]})(e.where));let o=[];e.orderBy&&(o=(function(d){return d.map((p=>(function(b){return new ho(fi(b.field),(function(E){switch(E){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}})(b.direction))})(p)))})(e.orderBy));let a=null;e.limit&&(a=(function(d){let p;return p=typeof d=="object"?d.value:d,Oo(p)?null:p})(e.limit));let l=null;e.startAt&&(l=(function(d){const p=!!d.before,m=d.values||[];return new uo(m,p)})(e.startAt));let u=null;return e.endAt&&(u=(function(d){const p=!d.before,m=d.values||[];return new uo(m,p)})(e.endAt)),bw(t,s,o,r,a,"F",l,u)}function eE(n,t){const e=(function(s){switch(s){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return $(28987,{purpose:s})}})(t.purpose);return e==null?null:{"goog-listen-tags":e}}function Pg(n){return n.unaryFilter!==void 0?(function(e){switch(e.unaryFilter.op){case"IS_NAN":const i=fi(e.unaryFilter.field);return xt.create(i,"==",{doubleValue:NaN});case"IS_NULL":const s=fi(e.unaryFilter.field);return xt.create(s,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=fi(e.unaryFilter.field);return xt.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const o=fi(e.unaryFilter.field);return xt.create(o,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return $(61313);default:return $(60726)}})(n):n.fieldFilter!==void 0?(function(e){return xt.create(fi(e.fieldFilter.field),(function(s){switch(s){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return $(58110);default:return $(50506)}})(e.fieldFilter.op),e.fieldFilter.value)})(n):n.compositeFilter!==void 0?(function(e){return he.create(e.compositeFilter.filters.map((i=>Pg(i))),(function(s){switch(s){case"AND":return"and";case"OR":return"or";default:return $(1026)}})(e.compositeFilter.op))})(n):$(30097,{filter:n})}function nE(n){return jw[n]}function iE(n){return Hw[n]}function sE(n){return Ww[n]}function di(n){return{fieldPath:n.canonicalString()}}function fi(n){return Vt.fromServerFormat(n.fieldPath)}function Rg(n){return n instanceof xt?(function(e){if(e.op==="=="){if(Lh(e.value))return{unaryFilter:{field:di(e.field),op:"IS_NAN"}};if(Vh(e.value))return{unaryFilter:{field:di(e.field),op:"IS_NULL"}}}else if(e.op==="!="){if(Lh(e.value))return{unaryFilter:{field:di(e.field),op:"IS_NOT_NAN"}};if(Vh(e.value))return{unaryFilter:{field:di(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:di(e.field),op:iE(e.op),value:e.value}}})(n):n instanceof he?(function(e){const i=e.getFilters().map((s=>Rg(s)));return i.length===1?i[0]:{compositeFilter:{op:sE(e.op),filters:i}}})(n):$(54877,{filter:n})}function rE(n){const t=[];return n.fields.forEach((e=>t.push(e.canonicalString()))),{fieldPaths:t}}function kg(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}class rn{constructor(t,e,i,s,r=H.min(),o=H.min(),a=Lt.EMPTY_BYTE_STRING,l=null){this.target=t,this.targetId=e,this.purpose=i,this.sequenceNumber=s,this.snapshotVersion=r,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(t){return new rn(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new rn(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new rn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new rn(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class oE{constructor(t){this.yt=t}}function aE(n){const t=tE({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yl(t,t.limit,"L"):t}class lE{constructor(){this.Cn=new cE}addToCollectionParentIndex(t,e){return this.Cn.add(e),L.resolve()}getCollectionParents(t,e){return L.resolve(this.Cn.getEntries(e))}addFieldIndex(t,e){return L.resolve()}deleteFieldIndex(t,e){return L.resolve()}deleteAllFieldIndexes(t){return L.resolve()}createTargetIndexes(t,e){return L.resolve()}getDocumentsMatchingTarget(t,e){return L.resolve(null)}getIndexType(t,e){return L.resolve(0)}getFieldIndexes(t,e){return L.resolve([])}getNextCollectionGroupToUpdate(t){return L.resolve(null)}getMinOffset(t,e){return L.resolve(mn.min())}getMinOffsetFromCollectionGroup(t,e){return L.resolve(mn.min())}updateCollectionGroup(t,e,i){return L.resolve()}updateIndexEntries(t,e){return L.resolve()}}class cE{constructor(){this.index={}}add(t){const e=t.lastSegment(),i=t.popLast(),s=this.index[e]||new Pt(ct.comparator),r=!s.has(i);return this.index[e]=s.add(i),r}has(t){const e=t.lastSegment(),i=t.popLast(),s=this.index[e];return s&&s.has(i)}getEntries(t){return(this.index[t]||new Pt(ct.comparator)).toArray()}}const Xh={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Dg=41943040;class Qt{static withCacheSize(t){return new Qt(t,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(t,e,i){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=i}}Qt.DEFAULT_COLLECTION_PERCENTILE=10,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Qt.DEFAULT=new Qt(Dg,Qt.DEFAULT_COLLECTION_PERCENTILE,Qt.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Qt.DISABLED=new Qt(-1,0,0);class Ci{constructor(t){this.ar=t}next(){return this.ar+=2,this.ar}static ur(){return new Ci(0)}static cr(){return new Ci(-1)}}const Qh="LruGarbageCollector",uE=1048576;function Jh([n,t],[e,i]){const s=Q(n,e);return s===0?Q(t,i):s}class hE{constructor(t){this.Ir=t,this.buffer=new Pt(Jh),this.Er=0}dr(){return++this.Er}Ar(t){const e=[t,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(e);else{const i=this.buffer.last();Jh(e,i)<0&&(this.buffer=this.buffer.delete(i).add(e))}}get maxValue(){return this.buffer.last()[0]}}class dE{constructor(t,e,i){this.garbageCollector=t,this.asyncQueue=e,this.localStore=i,this.Rr=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==-1&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return this.Rr!==null}Vr(t){B(Qh,`Garbage collection scheduled in ${t}ms`),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",t,(async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Bi(e)?B(Qh,"Ignoring IndexedDB error during garbage collection: ",e):await Fi(e)}await this.Vr(3e5)}))}}class fE{constructor(t,e){this.mr=t,this.params=e}calculateTargetCount(t,e){return this.mr.gr(t).next((i=>Math.floor(e/100*i)))}nthSequenceNumber(t,e){if(e===0)return L.resolve(Mo.ce);const i=new hE(e);return this.mr.forEachTarget(t,(s=>i.Ar(s.sequenceNumber))).next((()=>this.mr.pr(t,(s=>i.Ar(s))))).next((()=>i.maxValue))}removeTargets(t,e,i){return this.mr.removeTargets(t,e,i)}removeOrphanedDocuments(t,e){return this.mr.removeOrphanedDocuments(t,e)}collect(t,e){return this.params.cacheSizeCollectionThreshold===-1?(B("LruGarbageCollector","Garbage collection skipped; disabled"),L.resolve(Xh)):this.getCacheSize(t).next((i=>i<this.params.cacheSizeCollectionThreshold?(B("LruGarbageCollector",`Garbage collection skipped; Cache size ${i} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),Xh):this.yr(t,e)))}getCacheSize(t){return this.mr.getCacheSize(t)}yr(t,e){let i,s,r,o,a,l,u;const h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next((d=>(d>this.params.maximumSequenceNumbersToCollect?(B("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),s=this.params.maximumSequenceNumbersToCollect):s=d,o=Date.now(),this.nthSequenceNumber(t,s)))).next((d=>(i=d,a=Date.now(),this.removeTargets(t,i,e)))).next((d=>(r=d,l=Date.now(),this.removeOrphanedDocuments(t,i)))).next((d=>(u=Date.now(),ui()<=X.DEBUG&&B("LruGarbageCollector",`LRU Garbage Collection
	Counted targets in ${o-h}ms
	Determined least recently used ${s} in `+(a-o)+`ms
	Removed ${r} targets in `+(l-a)+`ms
	Removed ${d} documents in `+(u-l)+`ms
Total Duration: ${u-h}ms`),L.resolve({didRun:!0,sequenceNumbersCollected:s,targetsRemoved:r,documentsRemoved:d}))))}}function pE(n,t){return new fE(n,t)}class gE{constructor(){this.changes=new ei((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,$t.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const i=this.changes.get(e);return i!==void 0?L.resolve(i):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class mE{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class yE{constructor(t,e,i,s){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=i,this.indexManager=s}getDocument(t,e){let i=null;return this.documentOverlayCache.getOverlay(t,e).next((s=>(i=s,this.remoteDocumentCache.getEntry(t,e)))).next((s=>(i!==null&&Es(i.mutation,s,le.empty(),dt.now()),s)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((i=>this.getLocalViewOfDocuments(t,i,J()).next((()=>i))))}getLocalViewOfDocuments(t,e,i=J()){const s=Un();return this.populateOverlays(t,s,e).next((()=>this.computeViews(t,e,s,i).next((r=>{let o=us();return r.forEach(((a,l)=>{o=o.insert(a,l.overlayedDocument)})),o}))))}getOverlayedDocuments(t,e){const i=Un();return this.populateOverlays(t,i,e).next((()=>this.computeViews(t,e,i,J())))}populateOverlays(t,e,i){const s=[];return i.forEach((r=>{e.has(r)||s.push(r)})),this.documentOverlayCache.getOverlays(t,s).next((r=>{r.forEach(((o,a)=>{e.set(o,a)}))}))}computeViews(t,e,i,s){let r=$e();const o=ws(),a=(function(){return ws()})();return e.forEach(((l,u)=>{const h=i.get(u.key);s.has(u.key)&&(h===void 0||h.mutation instanceof ni)?r=r.insert(u.key,u):h!==void 0?(o.set(u.key,h.mutation.getFieldMask()),Es(h.mutation,u,h.mutation.getFieldMask(),dt.now())):o.set(u.key,le.empty())})),this.recalculateAndSaveOverlays(t,r).next((l=>(l.forEach(((u,h)=>o.set(u,h))),e.forEach(((u,h)=>a.set(u,new mE(h,o.get(u)??null)))),a)))}recalculateAndSaveOverlays(t,e){const i=ws();let s=new mt(((o,a)=>o-a)),r=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((o=>{for(const a of o)a.keys().forEach((l=>{const u=e.get(l);if(u===null)return;let h=i.get(l)||le.empty();h=a.applyToLocalView(u,h),i.set(l,h);const d=(s.get(a.batchId)||J()).add(l);s=s.insert(a.batchId,d)}))})).next((()=>{const o=[],a=s.getReverseIterator();for(;a.hasNext();){const l=a.getNext(),u=l.key,h=l.value,d=pg();h.forEach((p=>{if(!r.has(p)){const m=vg(e.get(p),i.get(p));m!==null&&d.set(p,m),r=r.add(p)}})),o.push(this.documentOverlayCache.saveOverlays(t,u,d))}return L.waitFor(o)})).next((()=>i))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((i=>this.recalculateAndSaveOverlays(t,i)))}getDocumentsMatchingQuery(t,e,i,s){return(function(o){return z.isDocumentKey(o.path)&&o.collectionGroup===null&&o.filters.length===0})(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):cg(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,i,s):this.getDocumentsMatchingCollectionQuery(t,e,i,s)}getNextDocuments(t,e,i,s){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,i,s).next((r=>{const o=s-r.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,i.largestBatchId,s-r.size):L.resolve(Un());let a=Ds,l=r;return o.next((u=>L.forEach(u,((h,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),r.get(h)?L.resolve():this.remoteDocumentCache.getEntry(t,h).next((p=>{l=l.insert(h,p)}))))).next((()=>this.populateOverlays(t,u,r))).next((()=>this.computeViews(t,l,u,J()))).next((h=>({batchId:a,changes:fg(h)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new z(e)).next((i=>{let s=us();return i.isFoundDocument()&&(s=s.insert(i.key,i)),s}))}getDocumentsMatchingCollectionGroupQuery(t,e,i,s){const r=e.collectionGroup;let o=us();return this.indexManager.getCollectionParents(t,r).next((a=>L.forEach(a,(l=>{const u=(function(d,p){return new er(p,null,d.explicitOrderBy.slice(),d.filters.slice(),d.limit,d.limitType,d.startAt,d.endAt)})(e,l.child(r));return this.getDocumentsMatchingCollectionQuery(t,u,i,s).next((h=>{h.forEach(((d,p)=>{o=o.insert(d,p)}))}))})).next((()=>o))))}getDocumentsMatchingCollectionQuery(t,e,i,s){let r;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,i.largestBatchId).next((o=>(r=o,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,i,r,s)))).next((o=>{r.forEach(((l,u)=>{const h=u.getKey();o.get(h)===null&&(o=o.insert(h,$t.newInvalidDocument(h)))}));let a=us();return o.forEach(((l,u)=>{const h=r.get(l);h!==void 0&&Es(h.mutation,u,le.empty(),dt.now()),No(e,u)&&(a=a.insert(l,u))})),a}))}}class _E{constructor(t){this.serializer=t,this.Lr=new Map,this.kr=new Map}getBundleMetadata(t,e){return L.resolve(this.Lr.get(e))}saveBundleMetadata(t,e){return this.Lr.set(e.id,(function(s){return{id:s.id,version:s.version,createTime:ve(s.createTime)}})(e)),L.resolve()}getNamedQuery(t,e){return L.resolve(this.kr.get(e))}saveNamedQuery(t,e){return this.kr.set(e.name,(function(s){return{name:s.name,query:aE(s.bundledQuery),readTime:ve(s.readTime)}})(e)),L.resolve()}}class bE{constructor(){this.overlays=new mt(z.comparator),this.qr=new Map}getOverlay(t,e){return L.resolve(this.overlays.get(e))}getOverlays(t,e){const i=Un();return L.forEach(e,(s=>this.getOverlay(t,s).next((r=>{r!==null&&i.set(s,r)})))).next((()=>i))}saveOverlays(t,e,i){return i.forEach(((s,r)=>{this.St(t,e,r)})),L.resolve()}removeOverlaysForBatchId(t,e,i){const s=this.qr.get(i);return s!==void 0&&(s.forEach((r=>this.overlays=this.overlays.remove(r))),this.qr.delete(i)),L.resolve()}getOverlaysForCollection(t,e,i){const s=Un(),r=e.length+1,o=new z(e.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){const l=a.getNext().value,u=l.getKey();if(!e.isPrefixOf(u.path))break;u.path.length===r&&l.largestBatchId>i&&s.set(l.getKey(),l)}return L.resolve(s)}getOverlaysForCollectionGroup(t,e,i,s){let r=new mt(((u,h)=>u-h));const o=this.overlays.getIterator();for(;o.hasNext();){const u=o.getNext().value;if(u.getKey().getCollectionGroup()===e&&u.largestBatchId>i){let h=r.get(u.largestBatchId);h===null&&(h=Un(),r=r.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}const a=Un(),l=r.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach(((u,h)=>a.set(u,h))),!(a.size()>=s)););return L.resolve(a)}St(t,e,i){const s=this.overlays.get(i.key);if(s!==null){const o=this.qr.get(s.largestBatchId).delete(i.key);this.qr.set(s.largestBatchId,o)}this.overlays=this.overlays.insert(i.key,new Nw(e,i));let r=this.qr.get(e);r===void 0&&(r=J(),this.qr.set(e,r)),this.qr.set(e,r.add(i.key))}}class vE{constructor(){this.sessionToken=Lt.EMPTY_BYTE_STRING}getSessionToken(t){return L.resolve(this.sessionToken)}setSessionToken(t,e){return this.sessionToken=e,L.resolve()}}class dc{constructor(){this.Qr=new Pt(Dt.$r),this.Ur=new Pt(Dt.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(t,e){const i=new Dt(t,e);this.Qr=this.Qr.add(i),this.Ur=this.Ur.add(i)}Wr(t,e){t.forEach((i=>this.addReference(i,e)))}removeReference(t,e){this.Gr(new Dt(t,e))}zr(t,e){t.forEach((i=>this.removeReference(i,e)))}jr(t){const e=new z(new ct([])),i=new Dt(e,t),s=new Dt(e,t+1),r=[];return this.Ur.forEachInRange([i,s],(o=>{this.Gr(o),r.push(o.key)})),r}Jr(){this.Qr.forEach((t=>this.Gr(t)))}Gr(t){this.Qr=this.Qr.delete(t),this.Ur=this.Ur.delete(t)}Hr(t){const e=new z(new ct([])),i=new Dt(e,t),s=new Dt(e,t+1);let r=J();return this.Ur.forEachInRange([i,s],(o=>{r=r.add(o.key)})),r}containsKey(t){const e=new Dt(t,0),i=this.Qr.firstAfterOrEqual(e);return i!==null&&t.isEqual(i.key)}}class Dt{constructor(t,e){this.key=t,this.Yr=e}static $r(t,e){return z.comparator(t.key,e.key)||Q(t.Yr,e.Yr)}static Kr(t,e){return Q(t.Yr,e.Yr)||z.comparator(t.key,e.key)}}class wE{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.tr=1,this.Zr=new Pt(Dt.$r)}checkEmpty(t){return L.resolve(this.mutationQueue.length===0)}addMutationBatch(t,e,i,s){const r=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const o=new Lw(r,e,i,s);this.mutationQueue.push(o);for(const a of s)this.Zr=this.Zr.add(new Dt(a.key,r)),this.indexManager.addToCollectionParentIndex(t,a.key.path.popLast());return L.resolve(o)}lookupMutationBatch(t,e){return L.resolve(this.Xr(e))}getNextMutationBatchAfterBatchId(t,e){const i=e+1,s=this.ei(i),r=s<0?0:s;return L.resolve(this.mutationQueue.length>r?this.mutationQueue[r]:null)}getHighestUnacknowledgedBatchId(){return L.resolve(this.mutationQueue.length===0?ec:this.tr-1)}getAllMutationBatches(t){return L.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const i=new Dt(e,0),s=new Dt(e,Number.POSITIVE_INFINITY),r=[];return this.Zr.forEachInRange([i,s],(o=>{const a=this.Xr(o.Yr);r.push(a)})),L.resolve(r)}getAllMutationBatchesAffectingDocumentKeys(t,e){let i=new Pt(Q);return e.forEach((s=>{const r=new Dt(s,0),o=new Dt(s,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([r,o],(a=>{i=i.add(a.Yr)}))})),L.resolve(this.ti(i))}getAllMutationBatchesAffectingQuery(t,e){const i=e.path,s=i.length+1;let r=i;z.isDocumentKey(r)||(r=r.child(""));const o=new Dt(new z(r),0);let a=new Pt(Q);return this.Zr.forEachWhile((l=>{const u=l.key.path;return!!i.isPrefixOf(u)&&(u.length===s&&(a=a.add(l.Yr)),!0)}),o),L.resolve(this.ti(a))}ti(t){const e=[];return t.forEach((i=>{const s=this.Xr(i);s!==null&&e.push(s)})),e}removeMutationBatch(t,e){st(this.ni(e.batchId,"removed")===0,55003),this.mutationQueue.shift();let i=this.Zr;return L.forEach(e.mutations,(s=>{const r=new Dt(s.key,e.batchId);return i=i.delete(r),this.referenceDelegate.markPotentiallyOrphaned(t,s.key)})).next((()=>{this.Zr=i}))}ir(t){}containsKey(t,e){const i=new Dt(e,0),s=this.Zr.firstAfterOrEqual(i);return L.resolve(e.isEqual(s&&s.key))}performConsistencyCheck(t){return this.mutationQueue.length,L.resolve()}ni(t,e){return this.ei(t)}ei(t){return this.mutationQueue.length===0?0:t-this.mutationQueue[0].batchId}Xr(t){const e=this.ei(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class EE{constructor(t){this.ri=t,this.docs=(function(){return new mt(z.comparator)})(),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const i=e.key,s=this.docs.get(i),r=s?s.size:0,o=this.ri(e);return this.docs=this.docs.insert(i,{document:e.mutableCopy(),size:o}),this.size+=o-r,this.indexManager.addToCollectionParentIndex(t,i.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const i=this.docs.get(e);return L.resolve(i?i.document.mutableCopy():$t.newInvalidDocument(e))}getEntries(t,e){let i=$e();return e.forEach((s=>{const r=this.docs.get(s);i=i.insert(s,r?r.document.mutableCopy():$t.newInvalidDocument(s))})),L.resolve(i)}getDocumentsMatchingQuery(t,e,i,s){let r=$e();const o=e.path,a=new z(o.child("__id-9223372036854775808__")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){const{key:u,value:{document:h}}=l.getNext();if(!o.isPrefixOf(u.path))break;u.path.length>o.length+1||Q0(X0(h),i)<=0||(s.has(h.key)||No(e,h))&&(r=r.insert(h.key,h.mutableCopy()))}return L.resolve(r)}getAllFromCollectionGroup(t,e,i,s){$(9500)}ii(t,e){return L.forEach(this.docs,(i=>e(i)))}newChangeBuffer(t){return new TE(this)}getSize(t){return L.resolve(this.size)}}class TE extends gE{constructor(t){super(),this.Nr=t}applyChanges(t){const e=[];return this.changes.forEach(((i,s)=>{s.isValidDocument()?e.push(this.Nr.addEntry(t,s)):this.Nr.removeEntry(i)})),L.waitFor(e)}getFromCache(t,e){return this.Nr.getEntry(t,e)}getAllFromCache(t,e){return this.Nr.getEntries(t,e)}}class xE{constructor(t){this.persistence=t,this.si=new ei((e=>sc(e)),rc),this.lastRemoteSnapshotVersion=H.min(),this.highestTargetId=0,this.oi=0,this._i=new dc,this.targetCount=0,this.ai=Ci.ur()}forEachTarget(t,e){return this.si.forEach(((i,s)=>e(s))),L.resolve()}getLastRemoteSnapshotVersion(t){return L.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return L.resolve(this.oi)}allocateTargetId(t){return this.highestTargetId=this.ai.next(),L.resolve(this.highestTargetId)}setTargetsMetadata(t,e,i){return i&&(this.lastRemoteSnapshotVersion=i),e>this.oi&&(this.oi=e),L.resolve()}Pr(t){this.si.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.ai=new Ci(e),this.highestTargetId=e),t.sequenceNumber>this.oi&&(this.oi=t.sequenceNumber)}addTargetData(t,e){return this.Pr(e),this.targetCount+=1,L.resolve()}updateTargetData(t,e){return this.Pr(e),L.resolve()}removeTargetData(t,e){return this.si.delete(e.target),this._i.jr(e.targetId),this.targetCount-=1,L.resolve()}removeTargets(t,e,i){let s=0;const r=[];return this.si.forEach(((o,a)=>{a.sequenceNumber<=e&&i.get(a.targetId)===null&&(this.si.delete(o),r.push(this.removeMatchingKeysForTargetId(t,a.targetId)),s++)})),L.waitFor(r).next((()=>s))}getTargetCount(t){return L.resolve(this.targetCount)}getTargetData(t,e){const i=this.si.get(e)||null;return L.resolve(i)}addMatchingKeys(t,e,i){return this._i.Wr(e,i),L.resolve()}removeMatchingKeys(t,e,i){this._i.zr(e,i);const s=this.persistence.referenceDelegate,r=[];return s&&e.forEach((o=>{r.push(s.markPotentiallyOrphaned(t,o))})),L.waitFor(r)}removeMatchingKeysForTargetId(t,e){return this._i.jr(e),L.resolve()}getMatchingKeysForTargetId(t,e){const i=this._i.Hr(e);return L.resolve(i)}containsKey(t,e){return L.resolve(this._i.containsKey(e))}}class Mg{constructor(t,e){this.ui={},this.overlays={},this.ci=new Mo(0),this.li=!1,this.li=!0,this.hi=new vE,this.referenceDelegate=t(this),this.Pi=new xE(this),this.indexManager=new lE,this.remoteDocumentCache=(function(s){return new EE(s)})((i=>this.referenceDelegate.Ti(i))),this.serializer=new oE(e),this.Ii=new _E(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new bE,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let i=this.ui[t.toKey()];return i||(i=new wE(e,this.referenceDelegate),this.ui[t.toKey()]=i),i}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(t,e,i){B("MemoryPersistence","Starting transaction:",t);const s=new IE(this.ci.next());return this.referenceDelegate.Ei(),i(s).next((r=>this.referenceDelegate.di(s).next((()=>r)))).toPromise().then((r=>(s.raiseOnCommittedEvent(),r)))}Ai(t,e){return L.or(Object.values(this.ui).map((i=>()=>i.containsKey(t,e))))}}class IE extends Z0{constructor(t){super(),this.currentSequenceNumber=t}}class fc{constructor(t){this.persistence=t,this.Ri=new dc,this.Vi=null}static mi(t){return new fc(t)}get fi(){if(this.Vi)return this.Vi;throw $(60996)}addReference(t,e,i){return this.Ri.addReference(i,e),this.fi.delete(i.toString()),L.resolve()}removeReference(t,e,i){return this.Ri.removeReference(i,e),this.fi.add(i.toString()),L.resolve()}markPotentiallyOrphaned(t,e){return this.fi.add(e.toString()),L.resolve()}removeTarget(t,e){this.Ri.jr(e.targetId).forEach((s=>this.fi.add(s.toString())));const i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(t,e.targetId).next((s=>{s.forEach((r=>this.fi.add(r.toString())))})).next((()=>i.removeTargetData(t,e)))}Ei(){this.Vi=new Set}di(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return L.forEach(this.fi,(i=>{const s=z.fromPath(i);return this.gi(t,s).next((r=>{r||e.removeEntry(s,H.min())}))})).next((()=>(this.Vi=null,e.apply(t))))}updateLimboDocument(t,e){return this.gi(t,e).next((i=>{i?this.fi.delete(e.toString()):this.fi.add(e.toString())}))}Ti(t){return 0}gi(t,e){return L.or([()=>L.resolve(this.Ri.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Ai(t,e)])}}class mo{constructor(t,e){this.persistence=t,this.pi=new ei((i=>nw(i.path)),((i,s)=>i.isEqual(s))),this.garbageCollector=pE(this,e)}static mi(t,e){return new mo(t,e)}Ei(){}di(t){return L.resolve()}forEachTarget(t,e){return this.persistence.getTargetCache().forEachTarget(t,e)}gr(t){const e=this.wr(t);return this.persistence.getTargetCache().getTargetCount(t).next((i=>e.next((s=>i+s))))}wr(t){let e=0;return this.pr(t,(i=>{e++})).next((()=>e))}pr(t,e){return L.forEach(this.pi,((i,s)=>this.br(t,i,s).next((r=>r?L.resolve():e(s)))))}removeTargets(t,e,i){return this.persistence.getTargetCache().removeTargets(t,e,i)}removeOrphanedDocuments(t,e){let i=0;const s=this.persistence.getRemoteDocumentCache(),r=s.newChangeBuffer();return s.ii(t,(o=>this.br(t,o,e).next((a=>{a||(i++,r.removeEntry(o,H.min()))})))).next((()=>r.apply(t))).next((()=>i))}markPotentiallyOrphaned(t,e){return this.pi.set(e,t.currentSequenceNumber),L.resolve()}removeTarget(t,e){const i=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(t,i)}addReference(t,e,i){return this.pi.set(i,t.currentSequenceNumber),L.resolve()}removeReference(t,e,i){return this.pi.set(i,t.currentSequenceNumber),L.resolve()}updateLimboDocument(t,e){return this.pi.set(e,t.currentSequenceNumber),L.resolve()}Ti(t){let e=t.key.toString().length;return t.isFoundDocument()&&(e+=Wr(t.data.value)),e}br(t,e,i){return L.or([()=>this.persistence.Ai(t,e),()=>this.persistence.getTargetCache().containsKey(t,e),()=>{const s=this.pi.get(e);return L.resolve(s!==void 0&&s>i)}])}getCacheSize(t){return this.persistence.getRemoteDocumentCache().getSize(t)}}class pc{constructor(t,e,i,s){this.targetId=t,this.fromCache=e,this.Es=i,this.ds=s}static As(t,e){let i=J(),s=J();for(const r of e.docChanges)switch(r.type){case 0:i=i.add(r.doc.key);break;case 1:s=s.add(r.doc.key)}return new pc(t,e.fromCache,i,s)}}class AE{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class SE{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=(function(){return d_()?8:tw(Wt())>0?6:4})()}initialize(t,e){this.ps=t,this.indexManager=e,this.Rs=!0}getDocumentsMatchingQuery(t,e,i,s){const r={result:null};return this.ys(t,e).next((o=>{r.result=o})).next((()=>{if(!r.result)return this.ws(t,e,s,i).next((o=>{r.result=o}))})).next((()=>{if(r.result)return;const o=new AE;return this.Ss(t,e,o).next((a=>{if(r.result=a,this.Vs)return this.bs(t,e,o,a.size)}))})).next((()=>r.result))}bs(t,e,i,s){return i.documentReadCount<this.fs?(ui()<=X.DEBUG&&B("QueryEngine","SDK will not create cache indexes for query:",hi(e),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),L.resolve()):(ui()<=X.DEBUG&&B("QueryEngine","Query:",hi(e),"scans",i.documentReadCount,"local documents and returns",s,"documents as results."),i.documentReadCount>this.gs*s?(ui()<=X.DEBUG&&B("QueryEngine","The SDK decides to create cache indexes for query:",hi(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,_e(e))):L.resolve())}ys(t,e){if(Uh(e))return L.resolve(null);let i=_e(e);return this.indexManager.getIndexType(t,i).next((s=>s===0?null:(e.limit!==null&&s===1&&(e=yl(e,null,"F"),i=_e(e)),this.indexManager.getDocumentsMatchingTarget(t,i).next((r=>{const o=J(...r);return this.ps.getDocuments(t,o).next((a=>this.indexManager.getMinOffset(t,i).next((l=>{const u=this.Ds(e,a);return this.Cs(e,u,o,l.readTime)?this.ys(t,yl(e,null,"F")):this.vs(t,u,e,l)}))))})))))}ws(t,e,i,s){return Uh(e)||s.isEqual(H.min())?L.resolve(null):this.ps.getDocuments(t,i).next((r=>{const o=this.Ds(e,r);return this.Cs(e,o,i,s)?L.resolve(null):(ui()<=X.DEBUG&&B("QueryEngine","Re-using previous result from %s to execute query: %s",s.toString(),hi(e)),this.vs(t,o,e,Y0(s,Ds)).next((a=>a)))}))}Ds(t,e){let i=new Pt(hg(t));return e.forEach(((s,r)=>{No(t,r)&&(i=i.add(r))})),i}Cs(t,e,i,s){if(t.limit===null)return!1;if(i.size!==e.size)return!0;const r=t.limitType==="F"?e.last():e.first();return!!r&&(r.hasPendingWrites||r.version.compareTo(s)>0)}Ss(t,e,i){return ui()<=X.DEBUG&&B("QueryEngine","Using full collection scan to execute query:",hi(e)),this.ps.getDocumentsMatchingQuery(t,e,mn.min(),i)}vs(t,e,i,s){return this.ps.getDocumentsMatchingQuery(t,i,s).next((r=>(e.forEach((o=>{r=r.insert(o.key,o)})),r)))}}const gc="LocalStore",CE=3e8;class PE{constructor(t,e,i,s){this.persistence=t,this.Fs=e,this.serializer=s,this.Ms=new mt(Q),this.xs=new ei((r=>sc(r)),rc),this.Os=new Map,this.Ns=t.getRemoteDocumentCache(),this.Pi=t.getTargetCache(),this.Ii=t.getBundleCache(),this.Bs(i)}Bs(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new yE(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.Ms)))}}function RE(n,t,e,i){return new PE(n,t,e,i)}async function Og(n,t){const e=q(n);return await e.persistence.runTransaction("Handle user change","readonly",(i=>{let s;return e.mutationQueue.getAllMutationBatches(i).next((r=>(s=r,e.Bs(t),e.mutationQueue.getAllMutationBatches(i)))).next((r=>{const o=[],a=[];let l=J();for(const u of s){o.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}for(const u of r){a.push(u.batchId);for(const h of u.mutations)l=l.add(h.key)}return e.localDocuments.getDocuments(i,l).next((u=>({Ls:u,removedBatchIds:o,addedBatchIds:a})))}))}))}function kE(n,t){const e=q(n);return e.persistence.runTransaction("Acknowledge batch","readwrite-primary",(i=>{const s=t.batch.keys(),r=e.Ns.newChangeBuffer({trackRemovals:!0});return(function(a,l,u,h){const d=u.batch,p=d.keys();let m=L.resolve();return p.forEach((b=>{m=m.next((()=>h.getEntry(l,b))).next((v=>{const E=u.docVersions.get(b);st(E!==null,48541),v.version.compareTo(E)<0&&(d.applyToRemoteDocument(v,u),v.isValidDocument()&&(v.setReadTime(u.commitVersion),h.addEntry(v)))}))})),m.next((()=>a.mutationQueue.removeMutationBatch(l,d)))})(e,i,t,r).next((()=>r.apply(i))).next((()=>e.mutationQueue.performConsistencyCheck(i))).next((()=>e.documentOverlayCache.removeOverlaysForBatchId(i,s,t.batch.batchId))).next((()=>e.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(i,(function(a){let l=J();for(let u=0;u<a.mutationResults.length;++u)a.mutationResults[u].transformResults.length>0&&(l=l.add(a.batch.mutations[u].key));return l})(t)))).next((()=>e.localDocuments.getDocuments(i,s)))}))}function Vg(n){const t=q(n);return t.persistence.runTransaction("Get last remote snapshot version","readonly",(e=>t.Pi.getLastRemoteSnapshotVersion(e)))}function DE(n,t){const e=q(n),i=t.snapshotVersion;let s=e.Ms;return e.persistence.runTransaction("Apply remote event","readwrite-primary",(r=>{const o=e.Ns.newChangeBuffer({trackRemovals:!0});s=e.Ms;const a=[];t.targetChanges.forEach(((h,d)=>{const p=s.get(d);if(!p)return;a.push(e.Pi.removeMatchingKeys(r,h.removedDocuments,d).next((()=>e.Pi.addMatchingKeys(r,h.addedDocuments,d))));let m=p.withSequenceNumber(r.currentSequenceNumber);t.targetMismatches.get(d)!==null?m=m.withResumeToken(Lt.EMPTY_BYTE_STRING,H.min()).withLastLimboFreeSnapshotVersion(H.min()):h.resumeToken.approximateByteSize()>0&&(m=m.withResumeToken(h.resumeToken,i)),s=s.insert(d,m),(function(v,E,C){return v.resumeToken.approximateByteSize()===0||E.snapshotVersion.toMicroseconds()-v.snapshotVersion.toMicroseconds()>=CE?!0:C.addedDocuments.size+C.modifiedDocuments.size+C.removedDocuments.size>0})(p,m,h)&&a.push(e.Pi.updateTargetData(r,m))}));let l=$e(),u=J();if(t.documentUpdates.forEach((h=>{t.resolvedLimboDocuments.has(h)&&a.push(e.persistence.referenceDelegate.updateLimboDocument(r,h))})),a.push(ME(r,o,t.documentUpdates).next((h=>{l=h.ks,u=h.qs}))),!i.isEqual(H.min())){const h=e.Pi.getLastRemoteSnapshotVersion(r).next((d=>e.Pi.setTargetsMetadata(r,r.currentSequenceNumber,i)));a.push(h)}return L.waitFor(a).next((()=>o.apply(r))).next((()=>e.localDocuments.getLocalViewOfDocuments(r,l,u))).next((()=>l))})).then((r=>(e.Ms=s,r)))}function ME(n,t,e){let i=J(),s=J();return e.forEach((r=>i=i.add(r))),t.getEntries(n,i).next((r=>{let o=$e();return e.forEach(((a,l)=>{const u=r.get(a);l.isFoundDocument()!==u.isFoundDocument()&&(s=s.add(a)),l.isNoDocument()&&l.version.isEqual(H.min())?(t.removeEntry(a,l.readTime),o=o.insert(a,l)):!u.isValidDocument()||l.version.compareTo(u.version)>0||l.version.compareTo(u.version)===0&&u.hasPendingWrites?(t.addEntry(l),o=o.insert(a,l)):B(gc,"Ignoring outdated watch update for ",a,". Current version:",u.version," Watch version:",l.version)})),{ks:o,qs:s}}))}function OE(n,t){const e=q(n);return e.persistence.runTransaction("Get next mutation batch","readonly",(i=>(t===void 0&&(t=ec),e.mutationQueue.getNextMutationBatchAfterBatchId(i,t))))}function VE(n,t){const e=q(n);return e.persistence.runTransaction("Allocate target","readwrite",(i=>{let s;return e.Pi.getTargetData(i,t).next((r=>r?(s=r,L.resolve(s)):e.Pi.allocateTargetId(i).next((o=>(s=new rn(t,o,"TargetPurposeListen",i.currentSequenceNumber),e.Pi.addTargetData(i,s).next((()=>s)))))))})).then((i=>{const s=e.Ms.get(i.targetId);return(s===null||i.snapshotVersion.compareTo(s.snapshotVersion)>0)&&(e.Ms=e.Ms.insert(i.targetId,i),e.xs.set(t,i.targetId)),i}))}async function El(n,t,e){const i=q(n),s=i.Ms.get(t),r=e?"readwrite":"readwrite-primary";try{e||await i.persistence.runTransaction("Release target",r,(o=>i.persistence.referenceDelegate.removeTarget(o,s)))}catch(o){if(!Bi(o))throw o;B(gc,`Failed to update sequence numbers for target ${t}: ${o}`)}i.Ms=i.Ms.remove(t),i.xs.delete(s.target)}function Zh(n,t,e){const i=q(n);let s=H.min(),r=J();return i.persistence.runTransaction("Execute query","readwrite",(o=>(function(l,u,h){const d=q(l),p=d.xs.get(h);return p!==void 0?L.resolve(d.Ms.get(p)):d.Pi.getTargetData(u,h)})(i,o,_e(t)).next((a=>{if(a)return s=a.lastLimboFreeSnapshotVersion,i.Pi.getMatchingKeysForTargetId(o,a.targetId).next((l=>{r=l}))})).next((()=>i.Fs.getDocumentsMatchingQuery(o,t,e?s:H.min(),e?r:J()))).next((a=>(LE(i,ww(t),a),{documents:a,Qs:r})))))}function LE(n,t,e){let i=n.Os.get(t)||H.min();e.forEach(((s,r)=>{r.readTime.compareTo(i)>0&&(i=r.readTime)})),n.Os.set(t,i)}class td{constructor(){this.activeTargetIds=Sw()}zs(t){this.activeTargetIds=this.activeTargetIds.add(t)}js(t){this.activeTargetIds=this.activeTargetIds.delete(t)}Gs(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class NE{constructor(){this.Mo=new td,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,i){}addLocalQueryTarget(t,e=!0){return e&&this.Mo.zs(t),this.xo[t]||"not-current"}updateQueryState(t,e,i){this.xo[t]=e}removeLocalQueryTarget(t){this.Mo.js(t)}isLocalQueryTarget(t){return this.Mo.activeTargetIds.has(t)}clearQueryState(t){delete this.xo[t]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(t){return this.Mo.activeTargetIds.has(t)}start(){return this.Mo=new td,Promise.resolve()}handleUserChange(t,e,i){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class FE{Oo(t){}shutdown(){}}const ed="ConnectivityMonitor";class nd{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(t){this.qo.push(t)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){B(ed,"Network connectivity changed: AVAILABLE");for(const t of this.qo)t(0)}ko(){B(ed,"Network connectivity changed: UNAVAILABLE");for(const t of this.qo)t(1)}static v(){return typeof window<"u"&&window.addEventListener!==void 0&&window.removeEventListener!==void 0}}let Ar=null;function Tl(){return Ar===null?Ar=(function(){return 268435456+Math.round(2147483648*Math.random())})():Ar++,"0x"+Ar.toString(16)}const Ra="RestConnection",BE={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class UE{get $o(){return!1}constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",i=encodeURIComponent(this.databaseId.projectId),s=encodeURIComponent(this.databaseId.database);this.Uo=e+"://"+t.host,this.Ko=`projects/${i}/databases/${s}`,this.Wo=this.databaseId.database===lo?`project_id=${i}`:`project_id=${i}&database_id=${s}`}Go(t,e,i,s,r){const o=Tl(),a=this.zo(t,e.toUriEncodedString());B(Ra,`Sending RPC '${t}' ${o}:`,a,i);const l={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(l,s,r);const{host:u}=new URL(a),h=Oi(u);return this.Jo(t,a,l,i,h).then((d=>(B(Ra,`Received RPC '${t}' ${o}: `,d),d)),(d=>{throw xi(Ra,`RPC '${t}' ${o} failed with error: `,d,"url: ",a,"request:",i),d}))}Ho(t,e,i,s,r,o){return this.Go(t,e,i,s,r)}jo(t,e,i){t["X-Goog-Api-Client"]=(function(){return"gl-js/ fire/"+Ni})(),t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((s,r)=>t[r]=s)),i&&i.headers.forEach(((s,r)=>t[r]=s))}zo(t,e){const i=BE[t];return`${this.Uo}/v1/${e}:${i}`}terminate(){}}class zE{constructor(t){this.Yo=t.Yo,this.Zo=t.Zo}Xo(t){this.e_=t}t_(t){this.n_=t}r_(t){this.i_=t}onMessage(t){this.s_=t}close(){this.Zo()}send(t){this.Yo(t)}o_(){this.e_()}__(){this.n_()}a_(t){this.i_(t)}u_(t){this.s_(t)}}const Ft="WebChannelConnection";class $E extends UE{constructor(t){super(t),this.c_=[],this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Jo(t,e,i,s,r){const o=Tl();return new Promise(((a,l)=>{const u=new Fp;u.setWithCredentials(!0),u.listenOnce(Bp.COMPLETE,(()=>{try{switch(u.getLastErrorCode()){case Hr.NO_ERROR:const d=u.getResponseJson();B(Ft,`XHR for RPC '${t}' ${o} received:`,JSON.stringify(d)),a(d);break;case Hr.TIMEOUT:B(Ft,`RPC '${t}' ${o} timed out`),l(new U(V.DEADLINE_EXCEEDED,"Request time out"));break;case Hr.HTTP_ERROR:const p=u.getStatus();if(B(Ft,`RPC '${t}' ${o} failed with status:`,p,"response text:",u.getResponseText()),p>0){let m=u.getResponseJson();Array.isArray(m)&&(m=m[0]);const b=m?.error;if(b&&b.status&&b.message){const v=(function(C){const P=C.toLowerCase().replace(/_/g,"-");return Object.values(V).indexOf(P)>=0?P:V.UNKNOWN})(b.status);l(new U(v,b.message))}else l(new U(V.UNKNOWN,"Server responded with status "+u.getStatus()))}else l(new U(V.UNAVAILABLE,"Connection failed."));break;default:$(9055,{l_:t,streamId:o,h_:u.getLastErrorCode(),P_:u.getLastError()})}}finally{B(Ft,`RPC '${t}' ${o} completed.`)}}));const h=JSON.stringify(s);B(Ft,`RPC '${t}' ${o} sending request:`,s),u.send(e,"POST",h,i,15)}))}T_(t,e,i){const s=Tl(),r=[this.Uo,"/","google.firestore.v1.Firestore","/",t,"/channel"],o=$p(),a=zp(),l={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},u=this.longPollingOptions.timeoutSeconds;u!==void 0&&(l.longPollingTimeout=Math.round(1e3*u)),this.useFetchStreams&&(l.useFetchStreams=!0),this.jo(l.initMessageHeaders,e,i),l.encodeInitMessageHeaders=!0;const h=r.join("");B(Ft,`Creating RPC '${t}' stream ${s}: ${h}`,l);const d=o.createWebChannel(h,l);this.I_(d);let p=!1,m=!1;const b=new zE({Yo:E=>{m?B(Ft,`Not sending because RPC '${t}' stream ${s} is closed:`,E):(p||(B(Ft,`Opening RPC '${t}' stream ${s} transport.`),d.open(),p=!0),B(Ft,`RPC '${t}' stream ${s} sending:`,E),d.send(E))},Zo:()=>d.close()}),v=(E,C,P)=>{E.listen(C,(k=>{try{P(k)}catch(M){setTimeout((()=>{throw M}),0)}}))};return v(d,cs.EventType.OPEN,(()=>{m||(B(Ft,`RPC '${t}' stream ${s} transport opened.`),b.o_())})),v(d,cs.EventType.CLOSE,(()=>{m||(m=!0,B(Ft,`RPC '${t}' stream ${s} transport closed`),b.a_(),this.E_(d))})),v(d,cs.EventType.ERROR,(E=>{m||(m=!0,xi(Ft,`RPC '${t}' stream ${s} transport errored. Name:`,E.name,"Message:",E.message),b.a_(new U(V.UNAVAILABLE,"The operation could not be completed")))})),v(d,cs.EventType.MESSAGE,(E=>{if(!m){const C=E.data[0];st(!!C,16349);const P=C,k=P?.error||P[0]?.error;if(k){B(Ft,`RPC '${t}' stream ${s} received error:`,k);const M=k.status;let O=(function(y){const T=Tt[y];if(T!==void 0)return Eg(T)})(M),N=k.message;O===void 0&&(O=V.INTERNAL,N="Unknown error status: "+M+" with message "+k.message),m=!0,b.a_(new U(O,N)),d.close()}else B(Ft,`RPC '${t}' stream ${s} received:`,C),b.u_(C)}})),v(a,Up.STAT_EVENT,(E=>{E.stat===ul.PROXY?B(Ft,`RPC '${t}' stream ${s} detected buffering proxy`):E.stat===ul.NOPROXY&&B(Ft,`RPC '${t}' stream ${s} detected no buffering proxy`)})),setTimeout((()=>{b.__()}),0),b}terminate(){this.c_.forEach((t=>t.close())),this.c_=[]}I_(t){this.c_.push(t)}E_(t){this.c_=this.c_.filter((e=>e===t))}}function ka(){return typeof document<"u"?document:null}function zo(n){return new qw(n,!0)}class Lg{constructor(t,e,i=1e3,s=1.5,r=6e4){this.Mi=t,this.timerId=e,this.d_=i,this.A_=s,this.R_=r,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(t){this.cancel();const e=Math.floor(this.V_+this.y_()),i=Math.max(0,Date.now()-this.f_),s=Math.max(0,e-i);s>0&&B("ExponentialBackoff",`Backing off for ${s} ms (base delay: ${this.V_} ms, delay with jitter: ${e} ms, last attempt: ${i} ms ago)`),this.m_=this.Mi.enqueueAfterDelay(this.timerId,s,(()=>(this.f_=Date.now(),t()))),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){this.m_!==null&&(this.m_.skipDelay(),this.m_=null)}cancel(){this.m_!==null&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const id="PersistentStream";class Ng{constructor(t,e,i,s,r,o,a,l){this.Mi=t,this.S_=i,this.b_=s,this.connection=r,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Lg(t,e)}x_(){return this.state===1||this.state===5||this.O_()}O_(){return this.state===2||this.state===3}start(){this.F_=0,this.state!==4?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&this.C_===null&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,(()=>this.k_())))}q_(t){this.Q_(),this.stream.send(t)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(t,e){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,t!==4?this.M_.reset():e&&e.code===V.RESOURCE_EXHAUSTED?(ze(e.toString()),ze("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):e&&e.code===V.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.K_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.r_(e)}K_(){}auth(){this.state=1;const t=this.W_(this.D_),e=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([i,s])=>{this.D_===e&&this.G_(i,s)}),(i=>{t((()=>{const s=new U(V.UNKNOWN,"Fetching auth token failed: "+i.message);return this.z_(s)}))}))}G_(t,e){const i=this.W_(this.D_);this.stream=this.j_(t,e),this.stream.Xo((()=>{i((()=>this.listener.Xo()))})),this.stream.t_((()=>{i((()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,(()=>(this.O_()&&(this.state=3),Promise.resolve()))),this.listener.t_())))})),this.stream.r_((s=>{i((()=>this.z_(s)))})),this.stream.onMessage((s=>{i((()=>++this.F_==1?this.J_(s):this.onNext(s)))}))}N_(){this.state=5,this.M_.p_((async()=>{this.state=0,this.start()}))}z_(t){return B(id,`close with error: ${t}`),this.stream=null,this.close(4,t)}W_(t){return e=>{this.Mi.enqueueAndForget((()=>this.D_===t?e():(B(id,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class jE extends Ng{constructor(t,e,i,s,r,o){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,i,s,o),this.serializer=r}j_(t,e){return this.connection.T_("Listen",t,e)}J_(t){return this.onNext(t)}onNext(t){this.M_.reset();const e=Yw(this.serializer,t),i=(function(r){if(!("targetChange"in r))return H.min();const o=r.targetChange;return o.targetIds&&o.targetIds.length?H.min():o.readTime?ve(o.readTime):H.min()})(t);return this.listener.H_(e,i)}Y_(t){const e={};e.database=wl(this.serializer),e.addTarget=(function(r,o){let a;const l=o.target;if(a=gl(l)?{documents:Jw(r,l)}:{query:Zw(r,l).ft},a.targetId=o.targetId,o.resumeToken.approximateByteSize()>0){a.resumeToken=Ig(r,o.resumeToken);const u=_l(r,o.expectedCount);u!==null&&(a.expectedCount=u)}else if(o.snapshotVersion.compareTo(H.min())>0){a.readTime=go(r,o.snapshotVersion.toTimestamp());const u=_l(r,o.expectedCount);u!==null&&(a.expectedCount=u)}return a})(this.serializer,t);const i=eE(this.serializer,t);i&&(e.labels=i),this.q_(e)}Z_(t){const e={};e.database=wl(this.serializer),e.removeTarget=t,this.q_(e)}}class HE extends Ng{constructor(t,e,i,s,r,o){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,i,s,o),this.serializer=r}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(t,e){return this.connection.T_("Write",t,e)}J_(t){return st(!!t.streamToken,31322),this.lastStreamToken=t.streamToken,st(!t.writeResults||t.writeResults.length===0,55816),this.listener.ta()}onNext(t){st(!!t.streamToken,12678),this.lastStreamToken=t.streamToken,this.M_.reset();const e=Qw(t.writeResults,t.commitTime),i=ve(t.commitTime);return this.listener.na(i,e)}ra(){const t={};t.database=wl(this.serializer),this.q_(t)}ea(t){const e={streamToken:this.lastStreamToken,writes:t.map((i=>Xw(this.serializer,i)))};this.q_(e)}}class WE{}class qE extends WE{constructor(t,e,i,s){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=i,this.serializer=s,this.ia=!1}sa(){if(this.ia)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.")}Go(t,e,i,s){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([r,o])=>this.connection.Go(t,bl(e,i),s,r,o))).catch((r=>{throw r.name==="FirebaseError"?(r.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),r):new U(V.UNKNOWN,r.toString())}))}Ho(t,e,i,s,r){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([o,a])=>this.connection.Ho(t,bl(e,i),s,o,a,r))).catch((o=>{throw o.name==="FirebaseError"?(o.code===V.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),o):new U(V.UNKNOWN,o.toString())}))}terminate(){this.ia=!0,this.connection.terminate()}}class GE{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){this.oa===0&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve()))))}ha(t){this.state==="Online"?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.ca("Offline")))}set(t){this.Pa(),this.oa=0,t==="Online"&&(this.aa=!1),this.ca(t)}ca(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}la(t){const e=`Could not reach Cloud Firestore backend. ${t}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.aa?(ze(e),this.aa=!1):B("OnlineStateTracker",e)}Pa(){this._a!==null&&(this._a.cancel(),this._a=null)}}const Xn="RemoteStore";class KE{constructor(t,e,i,s,r){this.localStore=t,this.datastore=e,this.asyncQueue=i,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=r,this.Aa.Oo((o=>{i.enqueueAndForget((async()=>{ii(this)&&(B(Xn,"Restarting streams for network reachability change."),await(async function(l){const u=q(l);u.Ea.add(4),await sr(u),u.Ra.set("Unknown"),u.Ea.delete(4),await $o(u)})(this))}))})),this.Ra=new GE(i,s)}}async function $o(n){if(ii(n))for(const t of n.da)await t(!0)}async function sr(n){for(const t of n.da)await t(!1)}function Fg(n,t){const e=q(n);e.Ia.has(t.targetId)||(e.Ia.set(t.targetId,t),bc(e)?_c(e):Ui(e).O_()&&yc(e,t))}function mc(n,t){const e=q(n),i=Ui(e);e.Ia.delete(t),i.O_()&&Bg(e,t),e.Ia.size===0&&(i.O_()?i.L_():ii(e)&&e.Ra.set("Unknown"))}function yc(n,t){if(n.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(H.min())>0){const e=n.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(e)}Ui(n).Y_(t)}function Bg(n,t){n.Va.Ue(t),Ui(n).Z_(t)}function _c(n){n.Va=new $w({getRemoteKeysForTarget:t=>n.remoteSyncer.getRemoteKeysForTarget(t),At:t=>n.Ia.get(t)||null,ht:()=>n.datastore.serializer.databaseId}),Ui(n).start(),n.Ra.ua()}function bc(n){return ii(n)&&!Ui(n).x_()&&n.Ia.size>0}function ii(n){return q(n).Ea.size===0}function Ug(n){n.Va=void 0}async function YE(n){n.Ra.set("Online")}async function XE(n){n.Ia.forEach(((t,e)=>{yc(n,t)}))}async function QE(n,t){Ug(n),bc(n)?(n.Ra.ha(t),_c(n)):n.Ra.set("Unknown")}async function JE(n,t,e){if(n.Ra.set("Online"),t instanceof xg&&t.state===2&&t.cause)try{await(async function(s,r){const o=r.cause;for(const a of r.targetIds)s.Ia.has(a)&&(await s.remoteSyncer.rejectListen(a,o),s.Ia.delete(a),s.Va.removeTarget(a))})(n,t)}catch(i){B(Xn,"Failed to remove targets %s: %s ",t.targetIds.join(","),i),await yo(n,i)}else if(t instanceof Kr?n.Va.Ze(t):t instanceof Tg?n.Va.st(t):n.Va.tt(t),!e.isEqual(H.min()))try{const i=await Vg(n.localStore);e.compareTo(i)>=0&&await(function(r,o){const a=r.Va.Tt(o);return a.targetChanges.forEach(((l,u)=>{if(l.resumeToken.approximateByteSize()>0){const h=r.Ia.get(u);h&&r.Ia.set(u,h.withResumeToken(l.resumeToken,o))}})),a.targetMismatches.forEach(((l,u)=>{const h=r.Ia.get(l);if(!h)return;r.Ia.set(l,h.withResumeToken(Lt.EMPTY_BYTE_STRING,h.snapshotVersion)),Bg(r,l);const d=new rn(h.target,l,u,h.sequenceNumber);yc(r,d)})),r.remoteSyncer.applyRemoteEvent(a)})(n,e)}catch(i){B(Xn,"Failed to raise snapshot:",i),await yo(n,i)}}async function yo(n,t,e){if(!Bi(t))throw t;n.Ea.add(1),await sr(n),n.Ra.set("Offline"),e||(e=()=>Vg(n.localStore)),n.asyncQueue.enqueueRetryable((async()=>{B(Xn,"Retrying IndexedDB access"),await e(),n.Ea.delete(1),await $o(n)}))}function zg(n,t){return t().catch((e=>yo(n,e,t)))}async function jo(n){const t=q(n),e=vn(t);let i=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:ec;for(;ZE(t);)try{const s=await OE(t.localStore,i);if(s===null){t.Ta.length===0&&e.L_();break}i=s.batchId,tT(t,s)}catch(s){await yo(t,s)}$g(t)&&jg(t)}function ZE(n){return ii(n)&&n.Ta.length<10}function tT(n,t){n.Ta.push(t);const e=vn(n);e.O_()&&e.X_&&e.ea(t.mutations)}function $g(n){return ii(n)&&!vn(n).x_()&&n.Ta.length>0}function jg(n){vn(n).start()}async function eT(n){vn(n).ra()}async function nT(n){const t=vn(n);for(const e of n.Ta)t.ea(e.mutations)}async function iT(n,t,e){const i=n.Ta.shift(),s=cc.from(i,t,e);await zg(n,(()=>n.remoteSyncer.applySuccessfulWrite(s))),await jo(n)}async function sT(n,t){t&&vn(n).X_&&await(async function(i,s){if((function(o){return Bw(o)&&o!==V.ABORTED})(s.code)){const r=i.Ta.shift();vn(i).B_(),await zg(i,(()=>i.remoteSyncer.rejectFailedWrite(r.batchId,s))),await jo(i)}})(n,t),$g(n)&&jg(n)}async function sd(n,t){const e=q(n);e.asyncQueue.verifyOperationInProgress(),B(Xn,"RemoteStore received new credentials");const i=ii(e);e.Ea.add(3),await sr(e),i&&e.Ra.set("Unknown"),await e.remoteSyncer.handleCredentialChange(t),e.Ea.delete(3),await $o(e)}async function rT(n,t){const e=q(n);t?(e.Ea.delete(2),await $o(e)):t||(e.Ea.add(2),await sr(e),e.Ra.set("Unknown"))}function Ui(n){return n.ma||(n.ma=(function(e,i,s){const r=q(e);return r.sa(),new jE(i,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)})(n.datastore,n.asyncQueue,{Xo:YE.bind(null,n),t_:XE.bind(null,n),r_:QE.bind(null,n),H_:JE.bind(null,n)}),n.da.push((async t=>{t?(n.ma.B_(),bc(n)?_c(n):n.Ra.set("Unknown")):(await n.ma.stop(),Ug(n))}))),n.ma}function vn(n){return n.fa||(n.fa=(function(e,i,s){const r=q(e);return r.sa(),new HE(i,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,s)})(n.datastore,n.asyncQueue,{Xo:()=>Promise.resolve(),t_:eT.bind(null,n),r_:sT.bind(null,n),ta:nT.bind(null,n),na:iT.bind(null,n)}),n.da.push((async t=>{t?(n.fa.B_(),await jo(n)):(await n.fa.stop(),n.Ta.length>0&&(B(Xn,`Stopping write stream with ${n.Ta.length} pending writes`),n.Ta=[]))}))),n.fa}class vc{constructor(t,e,i,s,r){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=i,this.op=s,this.removalCallback=r,this.deferred=new $n,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((o=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,i,s,r){const o=Date.now()+i,a=new vc(t,e,o,s,r);return a.start(i),a}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new U(V.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function wc(n,t){if(ze("AsyncQueue",`${t}: ${n}`),Bi(n))return new U(V.UNAVAILABLE,`${t}: ${n}`);throw n}class _i{static emptySet(t){return new _i(t.comparator)}constructor(t){this.comparator=t?(e,i)=>t(e,i)||z.comparator(e.key,i.key):(e,i)=>z.comparator(e.key,i.key),this.keyedMap=us(),this.sortedSet=new mt(this.comparator)}has(t){return this.keyedMap.get(t)!=null}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,i)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof _i)||this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),i=t.sortedSet.getIterator();for(;e.hasNext();){const s=e.getNext().key,r=i.getNext().key;if(!s.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),t.length===0?"DocumentSet ()":`DocumentSet (
  `+t.join(`  
`)+`
)`}copy(t,e){const i=new _i;return i.comparator=this.comparator,i.keyedMap=t,i.sortedSet=e,i}}class rd{constructor(){this.ga=new mt(z.comparator)}track(t){const e=t.doc.key,i=this.ga.get(e);i?t.type!==0&&i.type===3?this.ga=this.ga.insert(e,t):t.type===3&&i.type!==1?this.ga=this.ga.insert(e,{type:i.type,doc:t.doc}):t.type===2&&i.type===2?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):t.type===2&&i.type===0?this.ga=this.ga.insert(e,{type:0,doc:t.doc}):t.type===1&&i.type===0?this.ga=this.ga.remove(e):t.type===1&&i.type===2?this.ga=this.ga.insert(e,{type:1,doc:i.doc}):t.type===0&&i.type===1?this.ga=this.ga.insert(e,{type:2,doc:t.doc}):$(63341,{Rt:t,pa:i}):this.ga=this.ga.insert(e,t)}ya(){const t=[];return this.ga.inorderTraversal(((e,i)=>{t.push(i)})),t}}class Pi{constructor(t,e,i,s,r,o,a,l,u){this.query=t,this.docs=e,this.oldDocs=i,this.docChanges=s,this.mutatedKeys=r,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=u}static fromInitialDocuments(t,e,i,s,r){const o=[];return e.forEach((a=>{o.push({type:0,doc:a})})),new Pi(t,e,_i.emptySet(e),o,i,s,!0,!1,r)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Lo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,i=t.docChanges;if(e.length!==i.length)return!1;for(let s=0;s<e.length;s++)if(e[s].type!==i[s].type||!e[s].doc.isEqual(i[s].doc))return!1;return!0}}class oT{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some((t=>t.Da()))}}class aT{constructor(){this.queries=od(),this.onlineState="Unknown",this.Ca=new Set}terminate(){(function(e,i){const s=q(e),r=s.queries;s.queries=od(),r.forEach(((o,a)=>{for(const l of a.Sa)l.onError(i)}))})(this,new U(V.ABORTED,"Firestore shutting down"))}}function od(){return new ei((n=>ug(n)),Lo)}async function lT(n,t){const e=q(n);let i=3;const s=t.query;let r=e.queries.get(s);r?!r.ba()&&t.Da()&&(i=2):(r=new oT,i=t.Da()?0:1);try{switch(i){case 0:r.wa=await e.onListen(s,!0);break;case 1:r.wa=await e.onListen(s,!1);break;case 2:await e.onFirstRemoteStoreListen(s)}}catch(o){const a=wc(o,`Initialization of query '${hi(t.query)}' failed`);return void t.onError(a)}e.queries.set(s,r),r.Sa.push(t),t.va(e.onlineState),r.wa&&t.Fa(r.wa)&&Ec(e)}async function cT(n,t){const e=q(n),i=t.query;let s=3;const r=e.queries.get(i);if(r){const o=r.Sa.indexOf(t);o>=0&&(r.Sa.splice(o,1),r.Sa.length===0?s=t.Da()?0:1:!r.ba()&&t.Da()&&(s=2))}switch(s){case 0:return e.queries.delete(i),e.onUnlisten(i,!0);case 1:return e.queries.delete(i),e.onUnlisten(i,!1);case 2:return e.onLastRemoteStoreUnlisten(i);default:return}}function uT(n,t){const e=q(n);let i=!1;for(const s of t){const r=s.query,o=e.queries.get(r);if(o){for(const a of o.Sa)a.Fa(s)&&(i=!0);o.wa=s}}i&&Ec(e)}function hT(n,t,e){const i=q(n),s=i.queries.get(t);if(s)for(const r of s.Sa)r.onError(e);i.queries.delete(t)}function Ec(n){n.Ca.forEach((t=>{t.next()}))}var xl,ad;(ad=xl||(xl={})).Ma="default",ad.Cache="cache";class dT{constructor(t,e,i){this.query=t,this.xa=e,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=i||{}}Fa(t){if(!this.options.includeMetadataChanges){const i=[];for(const s of t.docChanges)s.type!==3&&i.push(s);t=new Pi(t.query,t.docs,t.oldDocs,i,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.Oa?this.Ba(t)&&(this.xa.next(t),e=!0):this.La(t,this.onlineState)&&(this.ka(t),e=!0),this.Na=t,e}onError(t){this.xa.error(t)}va(t){this.onlineState=t;let e=!1;return this.Na&&!this.Oa&&this.La(this.Na,t)&&(this.ka(this.Na),e=!0),e}La(t,e){if(!t.fromCache||!this.Da())return!0;const i=e!=="Offline";return(!this.options.qa||!i)&&(!t.docs.isEmpty()||t.hasCachedResults||e==="Offline")}Ba(t){if(t.docChanges.length>0)return!0;const e=this.Na&&this.Na.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&this.options.includeMetadataChanges===!0}ka(t){t=Pi.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.Oa=!0,this.xa.next(t)}Da(){return this.options.source!==xl.Cache}}class Hg{constructor(t){this.key=t}}class Wg{constructor(t){this.key=t}}class fT{constructor(t,e){this.query=t,this.Ya=e,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=J(),this.mutatedKeys=J(),this.eu=hg(t),this.tu=new _i(this.eu)}get nu(){return this.Ya}ru(t,e){const i=e?e.iu:new rd,s=e?e.tu:this.tu;let r=e?e.mutatedKeys:this.mutatedKeys,o=s,a=!1;const l=this.query.limitType==="F"&&s.size===this.query.limit?s.last():null,u=this.query.limitType==="L"&&s.size===this.query.limit?s.first():null;if(t.inorderTraversal(((h,d)=>{const p=s.get(h),m=No(this.query,d)?d:null,b=!!p&&this.mutatedKeys.has(p.key),v=!!m&&(m.hasLocalMutations||this.mutatedKeys.has(m.key)&&m.hasCommittedMutations);let E=!1;p&&m?p.data.isEqual(m.data)?b!==v&&(i.track({type:3,doc:m}),E=!0):this.su(p,m)||(i.track({type:2,doc:m}),E=!0,(l&&this.eu(m,l)>0||u&&this.eu(m,u)<0)&&(a=!0)):!p&&m?(i.track({type:0,doc:m}),E=!0):p&&!m&&(i.track({type:1,doc:p}),E=!0,(l||u)&&(a=!0)),E&&(m?(o=o.add(m),r=v?r.add(h):r.delete(h)):(o=o.delete(h),r=r.delete(h)))})),this.query.limit!==null)for(;o.size>this.query.limit;){const h=this.query.limitType==="F"?o.last():o.first();o=o.delete(h.key),r=r.delete(h.key),i.track({type:1,doc:h})}return{tu:o,iu:i,Cs:a,mutatedKeys:r}}su(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,i,s){const r=this.tu;this.tu=t.tu,this.mutatedKeys=t.mutatedKeys;const o=t.iu.ya();o.sort(((h,d)=>(function(m,b){const v=E=>{switch(E){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return $(20277,{Rt:E})}};return v(m)-v(b)})(h.type,d.type)||this.eu(h.doc,d.doc))),this.ou(i),s=s??!1;const a=e&&!s?this._u():[],l=this.Xa.size===0&&this.current&&!s?1:0,u=l!==this.Za;return this.Za=l,o.length!==0||u?{snapshot:new Pi(this.query,t.tu,r,o,t.mutatedKeys,l===0,u,!1,!!i&&i.resumeToken.approximateByteSize()>0),au:a}:{au:a}}va(t){return this.current&&t==="Offline"?(this.current=!1,this.applyChanges({tu:this.tu,iu:new rd,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(t){return!this.Ya.has(t)&&!!this.tu.has(t)&&!this.tu.get(t).hasLocalMutations}ou(t){t&&(t.addedDocuments.forEach((e=>this.Ya=this.Ya.add(e))),t.modifiedDocuments.forEach((e=>{})),t.removedDocuments.forEach((e=>this.Ya=this.Ya.delete(e))),this.current=t.current)}_u(){if(!this.current)return[];const t=this.Xa;this.Xa=J(),this.tu.forEach((i=>{this.uu(i.key)&&(this.Xa=this.Xa.add(i.key))}));const e=[];return t.forEach((i=>{this.Xa.has(i)||e.push(new Wg(i))})),this.Xa.forEach((i=>{t.has(i)||e.push(new Hg(i))})),e}cu(t){this.Ya=t.Qs,this.Xa=J();const e=this.ru(t.documents);return this.applyChanges(e,!0)}lu(){return Pi.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,this.Za===0,this.hasCachedResults)}}const Tc="SyncEngine";class pT{constructor(t,e,i){this.query=t,this.targetId=e,this.view=i}}class gT{constructor(t){this.key=t,this.hu=!1}}class mT{constructor(t,e,i,s,r,o){this.localStore=t,this.remoteStore=e,this.eventManager=i,this.sharedClientState=s,this.currentUser=r,this.maxConcurrentLimboResolutions=o,this.Pu={},this.Tu=new ei((a=>ug(a)),Lo),this.Iu=new Map,this.Eu=new Set,this.du=new mt(z.comparator),this.Au=new Map,this.Ru=new dc,this.Vu={},this.mu=new Map,this.fu=Ci.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return this.gu===!0}}async function yT(n,t,e=!0){const i=Qg(n);let s;const r=i.Tu.get(t);return r?(i.sharedClientState.addLocalQueryTarget(r.targetId),s=r.view.lu()):s=await qg(i,t,e,!0),s}async function _T(n,t){const e=Qg(n);await qg(e,t,!0,!1)}async function qg(n,t,e,i){const s=await VE(n.localStore,_e(t)),r=s.targetId,o=n.sharedClientState.addLocalQueryTarget(r,e);let a;return i&&(a=await bT(n,t,r,o==="current",s.resumeToken)),n.isPrimaryClient&&e&&Fg(n.remoteStore,s),a}async function bT(n,t,e,i,s){n.pu=(d,p,m)=>(async function(v,E,C,P){let k=E.view.ru(C);k.Cs&&(k=await Zh(v.localStore,E.query,!1).then((({documents:w})=>E.view.ru(w,k))));const M=P&&P.targetChanges.get(E.targetId),O=P&&P.targetMismatches.get(E.targetId)!=null,N=E.view.applyChanges(k,v.isPrimaryClient,M,O);return cd(v,E.targetId,N.au),N.snapshot})(n,d,p,m);const r=await Zh(n.localStore,t,!0),o=new fT(t,r.Qs),a=o.ru(r.documents),l=ir.createSynthesizedTargetChangeForCurrentChange(e,i&&n.onlineState!=="Offline",s),u=o.applyChanges(a,n.isPrimaryClient,l);cd(n,e,u.au);const h=new pT(t,e,o);return n.Tu.set(t,h),n.Iu.has(e)?n.Iu.get(e).push(t):n.Iu.set(e,[t]),u.snapshot}async function vT(n,t,e){const i=q(n),s=i.Tu.get(t),r=i.Iu.get(s.targetId);if(r.length>1)return i.Iu.set(s.targetId,r.filter((o=>!Lo(o,t)))),void i.Tu.delete(t);i.isPrimaryClient?(i.sharedClientState.removeLocalQueryTarget(s.targetId),i.sharedClientState.isActiveQueryTarget(s.targetId)||await El(i.localStore,s.targetId,!1).then((()=>{i.sharedClientState.clearQueryState(s.targetId),e&&mc(i.remoteStore,s.targetId),Il(i,s.targetId)})).catch(Fi)):(Il(i,s.targetId),await El(i.localStore,s.targetId,!0))}async function wT(n,t){const e=q(n),i=e.Tu.get(t),s=e.Iu.get(i.targetId);e.isPrimaryClient&&s.length===1&&(e.sharedClientState.removeLocalQueryTarget(i.targetId),mc(e.remoteStore,i.targetId))}async function ET(n,t,e){const i=PT(n);try{const s=await(function(o,a){const l=q(o),u=dt.now(),h=a.reduce(((m,b)=>m.add(b.key)),J());let d,p;return l.persistence.runTransaction("Locally write mutations","readwrite",(m=>{let b=$e(),v=J();return l.Ns.getEntries(m,h).next((E=>{b=E,b.forEach(((C,P)=>{P.isValidDocument()||(v=v.add(C))}))})).next((()=>l.localDocuments.getOverlayedDocuments(m,b))).next((E=>{d=E;const C=[];for(const P of a){const k=Ow(P,d.get(P.key).overlayedDocument);k!=null&&C.push(new ni(P.key,k,ng(k.value.mapValue),be.exists(!0)))}return l.mutationQueue.addMutationBatch(m,u,C,a)})).next((E=>{p=E;const C=E.applyToLocalDocumentSet(d,v);return l.documentOverlayCache.saveOverlays(m,E.batchId,C)}))})).then((()=>({batchId:p.batchId,changes:fg(d)})))})(i.localStore,t);i.sharedClientState.addPendingMutation(s.batchId),(function(o,a,l){let u=o.Vu[o.currentUser.toKey()];u||(u=new mt(Q)),u=u.insert(a,l),o.Vu[o.currentUser.toKey()]=u})(i,s.batchId,e),await rr(i,s.changes),await jo(i.remoteStore)}catch(s){const r=wc(s,"Failed to persist write");e.reject(r)}}async function Gg(n,t){const e=q(n);try{const i=await DE(e.localStore,t);t.targetChanges.forEach(((s,r)=>{const o=e.Au.get(r);o&&(st(s.addedDocuments.size+s.modifiedDocuments.size+s.removedDocuments.size<=1,22616),s.addedDocuments.size>0?o.hu=!0:s.modifiedDocuments.size>0?st(o.hu,14607):s.removedDocuments.size>0&&(st(o.hu,42227),o.hu=!1))})),await rr(e,i,t)}catch(i){await Fi(i)}}function ld(n,t,e){const i=q(n);if(i.isPrimaryClient&&e===0||!i.isPrimaryClient&&e===1){const s=[];i.Tu.forEach(((r,o)=>{const a=o.view.va(t);a.snapshot&&s.push(a.snapshot)})),(function(o,a){const l=q(o);l.onlineState=a;let u=!1;l.queries.forEach(((h,d)=>{for(const p of d.Sa)p.va(a)&&(u=!0)})),u&&Ec(l)})(i.eventManager,t),s.length&&i.Pu.H_(s),i.onlineState=t,i.isPrimaryClient&&i.sharedClientState.setOnlineState(t)}}async function TT(n,t,e){const i=q(n);i.sharedClientState.updateQueryState(t,"rejected",e);const s=i.Au.get(t),r=s&&s.key;if(r){let o=new mt(z.comparator);o=o.insert(r,$t.newNoDocument(r,H.min()));const a=J().add(r),l=new Uo(H.min(),new Map,new mt(Q),o,a);await Gg(i,l),i.du=i.du.remove(r),i.Au.delete(t),xc(i)}else await El(i.localStore,t,!1).then((()=>Il(i,t,e))).catch(Fi)}async function xT(n,t){const e=q(n),i=t.batch.batchId;try{const s=await kE(e.localStore,t);Yg(e,i,null),Kg(e,i),e.sharedClientState.updateMutationState(i,"acknowledged"),await rr(e,s)}catch(s){await Fi(s)}}async function IT(n,t,e){const i=q(n);try{const s=await(function(o,a){const l=q(o);return l.persistence.runTransaction("Reject batch","readwrite-primary",(u=>{let h;return l.mutationQueue.lookupMutationBatch(u,a).next((d=>(st(d!==null,37113),h=d.keys(),l.mutationQueue.removeMutationBatch(u,d)))).next((()=>l.mutationQueue.performConsistencyCheck(u))).next((()=>l.documentOverlayCache.removeOverlaysForBatchId(u,h,a))).next((()=>l.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(u,h))).next((()=>l.localDocuments.getDocuments(u,h)))}))})(i.localStore,t);Yg(i,t,e),Kg(i,t),i.sharedClientState.updateMutationState(t,"rejected",e),await rr(i,s)}catch(s){await Fi(s)}}function Kg(n,t){(n.mu.get(t)||[]).forEach((e=>{e.resolve()})),n.mu.delete(t)}function Yg(n,t,e){const i=q(n);let s=i.Vu[i.currentUser.toKey()];if(s){const r=s.get(t);r&&(e?r.reject(e):r.resolve(),s=s.remove(t)),i.Vu[i.currentUser.toKey()]=s}}function Il(n,t,e=null){n.sharedClientState.removeLocalQueryTarget(t);for(const i of n.Iu.get(t))n.Tu.delete(i),e&&n.Pu.yu(i,e);n.Iu.delete(t),n.isPrimaryClient&&n.Ru.jr(t).forEach((i=>{n.Ru.containsKey(i)||Xg(n,i)}))}function Xg(n,t){n.Eu.delete(t.path.canonicalString());const e=n.du.get(t);e!==null&&(mc(n.remoteStore,e),n.du=n.du.remove(t),n.Au.delete(e),xc(n))}function cd(n,t,e){for(const i of e)i instanceof Hg?(n.Ru.addReference(i.key,t),AT(n,i)):i instanceof Wg?(B(Tc,"Document no longer in limbo: "+i.key),n.Ru.removeReference(i.key,t),n.Ru.containsKey(i.key)||Xg(n,i.key)):$(19791,{wu:i})}function AT(n,t){const e=t.key,i=e.path.canonicalString();n.du.get(e)||n.Eu.has(i)||(B(Tc,"New document in limbo: "+e),n.Eu.add(i),xc(n))}function xc(n){for(;n.Eu.size>0&&n.du.size<n.maxConcurrentLimboResolutions;){const t=n.Eu.values().next().value;n.Eu.delete(t);const e=new z(ct.fromString(t)),i=n.fu.next();n.Au.set(i,new gT(e)),n.du=n.du.insert(e,i),Fg(n.remoteStore,new rn(_e(oc(e.path)),i,"TargetPurposeLimboResolution",Mo.ce))}}async function rr(n,t,e){const i=q(n),s=[],r=[],o=[];i.Tu.isEmpty()||(i.Tu.forEach(((a,l)=>{o.push(i.pu(l,t,e).then((u=>{if((u||e)&&i.isPrimaryClient){const h=u?!u.fromCache:e?.targetChanges.get(l.targetId)?.current;i.sharedClientState.updateQueryState(l.targetId,h?"current":"not-current")}if(u){s.push(u);const h=pc.As(l.targetId,u);r.push(h)}})))})),await Promise.all(o),i.Pu.H_(s),await(async function(l,u){const h=q(l);try{await h.persistence.runTransaction("notifyLocalViewChanges","readwrite",(d=>L.forEach(u,(p=>L.forEach(p.Es,(m=>h.persistence.referenceDelegate.addReference(d,p.targetId,m))).next((()=>L.forEach(p.ds,(m=>h.persistence.referenceDelegate.removeReference(d,p.targetId,m)))))))))}catch(d){if(!Bi(d))throw d;B(gc,"Failed to update sequence numbers: "+d)}for(const d of u){const p=d.targetId;if(!d.fromCache){const m=h.Ms.get(p),b=m.snapshotVersion,v=m.withLastLimboFreeSnapshotVersion(b);h.Ms=h.Ms.insert(p,v)}}})(i.localStore,r))}async function ST(n,t){const e=q(n);if(!e.currentUser.isEqual(t)){B(Tc,"User change. New user:",t.toKey());const i=await Og(e.localStore,t);e.currentUser=t,(function(r,o){r.mu.forEach((a=>{a.forEach((l=>{l.reject(new U(V.CANCELLED,o))}))})),r.mu.clear()})(e,"'waitForPendingWrites' promise is rejected due to a user change."),e.sharedClientState.handleUserChange(t,i.removedBatchIds,i.addedBatchIds),await rr(e,i.Ls)}}function CT(n,t){const e=q(n),i=e.Au.get(t);if(i&&i.hu)return J().add(i.key);{let s=J();const r=e.Iu.get(t);if(!r)return s;for(const o of r){const a=e.Tu.get(o);s=s.unionWith(a.view.nu)}return s}}function Qg(n){const t=q(n);return t.remoteStore.remoteSyncer.applyRemoteEvent=Gg.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=CT.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=TT.bind(null,t),t.Pu.H_=uT.bind(null,t.eventManager),t.Pu.yu=hT.bind(null,t.eventManager),t}function PT(n){const t=q(n);return t.remoteStore.remoteSyncer.applySuccessfulWrite=xT.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=IT.bind(null,t),t}class _o{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(t){this.serializer=zo(t.databaseInfo.databaseId),this.sharedClientState=this.Du(t),this.persistence=this.Cu(t),await this.persistence.start(),this.localStore=this.vu(t),this.gcScheduler=this.Fu(t,this.localStore),this.indexBackfillerScheduler=this.Mu(t,this.localStore)}Fu(t,e){return null}Mu(t,e){return null}vu(t){return RE(this.persistence,new SE,t.initialUser,this.serializer)}Cu(t){return new Mg(fc.mi,this.serializer)}Du(t){return new NE}async terminate(){this.gcScheduler?.stop(),this.indexBackfillerScheduler?.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}_o.provider={build:()=>new _o};class RT extends _o{constructor(t){super(),this.cacheSizeBytes=t}Fu(t,e){st(this.persistence.referenceDelegate instanceof mo,46915);const i=this.persistence.referenceDelegate.garbageCollector;return new dE(i,t.asyncQueue,e)}Cu(t){const e=this.cacheSizeBytes!==void 0?Qt.withCacheSize(this.cacheSizeBytes):Qt.DEFAULT;return new Mg((i=>mo.mi(i,e)),this.serializer)}}class Al{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=i=>ld(this.syncEngine,i,1),this.remoteStore.remoteSyncer.handleCredentialChange=ST.bind(null,this.syncEngine),await rT(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return(function(){return new aT})()}createDatastore(t){const e=zo(t.databaseInfo.databaseId),i=(function(r){return new $E(r)})(t.databaseInfo);return(function(r,o,a,l){return new qE(r,o,a,l)})(t.authCredentials,t.appCheckCredentials,i,e)}createRemoteStore(t){return(function(i,s,r,o,a){return new KE(i,s,r,o,a)})(this.localStore,this.datastore,t.asyncQueue,(e=>ld(this.syncEngine,e,0)),(function(){return nd.v()?new nd:new FE})())}createSyncEngine(t,e){return(function(s,r,o,a,l,u,h){const d=new mT(s,r,o,a,l,u);return h&&(d.gu=!0),d})(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){await(async function(e){const i=q(e);B(Xn,"RemoteStore shutting down."),i.Ea.add(5),await sr(i),i.Aa.shutdown(),i.Ra.set("Unknown")})(this.remoteStore),this.datastore?.terminate(),this.eventManager?.terminate()}}Al.provider={build:()=>new Al};class kT{constructor(t){this.observer=t,this.muted=!1}next(t){this.muted||this.observer.next&&this.Ou(this.observer.next,t)}error(t){this.muted||(this.observer.error?this.Ou(this.observer.error,t):ze("Uncaught Error in snapshot listener:",t.toString()))}Nu(){this.muted=!0}Ou(t,e){setTimeout((()=>{this.muted||t(e)}),0)}}const wn="FirestoreClient";class DT{constructor(t,e,i,s,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=i,this.databaseInfo=s,this.user=Ut.UNAUTHENTICATED,this.clientId=tc.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=r,this.authCredentials.start(i,(async o=>{B(wn,"Received user=",o.uid),await this.authCredentialListener(o),this.user=o})),this.appCheckCredentials.start(i,(o=>(B(wn,"Received new app check token=",o),this.appCheckCredentialListener(o,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}terminate(){this.asyncQueue.enterRestrictedMode();const t=new $n;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const i=wc(e,"Failed to shutdown persistence");t.reject(i)}})),t.promise}}async function Da(n,t){n.asyncQueue.verifyOperationInProgress(),B(wn,"Initializing OfflineComponentProvider");const e=n.configuration;await t.initialize(e);let i=e.initialUser;n.setCredentialChangeListener((async s=>{i.isEqual(s)||(await Og(t.localStore,s),i=s)})),t.persistence.setDatabaseDeletedListener((()=>n.terminate())),n._offlineComponents=t}async function ud(n,t){n.asyncQueue.verifyOperationInProgress();const e=await MT(n);B(wn,"Initializing OnlineComponentProvider"),await t.initialize(e,n.configuration),n.setCredentialChangeListener((i=>sd(t.remoteStore,i))),n.setAppCheckTokenChangeListener(((i,s)=>sd(t.remoteStore,s))),n._onlineComponents=t}async function MT(n){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){B(wn,"Using user provided OfflineComponentProvider");try{await Da(n,n._uninitializedComponentsProvider._offline)}catch(t){const e=t;if(!(function(s){return s.name==="FirebaseError"?s.code===V.FAILED_PRECONDITION||s.code===V.UNIMPLEMENTED:!(typeof DOMException<"u"&&s instanceof DOMException)||s.code===22||s.code===20||s.code===11})(e))throw e;xi("Error using user provided cache. Falling back to memory cache: "+e),await Da(n,new _o)}}else B(wn,"Using default OfflineComponentProvider"),await Da(n,new RT(void 0));return n._offlineComponents}async function Jg(n){return n._onlineComponents||(n._uninitializedComponentsProvider?(B(wn,"Using user provided OnlineComponentProvider"),await ud(n,n._uninitializedComponentsProvider._online)):(B(wn,"Using default OnlineComponentProvider"),await ud(n,new Al))),n._onlineComponents}function OT(n){return Jg(n).then((t=>t.syncEngine))}async function hd(n){const t=await Jg(n),e=t.eventManager;return e.onListen=yT.bind(null,t.syncEngine),e.onUnlisten=vT.bind(null,t.syncEngine),e.onFirstRemoteStoreListen=_T.bind(null,t.syncEngine),e.onLastRemoteStoreUnlisten=wT.bind(null,t.syncEngine),e}function Zg(n){const t={};return n.timeoutSeconds!==void 0&&(t.timeoutSeconds=n.timeoutSeconds),t}const dd=new Map;const tm="firestore.googleapis.com",fd=!0;class pd{constructor(t){if(t.host===void 0){if(t.ssl!==void 0)throw new U(V.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=tm,this.ssl=fd}else this.host=t.host,this.ssl=t.ssl??fd;if(this.isUsingEmulator=t.emulatorOptions!==void 0,this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,t.cacheSizeBytes===void 0)this.cacheSizeBytes=Dg;else{if(t.cacheSizeBytes!==-1&&t.cacheSizeBytes<uE)throw new U(V.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}K0("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:t.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=Zg(t.experimentalLongPollingOptions??{}),(function(i){if(i.timeoutSeconds!==void 0){if(isNaN(i.timeoutSeconds))throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (must not be NaN)`);if(i.timeoutSeconds<5)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (minimum allowed value is 5)`);if(i.timeoutSeconds>30)throw new U(V.INVALID_ARGUMENT,`invalid long polling timeout: ${i.timeoutSeconds} (maximum allowed value is 30)`)}})(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&(function(i,s){return i.timeoutSeconds===s.timeoutSeconds})(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Ho{constructor(t,e,i,s){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=i,this._app=s,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new pd({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new U(V.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!=="notTerminated"}_setSettings(t){if(this._settingsFrozen)throw new U(V.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new pd(t),this._emulatorOptions=t.emulatorOptions||{},t.credentials!==void 0&&(this._authCredentials=(function(i){if(!i)return new F0;switch(i.type){case"firstParty":return new $0(i.sessionIndex||"0",i.iamToken||null,i.authTokenFactory||null);case"provider":return i.client;default:throw new U(V.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}})(t.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask==="notTerminated"&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){this._terminateTask==="notTerminated"?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return(function(e){const i=dd.get(e);i&&(B("ComponentProvider","Removing Datastore"),dd.delete(e),i.terminate())})(this),Promise.resolve()}}function VT(n,t,e,i={}){n=yi(n,Ho);const s=Oi(t),r=n._getSettings(),o={...r,emulatorOptions:n._getEmulatorOptions()},a=`${t}:${e}`;s&&(Jf(`https://${a}`),Zf("Firestore",!0)),r.host!==tm&&r.host!==a&&xi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const l={...r,host:a,ssl:s,emulatorOptions:i};if(!qn(l,o)&&(n._setSettings(l),i.mockUserToken)){let u,h;if(typeof i.mockUserToken=="string")u=i.mockUserToken,h=Ut.MOCK_USER;else{u=i_(i.mockUserToken,n._app?.options.projectId);const d=i.mockUserToken.sub||i.mockUserToken.user_id;if(!d)throw new U(V.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");h=new Ut(d)}n._authCredentials=new B0(new Hp(u,h))}}class zi{constructor(t,e,i){this.converter=e,this._query=i,this.type="query",this.firestore=t}withConverter(t){return new zi(this.firestore,t,this._query)}}class St{constructor(t,e,i){this.converter=e,this._key=i,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new pn(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new St(this.firestore,t,this._key)}toJSON(){return{type:St._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(t,e,i){if(tr(e,St._jsonSchema))return new St(t,i||null,new z(ct.fromString(e.referencePath)))}}St._jsonSchemaVersion="firestore/documentReference/1.0",St._jsonSchema={type:It("string",St._jsonSchemaVersion),referencePath:It("string")};class pn extends zi{constructor(t,e,i){super(t,e,oc(i)),this._path=i,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new St(this.firestore,null,new z(t))}withConverter(t){return new pn(this.firestore,t,this._path)}}function LT(n,t,...e){if(n=Yt(n),Wp("collection","path",t),n instanceof Ho){const i=ct.fromString(t,...e);return Ah(i),new pn(n,null,i)}{if(!(n instanceof St||n instanceof pn))throw new U(V.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ct.fromString(t,...e));return Ah(i),new pn(n.firestore,null,i)}}function em(n,t,...e){if(n=Yt(n),arguments.length===1&&(t=tc.newId()),Wp("doc","path",t),n instanceof Ho){const i=ct.fromString(t,...e);return Ih(i),new St(n,null,new z(i))}{if(!(n instanceof St||n instanceof pn))throw new U(V.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const i=n._path.child(ct.fromString(t,...e));return Ih(i),new St(n.firestore,n instanceof pn?n.converter:null,new z(i))}}const gd="AsyncQueue";class md{constructor(t=Promise.resolve()){this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Lg(this,"async_queue_retry"),this._c=()=>{const i=ka();i&&B(gd,"Visibility state changed to "+i.visibilityState),this.M_.w_()},this.ac=t;const e=ka();e&&typeof e.addEventListener=="function"&&e.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.uc(),this.cc(t)}enterRestrictedMode(t){if(!this.ec){this.ec=!0,this.sc=t||!1;const e=ka();e&&typeof e.removeEventListener=="function"&&e.removeEventListener("visibilitychange",this._c)}}enqueue(t){if(this.uc(),this.ec)return new Promise((()=>{}));const e=new $n;return this.cc((()=>this.ec&&this.sc?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.Xu.push(t),this.lc())))}async lc(){if(this.Xu.length!==0){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(t){if(!Bi(t))throw t;B(gd,"Operation failed with retryable error: "+t)}this.Xu.length>0&&this.M_.p_((()=>this.lc()))}}cc(t){const e=this.ac.then((()=>(this.rc=!0,t().catch((i=>{throw this.nc=i,this.rc=!1,ze("INTERNAL UNHANDLED ERROR: ",yd(i)),i})).then((i=>(this.rc=!1,i))))));return this.ac=e,e}enqueueAfterDelay(t,e,i){this.uc(),this.oc.indexOf(t)>-1&&(e=0);const s=vc.createAndSchedule(this,t,e,i,(r=>this.hc(r)));return this.tc.push(s),s}uc(){this.nc&&$(47125,{Pc:yd(this.nc)})}verifyOperationInProgress(){}async Tc(){let t;do t=this.ac,await t;while(t!==this.ac)}Ic(t){for(const e of this.tc)if(e.timerId===t)return!0;return!1}Ec(t){return this.Tc().then((()=>{this.tc.sort(((e,i)=>e.targetTimeMs-i.targetTimeMs));for(const e of this.tc)if(e.skipDelay(),t!=="all"&&e.timerId===t)break;return this.Tc()}))}dc(t){this.oc.push(t)}hc(t){const e=this.tc.indexOf(t);this.tc.splice(e,1)}}function yd(n){let t=n.message||"";return n.stack&&(t=n.stack.includes(n.message)?n.stack:n.message+`
`+n.stack),t}function _d(n){return(function(e,i){if(typeof e!="object"||e===null)return!1;const s=e;for(const r of i)if(r in s&&typeof s[r]=="function")return!0;return!1})(n,["next","error","complete"])}class Fs extends Ho{constructor(t,e,i,s){super(t,e,i,s),this.type="firestore",this._queue=new md,this._persistenceKey=s?.name||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const t=this._firestoreClient.terminate();this._queue=new md(t),this._firestoreClient=void 0,await t}}}function NT(n,t){const e=typeof n=="object"?n:ip(),i=typeof n=="string"?n:lo,s=zl(e,"firestore").getImmediate({identifier:i});if(!s._initialized){const r=e_("firestore");r&&VT(s,...r)}return s}function nm(n){if(n._terminated)throw new U(V.FAILED_PRECONDITION,"The client has already been terminated.");return n._firestoreClient||FT(n),n._firestoreClient}function FT(n){const t=n._freezeSettings(),e=(function(s,r,o,a){return new rw(s,r,o,a.host,a.ssl,a.experimentalForceLongPolling,a.experimentalAutoDetectLongPolling,Zg(a.experimentalLongPollingOptions),a.useFetchStreams,a.isUsingEmulator)})(n._databaseId,n._app?.options.appId||"",n._persistenceKey,t);n._componentsProvider||t.localCache?._offlineComponentProvider&&t.localCache?._onlineComponentProvider&&(n._componentsProvider={_offline:t.localCache._offlineComponentProvider,_online:t.localCache._onlineComponentProvider}),n._firestoreClient=new DT(n._authCredentials,n._appCheckCredentials,n._queue,e,n._componentsProvider&&(function(s){const r=s?._online.build();return{_offline:s?._offline.build(r),_online:r}})(n._componentsProvider))}class se{constructor(t){this._byteString=t}static fromBase64String(t){try{return new se(Lt.fromBase64String(t))}catch(e){throw new U(V.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(t){return new se(Lt.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}toJSON(){return{type:se._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(t){if(tr(t,se._jsonSchema))return se.fromBase64String(t.bytes)}}se._jsonSchemaVersion="firestore/bytes/1.0",se._jsonSchema={type:It("string",se._jsonSchemaVersion),bytes:It("string")};class Ic{constructor(...t){for(let e=0;e<t.length;++e)if(t[e].length===0)throw new U(V.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new Vt(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class im{constructor(t){this._methodName=t}}class we{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new U(V.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new U(V.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}_compareTo(t){return Q(this._lat,t._lat)||Q(this._long,t._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:we._jsonSchemaVersion}}static fromJSON(t){if(tr(t,we._jsonSchema))return new we(t.latitude,t.longitude)}}we._jsonSchemaVersion="firestore/geoPoint/1.0",we._jsonSchema={type:It("string",we._jsonSchemaVersion),latitude:It("number"),longitude:It("number")};class Ee{constructor(t){this._values=(t||[]).map((e=>e))}toArray(){return this._values.map((t=>t))}isEqual(t){return(function(i,s){if(i.length!==s.length)return!1;for(let r=0;r<i.length;++r)if(i[r]!==s[r])return!1;return!0})(this._values,t._values)}toJSON(){return{type:Ee._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(t){if(tr(t,Ee._jsonSchema)){if(Array.isArray(t.vectorValues)&&t.vectorValues.every((e=>typeof e=="number")))return new Ee(t.vectorValues);throw new U(V.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}Ee._jsonSchemaVersion="firestore/vectorValue/1.0",Ee._jsonSchema={type:It("string",Ee._jsonSchemaVersion),vectorValues:It("object")};const BT=/^__.*__$/;class UT{constructor(t,e,i){this.data=t,this.fieldMask=e,this.fieldTransforms=i}toMutation(t,e){return this.fieldMask!==null?new ni(t,this.data,this.fieldMask,e,this.fieldTransforms):new nr(t,this.data,e,this.fieldTransforms)}}function sm(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw $(40011,{Ac:n})}}class Ac{constructor(t,e,i,s,r,o){this.settings=t,this.databaseId=e,this.serializer=i,this.ignoreUndefinedProperties=s,r===void 0&&this.Rc(),this.fieldTransforms=r||[],this.fieldMask=o||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(t){return new Ac({...this.settings,...t},this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(t){const e=this.path?.child(t),i=this.Vc({path:e,fc:!1});return i.gc(t),i}yc(t){const e=this.path?.child(t),i=this.Vc({path:e,fc:!1});return i.Rc(),i}wc(t){return this.Vc({path:void 0,fc:!0})}Sc(t){return bo(t,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(t){return this.fieldMask.find((e=>t.isPrefixOf(e)))!==void 0||this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))!==void 0}Rc(){if(this.path)for(let t=0;t<this.path.length;t++)this.gc(this.path.get(t))}gc(t){if(t.length===0)throw this.Sc("Document fields must not be empty");if(sm(this.Ac)&&BT.test(t))throw this.Sc('Document fields cannot begin and end with "__"')}}class zT{constructor(t,e,i){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=i||zo(t)}Cc(t,e,i,s=!1){return new Ac({Ac:t,methodName:e,Dc:i,path:Vt.emptyPath(),fc:!1,bc:s},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function rm(n){const t=n._freezeSettings(),e=zo(n._databaseId);return new zT(n._databaseId,!!t.ignoreUndefinedProperties,e)}function $T(n,t,e,i,s,r={}){const o=n.Cc(r.merge||r.mergeFields?2:0,t,e,s);lm("Data must be an object, but it was:",o,i);const a=om(i,o);let l,u;if(r.merge)l=new le(o.fieldMask),u=o.fieldTransforms;else if(r.mergeFields){const h=[];for(const d of r.mergeFields){const p=HT(t,d,e);if(!o.contains(p))throw new U(V.INVALID_ARGUMENT,`Field '${p}' is specified in your field mask but missing from your input data.`);qT(h,p)||h.push(p)}l=new le(h),u=o.fieldTransforms.filter((d=>l.covers(d.field)))}else l=null,u=o.fieldTransforms;return new UT(new ie(a),l,u)}function jT(n,t,e,i=!1){return Sc(e,n.Cc(i?4:3,t))}function Sc(n,t){if(am(n=Yt(n)))return lm("Unsupported field value:",t,n),om(n,t);if(n instanceof im)return(function(i,s){if(!sm(s.Ac))throw s.Sc(`${i._methodName}() can only be used with update() and set()`);if(!s.path)throw s.Sc(`${i._methodName}() is not currently supported inside arrays`);const r=i._toFieldTransform(s);r&&s.fieldTransforms.push(r)})(n,t),null;if(n===void 0&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),n instanceof Array){if(t.settings.fc&&t.Ac!==4)throw t.Sc("Nested arrays are not supported");return(function(i,s){const r=[];let o=0;for(const a of i){let l=Sc(a,s.wc(o));l==null&&(l={nullValue:"NULL_VALUE"}),r.push(l),o++}return{arrayValue:{values:r}}})(n,t)}return(function(i,s){if((i=Yt(i))===null)return{nullValue:"NULL_VALUE"};if(typeof i=="number")return Cw(s.serializer,i);if(typeof i=="boolean")return{booleanValue:i};if(typeof i=="string")return{stringValue:i};if(i instanceof Date){const r=dt.fromDate(i);return{timestampValue:go(s.serializer,r)}}if(i instanceof dt){const r=new dt(i.seconds,1e3*Math.floor(i.nanoseconds/1e3));return{timestampValue:go(s.serializer,r)}}if(i instanceof we)return{geoPointValue:{latitude:i.latitude,longitude:i.longitude}};if(i instanceof se)return{bytesValue:Ig(s.serializer,i._byteString)};if(i instanceof St){const r=s.databaseId,o=i.firestore._databaseId;if(!o.isEqual(r))throw s.Sc(`Document reference is for database ${o.projectId}/${o.database} but should be for database ${r.projectId}/${r.database}`);return{referenceValue:hc(i.firestore._databaseId||s.databaseId,i._key.path)}}if(i instanceof Ee)return(function(o,a){return{mapValue:{fields:{[tg]:{stringValue:eg},[co]:{arrayValue:{values:o.toArray().map((u=>{if(typeof u!="number")throw a.Sc("VectorValues must only contain numeric values.");return ac(a.serializer,u)}))}}}}}})(i,s);throw s.Sc(`Unsupported field value: ${Do(i)}`)})(n,t)}function om(n,t){const e={};return Kp(n)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):ti(n,((i,s)=>{const r=Sc(s,t.mc(i));r!=null&&(e[i]=r)})),{mapValue:{fields:e}}}function am(n){return!(typeof n!="object"||n===null||n instanceof Array||n instanceof Date||n instanceof dt||n instanceof we||n instanceof se||n instanceof St||n instanceof im||n instanceof Ee)}function lm(n,t,e){if(!am(e)||!qp(e)){const i=Do(e);throw i==="an object"?t.Sc(n+" a custom object"):t.Sc(n+" "+i)}}function HT(n,t,e){if((t=Yt(t))instanceof Ic)return t._internalPath;if(typeof t=="string")return cm(n,t);throw bo("Field path arguments must be of type string or ",n,!1,void 0,e)}const WT=new RegExp("[~\\*/\\[\\]]");function cm(n,t,e){if(t.search(WT)>=0)throw bo(`Invalid field path (${t}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,e);try{return new Ic(...t.split("."))._internalPath}catch{throw bo(`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,e)}}function bo(n,t,e,i,s){const r=i&&!i.isEmpty(),o=s!==void 0;let a=`Function ${t}() called with invalid data`;e&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(r||o)&&(l+=" (found",r&&(l+=` in field ${i}`),o&&(l+=` in document ${s}`),l+=")"),new U(V.INVALID_ARGUMENT,a+n+l)}function qT(n,t){return n.some((e=>e.isEqual(t)))}class um{constructor(t,e,i,s,r){this._firestore=t,this._userDataWriter=e,this._key=i,this._document=s,this._converter=r}get id(){return this._key.path.lastSegment()}get ref(){return new St(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document){if(this._converter){const t=new GT(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(hm("DocumentSnapshot.get",t));if(e!==null)return this._userDataWriter.convertValue(e)}}}class GT extends um{data(){return super.data()}}function hm(n,t){return typeof t=="string"?cm(n,t):t instanceof Ic?t._internalPath:t._delegate._internalPath}function KT(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new U(V.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Cc{}class YT extends Cc{}function XT(n,t,...e){let i=[];t instanceof Cc&&i.push(t),i=i.concat(e),(function(r){const o=r.filter((l=>l instanceof Rc)).length,a=r.filter((l=>l instanceof Pc)).length;if(o>1||o>0&&a>0)throw new U(V.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")})(i);for(const s of i)n=s._apply(n);return n}class Pc extends YT{constructor(t,e,i){super(),this._field=t,this._op=e,this._value=i,this.type="where"}static _create(t,e,i){return new Pc(t,e,i)}_apply(t){const e=this._parse(t);return dm(t._query,e),new zi(t.firestore,t.converter,ml(t._query,e))}_parse(t){const e=rm(t.firestore);return(function(r,o,a,l,u,h,d){let p;if(u.isKeyField()){if(h==="array-contains"||h==="array-contains-any")throw new U(V.INVALID_ARGUMENT,`Invalid Query. You can't perform '${h}' queries on documentId().`);if(h==="in"||h==="not-in"){vd(d,h);const b=[];for(const v of d)b.push(bd(l,r,v));p={arrayValue:{values:b}}}else p=bd(l,r,d)}else h!=="in"&&h!=="not-in"&&h!=="array-contains-any"||vd(d,h),p=jT(a,o,d,h==="in"||h==="not-in");return xt.create(u,h,p)})(t._query,"where",e,t.firestore._databaseId,this._field,this._op,this._value)}}class Rc extends Cc{constructor(t,e){super(),this.type=t,this._queryConstraints=e}static _create(t,e){return new Rc(t,e)}_parse(t){const e=this._queryConstraints.map((i=>i._parse(t))).filter((i=>i.getFilters().length>0));return e.length===1?e[0]:he.create(e,this._getOperator())}_apply(t){const e=this._parse(t);return e.getFilters().length===0?t:((function(s,r){let o=s;const a=r.getFlattenedFilters();for(const l of a)dm(o,l),o=ml(o,l)})(t._query,e),new zi(t.firestore,t.converter,ml(t._query,e)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}}function bd(n,t,e){if(typeof(e=Yt(e))=="string"){if(e==="")throw new U(V.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!cg(t)&&e.indexOf("/")!==-1)throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${e}' contains a '/' character.`);const i=t.path.child(ct.fromString(e));if(!z.isDocumentKey(i))throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${i}' is not because it has an odd number of segments (${i.length}).`);return Oh(n,new z(i))}if(e instanceof St)return Oh(n,e._key);throw new U(V.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Do(e)}.`)}function vd(n,t){if(!Array.isArray(n)||n.length===0)throw new U(V.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${t.toString()}' filters.`)}function dm(n,t){const e=(function(s,r){for(const o of s)for(const a of o.getFlattenedFilters())if(r.indexOf(a.op)>=0)return a.op;return null})(n.filters,(function(s){switch(s){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}})(t.op));if(e!==null)throw e===t.op?new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${t.op.toString()}' filter.`):new U(V.INVALID_ARGUMENT,`Invalid query. You cannot use '${t.op.toString()}' filters with '${e.toString()}' filters.`)}class QT{convertValue(t,e="none"){switch(bn(t)){case 0:return null;case 1:return t.booleanValue;case 2:return vt(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(_n(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 11:return this.convertObject(t.mapValue,e);case 10:return this.convertVectorValue(t.mapValue);default:throw $(62114,{value:t})}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const i={};return ti(t,((s,r)=>{i[s]=this.convertValue(r,e)})),i}convertVectorValue(t){const e=t.fields?.[co].arrayValue?.values?.map((i=>vt(i.doubleValue)));return new Ee(e)}convertGeoPoint(t){return new we(vt(t.latitude),vt(t.longitude))}convertArray(t,e){return(t.values||[]).map((i=>this.convertValue(i,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const i=Vo(t);return i==null?null:this.convertValue(i,e);case"estimate":return this.convertTimestamp(Ms(t));default:return null}}convertTimestamp(t){const e=yn(t);return new dt(e.seconds,e.nanos)}convertDocumentKey(t,e){const i=ct.fromString(t);st(kg(i),9688,{name:t});const s=new Os(i.get(1),i.get(3)),r=new z(i.popFirst(5));return s.isEqual(e)||ze(`Document ${r} contains a document reference within a different database (${s.projectId}/${s.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),r}}function JT(n,t,e){let i;return i=n?n.toFirestore(t):t,i}class ds{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class jn extends um{constructor(t,e,i,s,r,o){super(t,e,i,s,o),this._firestore=t,this._firestoreImpl=t,this.metadata=r}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Yr(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const i=this._document.data.field(hm("DocumentSnapshot.get",t));if(i!==null)return this._userDataWriter.convertValue(i,e.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t=this._document,e={};return e.type=jn._jsonSchemaVersion,e.bundle="",e.bundleSource="DocumentSnapshot",e.bundleName=this._key.toString(),!t||!t.isValidDocument()||!t.isFoundDocument()?e:(this._userDataWriter.convertObjectMap(t.data.value.mapValue.fields,"previous"),e.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),e)}}jn._jsonSchemaVersion="firestore/documentSnapshot/1.0",jn._jsonSchema={type:It("string",jn._jsonSchemaVersion),bundleSource:It("string","DocumentSnapshot"),bundleName:It("string"),bundle:It("string")};class Yr extends jn{data(t={}){return super.data(t)}}class bi{constructor(t,e,i,s){this._firestore=t,this._userDataWriter=e,this._snapshot=s,this.metadata=new ds(s.hasPendingWrites,s.fromCache),this.query=i}get docs(){const t=[];return this.forEach((e=>t.push(e))),t}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(t,e){this._snapshot.docs.forEach((i=>{t.call(e,new Yr(this._firestore,this._userDataWriter,i.key,i,new ds(this._snapshot.mutatedKeys.has(i.key),this._snapshot.fromCache),this.query.converter))}))}docChanges(t={}){const e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new U(V.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=(function(s,r){if(s._snapshot.oldDocs.isEmpty()){let o=0;return s._snapshot.docChanges.map((a=>{const l=new Yr(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ds(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);return a.doc,{type:"added",doc:l,oldIndex:-1,newIndex:o++}}))}{let o=s._snapshot.oldDocs;return s._snapshot.docChanges.filter((a=>r||a.type!==3)).map((a=>{const l=new Yr(s._firestore,s._userDataWriter,a.doc.key,a.doc,new ds(s._snapshot.mutatedKeys.has(a.doc.key),s._snapshot.fromCache),s.query.converter);let u=-1,h=-1;return a.type!==0&&(u=o.indexOf(a.doc.key),o=o.delete(a.doc.key)),a.type!==1&&(o=o.add(a.doc),h=o.indexOf(a.doc.key)),{type:ZT(a.type),doc:l,oldIndex:u,newIndex:h}}))}})(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new U(V.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const t={};t.type=bi._jsonSchemaVersion,t.bundleSource="QuerySnapshot",t.bundleName=tc.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const e=[],i=[],s=[];return this.docs.forEach((r=>{r._document!==null&&(e.push(r._document),i.push(this._userDataWriter.convertObjectMap(r._document.data.value.mapValue.fields,"previous")),s.push(r.ref.path))})),t.bundle=(this._firestore,this.query._query,t.bundleName,"NOT SUPPORTED"),t}}function ZT(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return $(61501,{type:n})}}bi._jsonSchemaVersion="firestore/querySnapshot/1.0",bi._jsonSchema={type:It("string",bi._jsonSchemaVersion),bundleSource:It("string","QuerySnapshot"),bundleName:It("string"),bundle:It("string")};class fm extends QT{constructor(t){super(),this.firestore=t}convertBytes(t){return new se(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new St(this.firestore,null,e)}}function tx(n){return pm(yi(n.firestore,Fs),[new lc(n._key,be.none())])}function ex(n,t){const e=yi(n.firestore,Fs),i=em(n),s=JT(n.converter,t);return pm(e,[$T(rm(n.firestore),"addDoc",i._key,s,n.converter!==null,{}).toMutation(i._key,be.exists(!1))]).then((()=>i))}function nx(n,...t){n=Yt(n);let e={includeMetadataChanges:!1,source:"default"},i=0;typeof t[i]!="object"||_d(t[i])||(e=t[i++]);const s={includeMetadataChanges:e.includeMetadataChanges,source:e.source};if(_d(t[i])){const l=t[i];t[i]=l.next?.bind(l),t[i+1]=l.error?.bind(l),t[i+2]=l.complete?.bind(l)}let r,o,a;if(n instanceof St)o=yi(n.firestore,Fs),a=oc(n._key.path),r={next:l=>{t[i]&&t[i](ix(o,n,l))},error:t[i+1],complete:t[i+2]};else{const l=yi(n,zi);o=yi(l.firestore,Fs),a=l._query;const u=new fm(o);r={next:h=>{t[i]&&t[i](new bi(o,u,l,h))},error:t[i+1],complete:t[i+2]},KT(n._query)}return(function(u,h,d,p){const m=new kT(p),b=new dT(h,m,d);return u.asyncQueue.enqueueAndForget((async()=>lT(await hd(u),b))),()=>{m.Nu(),u.asyncQueue.enqueueAndForget((async()=>cT(await hd(u),b)))}})(nm(o),a,s,r)}function pm(n,t){return(function(i,s){const r=new $n;return i.asyncQueue.enqueueAndForget((async()=>ET(await OT(i),s,r))),r.promise})(nm(n),t)}function ix(n,t,e){const i=e.docs.get(t._key),s=new fm(n);return new jn(n,s,t._key,i,new ds(e.hasPendingWrites,e.fromCache),t.converter)}(function(t,e=!0){(function(s){Ni=s})(Vi),Ei(new Gn("firestore",((i,{instanceIdentifier:s,options:r})=>{const o=i.getProvider("app").getImmediate(),a=new Fs(new U0(i.getProvider("auth-internal")),new j0(o,i.getProvider("app-check-internal")),(function(u,h){if(!Object.prototype.hasOwnProperty.apply(u.options,["projectId"]))throw new U(V.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Os(u.options.projectId,h)})(o,s),o);return r={useFetchStreams:e,...r},a._setSettings(r),a}),"PUBLIC").setMultipleInstances(!0)),dn(wh,Eh,t),dn(wh,Eh,"esm2020")})();const gm=NT(Lp),mm=n=>LT(gm,`users/${n}/fixed_income`);function sx(n,t){if(!n)return()=>{};const e=XT(mm(n));return nx(e,i=>{const s=[];i.forEach(r=>{s.push({id:r.id,...r.data()})}),t(s)},i=>{console.error("Firestore Error:",i)})}async function rx(n,t){if(!n)throw new Error("User not authenticated");return ex(mm(n),t)}async function ox(n,t){if(!n)throw new Error("User not authenticated");const e=em(gm,`users/${n}/fixed_income`,t);return tx(e)}class ax{constructor(){this.state={user:null,dashboard:{totalBalance:0,profit:0,profitPercentage:0,goal:1e6,dividends:0,allocation:{labels:["Renda Fixa"],data:[100]},topAssets:[]},fixedIncome:{assets:[],closedAssets:[]}},this.listeners=[],N0(t=>{t?(this.state.user={uid:t.uid,name:t.displayName,email:t.email,photo:t.photoURL},sx(t.uid,e=>{this.state.fixedIncome.assets=e,this.updateDashboardFromAssets(),this.notify()})):(this.state.user=null,this.state.fixedIncome.assets=[],this.updateDashboardFromAssets(),this.notify()),this.notify()})}updateDashboardFromAssets(){const t=this.state.fixedIncome.assets,e=t.reduce((a,l)=>a+(parseFloat(l.investedValue)||0),0),i=t.reduce((a,l)=>a+(parseFloat(l.currentBalance)||0),0),s=i-e,r=e>0?s/e*100:0;this.state.dashboard.totalBalance=i,this.state.dashboard.profit=s,this.state.dashboard.profitPercentage=r;const o=[...t].sort((a,l)=>l.currentBalance-a.currentBalance).slice(0,5);this.state.dashboard.topAssets=o.map(a=>({name:a.issuer,ticker:a.type,value:a.currentBalance,percentage:i>0?a.currentBalance/i*100:0})),this.state.dashboard.allocation={labels:["Renda Fixa"],data:[100]}}notify(){this.listeners.forEach(t=>t(this.state))}getState(){return this.state}subscribe(t){return this.listeners.push(t),t(this.state),()=>{this.listeners=this.listeners.filter(e=>e!==t)}}updateAssetBalance(t,e){const i=this.state.fixedIncome.assets.find(s=>s.id===t);if(i){const s=parseFloat(e);if(s!==i.currentBalance){i.currentBalance=s;const r=new Date;i.lastUpdate=r.toISOString(),i.history.push({date:r.toISOString(),type:"update",value:s}),this.listeners.forEach(o=>o(this.state))}}}removeHistoryItem(t,e){const i=this.state.fixedIncome.assets.find(s=>s.id===t);if(i&&i.history[e]){if(i.history.splice(e,1),i.history.length>0){const s=[...i.history].sort((o,a)=>new Date(o.date)-new Date(a.date)),r=s[s.length-1];i.currentBalance=r.value,i.lastUpdate=r.date}else i.currentBalance=i.investedValue,i.lastUpdate=null;this.listeners.forEach(s=>s(this.state))}}sellAsset(t,e,i){const s=this.state.fixedIncome.assets.findIndex(l=>l.id===t);if(s===-1)return;const r=this.state.fixedIncome.assets[s],o=e>=r.currentBalance,a={date:i,type:"sell",value:parseFloat(e)};o?(r.currentBalance=0,r.history.push(a),r.status="liquidated",this.state.fixedIncome.closedAssets.push(r),this.state.fixedIncome.assets.splice(s,1)):(r.currentBalance-=parseFloat(e),r.history.push(a)),this.listeners.forEach(l=>l(this.state))}editAsset(t,e){const i=this.state.fixedIncome.assets.find(s=>s.id===t);i&&(Object.assign(i,e),this.listeners.forEach(s=>s(this.state)))}async deleteAsset(t){const e=this.state.fixedIncome.assets.findIndex(i=>i.id===t);if(e!==-1&&(this.state.fixedIncome.assets.splice(e,1),this.listeners.forEach(i=>i(this.state))),this.state.user&&this.state.user.uid)try{await ox(this.state.user.uid,t)}catch(i){console.error("Failed to delete asset in Firestore:",i)}}}const jt=new ax;function or(n){return n+.5|0}const on=(n,t,e)=>Math.max(Math.min(n,e),t);function fs(n){return on(or(n*2.55),0,255)}function gn(n){return on(or(n*255),0,255)}function De(n){return on(or(n/2.55)/100,0,1)}function wd(n){return on(or(n*100),0,100)}const ne={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,A:10,B:11,C:12,D:13,E:14,F:15,a:10,b:11,c:12,d:13,e:14,f:15},Sl=[..."0123456789ABCDEF"],lx=n=>Sl[n&15],cx=n=>Sl[(n&240)>>4]+Sl[n&15],Sr=n=>(n&240)>>4===(n&15),ux=n=>Sr(n.r)&&Sr(n.g)&&Sr(n.b)&&Sr(n.a);function hx(n){var t=n.length,e;return n[0]==="#"&&(t===4||t===5?e={r:255&ne[n[1]]*17,g:255&ne[n[2]]*17,b:255&ne[n[3]]*17,a:t===5?ne[n[4]]*17:255}:(t===7||t===9)&&(e={r:ne[n[1]]<<4|ne[n[2]],g:ne[n[3]]<<4|ne[n[4]],b:ne[n[5]]<<4|ne[n[6]],a:t===9?ne[n[7]]<<4|ne[n[8]]:255})),e}const dx=(n,t)=>n<255?t(n):"";function fx(n){var t=ux(n)?lx:cx;return n?"#"+t(n.r)+t(n.g)+t(n.b)+dx(n.a,t):void 0}const px=/^(hsla?|hwb|hsv)\(\s*([-+.e\d]+)(?:deg)?[\s,]+([-+.e\d]+)%[\s,]+([-+.e\d]+)%(?:[\s,]+([-+.e\d]+)(%)?)?\s*\)$/;function ym(n,t,e){const i=t*Math.min(e,1-e),s=(r,o=(r+n/30)%12)=>e-i*Math.max(Math.min(o-3,9-o,1),-1);return[s(0),s(8),s(4)]}function gx(n,t,e){const i=(s,r=(s+n/60)%6)=>e-e*t*Math.max(Math.min(r,4-r,1),0);return[i(5),i(3),i(1)]}function mx(n,t,e){const i=ym(n,1,.5);let s;for(t+e>1&&(s=1/(t+e),t*=s,e*=s),s=0;s<3;s++)i[s]*=1-t-e,i[s]+=t;return i}function yx(n,t,e,i,s){return n===s?(t-e)/i+(t<e?6:0):t===s?(e-n)/i+2:(n-t)/i+4}function kc(n){const e=n.r/255,i=n.g/255,s=n.b/255,r=Math.max(e,i,s),o=Math.min(e,i,s),a=(r+o)/2;let l,u,h;return r!==o&&(h=r-o,u=a>.5?h/(2-r-o):h/(r+o),l=yx(e,i,s,h,r),l=l*60+.5),[l|0,u||0,a]}function Dc(n,t,e,i){return(Array.isArray(t)?n(t[0],t[1],t[2]):n(t,e,i)).map(gn)}function Mc(n,t,e){return Dc(ym,n,t,e)}function _x(n,t,e){return Dc(mx,n,t,e)}function bx(n,t,e){return Dc(gx,n,t,e)}function _m(n){return(n%360+360)%360}function vx(n){const t=px.exec(n);let e=255,i;if(!t)return;t[5]!==i&&(e=t[6]?fs(+t[5]):gn(+t[5]));const s=_m(+t[2]),r=+t[3]/100,o=+t[4]/100;return t[1]==="hwb"?i=_x(s,r,o):t[1]==="hsv"?i=bx(s,r,o):i=Mc(s,r,o),{r:i[0],g:i[1],b:i[2],a:e}}function wx(n,t){var e=kc(n);e[0]=_m(e[0]+t),e=Mc(e),n.r=e[0],n.g=e[1],n.b=e[2]}function Ex(n){if(!n)return;const t=kc(n),e=t[0],i=wd(t[1]),s=wd(t[2]);return n.a<255?`hsla(${e}, ${i}%, ${s}%, ${De(n.a)})`:`hsl(${e}, ${i}%, ${s}%)`}const Ed={x:"dark",Z:"light",Y:"re",X:"blu",W:"gr",V:"medium",U:"slate",A:"ee",T:"ol",S:"or",B:"ra",C:"lateg",D:"ights",R:"in",Q:"turquois",E:"hi",P:"ro",O:"al",N:"le",M:"de",L:"yello",F:"en",K:"ch",G:"arks",H:"ea",I:"ightg",J:"wh"},Td={OiceXe:"f0f8ff",antiquewEte:"faebd7",aqua:"ffff",aquamarRe:"7fffd4",azuY:"f0ffff",beige:"f5f5dc",bisque:"ffe4c4",black:"0",blanKedOmond:"ffebcd",Xe:"ff",XeviTet:"8a2be2",bPwn:"a52a2a",burlywood:"deb887",caMtXe:"5f9ea0",KartYuse:"7fff00",KocTate:"d2691e",cSO:"ff7f50",cSnflowerXe:"6495ed",cSnsilk:"fff8dc",crimson:"dc143c",cyan:"ffff",xXe:"8b",xcyan:"8b8b",xgTMnPd:"b8860b",xWay:"a9a9a9",xgYF:"6400",xgYy:"a9a9a9",xkhaki:"bdb76b",xmagFta:"8b008b",xTivegYF:"556b2f",xSange:"ff8c00",xScEd:"9932cc",xYd:"8b0000",xsOmon:"e9967a",xsHgYF:"8fbc8f",xUXe:"483d8b",xUWay:"2f4f4f",xUgYy:"2f4f4f",xQe:"ced1",xviTet:"9400d3",dAppRk:"ff1493",dApskyXe:"bfff",dimWay:"696969",dimgYy:"696969",dodgerXe:"1e90ff",fiYbrick:"b22222",flSOwEte:"fffaf0",foYstWAn:"228b22",fuKsia:"ff00ff",gaRsbSo:"dcdcdc",ghostwEte:"f8f8ff",gTd:"ffd700",gTMnPd:"daa520",Way:"808080",gYF:"8000",gYFLw:"adff2f",gYy:"808080",honeyMw:"f0fff0",hotpRk:"ff69b4",RdianYd:"cd5c5c",Rdigo:"4b0082",ivSy:"fffff0",khaki:"f0e68c",lavFMr:"e6e6fa",lavFMrXsh:"fff0f5",lawngYF:"7cfc00",NmoncEffon:"fffacd",ZXe:"add8e6",ZcSO:"f08080",Zcyan:"e0ffff",ZgTMnPdLw:"fafad2",ZWay:"d3d3d3",ZgYF:"90ee90",ZgYy:"d3d3d3",ZpRk:"ffb6c1",ZsOmon:"ffa07a",ZsHgYF:"20b2aa",ZskyXe:"87cefa",ZUWay:"778899",ZUgYy:"778899",ZstAlXe:"b0c4de",ZLw:"ffffe0",lime:"ff00",limegYF:"32cd32",lRF:"faf0e6",magFta:"ff00ff",maPon:"800000",VaquamarRe:"66cdaa",VXe:"cd",VScEd:"ba55d3",VpurpN:"9370db",VsHgYF:"3cb371",VUXe:"7b68ee",VsprRggYF:"fa9a",VQe:"48d1cc",VviTetYd:"c71585",midnightXe:"191970",mRtcYam:"f5fffa",mistyPse:"ffe4e1",moccasR:"ffe4b5",navajowEte:"ffdead",navy:"80",Tdlace:"fdf5e6",Tive:"808000",TivedBb:"6b8e23",Sange:"ffa500",SangeYd:"ff4500",ScEd:"da70d6",pOegTMnPd:"eee8aa",pOegYF:"98fb98",pOeQe:"afeeee",pOeviTetYd:"db7093",papayawEp:"ffefd5",pHKpuff:"ffdab9",peru:"cd853f",pRk:"ffc0cb",plum:"dda0dd",powMrXe:"b0e0e6",purpN:"800080",YbeccapurpN:"663399",Yd:"ff0000",Psybrown:"bc8f8f",PyOXe:"4169e1",saddNbPwn:"8b4513",sOmon:"fa8072",sandybPwn:"f4a460",sHgYF:"2e8b57",sHshell:"fff5ee",siFna:"a0522d",silver:"c0c0c0",skyXe:"87ceeb",UXe:"6a5acd",UWay:"708090",UgYy:"708090",snow:"fffafa",sprRggYF:"ff7f",stAlXe:"4682b4",tan:"d2b48c",teO:"8080",tEstN:"d8bfd8",tomato:"ff6347",Qe:"40e0d0",viTet:"ee82ee",JHt:"f5deb3",wEte:"ffffff",wEtesmoke:"f5f5f5",Lw:"ffff00",LwgYF:"9acd32"};function Tx(){const n={},t=Object.keys(Td),e=Object.keys(Ed);let i,s,r,o,a;for(i=0;i<t.length;i++){for(o=a=t[i],s=0;s<e.length;s++)r=e[s],a=a.replace(r,Ed[r]);r=parseInt(Td[o],16),n[a]=[r>>16&255,r>>8&255,r&255]}return n}let Cr;function xx(n){Cr||(Cr=Tx(),Cr.transparent=[0,0,0,0]);const t=Cr[n.toLowerCase()];return t&&{r:t[0],g:t[1],b:t[2],a:t.length===4?t[3]:255}}const Ix=/^rgba?\(\s*([-+.\d]+)(%)?[\s,]+([-+.e\d]+)(%)?[\s,]+([-+.e\d]+)(%)?(?:[\s,/]+([-+.e\d]+)(%)?)?\s*\)$/;function Ax(n){const t=Ix.exec(n);let e=255,i,s,r;if(t){if(t[7]!==i){const o=+t[7];e=t[8]?fs(o):on(o*255,0,255)}return i=+t[1],s=+t[3],r=+t[5],i=255&(t[2]?fs(i):on(i,0,255)),s=255&(t[4]?fs(s):on(s,0,255)),r=255&(t[6]?fs(r):on(r,0,255)),{r:i,g:s,b:r,a:e}}}function Sx(n){return n&&(n.a<255?`rgba(${n.r}, ${n.g}, ${n.b}, ${De(n.a)})`:`rgb(${n.r}, ${n.g}, ${n.b})`)}const Ma=n=>n<=.0031308?n*12.92:Math.pow(n,1/2.4)*1.055-.055,li=n=>n<=.04045?n/12.92:Math.pow((n+.055)/1.055,2.4);function Cx(n,t,e){const i=li(De(n.r)),s=li(De(n.g)),r=li(De(n.b));return{r:gn(Ma(i+e*(li(De(t.r))-i))),g:gn(Ma(s+e*(li(De(t.g))-s))),b:gn(Ma(r+e*(li(De(t.b))-r))),a:n.a+e*(t.a-n.a)}}function Pr(n,t,e){if(n){let i=kc(n);i[t]=Math.max(0,Math.min(i[t]+i[t]*e,t===0?360:1)),i=Mc(i),n.r=i[0],n.g=i[1],n.b=i[2]}}function bm(n,t){return n&&Object.assign(t||{},n)}function xd(n){var t={r:0,g:0,b:0,a:255};return Array.isArray(n)?n.length>=3&&(t={r:n[0],g:n[1],b:n[2],a:255},n.length>3&&(t.a=gn(n[3]))):(t=bm(n,{r:0,g:0,b:0,a:1}),t.a=gn(t.a)),t}function Px(n){return n.charAt(0)==="r"?Ax(n):vx(n)}class Bs{constructor(t){if(t instanceof Bs)return t;const e=typeof t;let i;e==="object"?i=xd(t):e==="string"&&(i=hx(t)||xx(t)||Px(t)),this._rgb=i,this._valid=!!i}get valid(){return this._valid}get rgb(){var t=bm(this._rgb);return t&&(t.a=De(t.a)),t}set rgb(t){this._rgb=xd(t)}rgbString(){return this._valid?Sx(this._rgb):void 0}hexString(){return this._valid?fx(this._rgb):void 0}hslString(){return this._valid?Ex(this._rgb):void 0}mix(t,e){if(t){const i=this.rgb,s=t.rgb;let r;const o=e===r?.5:e,a=2*o-1,l=i.a-s.a,u=((a*l===-1?a:(a+l)/(1+a*l))+1)/2;r=1-u,i.r=255&u*i.r+r*s.r+.5,i.g=255&u*i.g+r*s.g+.5,i.b=255&u*i.b+r*s.b+.5,i.a=o*i.a+(1-o)*s.a,this.rgb=i}return this}interpolate(t,e){return t&&(this._rgb=Cx(this._rgb,t._rgb,e)),this}clone(){return new Bs(this.rgb)}alpha(t){return this._rgb.a=gn(t),this}clearer(t){const e=this._rgb;return e.a*=1-t,this}greyscale(){const t=this._rgb,e=or(t.r*.3+t.g*.59+t.b*.11);return t.r=t.g=t.b=e,this}opaquer(t){const e=this._rgb;return e.a*=1+t,this}negate(){const t=this._rgb;return t.r=255-t.r,t.g=255-t.g,t.b=255-t.b,this}lighten(t){return Pr(this._rgb,2,t),this}darken(t){return Pr(this._rgb,2,-t),this}saturate(t){return Pr(this._rgb,1,t),this}desaturate(t){return Pr(this._rgb,1,-t),this}rotate(t){return wx(this._rgb,t),this}}function Ce(){}const Rx=(()=>{let n=0;return()=>n++})();function Y(n){return n==null}function pt(n){if(Array.isArray&&Array.isArray(n))return!0;const t=Object.prototype.toString.call(n);return t.slice(0,7)==="[object"&&t.slice(-6)==="Array]"}function Z(n){return n!==null&&Object.prototype.toString.call(n)==="[object Object]"}function bt(n){return(typeof n=="number"||n instanceof Number)&&isFinite(+n)}function te(n,t){return bt(n)?n:t}function W(n,t){return typeof n>"u"?t:n}const kx=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100:+n/t,vm=(n,t)=>typeof n=="string"&&n.endsWith("%")?parseFloat(n)/100*t:+n;function lt(n,t,e){if(n&&typeof n.call=="function")return n.apply(e,t)}function rt(n,t,e,i){let s,r,o;if(pt(n))for(r=n.length,s=0;s<r;s++)t.call(e,n[s],s);else if(Z(n))for(o=Object.keys(n),r=o.length,s=0;s<r;s++)t.call(e,n[o[s]],o[s])}function vo(n,t){let e,i,s,r;if(!n||!t||n.length!==t.length)return!1;for(e=0,i=n.length;e<i;++e)if(s=n[e],r=t[e],s.datasetIndex!==r.datasetIndex||s.index!==r.index)return!1;return!0}function wo(n){if(pt(n))return n.map(wo);if(Z(n)){const t=Object.create(null),e=Object.keys(n),i=e.length;let s=0;for(;s<i;++s)t[e[s]]=wo(n[e[s]]);return t}return n}function wm(n){return["__proto__","prototype","constructor"].indexOf(n)===-1}function Dx(n,t,e,i){if(!wm(n))return;const s=t[n],r=e[n];Z(s)&&Z(r)?Us(s,r,i):t[n]=wo(r)}function Us(n,t,e){const i=pt(t)?t:[t],s=i.length;if(!Z(n))return n;e=e||{};const r=e.merger||Dx;let o;for(let a=0;a<s;++a){if(o=i[a],!Z(o))continue;const l=Object.keys(o);for(let u=0,h=l.length;u<h;++u)r(l[u],n,o,e)}return n}function Ts(n,t){return Us(n,t,{merger:Mx})}function Mx(n,t,e){if(!wm(n))return;const i=t[n],s=e[n];Z(i)&&Z(s)?Ts(i,s):Object.prototype.hasOwnProperty.call(t,n)||(t[n]=wo(s))}const Id={"":n=>n,x:n=>n.x,y:n=>n.y};function Ox(n){const t=n.split("."),e=[];let i="";for(const s of t)i+=s,i.endsWith("\\")?i=i.slice(0,-1)+".":(e.push(i),i="");return e}function Vx(n){const t=Ox(n);return e=>{for(const i of t){if(i==="")break;e=e&&e[i]}return e}}function En(n,t){return(Id[t]||(Id[t]=Vx(t)))(n)}function Oc(n){return n.charAt(0).toUpperCase()+n.slice(1)}const zs=n=>typeof n<"u",Tn=n=>typeof n=="function",Ad=(n,t)=>{if(n.size!==t.size)return!1;for(const e of n)if(!t.has(e))return!1;return!0};function Lx(n){return n.type==="mouseup"||n.type==="click"||n.type==="contextmenu"}const et=Math.PI,ft=2*et,Nx=ft+et,Eo=Number.POSITIVE_INFINITY,Fx=et/180,wt=et/2,Dn=et/4,Sd=et*2/3,an=Math.log10,Te=Math.sign;function xs(n,t,e){return Math.abs(n-t)<e}function Cd(n){const t=Math.round(n);n=xs(n,t,n/1e3)?t:n;const e=Math.pow(10,Math.floor(an(n))),i=n/e;return(i<=1?1:i<=2?2:i<=5?5:10)*e}function Bx(n){const t=[],e=Math.sqrt(n);let i;for(i=1;i<e;i++)n%i===0&&(t.push(i),t.push(n/i));return e===(e|0)&&t.push(e),t.sort((s,r)=>s-r).pop(),t}function Ux(n){return typeof n=="symbol"||typeof n=="object"&&n!==null&&!(Symbol.toPrimitive in n||"toString"in n||"valueOf"in n)}function Ri(n){return!Ux(n)&&!isNaN(parseFloat(n))&&isFinite(n)}function zx(n,t){const e=Math.round(n);return e-t<=n&&e+t>=n}function Em(n,t,e){let i,s,r;for(i=0,s=n.length;i<s;i++)r=n[i][e],isNaN(r)||(t.min=Math.min(t.min,r),t.max=Math.max(t.max,r))}function ce(n){return n*(et/180)}function Vc(n){return n*(180/et)}function Pd(n){if(!bt(n))return;let t=1,e=0;for(;Math.round(n*t)/t!==n;)t*=10,e++;return e}function Tm(n,t){const e=t.x-n.x,i=t.y-n.y,s=Math.sqrt(e*e+i*i);let r=Math.atan2(i,e);return r<-.5*et&&(r+=ft),{angle:r,distance:s}}function Cl(n,t){return Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2))}function $x(n,t){return(n-t+Nx)%ft-et}function zt(n){return(n%ft+ft)%ft}function $s(n,t,e,i){const s=zt(n),r=zt(t),o=zt(e),a=zt(r-s),l=zt(o-s),u=zt(s-r),h=zt(s-o);return s===r||s===o||i&&r===o||a>l&&u<h}function Mt(n,t,e){return Math.max(t,Math.min(e,n))}function jx(n){return Mt(n,-32768,32767)}function Le(n,t,e,i=1e-6){return n>=Math.min(t,e)-i&&n<=Math.max(t,e)+i}function Lc(n,t,e){e=e||(o=>n[o]<t);let i=n.length-1,s=0,r;for(;i-s>1;)r=s+i>>1,e(r)?s=r:i=r;return{lo:s,hi:i}}const Ne=(n,t,e,i)=>Lc(n,e,i?s=>{const r=n[s][t];return r<e||r===e&&n[s+1][t]===e}:s=>n[s][t]<e),Hx=(n,t,e)=>Lc(n,e,i=>n[i][t]>=e);function Wx(n,t,e){let i=0,s=n.length;for(;i<s&&n[i]<t;)i++;for(;s>i&&n[s-1]>e;)s--;return i>0||s<n.length?n.slice(i,s):n}const xm=["push","pop","shift","splice","unshift"];function qx(n,t){if(n._chartjs){n._chartjs.listeners.push(t);return}Object.defineProperty(n,"_chartjs",{configurable:!0,enumerable:!1,value:{listeners:[t]}}),xm.forEach(e=>{const i="_onData"+Oc(e),s=n[e];Object.defineProperty(n,e,{configurable:!0,enumerable:!1,value(...r){const o=s.apply(this,r);return n._chartjs.listeners.forEach(a=>{typeof a[i]=="function"&&a[i](...r)}),o}})})}function Rd(n,t){const e=n._chartjs;if(!e)return;const i=e.listeners,s=i.indexOf(t);s!==-1&&i.splice(s,1),!(i.length>0)&&(xm.forEach(r=>{delete n[r]}),delete n._chartjs)}function Im(n){const t=new Set(n);return t.size===n.length?n:Array.from(t)}const Am=(function(){return typeof window>"u"?function(n){return n()}:window.requestAnimationFrame})();function Sm(n,t){let e=[],i=!1;return function(...s){e=s,i||(i=!0,Am.call(window,()=>{i=!1,n.apply(t,e)}))}}function Gx(n,t){let e;return function(...i){return t?(clearTimeout(e),e=setTimeout(n,t,i)):n.apply(this,i),t}}const Nc=n=>n==="start"?"left":n==="end"?"right":"center",Bt=(n,t,e)=>n==="start"?t:n==="end"?e:(t+e)/2,Kx=(n,t,e,i)=>n===(i?"left":"right")?e:n==="center"?(t+e)/2:t;function Cm(n,t,e){const i=t.length;let s=0,r=i;if(n._sorted){const{iScale:o,vScale:a,_parsed:l}=n,u=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null,h=o.axis,{min:d,max:p,minDefined:m,maxDefined:b}=o.getUserBounds();if(m){if(s=Math.min(Ne(l,h,d).lo,e?i:Ne(t,h,o.getPixelForValue(d)).lo),u){const v=l.slice(0,s+1).reverse().findIndex(E=>!Y(E[a.axis]));s-=Math.max(0,v)}s=Mt(s,0,i-1)}if(b){let v=Math.max(Ne(l,o.axis,p,!0).hi+1,e?0:Ne(t,h,o.getPixelForValue(p),!0).hi+1);if(u){const E=l.slice(v-1).findIndex(C=>!Y(C[a.axis]));v+=Math.max(0,E)}r=Mt(v,s,i)-s}else r=i-s}return{start:s,count:r}}function Pm(n){const{xScale:t,yScale:e,_scaleRanges:i}=n,s={xmin:t.min,xmax:t.max,ymin:e.min,ymax:e.max};if(!i)return n._scaleRanges=s,!0;const r=i.xmin!==t.min||i.xmax!==t.max||i.ymin!==e.min||i.ymax!==e.max;return Object.assign(i,s),r}const Rr=n=>n===0||n===1,kd=(n,t,e)=>-(Math.pow(2,10*(n-=1))*Math.sin((n-t)*ft/e)),Dd=(n,t,e)=>Math.pow(2,-10*n)*Math.sin((n-t)*ft/e)+1,Is={linear:n=>n,easeInQuad:n=>n*n,easeOutQuad:n=>-n*(n-2),easeInOutQuad:n=>(n/=.5)<1?.5*n*n:-.5*(--n*(n-2)-1),easeInCubic:n=>n*n*n,easeOutCubic:n=>(n-=1)*n*n+1,easeInOutCubic:n=>(n/=.5)<1?.5*n*n*n:.5*((n-=2)*n*n+2),easeInQuart:n=>n*n*n*n,easeOutQuart:n=>-((n-=1)*n*n*n-1),easeInOutQuart:n=>(n/=.5)<1?.5*n*n*n*n:-.5*((n-=2)*n*n*n-2),easeInQuint:n=>n*n*n*n*n,easeOutQuint:n=>(n-=1)*n*n*n*n+1,easeInOutQuint:n=>(n/=.5)<1?.5*n*n*n*n*n:.5*((n-=2)*n*n*n*n+2),easeInSine:n=>-Math.cos(n*wt)+1,easeOutSine:n=>Math.sin(n*wt),easeInOutSine:n=>-.5*(Math.cos(et*n)-1),easeInExpo:n=>n===0?0:Math.pow(2,10*(n-1)),easeOutExpo:n=>n===1?1:-Math.pow(2,-10*n)+1,easeInOutExpo:n=>Rr(n)?n:n<.5?.5*Math.pow(2,10*(n*2-1)):.5*(-Math.pow(2,-10*(n*2-1))+2),easeInCirc:n=>n>=1?n:-(Math.sqrt(1-n*n)-1),easeOutCirc:n=>Math.sqrt(1-(n-=1)*n),easeInOutCirc:n=>(n/=.5)<1?-.5*(Math.sqrt(1-n*n)-1):.5*(Math.sqrt(1-(n-=2)*n)+1),easeInElastic:n=>Rr(n)?n:kd(n,.075,.3),easeOutElastic:n=>Rr(n)?n:Dd(n,.075,.3),easeInOutElastic(n){return Rr(n)?n:n<.5?.5*kd(n*2,.1125,.45):.5+.5*Dd(n*2-1,.1125,.45)},easeInBack(n){return n*n*((1.70158+1)*n-1.70158)},easeOutBack(n){return(n-=1)*n*((1.70158+1)*n+1.70158)+1},easeInOutBack(n){let t=1.70158;return(n/=.5)<1?.5*(n*n*(((t*=1.525)+1)*n-t)):.5*((n-=2)*n*(((t*=1.525)+1)*n+t)+2)},easeInBounce:n=>1-Is.easeOutBounce(1-n),easeOutBounce(n){return n<1/2.75?7.5625*n*n:n<2/2.75?7.5625*(n-=1.5/2.75)*n+.75:n<2.5/2.75?7.5625*(n-=2.25/2.75)*n+.9375:7.5625*(n-=2.625/2.75)*n+.984375},easeInOutBounce:n=>n<.5?Is.easeInBounce(n*2)*.5:Is.easeOutBounce(n*2-1)*.5+.5};function Fc(n){if(n&&typeof n=="object"){const t=n.toString();return t==="[object CanvasPattern]"||t==="[object CanvasGradient]"}return!1}function Md(n){return Fc(n)?n:new Bs(n)}function Oa(n){return Fc(n)?n:new Bs(n).saturate(.5).darken(.1).hexString()}const Yx=["x","y","borderWidth","radius","tension"],Xx=["color","borderColor","backgroundColor"];function Qx(n){n.set("animation",{delay:void 0,duration:1e3,easing:"easeOutQuart",fn:void 0,from:void 0,loop:void 0,to:void 0,type:void 0}),n.describe("animation",{_fallback:!1,_indexable:!1,_scriptable:t=>t!=="onProgress"&&t!=="onComplete"&&t!=="fn"}),n.set("animations",{colors:{type:"color",properties:Xx},numbers:{type:"number",properties:Yx}}),n.describe("animations",{_fallback:"animation"}),n.set("transitions",{active:{animation:{duration:400}},resize:{animation:{duration:0}},show:{animations:{colors:{from:"transparent"},visible:{type:"boolean",duration:0}}},hide:{animations:{colors:{to:"transparent"},visible:{type:"boolean",easing:"linear",fn:t=>t|0}}}})}function Jx(n){n.set("layout",{autoPadding:!0,padding:{top:0,right:0,bottom:0,left:0}})}const Od=new Map;function Zx(n,t){t=t||{};const e=n+JSON.stringify(t);let i=Od.get(e);return i||(i=new Intl.NumberFormat(n,t),Od.set(e,i)),i}function ar(n,t,e){return Zx(t,e).format(n)}const Rm={values(n){return pt(n)?n:""+n},numeric(n,t,e){if(n===0)return"0";const i=this.chart.options.locale;let s,r=n;if(e.length>1){const u=Math.max(Math.abs(e[0].value),Math.abs(e[e.length-1].value));(u<1e-4||u>1e15)&&(s="scientific"),r=tI(n,e)}const o=an(Math.abs(r)),a=isNaN(o)?1:Math.max(Math.min(-1*Math.floor(o),20),0),l={notation:s,minimumFractionDigits:a,maximumFractionDigits:a};return Object.assign(l,this.options.ticks.format),ar(n,i,l)},logarithmic(n,t,e){if(n===0)return"0";const i=e[t].significand||n/Math.pow(10,Math.floor(an(n)));return[1,2,3,5,10,15].includes(i)||t>.8*e.length?Rm.numeric.call(this,n,t,e):""}};function tI(n,t){let e=t.length>3?t[2].value-t[1].value:t[1].value-t[0].value;return Math.abs(e)>=1&&n!==Math.floor(n)&&(e=n-Math.floor(n)),e}var Wo={formatters:Rm};function eI(n){n.set("scale",{display:!0,offset:!1,reverse:!1,beginAtZero:!1,bounds:"ticks",clip:!0,grace:0,grid:{display:!0,lineWidth:1,drawOnChartArea:!0,drawTicks:!0,tickLength:8,tickWidth:(t,e)=>e.lineWidth,tickColor:(t,e)=>e.color,offset:!1},border:{display:!0,dash:[],dashOffset:0,width:1},title:{display:!1,text:"",padding:{top:4,bottom:4}},ticks:{minRotation:0,maxRotation:50,mirror:!1,textStrokeWidth:0,textStrokeColor:"",padding:3,display:!0,autoSkip:!0,autoSkipPadding:3,labelOffset:0,callback:Wo.formatters.values,minor:{},major:{},align:"center",crossAlign:"near",showLabelBackdrop:!1,backdropColor:"rgba(255, 255, 255, 0.75)",backdropPadding:2}}),n.route("scale.ticks","color","","color"),n.route("scale.grid","color","","borderColor"),n.route("scale.border","color","","borderColor"),n.route("scale.title","color","","color"),n.describe("scale",{_fallback:!1,_scriptable:t=>!t.startsWith("before")&&!t.startsWith("after")&&t!=="callback"&&t!=="parser",_indexable:t=>t!=="borderDash"&&t!=="tickBorderDash"&&t!=="dash"}),n.describe("scales",{_fallback:"scale"}),n.describe("scale.ticks",{_scriptable:t=>t!=="backdropPadding"&&t!=="callback",_indexable:t=>t!=="backdropPadding"})}const Qn=Object.create(null),Pl=Object.create(null);function As(n,t){if(!t)return n;const e=t.split(".");for(let i=0,s=e.length;i<s;++i){const r=e[i];n=n[r]||(n[r]=Object.create(null))}return n}function Va(n,t,e){return typeof t=="string"?Us(As(n,t),e):Us(As(n,""),t)}class nI{constructor(t,e){this.animation=void 0,this.backgroundColor="rgba(0,0,0,0.1)",this.borderColor="rgba(0,0,0,0.1)",this.color="#666",this.datasets={},this.devicePixelRatio=i=>i.chart.platform.getDevicePixelRatio(),this.elements={},this.events=["mousemove","mouseout","click","touchstart","touchmove"],this.font={family:"'Helvetica Neue', 'Helvetica', 'Arial', sans-serif",size:12,style:"normal",lineHeight:1.2,weight:null},this.hover={},this.hoverBackgroundColor=(i,s)=>Oa(s.backgroundColor),this.hoverBorderColor=(i,s)=>Oa(s.borderColor),this.hoverColor=(i,s)=>Oa(s.color),this.indexAxis="x",this.interaction={mode:"nearest",intersect:!0,includeInvisible:!1},this.maintainAspectRatio=!0,this.onHover=null,this.onClick=null,this.parsing=!0,this.plugins={},this.responsive=!0,this.scale=void 0,this.scales={},this.showLine=!0,this.drawActiveElementsOnTop=!0,this.describe(t),this.apply(e)}set(t,e){return Va(this,t,e)}get(t){return As(this,t)}describe(t,e){return Va(Pl,t,e)}override(t,e){return Va(Qn,t,e)}route(t,e,i,s){const r=As(this,t),o=As(this,i),a="_"+e;Object.defineProperties(r,{[a]:{value:r[e],writable:!0},[e]:{enumerable:!0,get(){const l=this[a],u=o[s];return Z(l)?Object.assign({},u,l):W(l,u)},set(l){this[a]=l}}})}apply(t){t.forEach(e=>e(this))}}var gt=new nI({_scriptable:n=>!n.startsWith("on"),_indexable:n=>n!=="events",hover:{_fallback:"interaction"},interaction:{_scriptable:!1,_indexable:!1}},[Qx,Jx,eI]);function iI(n){return!n||Y(n.size)||Y(n.family)?null:(n.style?n.style+" ":"")+(n.weight?n.weight+" ":"")+n.size+"px "+n.family}function To(n,t,e,i,s){let r=t[s];return r||(r=t[s]=n.measureText(s).width,e.push(s)),r>i&&(i=r),i}function sI(n,t,e,i){i=i||{};let s=i.data=i.data||{},r=i.garbageCollect=i.garbageCollect||[];i.font!==t&&(s=i.data={},r=i.garbageCollect=[],i.font=t),n.save(),n.font=t;let o=0;const a=e.length;let l,u,h,d,p;for(l=0;l<a;l++)if(d=e[l],d!=null&&!pt(d))o=To(n,s,r,o,d);else if(pt(d))for(u=0,h=d.length;u<h;u++)p=d[u],p!=null&&!pt(p)&&(o=To(n,s,r,o,p));n.restore();const m=r.length/2;if(m>e.length){for(l=0;l<m;l++)delete s[r[l]];r.splice(0,m)}return o}function Mn(n,t,e){const i=n.currentDevicePixelRatio,s=e!==0?Math.max(e/2,.5):0;return Math.round((t-s)*i)/i+s}function Vd(n,t){!t&&!n||(t=t||n.getContext("2d"),t.save(),t.resetTransform(),t.clearRect(0,0,n.width,n.height),t.restore())}function Rl(n,t,e,i){km(n,t,e,i,null)}function km(n,t,e,i,s){let r,o,a,l,u,h,d,p;const m=t.pointStyle,b=t.rotation,v=t.radius;let E=(b||0)*Fx;if(m&&typeof m=="object"&&(r=m.toString(),r==="[object HTMLImageElement]"||r==="[object HTMLCanvasElement]")){n.save(),n.translate(e,i),n.rotate(E),n.drawImage(m,-m.width/2,-m.height/2,m.width,m.height),n.restore();return}if(!(isNaN(v)||v<=0)){switch(n.beginPath(),m){default:s?n.ellipse(e,i,s/2,v,0,0,ft):n.arc(e,i,v,0,ft),n.closePath();break;case"triangle":h=s?s/2:v,n.moveTo(e+Math.sin(E)*h,i-Math.cos(E)*v),E+=Sd,n.lineTo(e+Math.sin(E)*h,i-Math.cos(E)*v),E+=Sd,n.lineTo(e+Math.sin(E)*h,i-Math.cos(E)*v),n.closePath();break;case"rectRounded":u=v*.516,l=v-u,o=Math.cos(E+Dn)*l,d=Math.cos(E+Dn)*(s?s/2-u:l),a=Math.sin(E+Dn)*l,p=Math.sin(E+Dn)*(s?s/2-u:l),n.arc(e-d,i-a,u,E-et,E-wt),n.arc(e+p,i-o,u,E-wt,E),n.arc(e+d,i+a,u,E,E+wt),n.arc(e-p,i+o,u,E+wt,E+et),n.closePath();break;case"rect":if(!b){l=Math.SQRT1_2*v,h=s?s/2:l,n.rect(e-h,i-l,2*h,2*l);break}E+=Dn;case"rectRot":d=Math.cos(E)*(s?s/2:v),o=Math.cos(E)*v,a=Math.sin(E)*v,p=Math.sin(E)*(s?s/2:v),n.moveTo(e-d,i-a),n.lineTo(e+p,i-o),n.lineTo(e+d,i+a),n.lineTo(e-p,i+o),n.closePath();break;case"crossRot":E+=Dn;case"cross":d=Math.cos(E)*(s?s/2:v),o=Math.cos(E)*v,a=Math.sin(E)*v,p=Math.sin(E)*(s?s/2:v),n.moveTo(e-d,i-a),n.lineTo(e+d,i+a),n.moveTo(e+p,i-o),n.lineTo(e-p,i+o);break;case"star":d=Math.cos(E)*(s?s/2:v),o=Math.cos(E)*v,a=Math.sin(E)*v,p=Math.sin(E)*(s?s/2:v),n.moveTo(e-d,i-a),n.lineTo(e+d,i+a),n.moveTo(e+p,i-o),n.lineTo(e-p,i+o),E+=Dn,d=Math.cos(E)*(s?s/2:v),o=Math.cos(E)*v,a=Math.sin(E)*v,p=Math.sin(E)*(s?s/2:v),n.moveTo(e-d,i-a),n.lineTo(e+d,i+a),n.moveTo(e+p,i-o),n.lineTo(e-p,i+o);break;case"line":o=s?s/2:Math.cos(E)*v,a=Math.sin(E)*v,n.moveTo(e-o,i-a),n.lineTo(e+o,i+a);break;case"dash":n.moveTo(e,i),n.lineTo(e+Math.cos(E)*(s?s/2:v),i+Math.sin(E)*v);break;case!1:n.closePath();break}n.fill(),t.borderWidth>0&&n.stroke()}}function Fe(n,t,e){return e=e||.5,!t||n&&n.x>t.left-e&&n.x<t.right+e&&n.y>t.top-e&&n.y<t.bottom+e}function qo(n,t){n.save(),n.beginPath(),n.rect(t.left,t.top,t.right-t.left,t.bottom-t.top),n.clip()}function Go(n){n.restore()}function rI(n,t,e,i,s){if(!t)return n.lineTo(e.x,e.y);if(s==="middle"){const r=(t.x+e.x)/2;n.lineTo(r,t.y),n.lineTo(r,e.y)}else s==="after"!=!!i?n.lineTo(t.x,e.y):n.lineTo(e.x,t.y);n.lineTo(e.x,e.y)}function oI(n,t,e,i){if(!t)return n.lineTo(e.x,e.y);n.bezierCurveTo(i?t.cp1x:t.cp2x,i?t.cp1y:t.cp2y,i?e.cp2x:e.cp1x,i?e.cp2y:e.cp1y,e.x,e.y)}function aI(n,t){t.translation&&n.translate(t.translation[0],t.translation[1]),Y(t.rotation)||n.rotate(t.rotation),t.color&&(n.fillStyle=t.color),t.textAlign&&(n.textAlign=t.textAlign),t.textBaseline&&(n.textBaseline=t.textBaseline)}function lI(n,t,e,i,s){if(s.strikethrough||s.underline){const r=n.measureText(i),o=t-r.actualBoundingBoxLeft,a=t+r.actualBoundingBoxRight,l=e-r.actualBoundingBoxAscent,u=e+r.actualBoundingBoxDescent,h=s.strikethrough?(l+u)/2:u;n.strokeStyle=n.fillStyle,n.beginPath(),n.lineWidth=s.decorationWidth||2,n.moveTo(o,h),n.lineTo(a,h),n.stroke()}}function cI(n,t){const e=n.fillStyle;n.fillStyle=t.color,n.fillRect(t.left,t.top,t.width,t.height),n.fillStyle=e}function Jn(n,t,e,i,s,r={}){const o=pt(t)?t:[t],a=r.strokeWidth>0&&r.strokeColor!=="";let l,u;for(n.save(),n.font=s.string,aI(n,r),l=0;l<o.length;++l)u=o[l],r.backdrop&&cI(n,r.backdrop),a&&(r.strokeColor&&(n.strokeStyle=r.strokeColor),Y(r.strokeWidth)||(n.lineWidth=r.strokeWidth),n.strokeText(u,e,i,r.maxWidth)),n.fillText(u,e,i,r.maxWidth),lI(n,e,i,u,r),i+=Number(s.lineHeight);n.restore()}function js(n,t){const{x:e,y:i,w:s,h:r,radius:o}=t;n.arc(e+o.topLeft,i+o.topLeft,o.topLeft,1.5*et,et,!0),n.lineTo(e,i+r-o.bottomLeft),n.arc(e+o.bottomLeft,i+r-o.bottomLeft,o.bottomLeft,et,wt,!0),n.lineTo(e+s-o.bottomRight,i+r),n.arc(e+s-o.bottomRight,i+r-o.bottomRight,o.bottomRight,wt,0,!0),n.lineTo(e+s,i+o.topRight),n.arc(e+s-o.topRight,i+o.topRight,o.topRight,0,-wt,!0),n.lineTo(e+o.topLeft,i)}const uI=/^(normal|(\d+(?:\.\d+)?)(px|em|%)?)$/,hI=/^(normal|italic|initial|inherit|unset|(oblique( -?[0-9]?[0-9]deg)?))$/;function dI(n,t){const e=(""+n).match(uI);if(!e||e[1]==="normal")return t*1.2;switch(n=+e[2],e[3]){case"px":return n;case"%":n/=100;break}return t*n}const fI=n=>+n||0;function Bc(n,t){const e={},i=Z(t),s=i?Object.keys(t):t,r=Z(n)?i?o=>W(n[o],n[t[o]]):o=>n[o]:()=>n;for(const o of s)e[o]=fI(r(o));return e}function Dm(n){return Bc(n,{top:"y",right:"x",bottom:"y",left:"x"})}function Hn(n){return Bc(n,["topLeft","topRight","bottomLeft","bottomRight"])}function qt(n){const t=Dm(n);return t.width=t.left+t.right,t.height=t.top+t.bottom,t}function Ct(n,t){n=n||{},t=t||gt.font;let e=W(n.size,t.size);typeof e=="string"&&(e=parseInt(e,10));let i=W(n.style,t.style);i&&!(""+i).match(hI)&&(console.warn('Invalid font style specified: "'+i+'"'),i=void 0);const s={family:W(n.family,t.family),lineHeight:dI(W(n.lineHeight,t.lineHeight),e),size:e,style:i,weight:W(n.weight,t.weight),string:""};return s.string=iI(s),s}function ps(n,t,e,i){let s,r,o;for(s=0,r=n.length;s<r;++s)if(o=n[s],o!==void 0&&o!==void 0)return o}function pI(n,t,e){const{min:i,max:s}=n,r=vm(t,(s-i)/2),o=(a,l)=>e&&a===0?0:a+l;return{min:o(i,-Math.abs(r)),max:o(s,r)}}function In(n,t){return Object.assign(Object.create(n),t)}function Uc(n,t=[""],e,i,s=()=>n[0]){const r=e||n;typeof i>"u"&&(i=Lm("_fallback",n));const o={[Symbol.toStringTag]:"Object",_cacheable:!0,_scopes:n,_rootScopes:r,_fallback:i,_getTarget:s,override:a=>Uc([a,...n],t,r,i)};return new Proxy(o,{deleteProperty(a,l){return delete a[l],delete a._keys,delete n[0][l],!0},get(a,l){return Om(a,l,()=>EI(l,t,n,a))},getOwnPropertyDescriptor(a,l){return Reflect.getOwnPropertyDescriptor(a._scopes[0],l)},getPrototypeOf(){return Reflect.getPrototypeOf(n[0])},has(a,l){return Nd(a).includes(l)},ownKeys(a){return Nd(a)},set(a,l,u){const h=a._storage||(a._storage=s());return a[l]=h[l]=u,delete a._keys,!0}})}function ki(n,t,e,i){const s={_cacheable:!1,_proxy:n,_context:t,_subProxy:e,_stack:new Set,_descriptors:Mm(n,i),setContext:r=>ki(n,r,e,i),override:r=>ki(n.override(r),t,e,i)};return new Proxy(s,{deleteProperty(r,o){return delete r[o],delete n[o],!0},get(r,o,a){return Om(r,o,()=>mI(r,o,a))},getOwnPropertyDescriptor(r,o){return r._descriptors.allKeys?Reflect.has(n,o)?{enumerable:!0,configurable:!0}:void 0:Reflect.getOwnPropertyDescriptor(n,o)},getPrototypeOf(){return Reflect.getPrototypeOf(n)},has(r,o){return Reflect.has(n,o)},ownKeys(){return Reflect.ownKeys(n)},set(r,o,a){return n[o]=a,delete r[o],!0}})}function Mm(n,t={scriptable:!0,indexable:!0}){const{_scriptable:e=t.scriptable,_indexable:i=t.indexable,_allKeys:s=t.allKeys}=n;return{allKeys:s,scriptable:e,indexable:i,isScriptable:Tn(e)?e:()=>e,isIndexable:Tn(i)?i:()=>i}}const gI=(n,t)=>n?n+Oc(t):t,zc=(n,t)=>Z(t)&&n!=="adapters"&&(Object.getPrototypeOf(t)===null||t.constructor===Object);function Om(n,t,e){if(Object.prototype.hasOwnProperty.call(n,t)||t==="constructor")return n[t];const i=e();return n[t]=i,i}function mI(n,t,e){const{_proxy:i,_context:s,_subProxy:r,_descriptors:o}=n;let a=i[t];return Tn(a)&&o.isScriptable(t)&&(a=yI(t,a,n,e)),pt(a)&&a.length&&(a=_I(t,a,n,o.isIndexable)),zc(t,a)&&(a=ki(a,s,r&&r[t],o)),a}function yI(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_stack:a}=e;if(a.has(n))throw new Error("Recursion detected: "+Array.from(a).join("->")+"->"+n);a.add(n);let l=t(r,o||i);return a.delete(n),zc(n,l)&&(l=$c(s._scopes,s,n,l)),l}function _I(n,t,e,i){const{_proxy:s,_context:r,_subProxy:o,_descriptors:a}=e;if(typeof r.index<"u"&&i(n))return t[r.index%t.length];if(Z(t[0])){const l=t,u=s._scopes.filter(h=>h!==l);t=[];for(const h of l){const d=$c(u,s,n,h);t.push(ki(d,r,o&&o[n],a))}}return t}function Vm(n,t,e){return Tn(n)?n(t,e):n}const bI=(n,t)=>n===!0?t:typeof n=="string"?En(t,n):void 0;function vI(n,t,e,i,s){for(const r of t){const o=bI(e,r);if(o){n.add(o);const a=Vm(o._fallback,e,s);if(typeof a<"u"&&a!==e&&a!==i)return a}else if(o===!1&&typeof i<"u"&&e!==i)return null}return!1}function $c(n,t,e,i){const s=t._rootScopes,r=Vm(t._fallback,e,i),o=[...n,...s],a=new Set;a.add(i);let l=Ld(a,o,e,r||e,i);return l===null||typeof r<"u"&&r!==e&&(l=Ld(a,o,r,l,i),l===null)?!1:Uc(Array.from(a),[""],s,r,()=>wI(t,e,i))}function Ld(n,t,e,i,s){for(;e;)e=vI(n,t,e,i,s);return e}function wI(n,t,e){const i=n._getTarget();t in i||(i[t]={});const s=i[t];return pt(s)&&Z(e)?e:s||{}}function EI(n,t,e,i){let s;for(const r of t)if(s=Lm(gI(r,n),e),typeof s<"u")return zc(n,s)?$c(e,i,n,s):s}function Lm(n,t){for(const e of t){if(!e)continue;const i=e[n];if(typeof i<"u")return i}}function Nd(n){let t=n._keys;return t||(t=n._keys=TI(n._scopes)),t}function TI(n){const t=new Set;for(const e of n)for(const i of Object.keys(e).filter(s=>!s.startsWith("_")))t.add(i);return Array.from(t)}function Nm(n,t,e,i){const{iScale:s}=n,{key:r="r"}=this._parsing,o=new Array(i);let a,l,u,h;for(a=0,l=i;a<l;++a)u=a+e,h=t[u],o[a]={r:s.parse(En(h,r),u)};return o}const xI=Number.EPSILON||1e-14,Di=(n,t)=>t<n.length&&!n[t].skip&&n[t],Fm=n=>n==="x"?"y":"x";function II(n,t,e,i){const s=n.skip?t:n,r=t,o=e.skip?t:e,a=Cl(r,s),l=Cl(o,r);let u=a/(a+l),h=l/(a+l);u=isNaN(u)?0:u,h=isNaN(h)?0:h;const d=i*u,p=i*h;return{previous:{x:r.x-d*(o.x-s.x),y:r.y-d*(o.y-s.y)},next:{x:r.x+p*(o.x-s.x),y:r.y+p*(o.y-s.y)}}}function AI(n,t,e){const i=n.length;let s,r,o,a,l,u=Di(n,0);for(let h=0;h<i-1;++h)if(l=u,u=Di(n,h+1),!(!l||!u)){if(xs(t[h],0,xI)){e[h]=e[h+1]=0;continue}s=e[h]/t[h],r=e[h+1]/t[h],a=Math.pow(s,2)+Math.pow(r,2),!(a<=9)&&(o=3/Math.sqrt(a),e[h]=s*o*t[h],e[h+1]=r*o*t[h])}}function SI(n,t,e="x"){const i=Fm(e),s=n.length;let r,o,a,l=Di(n,0);for(let u=0;u<s;++u){if(o=a,a=l,l=Di(n,u+1),!a)continue;const h=a[e],d=a[i];o&&(r=(h-o[e])/3,a[`cp1${e}`]=h-r,a[`cp1${i}`]=d-r*t[u]),l&&(r=(l[e]-h)/3,a[`cp2${e}`]=h+r,a[`cp2${i}`]=d+r*t[u])}}function CI(n,t="x"){const e=Fm(t),i=n.length,s=Array(i).fill(0),r=Array(i);let o,a,l,u=Di(n,0);for(o=0;o<i;++o)if(a=l,l=u,u=Di(n,o+1),!!l){if(u){const h=u[t]-l[t];s[o]=h!==0?(u[e]-l[e])/h:0}r[o]=a?u?Te(s[o-1])!==Te(s[o])?0:(s[o-1]+s[o])/2:s[o-1]:s[o]}AI(n,s,r),SI(n,r,t)}function kr(n,t,e){return Math.max(Math.min(n,e),t)}function PI(n,t){let e,i,s,r,o,a=Fe(n[0],t);for(e=0,i=n.length;e<i;++e)o=r,r=a,a=e<i-1&&Fe(n[e+1],t),r&&(s=n[e],o&&(s.cp1x=kr(s.cp1x,t.left,t.right),s.cp1y=kr(s.cp1y,t.top,t.bottom)),a&&(s.cp2x=kr(s.cp2x,t.left,t.right),s.cp2y=kr(s.cp2y,t.top,t.bottom)))}function RI(n,t,e,i,s){let r,o,a,l;if(t.spanGaps&&(n=n.filter(u=>!u.skip)),t.cubicInterpolationMode==="monotone")CI(n,s);else{let u=i?n[n.length-1]:n[0];for(r=0,o=n.length;r<o;++r)a=n[r],l=II(u,a,n[Math.min(r+1,o-(i?0:1))%o],t.tension),a.cp1x=l.previous.x,a.cp1y=l.previous.y,a.cp2x=l.next.x,a.cp2y=l.next.y,u=a}t.capBezierPoints&&PI(n,e)}function jc(){return typeof window<"u"&&typeof document<"u"}function Hc(n){let t=n.parentNode;return t&&t.toString()==="[object ShadowRoot]"&&(t=t.host),t}function xo(n,t,e){let i;return typeof n=="string"?(i=parseInt(n,10),n.indexOf("%")!==-1&&(i=i/100*t.parentNode[e])):i=n,i}const Ko=n=>n.ownerDocument.defaultView.getComputedStyle(n,null);function kI(n,t){return Ko(n).getPropertyValue(t)}const DI=["top","right","bottom","left"];function Wn(n,t,e){const i={};e=e?"-"+e:"";for(let s=0;s<4;s++){const r=DI[s];i[r]=parseFloat(n[t+"-"+r+e])||0}return i.width=i.left+i.right,i.height=i.top+i.bottom,i}const MI=(n,t,e)=>(n>0||t>0)&&(!e||!e.shadowRoot);function OI(n,t){const e=n.touches,i=e&&e.length?e[0]:n,{offsetX:s,offsetY:r}=i;let o=!1,a,l;if(MI(s,r,n.target))a=s,l=r;else{const u=t.getBoundingClientRect();a=i.clientX-u.left,l=i.clientY-u.top,o=!0}return{x:a,y:l,box:o}}function Nn(n,t){if("native"in n)return n;const{canvas:e,currentDevicePixelRatio:i}=t,s=Ko(e),r=s.boxSizing==="border-box",o=Wn(s,"padding"),a=Wn(s,"border","width"),{x:l,y:u,box:h}=OI(n,e),d=o.left+(h&&a.left),p=o.top+(h&&a.top);let{width:m,height:b}=t;return r&&(m-=o.width+a.width,b-=o.height+a.height),{x:Math.round((l-d)/m*e.width/i),y:Math.round((u-p)/b*e.height/i)}}function VI(n,t,e){let i,s;if(t===void 0||e===void 0){const r=n&&Hc(n);if(!r)t=n.clientWidth,e=n.clientHeight;else{const o=r.getBoundingClientRect(),a=Ko(r),l=Wn(a,"border","width"),u=Wn(a,"padding");t=o.width-u.width-l.width,e=o.height-u.height-l.height,i=xo(a.maxWidth,r,"clientWidth"),s=xo(a.maxHeight,r,"clientHeight")}}return{width:t,height:e,maxWidth:i||Eo,maxHeight:s||Eo}}const ln=n=>Math.round(n*10)/10;function LI(n,t,e,i){const s=Ko(n),r=Wn(s,"margin"),o=xo(s.maxWidth,n,"clientWidth")||Eo,a=xo(s.maxHeight,n,"clientHeight")||Eo,l=VI(n,t,e);let{width:u,height:h}=l;if(s.boxSizing==="content-box"){const p=Wn(s,"border","width"),m=Wn(s,"padding");u-=m.width+p.width,h-=m.height+p.height}return u=Math.max(0,u-r.width),h=Math.max(0,i?u/i:h-r.height),u=ln(Math.min(u,o,l.maxWidth)),h=ln(Math.min(h,a,l.maxHeight)),u&&!h&&(h=ln(u/2)),(t!==void 0||e!==void 0)&&i&&l.height&&h>l.height&&(h=l.height,u=ln(Math.floor(h*i))),{width:u,height:h}}function Fd(n,t,e){const i=t||1,s=ln(n.height*i),r=ln(n.width*i);n.height=ln(n.height),n.width=ln(n.width);const o=n.canvas;return o.style&&(e||!o.style.height&&!o.style.width)&&(o.style.height=`${n.height}px`,o.style.width=`${n.width}px`),n.currentDevicePixelRatio!==i||o.height!==s||o.width!==r?(n.currentDevicePixelRatio=i,o.height=s,o.width=r,n.ctx.setTransform(i,0,0,i,0,0),!0):!1}const NI=(function(){let n=!1;try{const t={get passive(){return n=!0,!1}};jc()&&(window.addEventListener("test",null,t),window.removeEventListener("test",null,t))}catch{}return n})();function Bd(n,t){const e=kI(n,t),i=e&&e.match(/^(\d+)(\.\d+)?px$/);return i?+i[1]:void 0}function Fn(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:n.y+e*(t.y-n.y)}}function FI(n,t,e,i){return{x:n.x+e*(t.x-n.x),y:i==="middle"?e<.5?n.y:t.y:i==="after"?e<1?n.y:t.y:e>0?t.y:n.y}}function BI(n,t,e,i){const s={x:n.cp2x,y:n.cp2y},r={x:t.cp1x,y:t.cp1y},o=Fn(n,s,e),a=Fn(s,r,e),l=Fn(r,t,e),u=Fn(o,a,e),h=Fn(a,l,e);return Fn(u,h,e)}const UI=function(n,t){return{x(e){return n+n+t-e},setWidth(e){t=e},textAlign(e){return e==="center"?e:e==="right"?"left":"right"},xPlus(e,i){return e-i},leftForLtr(e,i){return e-i}}},zI=function(){return{x(n){return n},setWidth(n){},textAlign(n){return n},xPlus(n,t){return n+t},leftForLtr(n,t){return n}}};function vi(n,t,e){return n?UI(t,e):zI()}function Bm(n,t){let e,i;(t==="ltr"||t==="rtl")&&(e=n.canvas.style,i=[e.getPropertyValue("direction"),e.getPropertyPriority("direction")],e.setProperty("direction",t,"important"),n.prevTextDirection=i)}function Um(n,t){t!==void 0&&(delete n.prevTextDirection,n.canvas.style.setProperty("direction",t[0],t[1]))}function zm(n){return n==="angle"?{between:$s,compare:$x,normalize:zt}:{between:Le,compare:(t,e)=>t-e,normalize:t=>t}}function Ud({start:n,end:t,count:e,loop:i,style:s}){return{start:n%e,end:t%e,loop:i&&(t-n+1)%e===0,style:s}}function $I(n,t,e){const{property:i,start:s,end:r}=e,{between:o,normalize:a}=zm(i),l=t.length;let{start:u,end:h,loop:d}=n,p,m;if(d){for(u+=l,h+=l,p=0,m=l;p<m&&o(a(t[u%l][i]),s,r);++p)u--,h--;u%=l,h%=l}return h<u&&(h+=l),{start:u,end:h,loop:d,style:n.style}}function $m(n,t,e){if(!e)return[n];const{property:i,start:s,end:r}=e,o=t.length,{compare:a,between:l,normalize:u}=zm(i),{start:h,end:d,loop:p,style:m}=$I(n,t,e),b=[];let v=!1,E=null,C,P,k;const M=()=>l(s,k,C)&&a(s,k)!==0,O=()=>a(r,C)===0||l(r,k,C),N=()=>v||M(),w=()=>!v||O();for(let y=h,T=h;y<=d;++y)P=t[y%o],!P.skip&&(C=u(P[i]),C!==k&&(v=l(C,s,r),E===null&&N()&&(E=a(C,s)===0?y:T),E!==null&&w()&&(b.push(Ud({start:E,end:y,loop:p,count:o,style:m})),E=null),T=y,k=C));return E!==null&&b.push(Ud({start:E,end:d,loop:p,count:o,style:m})),b}function jm(n,t){const e=[],i=n.segments;for(let s=0;s<i.length;s++){const r=$m(i[s],n.points,t);r.length&&e.push(...r)}return e}function jI(n,t,e,i){let s=0,r=t-1;if(e&&!i)for(;s<t&&!n[s].skip;)s++;for(;s<t&&n[s].skip;)s++;for(s%=t,e&&(r+=s);r>s&&n[r%t].skip;)r--;return r%=t,{start:s,end:r}}function HI(n,t,e,i){const s=n.length,r=[];let o=t,a=n[t],l;for(l=t+1;l<=e;++l){const u=n[l%s];u.skip||u.stop?a.skip||(i=!1,r.push({start:t%s,end:(l-1)%s,loop:i}),t=o=u.stop?l:null):(o=l,a.skip&&(t=l)),a=u}return o!==null&&r.push({start:t%s,end:o%s,loop:i}),r}function WI(n,t){const e=n.points,i=n.options.spanGaps,s=e.length;if(!s)return[];const r=!!n._loop,{start:o,end:a}=jI(e,s,r,i);if(i===!0)return zd(n,[{start:o,end:a,loop:r}],e,t);const l=a<o?a+s:a,u=!!n._fullLoop&&o===0&&a===s-1;return zd(n,HI(e,o,l,u),e,t)}function zd(n,t,e,i){return!i||!i.setContext||!e?t:qI(n,t,e,i)}function qI(n,t,e,i){const s=n._chart.getContext(),r=$d(n.options),{_datasetIndex:o,options:{spanGaps:a}}=n,l=e.length,u=[];let h=r,d=t[0].start,p=d;function m(b,v,E,C){const P=a?-1:1;if(b!==v){for(b+=l;e[b%l].skip;)b-=P;for(;e[v%l].skip;)v+=P;b%l!==v%l&&(u.push({start:b%l,end:v%l,loop:E,style:C}),h=C,d=v%l)}}for(const b of t){d=a?d:b.start;let v=e[d%l],E;for(p=d+1;p<=b.end;p++){const C=e[p%l];E=$d(i.setContext(In(s,{type:"segment",p0:v,p1:C,p0DataIndex:(p-1)%l,p1DataIndex:p%l,datasetIndex:o}))),GI(E,h)&&m(d,p-1,b.loop,h),v=C,h=E}d<p-1&&m(d,p-1,b.loop,h)}return u}function $d(n){return{backgroundColor:n.backgroundColor,borderCapStyle:n.borderCapStyle,borderDash:n.borderDash,borderDashOffset:n.borderDashOffset,borderJoinStyle:n.borderJoinStyle,borderWidth:n.borderWidth,borderColor:n.borderColor}}function GI(n,t){if(!t)return!1;const e=[],i=function(s,r){return Fc(r)?(e.includes(r)||e.push(r),e.indexOf(r)):r};return JSON.stringify(n,i)!==JSON.stringify(t,i)}function Dr(n,t,e){return n.options.clip?n[e]:t[e]}function KI(n,t){const{xScale:e,yScale:i}=n;return e&&i?{left:Dr(e,t,"left"),right:Dr(e,t,"right"),top:Dr(i,t,"top"),bottom:Dr(i,t,"bottom")}:t}function Hm(n,t){const e=t._clip;if(e.disabled)return!1;const i=KI(t,n.chartArea);return{left:e.left===!1?0:i.left-(e.left===!0?0:e.left),right:e.right===!1?n.width:i.right+(e.right===!0?0:e.right),top:e.top===!1?0:i.top-(e.top===!0?0:e.top),bottom:e.bottom===!1?n.height:i.bottom+(e.bottom===!0?0:e.bottom)}}class YI{constructor(){this._request=null,this._charts=new Map,this._running=!1,this._lastDate=void 0}_notify(t,e,i,s){const r=e.listeners[s],o=e.duration;r.forEach(a=>a({chart:t,initial:e.initial,numSteps:o,currentStep:Math.min(i-e.start,o)}))}_refresh(){this._request||(this._running=!0,this._request=Am.call(window,()=>{this._update(),this._request=null,this._running&&this._refresh()}))}_update(t=Date.now()){let e=0;this._charts.forEach((i,s)=>{if(!i.running||!i.items.length)return;const r=i.items;let o=r.length-1,a=!1,l;for(;o>=0;--o)l=r[o],l._active?(l._total>i.duration&&(i.duration=l._total),l.tick(t),a=!0):(r[o]=r[r.length-1],r.pop());a&&(s.draw(),this._notify(s,i,t,"progress")),r.length||(i.running=!1,this._notify(s,i,t,"complete"),i.initial=!1),e+=r.length}),this._lastDate=t,e===0&&(this._running=!1)}_getAnims(t){const e=this._charts;let i=e.get(t);return i||(i={running:!1,initial:!0,items:[],listeners:{complete:[],progress:[]}},e.set(t,i)),i}listen(t,e,i){this._getAnims(t).listeners[e].push(i)}add(t,e){!e||!e.length||this._getAnims(t).items.push(...e)}has(t){return this._getAnims(t).items.length>0}start(t){const e=this._charts.get(t);e&&(e.running=!0,e.start=Date.now(),e.duration=e.items.reduce((i,s)=>Math.max(i,s._duration),0),this._refresh())}running(t){if(!this._running)return!1;const e=this._charts.get(t);return!(!e||!e.running||!e.items.length)}stop(t){const e=this._charts.get(t);if(!e||!e.items.length)return;const i=e.items;let s=i.length-1;for(;s>=0;--s)i[s].cancel();e.items=[],this._notify(t,e,Date.now(),"complete")}remove(t){return this._charts.delete(t)}}var Pe=new YI;const jd="transparent",XI={boolean(n,t,e){return e>.5?t:n},color(n,t,e){const i=Md(n||jd),s=i.valid&&Md(t||jd);return s&&s.valid?s.mix(i,e).hexString():t},number(n,t,e){return n+(t-n)*e}};class QI{constructor(t,e,i,s){const r=e[i];s=ps([t.to,s,r,t.from]);const o=ps([t.from,r,s]);this._active=!0,this._fn=t.fn||XI[t.type||typeof o],this._easing=Is[t.easing]||Is.linear,this._start=Math.floor(Date.now()+(t.delay||0)),this._duration=this._total=Math.floor(t.duration),this._loop=!!t.loop,this._target=e,this._prop=i,this._from=o,this._to=s,this._promises=void 0}active(){return this._active}update(t,e,i){if(this._active){this._notify(!1);const s=this._target[this._prop],r=i-this._start,o=this._duration-r;this._start=i,this._duration=Math.floor(Math.max(o,t.duration)),this._total+=r,this._loop=!!t.loop,this._to=ps([t.to,e,s,t.from]),this._from=ps([t.from,s,e])}}cancel(){this._active&&(this.tick(Date.now()),this._active=!1,this._notify(!1))}tick(t){const e=t-this._start,i=this._duration,s=this._prop,r=this._from,o=this._loop,a=this._to;let l;if(this._active=r!==a&&(o||e<i),!this._active){this._target[s]=a,this._notify(!0);return}if(e<0){this._target[s]=r;return}l=e/i%2,l=o&&l>1?2-l:l,l=this._easing(Math.min(1,Math.max(0,l))),this._target[s]=this._fn(r,a,l)}wait(){const t=this._promises||(this._promises=[]);return new Promise((e,i)=>{t.push({res:e,rej:i})})}_notify(t){const e=t?"res":"rej",i=this._promises||[];for(let s=0;s<i.length;s++)i[s][e]()}}class Wm{constructor(t,e){this._chart=t,this._properties=new Map,this.configure(e)}configure(t){if(!Z(t))return;const e=Object.keys(gt.animation),i=this._properties;Object.getOwnPropertyNames(t).forEach(s=>{const r=t[s];if(!Z(r))return;const o={};for(const a of e)o[a]=r[a];(pt(r.properties)&&r.properties||[s]).forEach(a=>{(a===s||!i.has(a))&&i.set(a,o)})})}_animateOptions(t,e){const i=e.options,s=ZI(t,i);if(!s)return[];const r=this._createAnimations(s,i);return i.$shared&&JI(t.options.$animations,i).then(()=>{t.options=i},()=>{}),r}_createAnimations(t,e){const i=this._properties,s=[],r=t.$animations||(t.$animations={}),o=Object.keys(e),a=Date.now();let l;for(l=o.length-1;l>=0;--l){const u=o[l];if(u.charAt(0)==="$")continue;if(u==="options"){s.push(...this._animateOptions(t,e));continue}const h=e[u];let d=r[u];const p=i.get(u);if(d)if(p&&d.active()){d.update(p,h,a);continue}else d.cancel();if(!p||!p.duration){t[u]=h;continue}r[u]=d=new QI(p,t,u,h),s.push(d)}return s}update(t,e){if(this._properties.size===0){Object.assign(t,e);return}const i=this._createAnimations(t,e);if(i.length)return Pe.add(this._chart,i),!0}}function JI(n,t){const e=[],i=Object.keys(t);for(let s=0;s<i.length;s++){const r=n[i[s]];r&&r.active()&&e.push(r.wait())}return Promise.all(e)}function ZI(n,t){if(!t)return;let e=n.options;if(!e){n.options=t;return}return e.$shared&&(n.options=e=Object.assign({},e,{$shared:!1,$animations:{}})),e}function Hd(n,t){const e=n&&n.options||{},i=e.reverse,s=e.min===void 0?t:0,r=e.max===void 0?t:0;return{start:i?r:s,end:i?s:r}}function tA(n,t,e){if(e===!1)return!1;const i=Hd(n,e),s=Hd(t,e);return{top:s.end,right:i.end,bottom:s.start,left:i.start}}function eA(n){let t,e,i,s;return Z(n)?(t=n.top,e=n.right,i=n.bottom,s=n.left):t=e=i=s=n,{top:t,right:e,bottom:i,left:s,disabled:n===!1}}function qm(n,t){const e=[],i=n._getSortedDatasetMetas(t);let s,r;for(s=0,r=i.length;s<r;++s)e.push(i[s].index);return e}function Wd(n,t,e,i={}){const s=n.keys,r=i.mode==="single";let o,a,l,u;if(t===null)return;let h=!1;for(o=0,a=s.length;o<a;++o){if(l=+s[o],l===e){if(h=!0,i.all)continue;break}u=n.values[l],bt(u)&&(r||t===0||Te(t)===Te(u))&&(t+=u)}return!h&&!i.all?0:t}function nA(n,t){const{iScale:e,vScale:i}=t,s=e.axis==="x"?"x":"y",r=i.axis==="x"?"x":"y",o=Object.keys(n),a=new Array(o.length);let l,u,h;for(l=0,u=o.length;l<u;++l)h=o[l],a[l]={[s]:h,[r]:n[h]};return a}function La(n,t){const e=n&&n.options.stacked;return e||e===void 0&&t.stack!==void 0}function iA(n,t,e){return`${n.id}.${t.id}.${e.stack||e.type}`}function sA(n){const{min:t,max:e,minDefined:i,maxDefined:s}=n.getUserBounds();return{min:i?t:Number.NEGATIVE_INFINITY,max:s?e:Number.POSITIVE_INFINITY}}function rA(n,t,e){const i=n[t]||(n[t]={});return i[e]||(i[e]={})}function qd(n,t,e,i){for(const s of t.getMatchingVisibleMetas(i).reverse()){const r=n[s.index];if(e&&r>0||!e&&r<0)return s.index}return null}function Gd(n,t){const{chart:e,_cachedMeta:i}=n,s=e._stacks||(e._stacks={}),{iScale:r,vScale:o,index:a}=i,l=r.axis,u=o.axis,h=iA(r,o,i),d=t.length;let p;for(let m=0;m<d;++m){const b=t[m],{[l]:v,[u]:E}=b,C=b._stacks||(b._stacks={});p=C[u]=rA(s,h,v),p[a]=E,p._top=qd(p,o,!0,i.type),p._bottom=qd(p,o,!1,i.type);const P=p._visualValues||(p._visualValues={});P[a]=E}}function Na(n,t){const e=n.scales;return Object.keys(e).filter(i=>e[i].axis===t).shift()}function oA(n,t){return In(n,{active:!1,dataset:void 0,datasetIndex:t,index:t,mode:"default",type:"dataset"})}function aA(n,t,e){return In(n,{active:!1,dataIndex:t,parsed:void 0,raw:void 0,element:e,index:t,mode:"default",type:"data"})}function ss(n,t){const e=n.controller.index,i=n.vScale&&n.vScale.axis;if(i){t=t||n._parsed;for(const s of t){const r=s._stacks;if(!r||r[i]===void 0||r[i][e]===void 0)return;delete r[i][e],r[i]._visualValues!==void 0&&r[i]._visualValues[e]!==void 0&&delete r[i]._visualValues[e]}}}const Fa=n=>n==="reset"||n==="none",Kd=(n,t)=>t?n:Object.assign({},n),lA=(n,t,e)=>n&&!t.hidden&&t._stacked&&{keys:qm(e,!0),values:null};class An{static defaults={};static datasetElementType=null;static dataElementType=null;constructor(t,e){this.chart=t,this._ctx=t.ctx,this.index=e,this._cachedDataOpts={},this._cachedMeta=this.getMeta(),this._type=this._cachedMeta.type,this.options=void 0,this._parsing=!1,this._data=void 0,this._objectData=void 0,this._sharedOptions=void 0,this._drawStart=void 0,this._drawCount=void 0,this.enableOptionSharing=!1,this.supportsDecimation=!1,this.$context=void 0,this._syncList=[],this.datasetElementType=new.target.datasetElementType,this.dataElementType=new.target.dataElementType,this.initialize()}initialize(){const t=this._cachedMeta;this.configure(),this.linkScales(),t._stacked=La(t.vScale,t),this.addElements(),this.options.fill&&!this.chart.isPluginEnabled("filler")&&console.warn("Tried to use the 'fill' option without the 'Filler' plugin enabled. Please import and register the 'Filler' plugin and make sure it is not disabled in the options")}updateIndex(t){this.index!==t&&ss(this._cachedMeta),this.index=t}linkScales(){const t=this.chart,e=this._cachedMeta,i=this.getDataset(),s=(d,p,m,b)=>d==="x"?p:d==="r"?b:m,r=e.xAxisID=W(i.xAxisID,Na(t,"x")),o=e.yAxisID=W(i.yAxisID,Na(t,"y")),a=e.rAxisID=W(i.rAxisID,Na(t,"r")),l=e.indexAxis,u=e.iAxisID=s(l,r,o,a),h=e.vAxisID=s(l,o,r,a);e.xScale=this.getScaleForId(r),e.yScale=this.getScaleForId(o),e.rScale=this.getScaleForId(a),e.iScale=this.getScaleForId(u),e.vScale=this.getScaleForId(h)}getDataset(){return this.chart.data.datasets[this.index]}getMeta(){return this.chart.getDatasetMeta(this.index)}getScaleForId(t){return this.chart.scales[t]}_getOtherScale(t){const e=this._cachedMeta;return t===e.iScale?e.vScale:e.iScale}reset(){this._update("reset")}_destroy(){const t=this._cachedMeta;this._data&&Rd(this._data,this),t._stacked&&ss(t)}_dataCheck(){const t=this.getDataset(),e=t.data||(t.data=[]),i=this._data;if(Z(e)){const s=this._cachedMeta;this._data=nA(e,s)}else if(i!==e){if(i){Rd(i,this);const s=this._cachedMeta;ss(s),s._parsed=[]}e&&Object.isExtensible(e)&&qx(e,this),this._syncList=[],this._data=e}}addElements(){const t=this._cachedMeta;this._dataCheck(),this.datasetElementType&&(t.dataset=new this.datasetElementType)}buildOrUpdateElements(t){const e=this._cachedMeta,i=this.getDataset();let s=!1;this._dataCheck();const r=e._stacked;e._stacked=La(e.vScale,e),e.stack!==i.stack&&(s=!0,ss(e),e.stack=i.stack),this._resyncElements(t),(s||r!==e._stacked)&&(Gd(this,e._parsed),e._stacked=La(e.vScale,e))}configure(){const t=this.chart.config,e=t.datasetScopeKeys(this._type),i=t.getOptionScopes(this.getDataset(),e,!0);this.options=t.createResolver(i,this.getContext()),this._parsing=this.options.parsing,this._cachedDataOpts={}}parse(t,e){const{_cachedMeta:i,_data:s}=this,{iScale:r,_stacked:o}=i,a=r.axis;let l=t===0&&e===s.length?!0:i._sorted,u=t>0&&i._parsed[t-1],h,d,p;if(this._parsing===!1)i._parsed=s,i._sorted=!0,p=s;else{pt(s[t])?p=this.parseArrayData(i,s,t,e):Z(s[t])?p=this.parseObjectData(i,s,t,e):p=this.parsePrimitiveData(i,s,t,e);const m=()=>d[a]===null||u&&d[a]<u[a];for(h=0;h<e;++h)i._parsed[h+t]=d=p[h],l&&(m()&&(l=!1),u=d);i._sorted=l}o&&Gd(this,p)}parsePrimitiveData(t,e,i,s){const{iScale:r,vScale:o}=t,a=r.axis,l=o.axis,u=r.getLabels(),h=r===o,d=new Array(s);let p,m,b;for(p=0,m=s;p<m;++p)b=p+i,d[p]={[a]:h||r.parse(u[b],b),[l]:o.parse(e[b],b)};return d}parseArrayData(t,e,i,s){const{xScale:r,yScale:o}=t,a=new Array(s);let l,u,h,d;for(l=0,u=s;l<u;++l)h=l+i,d=e[h],a[l]={x:r.parse(d[0],h),y:o.parse(d[1],h)};return a}parseObjectData(t,e,i,s){const{xScale:r,yScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=new Array(s);let h,d,p,m;for(h=0,d=s;h<d;++h)p=h+i,m=e[p],u[h]={x:r.parse(En(m,a),p),y:o.parse(En(m,l),p)};return u}getParsed(t){return this._cachedMeta._parsed[t]}getDataElement(t){return this._cachedMeta.data[t]}applyStack(t,e,i){const s=this.chart,r=this._cachedMeta,o=e[t.axis],a={keys:qm(s,!0),values:e._stacks[t.axis]._visualValues};return Wd(a,o,r.index,{mode:i})}updateRangeFromParsed(t,e,i,s){const r=i[e.axis];let o=r===null?NaN:r;const a=s&&i._stacks[e.axis];s&&a&&(s.values=a,o=Wd(s,r,this._cachedMeta.index)),t.min=Math.min(t.min,o),t.max=Math.max(t.max,o)}getMinMax(t,e){const i=this._cachedMeta,s=i._parsed,r=i._sorted&&t===i.iScale,o=s.length,a=this._getOtherScale(t),l=lA(e,i,this.chart),u={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},{min:h,max:d}=sA(a);let p,m;function b(){m=s[p];const v=m[a.axis];return!bt(m[t.axis])||h>v||d<v}for(p=0;p<o&&!(!b()&&(this.updateRangeFromParsed(u,t,m,l),r));++p);if(r){for(p=o-1;p>=0;--p)if(!b()){this.updateRangeFromParsed(u,t,m,l);break}}return u}getAllParsedValues(t){const e=this._cachedMeta._parsed,i=[];let s,r,o;for(s=0,r=e.length;s<r;++s)o=e[s][t.axis],bt(o)&&i.push(o);return i}getMaxOverflow(){return!1}getLabelAndValue(t){const e=this._cachedMeta,i=e.iScale,s=e.vScale,r=this.getParsed(t);return{label:i?""+i.getLabelForValue(r[i.axis]):"",value:s?""+s.getLabelForValue(r[s.axis]):""}}_update(t){const e=this._cachedMeta;this.update(t||"default"),e._clip=eA(W(this.options.clip,tA(e.xScale,e.yScale,this.getMaxOverflow())))}update(t){}draw(){const t=this._ctx,e=this.chart,i=this._cachedMeta,s=i.data||[],r=e.chartArea,o=[],a=this._drawStart||0,l=this._drawCount||s.length-a,u=this.options.drawActiveElementsOnTop;let h;for(i.dataset&&i.dataset.draw(t,r,a,l),h=a;h<a+l;++h){const d=s[h];d.hidden||(d.active&&u?o.push(d):d.draw(t,r))}for(h=0;h<o.length;++h)o[h].draw(t,r)}getStyle(t,e){const i=e?"active":"default";return t===void 0&&this._cachedMeta.dataset?this.resolveDatasetElementOptions(i):this.resolveDataElementOptions(t||0,i)}getContext(t,e,i){const s=this.getDataset();let r;if(t>=0&&t<this._cachedMeta.data.length){const o=this._cachedMeta.data[t];r=o.$context||(o.$context=aA(this.getContext(),t,o)),r.parsed=this.getParsed(t),r.raw=s.data[t],r.index=r.dataIndex=t}else r=this.$context||(this.$context=oA(this.chart.getContext(),this.index)),r.dataset=s,r.index=r.datasetIndex=this.index;return r.active=!!e,r.mode=i,r}resolveDatasetElementOptions(t){return this._resolveElementOptions(this.datasetElementType.id,t)}resolveDataElementOptions(t,e){return this._resolveElementOptions(this.dataElementType.id,e,t)}_resolveElementOptions(t,e="default",i){const s=e==="active",r=this._cachedDataOpts,o=t+"-"+e,a=r[o],l=this.enableOptionSharing&&zs(i);if(a)return Kd(a,l);const u=this.chart.config,h=u.datasetElementScopeKeys(this._type,t),d=s?[`${t}Hover`,"hover",t,""]:[t,""],p=u.getOptionScopes(this.getDataset(),h),m=Object.keys(gt.elements[t]),b=()=>this.getContext(i,s,e),v=u.resolveNamedOptions(p,m,b,d);return v.$shared&&(v.$shared=l,r[o]=Object.freeze(Kd(v,l))),v}_resolveAnimations(t,e,i){const s=this.chart,r=this._cachedDataOpts,o=`animation-${e}`,a=r[o];if(a)return a;let l;if(s.options.animation!==!1){const h=this.chart.config,d=h.datasetAnimationScopeKeys(this._type,e),p=h.getOptionScopes(this.getDataset(),d);l=h.createResolver(p,this.getContext(t,i,e))}const u=new Wm(s,l&&l.animations);return l&&l._cacheable&&(r[o]=Object.freeze(u)),u}getSharedOptions(t){if(t.$shared)return this._sharedOptions||(this._sharedOptions=Object.assign({},t))}includeOptions(t,e){return!e||Fa(t)||this.chart._animationsDisabled}_getSharedOptions(t,e){const i=this.resolveDataElementOptions(t,e),s=this._sharedOptions,r=this.getSharedOptions(i),o=this.includeOptions(e,r)||r!==s;return this.updateSharedOptions(r,e,i),{sharedOptions:r,includeOptions:o}}updateElement(t,e,i,s){Fa(s)?Object.assign(t,i):this._resolveAnimations(e,s).update(t,i)}updateSharedOptions(t,e,i){t&&!Fa(e)&&this._resolveAnimations(void 0,e).update(t,i)}_setStyle(t,e,i,s){t.active=s;const r=this.getStyle(e,s);this._resolveAnimations(e,i,s).update(t,{options:!s&&this.getSharedOptions(r)||r})}removeHoverStyle(t,e,i){this._setStyle(t,i,"active",!1)}setHoverStyle(t,e,i){this._setStyle(t,i,"active",!0)}_removeDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!1)}_setDatasetHoverStyle(){const t=this._cachedMeta.dataset;t&&this._setStyle(t,void 0,"active",!0)}_resyncElements(t){const e=this._data,i=this._cachedMeta.data;for(const[a,l,u]of this._syncList)this[a](l,u);this._syncList=[];const s=i.length,r=e.length,o=Math.min(r,s);o&&this.parse(0,o),r>s?this._insertElements(s,r-s,t):r<s&&this._removeElements(r,s-r)}_insertElements(t,e,i=!0){const s=this._cachedMeta,r=s.data,o=t+e;let a;const l=u=>{for(u.length+=e,a=u.length-1;a>=o;a--)u[a]=u[a-e]};for(l(r),a=t;a<o;++a)r[a]=new this.dataElementType;this._parsing&&l(s._parsed),this.parse(t,e),i&&this.updateElements(r,t,e,"reset")}updateElements(t,e,i,s){}_removeElements(t,e){const i=this._cachedMeta;if(this._parsing){const s=i._parsed.splice(t,e);i._stacked&&ss(i,s)}i.data.splice(t,e)}_sync(t){if(this._parsing)this._syncList.push(t);else{const[e,i,s]=t;this[e](i,s)}this.chart._dataChanges.push([this.index,...t])}_onDataPush(){const t=arguments.length;this._sync(["_insertElements",this.getDataset().data.length-t,t])}_onDataPop(){this._sync(["_removeElements",this._cachedMeta.data.length-1,1])}_onDataShift(){this._sync(["_removeElements",0,1])}_onDataSplice(t,e){e&&this._sync(["_removeElements",t,e]);const i=arguments.length-2;i&&this._sync(["_insertElements",t,i])}_onDataUnshift(){this._sync(["_insertElements",0,arguments.length])}}function cA(n,t){if(!n._cache.$bar){const e=n.getMatchingVisibleMetas(t);let i=[];for(let s=0,r=e.length;s<r;s++)i=i.concat(e[s].controller.getAllParsedValues(n));n._cache.$bar=Im(i.sort((s,r)=>s-r))}return n._cache.$bar}function uA(n){const t=n.iScale,e=cA(t,n.type);let i=t._length,s,r,o,a;const l=()=>{o===32767||o===-32768||(zs(a)&&(i=Math.min(i,Math.abs(o-a)||i)),a=o)};for(s=0,r=e.length;s<r;++s)o=t.getPixelForValue(e[s]),l();for(a=void 0,s=0,r=t.ticks.length;s<r;++s)o=t.getPixelForTick(s),l();return i}function hA(n,t,e,i){const s=e.barThickness;let r,o;return Y(s)?(r=t.min*e.categoryPercentage,o=e.barPercentage):(r=s*i,o=1),{chunk:r/i,ratio:o,start:t.pixels[n]-r/2}}function dA(n,t,e,i){const s=t.pixels,r=s[n];let o=n>0?s[n-1]:null,a=n<s.length-1?s[n+1]:null;const l=e.categoryPercentage;o===null&&(o=r-(a===null?t.end-t.start:a-r)),a===null&&(a=r+r-o);const u=r-(r-Math.min(o,a))/2*l;return{chunk:Math.abs(a-o)/2*l/i,ratio:e.barPercentage,start:u}}function fA(n,t,e,i){const s=e.parse(n[0],i),r=e.parse(n[1],i),o=Math.min(s,r),a=Math.max(s,r);let l=o,u=a;Math.abs(o)>Math.abs(a)&&(l=a,u=o),t[e.axis]=u,t._custom={barStart:l,barEnd:u,start:s,end:r,min:o,max:a}}function Gm(n,t,e,i){return pt(n)?fA(n,t,e,i):t[e.axis]=e.parse(n,i),t}function Yd(n,t,e,i){const s=n.iScale,r=n.vScale,o=s.getLabels(),a=s===r,l=[];let u,h,d,p;for(u=e,h=e+i;u<h;++u)p=t[u],d={},d[s.axis]=a||s.parse(o[u],u),l.push(Gm(p,d,r,u));return l}function Ba(n){return n&&n.barStart!==void 0&&n.barEnd!==void 0}function pA(n,t,e){return n!==0?Te(n):(t.isHorizontal()?1:-1)*(t.min>=e?1:-1)}function gA(n){let t,e,i,s,r;return n.horizontal?(t=n.base>n.x,e="left",i="right"):(t=n.base<n.y,e="bottom",i="top"),t?(s="end",r="start"):(s="start",r="end"),{start:e,end:i,reverse:t,top:s,bottom:r}}function mA(n,t,e,i){let s=t.borderSkipped;const r={};if(!s){n.borderSkipped=r;return}if(s===!0){n.borderSkipped={top:!0,right:!0,bottom:!0,left:!0};return}const{start:o,end:a,reverse:l,top:u,bottom:h}=gA(n);s==="middle"&&e&&(n.enableBorderRadius=!0,(e._top||0)===i?s=u:(e._bottom||0)===i?s=h:(r[Xd(h,o,a,l)]=!0,s=u)),r[Xd(s,o,a,l)]=!0,n.borderSkipped=r}function Xd(n,t,e,i){return i?(n=yA(n,t,e),n=Qd(n,e,t)):n=Qd(n,t,e),n}function yA(n,t,e){return n===t?e:n===e?t:n}function Qd(n,t,e){return n==="start"?t:n==="end"?e:n}function _A(n,{inflateAmount:t},e){n.inflateAmount=t==="auto"?e===1?.33:0:t}class bA extends An{static id="bar";static defaults={datasetElementType:!1,dataElementType:"bar",categoryPercentage:.8,barPercentage:.9,grouped:!0,animations:{numbers:{type:"number",properties:["x","y","base","width","height"]}}};static overrides={scales:{_index_:{type:"category",offset:!0,grid:{offset:!0}},_value_:{type:"linear",beginAtZero:!0}}};parsePrimitiveData(t,e,i,s){return Yd(t,e,i,s)}parseArrayData(t,e,i,s){return Yd(t,e,i,s)}parseObjectData(t,e,i,s){const{iScale:r,vScale:o}=t,{xAxisKey:a="x",yAxisKey:l="y"}=this._parsing,u=r.axis==="x"?a:l,h=o.axis==="x"?a:l,d=[];let p,m,b,v;for(p=i,m=i+s;p<m;++p)v=e[p],b={},b[r.axis]=r.parse(En(v,u),p),d.push(Gm(En(v,h),b,o,p));return d}updateRangeFromParsed(t,e,i,s){super.updateRangeFromParsed(t,e,i,s);const r=i._custom;r&&e===this._cachedMeta.vScale&&(t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max))}getMaxOverflow(){return 0}getLabelAndValue(t){const e=this._cachedMeta,{iScale:i,vScale:s}=e,r=this.getParsed(t),o=r._custom,a=Ba(o)?"["+o.start+", "+o.end+"]":""+s.getLabelForValue(r[s.axis]);return{label:""+i.getLabelForValue(r[i.axis]),value:a}}initialize(){this.enableOptionSharing=!0,super.initialize();const t=this._cachedMeta;t.stack=this.getDataset().stack}update(t){const e=this._cachedMeta;this.updateElements(e.data,0,e.data.length,t)}updateElements(t,e,i,s){const r=s==="reset",{index:o,_cachedMeta:{vScale:a}}=this,l=a.getBasePixel(),u=a.isHorizontal(),h=this._getRuler(),{sharedOptions:d,includeOptions:p}=this._getSharedOptions(e,s);for(let m=e;m<e+i;m++){const b=this.getParsed(m),v=r||Y(b[a.axis])?{base:l,head:l}:this._calculateBarValuePixels(m),E=this._calculateBarIndexPixels(m,h),C=(b._stacks||{})[a.axis],P={horizontal:u,base:v.base,enableBorderRadius:!C||Ba(b._custom)||o===C._top||o===C._bottom,x:u?v.head:E.center,y:u?E.center:v.head,height:u?E.size:Math.abs(v.size),width:u?Math.abs(v.size):E.size};p&&(P.options=d||this.resolveDataElementOptions(m,t[m].active?"active":s));const k=P.options||t[m].options;mA(P,k,C,o),_A(P,k,h.ratio),this.updateElement(t[m],m,P,s)}}_getStacks(t,e){const{iScale:i}=this._cachedMeta,s=i.getMatchingVisibleMetas(this._type).filter(h=>h.controller.options.grouped),r=i.options.stacked,o=[],a=this._cachedMeta.controller.getParsed(e),l=a&&a[i.axis],u=h=>{const d=h._parsed.find(m=>m[i.axis]===l),p=d&&d[h.vScale.axis];if(Y(p)||isNaN(p))return!0};for(const h of s)if(!(e!==void 0&&u(h))&&((r===!1||o.indexOf(h.stack)===-1||r===void 0&&h.stack===void 0)&&o.push(h.stack),h.index===t))break;return o.length||o.push(void 0),o}_getStackCount(t){return this._getStacks(void 0,t).length}_getAxisCount(){return this._getAxis().length}getFirstScaleIdForIndexAxis(){const t=this.chart.scales,e=this.chart.options.indexAxis;return Object.keys(t).filter(i=>t[i].axis===e).shift()}_getAxis(){const t={},e=this.getFirstScaleIdForIndexAxis();for(const i of this.chart.data.datasets)t[W(this.chart.options.indexAxis==="x"?i.xAxisID:i.yAxisID,e)]=!0;return Object.keys(t)}_getStackIndex(t,e,i){const s=this._getStacks(t,i),r=e!==void 0?s.indexOf(e):-1;return r===-1?s.length-1:r}_getRuler(){const t=this.options,e=this._cachedMeta,i=e.iScale,s=[];let r,o;for(r=0,o=e.data.length;r<o;++r)s.push(i.getPixelForValue(this.getParsed(r)[i.axis],r));const a=t.barThickness;return{min:a||uA(e),pixels:s,start:i._startPixel,end:i._endPixel,stackCount:this._getStackCount(),scale:i,grouped:t.grouped,ratio:a?1:t.categoryPercentage*t.barPercentage}}_calculateBarValuePixels(t){const{_cachedMeta:{vScale:e,_stacked:i,index:s},options:{base:r,minBarLength:o}}=this,a=r||0,l=this.getParsed(t),u=l._custom,h=Ba(u);let d=l[e.axis],p=0,m=i?this.applyStack(e,l,i):d,b,v;m!==d&&(p=m-d,m=d),h&&(d=u.barStart,m=u.barEnd-u.barStart,d!==0&&Te(d)!==Te(u.barEnd)&&(p=0),p+=d);const E=!Y(r)&&!h?r:p;let C=e.getPixelForValue(E);if(this.chart.getDataVisibility(t)?b=e.getPixelForValue(p+m):b=C,v=b-C,Math.abs(v)<o){v=pA(v,e,a)*o,d===a&&(C-=v/2);const P=e.getPixelForDecimal(0),k=e.getPixelForDecimal(1),M=Math.min(P,k),O=Math.max(P,k);C=Math.max(Math.min(C,O),M),b=C+v,i&&!h&&(l._stacks[e.axis]._visualValues[s]=e.getValueForPixel(b)-e.getValueForPixel(C))}if(C===e.getPixelForValue(a)){const P=Te(v)*e.getLineWidthForValue(a)/2;C+=P,v-=P}return{size:v,base:C,head:b,center:b+v/2}}_calculateBarIndexPixels(t,e){const i=e.scale,s=this.options,r=s.skipNull,o=W(s.maxBarThickness,1/0);let a,l;const u=this._getAxisCount();if(e.grouped){const h=r?this._getStackCount(t):e.stackCount,d=s.barThickness==="flex"?dA(t,e,s,h*u):hA(t,e,s,h*u),p=this.chart.options.indexAxis==="x"?this.getDataset().xAxisID:this.getDataset().yAxisID,m=this._getAxis().indexOf(W(p,this.getFirstScaleIdForIndexAxis())),b=this._getStackIndex(this.index,this._cachedMeta.stack,r?t:void 0)+m;a=d.start+d.chunk*b+d.chunk/2,l=Math.min(o,d.chunk*d.ratio)}else a=i.getPixelForValue(this.getParsed(t)[i.axis],t),l=Math.min(o,e.min*e.ratio);return{base:a-l/2,head:a+l/2,center:a,size:l}}draw(){const t=this._cachedMeta,e=t.vScale,i=t.data,s=i.length;let r=0;for(;r<s;++r)this.getParsed(r)[e.axis]!==null&&!i[r].hidden&&i[r].draw(this._ctx)}}class vA extends An{static id="bubble";static defaults={datasetElementType:!1,dataElementType:"point",animations:{numbers:{type:"number",properties:["x","y","borderWidth","radius"]}}};static overrides={scales:{x:{type:"linear"},y:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,super.initialize()}parsePrimitiveData(t,e,i,s){const r=super.parsePrimitiveData(t,e,i,s);for(let o=0;o<r.length;o++)r[o]._custom=this.resolveDataElementOptions(o+i).radius;return r}parseArrayData(t,e,i,s){const r=super.parseArrayData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=W(a[2],this.resolveDataElementOptions(o+i).radius)}return r}parseObjectData(t,e,i,s){const r=super.parseObjectData(t,e,i,s);for(let o=0;o<r.length;o++){const a=e[i+o];r[o]._custom=W(a&&a.r&&+a.r,this.resolveDataElementOptions(o+i).radius)}return r}getMaxOverflow(){const t=this._cachedMeta.data;let e=0;for(let i=t.length-1;i>=0;--i)e=Math.max(e,t[i].size(this.resolveDataElementOptions(i))/2);return e>0&&e}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y),u=o._custom;return{label:i[t]||"",value:"("+a+", "+l+(u?", "+u:"")+")"}}update(t){const e=this._cachedMeta.data;this.updateElements(e,0,e.length,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a}=this._cachedMeta,{sharedOptions:l,includeOptions:u}=this._getSharedOptions(e,s),h=o.axis,d=a.axis;for(let p=e;p<e+i;p++){const m=t[p],b=!r&&this.getParsed(p),v={},E=v[h]=r?o.getPixelForDecimal(.5):o.getPixelForValue(b[h]),C=v[d]=r?a.getBasePixel():a.getPixelForValue(b[d]);v.skip=isNaN(E)||isNaN(C),u&&(v.options=l||this.resolveDataElementOptions(p,m.active?"active":s),r&&(v.options.radius=0)),this.updateElement(m,p,v,s)}}resolveDataElementOptions(t,e){const i=this.getParsed(t);let s=super.resolveDataElementOptions(t,e);s.$shared&&(s=Object.assign({},s,{$shared:!1}));const r=s.radius;return e!=="active"&&(s.radius=0),s.radius+=W(i&&i._custom,r),s}}function wA(n,t,e){let i=1,s=1,r=0,o=0;if(t<ft){const a=n,l=a+t,u=Math.cos(a),h=Math.sin(a),d=Math.cos(l),p=Math.sin(l),m=(k,M,O)=>$s(k,a,l,!0)?1:Math.max(M,M*e,O,O*e),b=(k,M,O)=>$s(k,a,l,!0)?-1:Math.min(M,M*e,O,O*e),v=m(0,u,d),E=m(wt,h,p),C=b(et,u,d),P=b(et+wt,h,p);i=(v-C)/2,s=(E-P)/2,r=-(v+C)/2,o=-(E+P)/2}return{ratioX:i,ratioY:s,offsetX:r,offsetY:o}}class Wc extends An{static id="doughnut";static defaults={datasetElementType:!1,dataElementType:"arc",animation:{animateRotate:!0,animateScale:!1},animations:{numbers:{type:"number",properties:["circumference","endAngle","innerRadius","outerRadius","startAngle","x","y","offset","borderWidth","spacing"]}},cutout:"50%",rotation:0,circumference:360,radius:"100%",spacing:0,indexAxis:"r"};static descriptors={_scriptable:t=>t!=="spacing",_indexable:t=>t!=="spacing"&&!t.startsWith("borderDash")&&!t.startsWith("hoverBorderDash")};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data,{labels:{pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=t.legend.options;return e.labels.length&&e.datasets.length?e.labels.map((l,u)=>{const d=t.getDatasetMeta(0).controller.getStyle(u);return{text:l,fillStyle:d.backgroundColor,fontColor:r,hidden:!t.getDataVisibility(u),lineDash:d.borderDash,lineDashOffset:d.borderDashOffset,lineJoin:d.borderJoinStyle,lineWidth:d.borderWidth,strokeStyle:d.borderColor,textAlign:s,pointStyle:i,borderRadius:o&&(a||d.borderRadius),index:u}}):[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}}};constructor(t,e){super(t,e),this.enableOptionSharing=!0,this.innerRadius=void 0,this.outerRadius=void 0,this.offsetX=void 0,this.offsetY=void 0}linkScales(){}parse(t,e){const i=this.getDataset().data,s=this._cachedMeta;if(this._parsing===!1)s._parsed=i;else{let r=l=>+i[l];if(Z(i[t])){const{key:l="value"}=this._parsing;r=u=>+En(i[u],l)}let o,a;for(o=t,a=t+e;o<a;++o)s._parsed[o]=r(o)}}_getRotation(){return ce(this.options.rotation-90)}_getCircumference(){return ce(this.options.circumference)}_getRotationExtents(){let t=ft,e=-ft;for(let i=0;i<this.chart.data.datasets.length;++i)if(this.chart.isDatasetVisible(i)&&this.chart.getDatasetMeta(i).type===this._type){const s=this.chart.getDatasetMeta(i).controller,r=s._getRotation(),o=s._getCircumference();t=Math.min(t,r),e=Math.max(e,r+o)}return{rotation:t,circumference:e-t}}update(t){const e=this.chart,{chartArea:i}=e,s=this._cachedMeta,r=s.data,o=this.getMaxBorderWidth()+this.getMaxOffset(r)+this.options.spacing,a=Math.max((Math.min(i.width,i.height)-o)/2,0),l=Math.min(kx(this.options.cutout,a),1),u=this._getRingWeight(this.index),{circumference:h,rotation:d}=this._getRotationExtents(),{ratioX:p,ratioY:m,offsetX:b,offsetY:v}=wA(d,h,l),E=(i.width-o)/p,C=(i.height-o)/m,P=Math.max(Math.min(E,C)/2,0),k=vm(this.options.radius,P),M=Math.max(k*l,0),O=(k-M)/this._getVisibleDatasetWeightTotal();this.offsetX=b*k,this.offsetY=v*k,s.total=this.calculateTotal(),this.outerRadius=k-O*this._getRingWeightOffset(this.index),this.innerRadius=Math.max(this.outerRadius-O*u,0),this.updateElements(r,0,r.length,t)}_circumference(t,e){const i=this.options,s=this._cachedMeta,r=this._getCircumference();return e&&i.animation.animateRotate||!this.chart.getDataVisibility(t)||s._parsed[t]===null||s.data[t].hidden?0:this.calculateCircumference(s._parsed[t]*r/ft)}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,a=o.chartArea,u=o.options.animation,h=(a.left+a.right)/2,d=(a.top+a.bottom)/2,p=r&&u.animateScale,m=p?0:this.innerRadius,b=p?0:this.outerRadius,{sharedOptions:v,includeOptions:E}=this._getSharedOptions(e,s);let C=this._getRotation(),P;for(P=0;P<e;++P)C+=this._circumference(P,r);for(P=e;P<e+i;++P){const k=this._circumference(P,r),M=t[P],O={x:h+this.offsetX,y:d+this.offsetY,startAngle:C,endAngle:C+k,circumference:k,outerRadius:b,innerRadius:m};E&&(O.options=v||this.resolveDataElementOptions(P,M.active?"active":s)),C+=k,this.updateElement(M,P,O,s)}}calculateTotal(){const t=this._cachedMeta,e=t.data;let i=0,s;for(s=0;s<e.length;s++){const r=t._parsed[s];r!==null&&!isNaN(r)&&this.chart.getDataVisibility(s)&&!e[s].hidden&&(i+=Math.abs(r))}return i}calculateCircumference(t){const e=this._cachedMeta.total;return e>0&&!isNaN(t)?ft*(Math.abs(t)/e):0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=ar(e._parsed[t],i.options.locale);return{label:s[t]||"",value:r}}getMaxBorderWidth(t){let e=0;const i=this.chart;let s,r,o,a,l;if(!t){for(s=0,r=i.data.datasets.length;s<r;++s)if(i.isDatasetVisible(s)){o=i.getDatasetMeta(s),t=o.data,a=o.controller;break}}if(!t)return 0;for(s=0,r=t.length;s<r;++s)l=a.resolveDataElementOptions(s),l.borderAlign!=="inner"&&(e=Math.max(e,l.borderWidth||0,l.hoverBorderWidth||0));return e}getMaxOffset(t){let e=0;for(let i=0,s=t.length;i<s;++i){const r=this.resolveDataElementOptions(i);e=Math.max(e,r.offset||0,r.hoverOffset||0)}return e}_getRingWeightOffset(t){let e=0;for(let i=0;i<t;++i)this.chart.isDatasetVisible(i)&&(e+=this._getRingWeight(i));return e}_getRingWeight(t){return Math.max(W(this.chart.data.datasets[t].weight,1),0)}_getVisibleDatasetWeightTotal(){return this._getRingWeightOffset(this.chart.data.datasets.length)||1}}class EA extends An{static id="line";static defaults={datasetElementType:"line",dataElementType:"point",showLine:!0,spanGaps:!1};static overrides={scales:{_index_:{type:"category"},_value_:{type:"linear"}}};initialize(){this.enableOptionSharing=!0,this.supportsDecimation=!0,super.initialize()}update(t){const e=this._cachedMeta,{dataset:i,data:s=[],_dataset:r}=e,o=this.chart._animationsDisabled;let{start:a,count:l}=Cm(e,s,o);this._drawStart=a,this._drawCount=l,Pm(e)&&(a=0,l=s.length),i._chart=this.chart,i._datasetIndex=this.index,i._decimated=!!r._decimated,i.points=s;const u=this.resolveDatasetElementOptions(t);this.options.showLine||(u.borderWidth=0),u.segment=this.options.segment,this.updateElement(i,void 0,{animated:!o,options:u},t),this.updateElements(s,a,l,t)}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:u}=this._cachedMeta,{sharedOptions:h,includeOptions:d}=this._getSharedOptions(e,s),p=o.axis,m=a.axis,{spanGaps:b,segment:v}=this.options,E=Ri(b)?b:Number.POSITIVE_INFINITY,C=this.chart._animationsDisabled||r||s==="none",P=e+i,k=t.length;let M=e>0&&this.getParsed(e-1);for(let O=0;O<k;++O){const N=t[O],w=C?N:{};if(O<e||O>=P){w.skip=!0;continue}const y=this.getParsed(O),T=Y(y[m]),A=w[p]=o.getPixelForValue(y[p],O),x=w[m]=r||T?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,y,l):y[m],O);w.skip=isNaN(A)||isNaN(x)||T,w.stop=O>0&&Math.abs(y[p]-M[p])>E,v&&(w.parsed=y,w.raw=u.data[O]),d&&(w.options=h||this.resolveDataElementOptions(O,N.active?"active":s)),C||this.updateElement(N,O,w,s),M=y}}getMaxOverflow(){const t=this._cachedMeta,e=t.dataset,i=e.options&&e.options.borderWidth||0,s=t.data||[];if(!s.length)return i;const r=s[0].size(this.resolveDataElementOptions(0)),o=s[s.length-1].size(this.resolveDataElementOptions(s.length-1));return Math.max(i,r,o)/2}draw(){const t=this._cachedMeta;t.dataset.updateControlPoints(this.chart.chartArea,t.iScale.axis),super.draw()}}class Km extends An{static id="polarArea";static defaults={dataElementType:"arc",animation:{animateRotate:!0,animateScale:!0},animations:{numbers:{type:"number",properties:["x","y","startAngle","endAngle","innerRadius","outerRadius"]}},indexAxis:"r",startAngle:0};static overrides={aspectRatio:1,plugins:{legend:{labels:{generateLabels(t){const e=t.data;if(e.labels.length&&e.datasets.length){const{labels:{pointStyle:i,color:s}}=t.legend.options;return e.labels.map((r,o)=>{const l=t.getDatasetMeta(0).controller.getStyle(o);return{text:r,fillStyle:l.backgroundColor,strokeStyle:l.borderColor,fontColor:s,lineWidth:l.borderWidth,pointStyle:i,hidden:!t.getDataVisibility(o),index:o}})}return[]}},onClick(t,e,i){i.chart.toggleDataVisibility(e.index),i.chart.update()}}},scales:{r:{type:"radialLinear",angleLines:{display:!1},beginAtZero:!0,grid:{circular:!0},pointLabels:{display:!1},startAngle:0}}};constructor(t,e){super(t,e),this.innerRadius=void 0,this.outerRadius=void 0}getLabelAndValue(t){const e=this._cachedMeta,i=this.chart,s=i.data.labels||[],r=ar(e._parsed[t].r,i.options.locale);return{label:s[t]||"",value:r}}parseObjectData(t,e,i,s){return Nm.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta.data;this._updateRadius(),this.updateElements(e,0,e.length,t)}getMinMax(){const t=this._cachedMeta,e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};return t.data.forEach((i,s)=>{const r=this.getParsed(s).r;!isNaN(r)&&this.chart.getDataVisibility(s)&&(r<e.min&&(e.min=r),r>e.max&&(e.max=r))}),e}_updateRadius(){const t=this.chart,e=t.chartArea,i=t.options,s=Math.min(e.right-e.left,e.bottom-e.top),r=Math.max(s/2,0),o=Math.max(i.cutoutPercentage?r/100*i.cutoutPercentage:1,0),a=(r-o)/t.getVisibleDatasetCount();this.outerRadius=r-a*this.index,this.innerRadius=this.outerRadius-a}updateElements(t,e,i,s){const r=s==="reset",o=this.chart,l=o.options.animation,u=this._cachedMeta.rScale,h=u.xCenter,d=u.yCenter,p=u.getIndexAngle(0)-.5*et;let m=p,b;const v=360/this.countVisibleElements();for(b=0;b<e;++b)m+=this._computeAngle(b,s,v);for(b=e;b<e+i;b++){const E=t[b];let C=m,P=m+this._computeAngle(b,s,v),k=o.getDataVisibility(b)?u.getDistanceFromCenterForValue(this.getParsed(b).r):0;m=P,r&&(l.animateScale&&(k=0),l.animateRotate&&(C=P=p));const M={x:h,y:d,innerRadius:0,outerRadius:k,startAngle:C,endAngle:P,options:this.resolveDataElementOptions(b,E.active?"active":s)};this.updateElement(E,b,M,s)}}countVisibleElements(){const t=this._cachedMeta;let e=0;return t.data.forEach((i,s)=>{!isNaN(this.getParsed(s).r)&&this.chart.getDataVisibility(s)&&e++}),e}_computeAngle(t,e,i){return this.chart.getDataVisibility(t)?ce(this.resolveDataElementOptions(t,e).angle||i):0}}class TA extends Wc{static id="pie";static defaults={cutout:0,rotation:0,circumference:360,radius:"100%"}}class xA extends An{static id="radar";static defaults={datasetElementType:"line",dataElementType:"point",indexAxis:"r",showLine:!0,elements:{line:{fill:"start"}}};static overrides={aspectRatio:1,scales:{r:{type:"radialLinear"}}};getLabelAndValue(t){const e=this._cachedMeta.vScale,i=this.getParsed(t);return{label:e.getLabels()[t],value:""+e.getLabelForValue(i[e.axis])}}parseObjectData(t,e,i,s){return Nm.bind(this)(t,e,i,s)}update(t){const e=this._cachedMeta,i=e.dataset,s=e.data||[],r=e.iScale.getLabels();if(i.points=s,t!=="resize"){const o=this.resolveDatasetElementOptions(t);this.options.showLine||(o.borderWidth=0);const a={_loop:!0,_fullLoop:r.length===s.length,options:o};this.updateElement(i,void 0,a,t)}this.updateElements(s,0,s.length,t)}updateElements(t,e,i,s){const r=this._cachedMeta.rScale,o=s==="reset";for(let a=e;a<e+i;a++){const l=t[a],u=this.resolveDataElementOptions(a,l.active?"active":s),h=r.getPointPositionForValue(a,this.getParsed(a).r),d=o?r.xCenter:h.x,p=o?r.yCenter:h.y,m={x:d,y:p,angle:h.angle,skip:isNaN(d)||isNaN(p),options:u};this.updateElement(l,a,m,s)}}}class IA extends An{static id="scatter";static defaults={datasetElementType:!1,dataElementType:"point",showLine:!1,fill:!1};static overrides={interaction:{mode:"point"},scales:{x:{type:"linear"},y:{type:"linear"}}};getLabelAndValue(t){const e=this._cachedMeta,i=this.chart.data.labels||[],{xScale:s,yScale:r}=e,o=this.getParsed(t),a=s.getLabelForValue(o.x),l=r.getLabelForValue(o.y);return{label:i[t]||"",value:"("+a+", "+l+")"}}update(t){const e=this._cachedMeta,{data:i=[]}=e,s=this.chart._animationsDisabled;let{start:r,count:o}=Cm(e,i,s);if(this._drawStart=r,this._drawCount=o,Pm(e)&&(r=0,o=i.length),this.options.showLine){this.datasetElementType||this.addElements();const{dataset:a,_dataset:l}=e;a._chart=this.chart,a._datasetIndex=this.index,a._decimated=!!l._decimated,a.points=i;const u=this.resolveDatasetElementOptions(t);u.segment=this.options.segment,this.updateElement(a,void 0,{animated:!s,options:u},t)}else this.datasetElementType&&(delete e.dataset,this.datasetElementType=!1);this.updateElements(i,r,o,t)}addElements(){const{showLine:t}=this.options;!this.datasetElementType&&t&&(this.datasetElementType=this.chart.registry.getElement("line")),super.addElements()}updateElements(t,e,i,s){const r=s==="reset",{iScale:o,vScale:a,_stacked:l,_dataset:u}=this._cachedMeta,h=this.resolveDataElementOptions(e,s),d=this.getSharedOptions(h),p=this.includeOptions(s,d),m=o.axis,b=a.axis,{spanGaps:v,segment:E}=this.options,C=Ri(v)?v:Number.POSITIVE_INFINITY,P=this.chart._animationsDisabled||r||s==="none";let k=e>0&&this.getParsed(e-1);for(let M=e;M<e+i;++M){const O=t[M],N=this.getParsed(M),w=P?O:{},y=Y(N[b]),T=w[m]=o.getPixelForValue(N[m],M),A=w[b]=r||y?a.getBasePixel():a.getPixelForValue(l?this.applyStack(a,N,l):N[b],M);w.skip=isNaN(T)||isNaN(A)||y,w.stop=M>0&&Math.abs(N[m]-k[m])>C,E&&(w.parsed=N,w.raw=u.data[M]),p&&(w.options=d||this.resolveDataElementOptions(M,O.active?"active":s)),P||this.updateElement(O,M,w,s),k=N}this.updateSharedOptions(d,s,h)}getMaxOverflow(){const t=this._cachedMeta,e=t.data||[];if(!this.options.showLine){let a=0;for(let l=e.length-1;l>=0;--l)a=Math.max(a,e[l].size(this.resolveDataElementOptions(l))/2);return a>0&&a}const i=t.dataset,s=i.options&&i.options.borderWidth||0;if(!e.length)return s;const r=e[0].size(this.resolveDataElementOptions(0)),o=e[e.length-1].size(this.resolveDataElementOptions(e.length-1));return Math.max(s,r,o)/2}}var AA=Object.freeze({__proto__:null,BarController:bA,BubbleController:vA,DoughnutController:Wc,LineController:EA,PieController:TA,PolarAreaController:Km,RadarController:xA,ScatterController:IA});function On(){throw new Error("This method is not implemented: Check that a complete date adapter is provided.")}class qc{static override(t){Object.assign(qc.prototype,t)}options;constructor(t){this.options=t||{}}init(){}formats(){return On()}parse(){return On()}format(){return On()}add(){return On()}diff(){return On()}startOf(){return On()}endOf(){return On()}}var SA={_date:qc};function CA(n,t,e,i){const{controller:s,data:r,_sorted:o}=n,a=s._cachedMeta.iScale,l=n.dataset&&n.dataset.options?n.dataset.options.spanGaps:null;if(a&&t===a.axis&&t!=="r"&&o&&r.length){const u=a._reversePixels?Hx:Ne;if(i){if(s._sharedOptions){const h=r[0],d=typeof h.getRange=="function"&&h.getRange(t);if(d){const p=u(r,t,e-d),m=u(r,t,e+d);return{lo:p.lo,hi:m.hi}}}}else{const h=u(r,t,e);if(l){const{vScale:d}=s._cachedMeta,{_parsed:p}=n,m=p.slice(0,h.lo+1).reverse().findIndex(v=>!Y(v[d.axis]));h.lo-=Math.max(0,m);const b=p.slice(h.hi).findIndex(v=>!Y(v[d.axis]));h.hi+=Math.max(0,b)}return h}}return{lo:0,hi:r.length-1}}function Yo(n,t,e,i,s){const r=n.getSortedVisibleDatasetMetas(),o=e[t];for(let a=0,l=r.length;a<l;++a){const{index:u,data:h}=r[a],{lo:d,hi:p}=CA(r[a],t,o,s);for(let m=d;m<=p;++m){const b=h[m];b.skip||i(b,u,m)}}}function PA(n){const t=n.indexOf("x")!==-1,e=n.indexOf("y")!==-1;return function(i,s){const r=t?Math.abs(i.x-s.x):0,o=e?Math.abs(i.y-s.y):0;return Math.sqrt(Math.pow(r,2)+Math.pow(o,2))}}function Ua(n,t,e,i,s){const r=[];return!s&&!n.isPointInArea(t)||Yo(n,e,t,function(a,l,u){!s&&!Fe(a,n.chartArea,0)||a.inRange(t.x,t.y,i)&&r.push({element:a,datasetIndex:l,index:u})},!0),r}function RA(n,t,e,i){let s=[];function r(o,a,l){const{startAngle:u,endAngle:h}=o.getProps(["startAngle","endAngle"],i),{angle:d}=Tm(o,{x:t.x,y:t.y});$s(d,u,h)&&s.push({element:o,datasetIndex:a,index:l})}return Yo(n,e,t,r),s}function kA(n,t,e,i,s,r){let o=[];const a=PA(e);let l=Number.POSITIVE_INFINITY;function u(h,d,p){const m=h.inRange(t.x,t.y,s);if(i&&!m)return;const b=h.getCenterPoint(s);if(!(!!r||n.isPointInArea(b))&&!m)return;const E=a(t,b);E<l?(o=[{element:h,datasetIndex:d,index:p}],l=E):E===l&&o.push({element:h,datasetIndex:d,index:p})}return Yo(n,e,t,u),o}function za(n,t,e,i,s,r){return!r&&!n.isPointInArea(t)?[]:e==="r"&&!i?RA(n,t,e,s):kA(n,t,e,i,s,r)}function Jd(n,t,e,i,s){const r=[],o=e==="x"?"inXRange":"inYRange";let a=!1;return Yo(n,e,t,(l,u,h)=>{l[o]&&l[o](t[e],s)&&(r.push({element:l,datasetIndex:u,index:h}),a=a||l.inRange(t.x,t.y,s))}),i&&!a?[]:r}var DA={modes:{index(n,t,e,i){const s=Nn(t,n),r=e.axis||"x",o=e.includeInvisible||!1,a=e.intersect?Ua(n,s,r,i,o):za(n,s,r,!1,i,o),l=[];return a.length?(n.getSortedVisibleDatasetMetas().forEach(u=>{const h=a[0].index,d=u.data[h];d&&!d.skip&&l.push({element:d,datasetIndex:u.index,index:h})}),l):[]},dataset(n,t,e,i){const s=Nn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;let a=e.intersect?Ua(n,s,r,i,o):za(n,s,r,!1,i,o);if(a.length>0){const l=a[0].datasetIndex,u=n.getDatasetMeta(l).data;a=[];for(let h=0;h<u.length;++h)a.push({element:u[h],datasetIndex:l,index:h})}return a},point(n,t,e,i){const s=Nn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return Ua(n,s,r,i,o)},nearest(n,t,e,i){const s=Nn(t,n),r=e.axis||"xy",o=e.includeInvisible||!1;return za(n,s,r,e.intersect,i,o)},x(n,t,e,i){const s=Nn(t,n);return Jd(n,s,"x",e.intersect,i)},y(n,t,e,i){const s=Nn(t,n);return Jd(n,s,"y",e.intersect,i)}}};const Ym=["left","top","right","bottom"];function rs(n,t){return n.filter(e=>e.pos===t)}function Zd(n,t){return n.filter(e=>Ym.indexOf(e.pos)===-1&&e.box.axis===t)}function os(n,t){return n.sort((e,i)=>{const s=t?i:e,r=t?e:i;return s.weight===r.weight?s.index-r.index:s.weight-r.weight})}function MA(n){const t=[];let e,i,s,r,o,a;for(e=0,i=(n||[]).length;e<i;++e)s=n[e],{position:r,options:{stack:o,stackWeight:a=1}}=s,t.push({index:e,box:s,pos:r,horizontal:s.isHorizontal(),weight:s.weight,stack:o&&r+o,stackWeight:a});return t}function OA(n){const t={};for(const e of n){const{stack:i,pos:s,stackWeight:r}=e;if(!i||!Ym.includes(s))continue;const o=t[i]||(t[i]={count:0,placed:0,weight:0,size:0});o.count++,o.weight+=r}return t}function VA(n,t){const e=OA(n),{vBoxMaxWidth:i,hBoxMaxHeight:s}=t;let r,o,a;for(r=0,o=n.length;r<o;++r){a=n[r];const{fullSize:l}=a.box,u=e[a.stack],h=u&&a.stackWeight/u.weight;a.horizontal?(a.width=h?h*i:l&&t.availableWidth,a.height=s):(a.width=i,a.height=h?h*s:l&&t.availableHeight)}return e}function LA(n){const t=MA(n),e=os(t.filter(u=>u.box.fullSize),!0),i=os(rs(t,"left"),!0),s=os(rs(t,"right")),r=os(rs(t,"top"),!0),o=os(rs(t,"bottom")),a=Zd(t,"x"),l=Zd(t,"y");return{fullSize:e,leftAndTop:i.concat(r),rightAndBottom:s.concat(l).concat(o).concat(a),chartArea:rs(t,"chartArea"),vertical:i.concat(s).concat(l),horizontal:r.concat(o).concat(a)}}function tf(n,t,e,i){return Math.max(n[e],t[e])+Math.max(n[i],t[i])}function Xm(n,t){n.top=Math.max(n.top,t.top),n.left=Math.max(n.left,t.left),n.bottom=Math.max(n.bottom,t.bottom),n.right=Math.max(n.right,t.right)}function NA(n,t,e,i){const{pos:s,box:r}=e,o=n.maxPadding;if(!Z(s)){e.size&&(n[s]-=e.size);const d=i[e.stack]||{size:0,count:1};d.size=Math.max(d.size,e.horizontal?r.height:r.width),e.size=d.size/d.count,n[s]+=e.size}r.getPadding&&Xm(o,r.getPadding());const a=Math.max(0,t.outerWidth-tf(o,n,"left","right")),l=Math.max(0,t.outerHeight-tf(o,n,"top","bottom")),u=a!==n.w,h=l!==n.h;return n.w=a,n.h=l,e.horizontal?{same:u,other:h}:{same:h,other:u}}function FA(n){const t=n.maxPadding;function e(i){const s=Math.max(t[i]-n[i],0);return n[i]+=s,s}n.y+=e("top"),n.x+=e("left"),e("right"),e("bottom")}function BA(n,t){const e=t.maxPadding;function i(s){const r={left:0,top:0,right:0,bottom:0};return s.forEach(o=>{r[o]=Math.max(t[o],e[o])}),r}return i(n?["left","right"]:["top","bottom"])}function gs(n,t,e,i){const s=[];let r,o,a,l,u,h;for(r=0,o=n.length,u=0;r<o;++r){a=n[r],l=a.box,l.update(a.width||t.w,a.height||t.h,BA(a.horizontal,t));const{same:d,other:p}=NA(t,e,a,i);u|=d&&s.length,h=h||p,l.fullSize||s.push(a)}return u&&gs(s,t,e,i)||h}function Mr(n,t,e,i,s){n.top=e,n.left=t,n.right=t+i,n.bottom=e+s,n.width=i,n.height=s}function ef(n,t,e,i){const s=e.padding;let{x:r,y:o}=t;for(const a of n){const l=a.box,u=i[a.stack]||{placed:0,weight:1},h=a.stackWeight/u.weight||1;if(a.horizontal){const d=t.w*h,p=u.size||l.height;zs(u.start)&&(o=u.start),l.fullSize?Mr(l,s.left,o,e.outerWidth-s.right-s.left,p):Mr(l,t.left+u.placed,o,d,p),u.start=o,u.placed+=d,o=l.bottom}else{const d=t.h*h,p=u.size||l.width;zs(u.start)&&(r=u.start),l.fullSize?Mr(l,r,s.top,p,e.outerHeight-s.bottom-s.top):Mr(l,r,t.top+u.placed,p,d),u.start=r,u.placed+=d,r=l.right}}t.x=r,t.y=o}var Ht={addBox(n,t){n.boxes||(n.boxes=[]),t.fullSize=t.fullSize||!1,t.position=t.position||"top",t.weight=t.weight||0,t._layers=t._layers||function(){return[{z:0,draw(e){t.draw(e)}}]},n.boxes.push(t)},removeBox(n,t){const e=n.boxes?n.boxes.indexOf(t):-1;e!==-1&&n.boxes.splice(e,1)},configure(n,t,e){t.fullSize=e.fullSize,t.position=e.position,t.weight=e.weight},update(n,t,e,i){if(!n)return;const s=qt(n.options.layout.padding),r=Math.max(t-s.width,0),o=Math.max(e-s.height,0),a=LA(n.boxes),l=a.vertical,u=a.horizontal;rt(n.boxes,v=>{typeof v.beforeLayout=="function"&&v.beforeLayout()});const h=l.reduce((v,E)=>E.box.options&&E.box.options.display===!1?v:v+1,0)||1,d=Object.freeze({outerWidth:t,outerHeight:e,padding:s,availableWidth:r,availableHeight:o,vBoxMaxWidth:r/2/h,hBoxMaxHeight:o/2}),p=Object.assign({},s);Xm(p,qt(i));const m=Object.assign({maxPadding:p,w:r,h:o,x:s.left,y:s.top},s),b=VA(l.concat(u),d);gs(a.fullSize,m,d,b),gs(l,m,d,b),gs(u,m,d,b)&&gs(l,m,d,b),FA(m),ef(a.leftAndTop,m,d,b),m.x+=m.w,m.y+=m.h,ef(a.rightAndBottom,m,d,b),n.chartArea={left:m.left,top:m.top,right:m.left+m.w,bottom:m.top+m.h,height:m.h,width:m.w},rt(a.chartArea,v=>{const E=v.box;Object.assign(E,n.chartArea),E.update(m.w,m.h,{left:0,top:0,right:0,bottom:0})})}};class Qm{acquireContext(t,e){}releaseContext(t){return!1}addEventListener(t,e,i){}removeEventListener(t,e,i){}getDevicePixelRatio(){return 1}getMaximumSize(t,e,i,s){return e=Math.max(0,e||t.width),i=i||t.height,{width:e,height:Math.max(0,s?Math.floor(e/s):i)}}isAttached(t){return!0}updateConfig(t){}}class UA extends Qm{acquireContext(t){return t&&t.getContext&&t.getContext("2d")||null}updateConfig(t){t.options.animation=!1}}const Xr="$chartjs",zA={touchstart:"mousedown",touchmove:"mousemove",touchend:"mouseup",pointerenter:"mouseenter",pointerdown:"mousedown",pointermove:"mousemove",pointerup:"mouseup",pointerleave:"mouseout",pointerout:"mouseout"},nf=n=>n===null||n==="";function $A(n,t){const e=n.style,i=n.getAttribute("height"),s=n.getAttribute("width");if(n[Xr]={initial:{height:i,width:s,style:{display:e.display,height:e.height,width:e.width}}},e.display=e.display||"block",e.boxSizing=e.boxSizing||"border-box",nf(s)){const r=Bd(n,"width");r!==void 0&&(n.width=r)}if(nf(i))if(n.style.height==="")n.height=n.width/(t||2);else{const r=Bd(n,"height");r!==void 0&&(n.height=r)}return n}const Jm=NI?{passive:!0}:!1;function jA(n,t,e){n&&n.addEventListener(t,e,Jm)}function HA(n,t,e){n&&n.canvas&&n.canvas.removeEventListener(t,e,Jm)}function WA(n,t){const e=zA[n.type]||n.type,{x:i,y:s}=Nn(n,t);return{type:e,chart:t,native:n,x:i!==void 0?i:null,y:s!==void 0?s:null}}function Io(n,t){for(const e of n)if(e===t||e.contains(t))return!0}function qA(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Io(a.addedNodes,i),o=o&&!Io(a.removedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}function GA(n,t,e){const i=n.canvas,s=new MutationObserver(r=>{let o=!1;for(const a of r)o=o||Io(a.removedNodes,i),o=o&&!Io(a.addedNodes,i);o&&e()});return s.observe(document,{childList:!0,subtree:!0}),s}const Hs=new Map;let sf=0;function Zm(){const n=window.devicePixelRatio;n!==sf&&(sf=n,Hs.forEach((t,e)=>{e.currentDevicePixelRatio!==n&&t()}))}function KA(n,t){Hs.size||window.addEventListener("resize",Zm),Hs.set(n,t)}function YA(n){Hs.delete(n),Hs.size||window.removeEventListener("resize",Zm)}function XA(n,t,e){const i=n.canvas,s=i&&Hc(i);if(!s)return;const r=Sm((a,l)=>{const u=s.clientWidth;e(a,l),u<s.clientWidth&&e()},window),o=new ResizeObserver(a=>{const l=a[0],u=l.contentRect.width,h=l.contentRect.height;u===0&&h===0||r(u,h)});return o.observe(s),KA(n,r),o}function $a(n,t,e){e&&e.disconnect(),t==="resize"&&YA(n)}function QA(n,t,e){const i=n.canvas,s=Sm(r=>{n.ctx!==null&&e(WA(r,n))},n);return jA(i,t,s),s}class JA extends Qm{acquireContext(t,e){const i=t&&t.getContext&&t.getContext("2d");return i&&i.canvas===t?($A(t,e),i):null}releaseContext(t){const e=t.canvas;if(!e[Xr])return!1;const i=e[Xr].initial;["height","width"].forEach(r=>{const o=i[r];Y(o)?e.removeAttribute(r):e.setAttribute(r,o)});const s=i.style||{};return Object.keys(s).forEach(r=>{e.style[r]=s[r]}),e.width=e.width,delete e[Xr],!0}addEventListener(t,e,i){this.removeEventListener(t,e);const s=t.$proxies||(t.$proxies={}),o={attach:qA,detach:GA,resize:XA}[e]||QA;s[e]=o(t,e,i)}removeEventListener(t,e){const i=t.$proxies||(t.$proxies={}),s=i[e];if(!s)return;({attach:$a,detach:$a,resize:$a}[e]||HA)(t,e,s),i[e]=void 0}getDevicePixelRatio(){return window.devicePixelRatio}getMaximumSize(t,e,i,s){return LI(t,e,i,s)}isAttached(t){const e=t&&Hc(t);return!!(e&&e.isConnected)}}function ZA(n){return!jc()||typeof OffscreenCanvas<"u"&&n instanceof OffscreenCanvas?UA:JA}class He{static defaults={};static defaultRoutes=void 0;x;y;active=!1;options;$animations;tooltipPosition(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}hasValue(){return Ri(this.x)&&Ri(this.y)}getProps(t,e){const i=this.$animations;if(!e||!i)return this;const s={};return t.forEach(r=>{s[r]=i[r]&&i[r].active()?i[r]._to:this[r]}),s}}function t1(n,t){const e=n.options.ticks,i=e1(n),s=Math.min(e.maxTicksLimit||i,i),r=e.major.enabled?i1(t):[],o=r.length,a=r[0],l=r[o-1],u=[];if(o>s)return s1(t,u,r,o/s),u;const h=n1(r,t,s);if(o>0){let d,p;const m=o>1?Math.round((l-a)/(o-1)):null;for(Or(t,u,h,Y(m)?0:a-m,a),d=0,p=o-1;d<p;d++)Or(t,u,h,r[d],r[d+1]);return Or(t,u,h,l,Y(m)?t.length:l+m),u}return Or(t,u,h),u}function e1(n){const t=n.options.offset,e=n._tickSize(),i=n._length/e+(t?0:1),s=n._maxLength/e;return Math.floor(Math.min(i,s))}function n1(n,t,e){const i=r1(n),s=t.length/e;if(!i)return Math.max(s,1);const r=Bx(i);for(let o=0,a=r.length-1;o<a;o++){const l=r[o];if(l>s)return l}return Math.max(s,1)}function i1(n){const t=[];let e,i;for(e=0,i=n.length;e<i;e++)n[e].major&&t.push(e);return t}function s1(n,t,e,i){let s=0,r=e[0],o;for(i=Math.ceil(i),o=0;o<n.length;o++)o===r&&(t.push(n[o]),s++,r=e[s*i])}function Or(n,t,e,i,s){const r=W(i,0),o=Math.min(W(s,n.length),n.length);let a=0,l,u,h;for(e=Math.ceil(e),s&&(l=s-i,e=l/Math.floor(l/e)),h=r;h<0;)a++,h=Math.round(r+a*e);for(u=Math.max(r,0);u<o;u++)u===h&&(t.push(n[u]),a++,h=Math.round(r+a*e))}function r1(n){const t=n.length;let e,i;if(t<2)return!1;for(i=n[0],e=1;e<t;++e)if(n[e]-n[e-1]!==i)return!1;return i}const o1=n=>n==="left"?"right":n==="right"?"left":n,rf=(n,t,e)=>t==="top"||t==="left"?n[t]+e:n[t]-e,of=(n,t)=>Math.min(t||n,n);function af(n,t){const e=[],i=n.length/t,s=n.length;let r=0;for(;r<s;r+=i)e.push(n[Math.floor(r)]);return e}function a1(n,t,e){const i=n.ticks.length,s=Math.min(t,i-1),r=n._startPixel,o=n._endPixel,a=1e-6;let l=n.getPixelForTick(s),u;if(!(e&&(i===1?u=Math.max(l-r,o-l):t===0?u=(n.getPixelForTick(1)-l)/2:u=(l-n.getPixelForTick(s-1))/2,l+=s<t?u:-u,l<r-a||l>o+a)))return l}function l1(n,t){rt(n,e=>{const i=e.gc,s=i.length/2;let r;if(s>t){for(r=0;r<s;++r)delete e.data[i[r]];i.splice(0,s)}})}function as(n){return n.drawTicks?n.tickLength:0}function lf(n,t){if(!n.display)return 0;const e=Ct(n.font,t),i=qt(n.padding);return(pt(n.text)?n.text.length:1)*e.lineHeight+i.height}function c1(n,t){return In(n,{scale:t,type:"scale"})}function u1(n,t,e){return In(n,{tick:e,index:t,type:"tick"})}function h1(n,t,e){let i=Nc(n);return(e&&t!=="right"||!e&&t==="right")&&(i=o1(i)),i}function d1(n,t,e,i){const{top:s,left:r,bottom:o,right:a,chart:l}=n,{chartArea:u,scales:h}=l;let d=0,p,m,b;const v=o-s,E=a-r;if(n.isHorizontal()){if(m=Bt(i,r,a),Z(e)){const C=Object.keys(e)[0],P=e[C];b=h[C].getPixelForValue(P)+v-t}else e==="center"?b=(u.bottom+u.top)/2+v-t:b=rf(n,e,t);p=a-r}else{if(Z(e)){const C=Object.keys(e)[0],P=e[C];m=h[C].getPixelForValue(P)-E+t}else e==="center"?m=(u.left+u.right)/2-E+t:m=rf(n,e,t);b=Bt(i,o,s),d=e==="left"?-wt:wt}return{titleX:m,titleY:b,maxWidth:p,rotation:d}}class si extends He{constructor(t){super(),this.id=t.id,this.type=t.type,this.options=void 0,this.ctx=t.ctx,this.chart=t.chart,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this._margins={left:0,right:0,top:0,bottom:0},this.maxWidth=void 0,this.maxHeight=void 0,this.paddingTop=void 0,this.paddingBottom=void 0,this.paddingLeft=void 0,this.paddingRight=void 0,this.axis=void 0,this.labelRotation=void 0,this.min=void 0,this.max=void 0,this._range=void 0,this.ticks=[],this._gridLineItems=null,this._labelItems=null,this._labelSizes=null,this._length=0,this._maxLength=0,this._longestTextCache={},this._startPixel=void 0,this._endPixel=void 0,this._reversePixels=!1,this._userMax=void 0,this._userMin=void 0,this._suggestedMax=void 0,this._suggestedMin=void 0,this._ticksLength=0,this._borderValue=0,this._cache={},this._dataLimitsCached=!1,this.$context=void 0}init(t){this.options=t.setContext(this.getContext()),this.axis=t.axis,this._userMin=this.parse(t.min),this._userMax=this.parse(t.max),this._suggestedMin=this.parse(t.suggestedMin),this._suggestedMax=this.parse(t.suggestedMax)}parse(t,e){return t}getUserBounds(){let{_userMin:t,_userMax:e,_suggestedMin:i,_suggestedMax:s}=this;return t=te(t,Number.POSITIVE_INFINITY),e=te(e,Number.NEGATIVE_INFINITY),i=te(i,Number.POSITIVE_INFINITY),s=te(s,Number.NEGATIVE_INFINITY),{min:te(t,i),max:te(e,s),minDefined:bt(t),maxDefined:bt(e)}}getMinMax(t){let{min:e,max:i,minDefined:s,maxDefined:r}=this.getUserBounds(),o;if(s&&r)return{min:e,max:i};const a=this.getMatchingVisibleMetas();for(let l=0,u=a.length;l<u;++l)o=a[l].controller.getMinMax(this,t),s||(e=Math.min(e,o.min)),r||(i=Math.max(i,o.max));return e=r&&e>i?i:e,i=s&&e>i?e:i,{min:te(e,te(i,e)),max:te(i,te(e,i))}}getPadding(){return{left:this.paddingLeft||0,top:this.paddingTop||0,right:this.paddingRight||0,bottom:this.paddingBottom||0}}getTicks(){return this.ticks}getLabels(){const t=this.chart.data;return this.options.labels||(this.isHorizontal()?t.xLabels:t.yLabels)||t.labels||[]}getLabelItems(t=this.chart.chartArea){return this._labelItems||(this._labelItems=this._computeLabelItems(t))}beforeLayout(){this._cache={},this._dataLimitsCached=!1}beforeUpdate(){lt(this.options.beforeUpdate,[this])}update(t,e,i){const{beginAtZero:s,grace:r,ticks:o}=this.options,a=o.sampleSize;this.beforeUpdate(),this.maxWidth=t,this.maxHeight=e,this._margins=i=Object.assign({left:0,right:0,top:0,bottom:0},i),this.ticks=null,this._labelSizes=null,this._gridLineItems=null,this._labelItems=null,this.beforeSetDimensions(),this.setDimensions(),this.afterSetDimensions(),this._maxLength=this.isHorizontal()?this.width+i.left+i.right:this.height+i.top+i.bottom,this._dataLimitsCached||(this.beforeDataLimits(),this.determineDataLimits(),this.afterDataLimits(),this._range=pI(this,r,s),this._dataLimitsCached=!0),this.beforeBuildTicks(),this.ticks=this.buildTicks()||[],this.afterBuildTicks();const l=a<this.ticks.length;this._convertTicksToLabels(l?af(this.ticks,a):this.ticks),this.configure(),this.beforeCalculateLabelRotation(),this.calculateLabelRotation(),this.afterCalculateLabelRotation(),o.display&&(o.autoSkip||o.source==="auto")&&(this.ticks=t1(this,this.ticks),this._labelSizes=null,this.afterAutoSkip()),l&&this._convertTicksToLabels(this.ticks),this.beforeFit(),this.fit(),this.afterFit(),this.afterUpdate()}configure(){let t=this.options.reverse,e,i;this.isHorizontal()?(e=this.left,i=this.right):(e=this.top,i=this.bottom,t=!t),this._startPixel=e,this._endPixel=i,this._reversePixels=t,this._length=i-e,this._alignToPixels=this.options.alignToPixels}afterUpdate(){lt(this.options.afterUpdate,[this])}beforeSetDimensions(){lt(this.options.beforeSetDimensions,[this])}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=0,this.right=this.width):(this.height=this.maxHeight,this.top=0,this.bottom=this.height),this.paddingLeft=0,this.paddingTop=0,this.paddingRight=0,this.paddingBottom=0}afterSetDimensions(){lt(this.options.afterSetDimensions,[this])}_callHooks(t){this.chart.notifyPlugins(t,this.getContext()),lt(this.options[t],[this])}beforeDataLimits(){this._callHooks("beforeDataLimits")}determineDataLimits(){}afterDataLimits(){this._callHooks("afterDataLimits")}beforeBuildTicks(){this._callHooks("beforeBuildTicks")}buildTicks(){return[]}afterBuildTicks(){this._callHooks("afterBuildTicks")}beforeTickToLabelConversion(){lt(this.options.beforeTickToLabelConversion,[this])}generateTickLabels(t){const e=this.options.ticks;let i,s,r;for(i=0,s=t.length;i<s;i++)r=t[i],r.label=lt(e.callback,[r.value,i,t],this)}afterTickToLabelConversion(){lt(this.options.afterTickToLabelConversion,[this])}beforeCalculateLabelRotation(){lt(this.options.beforeCalculateLabelRotation,[this])}calculateLabelRotation(){const t=this.options,e=t.ticks,i=of(this.ticks.length,t.ticks.maxTicksLimit),s=e.minRotation||0,r=e.maxRotation;let o=s,a,l,u;if(!this._isVisible()||!e.display||s>=r||i<=1||!this.isHorizontal()){this.labelRotation=s;return}const h=this._getLabelSizes(),d=h.widest.width,p=h.highest.height,m=Mt(this.chart.width-d,0,this.maxWidth);a=t.offset?this.maxWidth/i:m/(i-1),d+6>a&&(a=m/(i-(t.offset?.5:1)),l=this.maxHeight-as(t.grid)-e.padding-lf(t.title,this.chart.options.font),u=Math.sqrt(d*d+p*p),o=Vc(Math.min(Math.asin(Mt((h.highest.height+6)/a,-1,1)),Math.asin(Mt(l/u,-1,1))-Math.asin(Mt(p/u,-1,1)))),o=Math.max(s,Math.min(r,o))),this.labelRotation=o}afterCalculateLabelRotation(){lt(this.options.afterCalculateLabelRotation,[this])}afterAutoSkip(){}beforeFit(){lt(this.options.beforeFit,[this])}fit(){const t={width:0,height:0},{chart:e,options:{ticks:i,title:s,grid:r}}=this,o=this._isVisible(),a=this.isHorizontal();if(o){const l=lf(s,e.options.font);if(a?(t.width=this.maxWidth,t.height=as(r)+l):(t.height=this.maxHeight,t.width=as(r)+l),i.display&&this.ticks.length){const{first:u,last:h,widest:d,highest:p}=this._getLabelSizes(),m=i.padding*2,b=ce(this.labelRotation),v=Math.cos(b),E=Math.sin(b);if(a){const C=i.mirror?0:E*d.width+v*p.height;t.height=Math.min(this.maxHeight,t.height+C+m)}else{const C=i.mirror?0:v*d.width+E*p.height;t.width=Math.min(this.maxWidth,t.width+C+m)}this._calculatePadding(u,h,E,v)}}this._handleMargins(),a?(this.width=this._length=e.width-this._margins.left-this._margins.right,this.height=t.height):(this.width=t.width,this.height=this._length=e.height-this._margins.top-this._margins.bottom)}_calculatePadding(t,e,i,s){const{ticks:{align:r,padding:o},position:a}=this.options,l=this.labelRotation!==0,u=a!=="top"&&this.axis==="x";if(this.isHorizontal()){const h=this.getPixelForTick(0)-this.left,d=this.right-this.getPixelForTick(this.ticks.length-1);let p=0,m=0;l?u?(p=s*t.width,m=i*e.height):(p=i*t.height,m=s*e.width):r==="start"?m=e.width:r==="end"?p=t.width:r!=="inner"&&(p=t.width/2,m=e.width/2),this.paddingLeft=Math.max((p-h+o)*this.width/(this.width-h),0),this.paddingRight=Math.max((m-d+o)*this.width/(this.width-d),0)}else{let h=e.height/2,d=t.height/2;r==="start"?(h=0,d=t.height):r==="end"&&(h=e.height,d=0),this.paddingTop=h+o,this.paddingBottom=d+o}}_handleMargins(){this._margins&&(this._margins.left=Math.max(this.paddingLeft,this._margins.left),this._margins.top=Math.max(this.paddingTop,this._margins.top),this._margins.right=Math.max(this.paddingRight,this._margins.right),this._margins.bottom=Math.max(this.paddingBottom,this._margins.bottom))}afterFit(){lt(this.options.afterFit,[this])}isHorizontal(){const{axis:t,position:e}=this.options;return e==="top"||e==="bottom"||t==="x"}isFullSize(){return this.options.fullSize}_convertTicksToLabels(t){this.beforeTickToLabelConversion(),this.generateTickLabels(t);let e,i;for(e=0,i=t.length;e<i;e++)Y(t[e].label)&&(t.splice(e,1),i--,e--);this.afterTickToLabelConversion()}_getLabelSizes(){let t=this._labelSizes;if(!t){const e=this.options.ticks.sampleSize;let i=this.ticks;e<i.length&&(i=af(i,e)),this._labelSizes=t=this._computeLabelSizes(i,i.length,this.options.ticks.maxTicksLimit)}return t}_computeLabelSizes(t,e,i){const{ctx:s,_longestTextCache:r}=this,o=[],a=[],l=Math.floor(e/of(e,i));let u=0,h=0,d,p,m,b,v,E,C,P,k,M,O;for(d=0;d<e;d+=l){if(b=t[d].label,v=this._resolveTickFontOptions(d),s.font=E=v.string,C=r[E]=r[E]||{data:{},gc:[]},P=v.lineHeight,k=M=0,!Y(b)&&!pt(b))k=To(s,C.data,C.gc,k,b),M=P;else if(pt(b))for(p=0,m=b.length;p<m;++p)O=b[p],!Y(O)&&!pt(O)&&(k=To(s,C.data,C.gc,k,O),M+=P);o.push(k),a.push(M),u=Math.max(k,u),h=Math.max(M,h)}l1(r,e);const N=o.indexOf(u),w=a.indexOf(h),y=T=>({width:o[T]||0,height:a[T]||0});return{first:y(0),last:y(e-1),widest:y(N),highest:y(w),widths:o,heights:a}}getLabelForValue(t){return t}getPixelForValue(t,e){return NaN}getValueForPixel(t){}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getPixelForDecimal(t){this._reversePixels&&(t=1-t);const e=this._startPixel+t*this._length;return jx(this._alignToPixels?Mn(this.chart,e,0):e)}getDecimalForPixel(t){const e=(t-this._startPixel)/this._length;return this._reversePixels?1-e:e}getBasePixel(){return this.getPixelForValue(this.getBaseValue())}getBaseValue(){const{min:t,max:e}=this;return t<0&&e<0?e:t>0&&e>0?t:0}getContext(t){const e=this.ticks||[];if(t>=0&&t<e.length){const i=e[t];return i.$context||(i.$context=u1(this.getContext(),t,i))}return this.$context||(this.$context=c1(this.chart.getContext(),this))}_tickSize(){const t=this.options.ticks,e=ce(this.labelRotation),i=Math.abs(Math.cos(e)),s=Math.abs(Math.sin(e)),r=this._getLabelSizes(),o=t.autoSkipPadding||0,a=r?r.widest.width+o:0,l=r?r.highest.height+o:0;return this.isHorizontal()?l*i>a*s?a/i:l/s:l*s<a*i?l/i:a/s}_isVisible(){const t=this.options.display;return t!=="auto"?!!t:this.getMatchingVisibleMetas().length>0}_computeGridLineItems(t){const e=this.axis,i=this.chart,s=this.options,{grid:r,position:o,border:a}=s,l=r.offset,u=this.isHorizontal(),d=this.ticks.length+(l?1:0),p=as(r),m=[],b=a.setContext(this.getContext()),v=b.display?b.width:0,E=v/2,C=function(ot){return Mn(i,ot,v)};let P,k,M,O,N,w,y,T,A,x,S,I;if(o==="top")P=C(this.bottom),w=this.bottom-p,T=P-E,x=C(t.top)+E,I=t.bottom;else if(o==="bottom")P=C(this.top),x=t.top,I=C(t.bottom)-E,w=P+E,T=this.top+p;else if(o==="left")P=C(this.right),N=this.right-p,y=P-E,A=C(t.left)+E,S=t.right;else if(o==="right")P=C(this.left),A=t.left,S=C(t.right)-E,N=P+E,y=this.left+p;else if(e==="x"){if(o==="center")P=C((t.top+t.bottom)/2+.5);else if(Z(o)){const ot=Object.keys(o)[0],ut=o[ot];P=C(this.chart.scales[ot].getPixelForValue(ut))}x=t.top,I=t.bottom,w=P+E,T=w+p}else if(e==="y"){if(o==="center")P=C((t.left+t.right)/2);else if(Z(o)){const ot=Object.keys(o)[0],ut=o[ot];P=C(this.chart.scales[ot].getPixelForValue(ut))}N=P-E,y=N-p,A=t.left,S=t.right}const nt=W(s.ticks.maxTicksLimit,d),K=Math.max(1,Math.ceil(d/nt));for(k=0;k<d;k+=K){const ot=this.getContext(k),ut=r.setContext(ot),Rt=a.setContext(ot),it=ut.lineWidth,Et=ut.color,yt=Rt.dash||[],Ae=Rt.dashOffset,We=ut.tickWidth,ee=ut.tickColor,Se=ut.tickBorderDash||[],re=ut.tickBorderDashOffset;M=a1(this,k,l),M!==void 0&&(O=Mn(i,M,it),u?N=y=A=S=O:w=T=x=I=O,m.push({tx1:N,ty1:w,tx2:y,ty2:T,x1:A,y1:x,x2:S,y2:I,width:it,color:Et,borderDash:yt,borderDashOffset:Ae,tickWidth:We,tickColor:ee,tickBorderDash:Se,tickBorderDashOffset:re}))}return this._ticksLength=d,this._borderValue=P,m}_computeLabelItems(t){const e=this.axis,i=this.options,{position:s,ticks:r}=i,o=this.isHorizontal(),a=this.ticks,{align:l,crossAlign:u,padding:h,mirror:d}=r,p=as(i.grid),m=p+h,b=d?-h:m,v=-ce(this.labelRotation),E=[];let C,P,k,M,O,N,w,y,T,A,x,S,I="middle";if(s==="top")N=this.bottom-b,w=this._getXAxisLabelAlignment();else if(s==="bottom")N=this.top+b,w=this._getXAxisLabelAlignment();else if(s==="left"){const K=this._getYAxisLabelAlignment(p);w=K.textAlign,O=K.x}else if(s==="right"){const K=this._getYAxisLabelAlignment(p);w=K.textAlign,O=K.x}else if(e==="x"){if(s==="center")N=(t.top+t.bottom)/2+m;else if(Z(s)){const K=Object.keys(s)[0],ot=s[K];N=this.chart.scales[K].getPixelForValue(ot)+m}w=this._getXAxisLabelAlignment()}else if(e==="y"){if(s==="center")O=(t.left+t.right)/2-m;else if(Z(s)){const K=Object.keys(s)[0],ot=s[K];O=this.chart.scales[K].getPixelForValue(ot)}w=this._getYAxisLabelAlignment(p).textAlign}e==="y"&&(l==="start"?I="top":l==="end"&&(I="bottom"));const nt=this._getLabelSizes();for(C=0,P=a.length;C<P;++C){k=a[C],M=k.label;const K=r.setContext(this.getContext(C));y=this.getPixelForTick(C)+r.labelOffset,T=this._resolveTickFontOptions(C),A=T.lineHeight,x=pt(M)?M.length:1;const ot=x/2,ut=K.color,Rt=K.textStrokeColor,it=K.textStrokeWidth;let Et=w;o?(O=y,w==="inner"&&(C===P-1?Et=this.options.reverse?"left":"right":C===0?Et=this.options.reverse?"right":"left":Et="center"),s==="top"?u==="near"||v!==0?S=-x*A+A/2:u==="center"?S=-nt.highest.height/2-ot*A+A:S=-nt.highest.height+A/2:u==="near"||v!==0?S=A/2:u==="center"?S=nt.highest.height/2-ot*A:S=nt.highest.height-x*A,d&&(S*=-1),v!==0&&!K.showLabelBackdrop&&(O+=A/2*Math.sin(v))):(N=y,S=(1-x)*A/2);let yt;if(K.showLabelBackdrop){const Ae=qt(K.backdropPadding),We=nt.heights[C],ee=nt.widths[C];let Se=S-Ae.top,re=0-Ae.left;switch(I){case"middle":Se-=We/2;break;case"bottom":Se-=We;break}switch(w){case"center":re-=ee/2;break;case"right":re-=ee;break;case"inner":C===P-1?re-=ee:C>0&&(re-=ee/2);break}yt={left:re,top:Se,width:ee+Ae.width,height:We+Ae.height,color:K.backdropColor}}E.push({label:M,font:T,textOffset:S,options:{rotation:v,color:ut,strokeColor:Rt,strokeWidth:it,textAlign:Et,textBaseline:I,translation:[O,N],backdrop:yt}})}return E}_getXAxisLabelAlignment(){const{position:t,ticks:e}=this.options;if(-ce(this.labelRotation))return t==="top"?"left":"right";let s="center";return e.align==="start"?s="left":e.align==="end"?s="right":e.align==="inner"&&(s="inner"),s}_getYAxisLabelAlignment(t){const{position:e,ticks:{crossAlign:i,mirror:s,padding:r}}=this.options,o=this._getLabelSizes(),a=t+r,l=o.widest.width;let u,h;return e==="left"?s?(h=this.right+r,i==="near"?u="left":i==="center"?(u="center",h+=l/2):(u="right",h+=l)):(h=this.right-a,i==="near"?u="right":i==="center"?(u="center",h-=l/2):(u="left",h=this.left)):e==="right"?s?(h=this.left+r,i==="near"?u="right":i==="center"?(u="center",h-=l/2):(u="left",h-=l)):(h=this.left+a,i==="near"?u="left":i==="center"?(u="center",h+=l/2):(u="right",h=this.right)):u="right",{textAlign:u,x:h}}_computeLabelArea(){if(this.options.ticks.mirror)return;const t=this.chart,e=this.options.position;if(e==="left"||e==="right")return{top:0,left:this.left,bottom:t.height,right:this.right};if(e==="top"||e==="bottom")return{top:this.top,left:0,bottom:this.bottom,right:t.width}}drawBackground(){const{ctx:t,options:{backgroundColor:e},left:i,top:s,width:r,height:o}=this;e&&(t.save(),t.fillStyle=e,t.fillRect(i,s,r,o),t.restore())}getLineWidthForValue(t){const e=this.options.grid;if(!this._isVisible()||!e.display)return 0;const s=this.ticks.findIndex(r=>r.value===t);return s>=0?e.setContext(this.getContext(s)).lineWidth:0}drawGrid(t){const e=this.options.grid,i=this.ctx,s=this._gridLineItems||(this._gridLineItems=this._computeGridLineItems(t));let r,o;const a=(l,u,h)=>{!h.width||!h.color||(i.save(),i.lineWidth=h.width,i.strokeStyle=h.color,i.setLineDash(h.borderDash||[]),i.lineDashOffset=h.borderDashOffset,i.beginPath(),i.moveTo(l.x,l.y),i.lineTo(u.x,u.y),i.stroke(),i.restore())};if(e.display)for(r=0,o=s.length;r<o;++r){const l=s[r];e.drawOnChartArea&&a({x:l.x1,y:l.y1},{x:l.x2,y:l.y2},l),e.drawTicks&&a({x:l.tx1,y:l.ty1},{x:l.tx2,y:l.ty2},{color:l.tickColor,width:l.tickWidth,borderDash:l.tickBorderDash,borderDashOffset:l.tickBorderDashOffset})}}drawBorder(){const{chart:t,ctx:e,options:{border:i,grid:s}}=this,r=i.setContext(this.getContext()),o=i.display?r.width:0;if(!o)return;const a=s.setContext(this.getContext(0)).lineWidth,l=this._borderValue;let u,h,d,p;this.isHorizontal()?(u=Mn(t,this.left,o)-o/2,h=Mn(t,this.right,a)+a/2,d=p=l):(d=Mn(t,this.top,o)-o/2,p=Mn(t,this.bottom,a)+a/2,u=h=l),e.save(),e.lineWidth=r.width,e.strokeStyle=r.color,e.beginPath(),e.moveTo(u,d),e.lineTo(h,p),e.stroke(),e.restore()}drawLabels(t){if(!this.options.ticks.display)return;const i=this.ctx,s=this._computeLabelArea();s&&qo(i,s);const r=this.getLabelItems(t);for(const o of r){const a=o.options,l=o.font,u=o.label,h=o.textOffset;Jn(i,u,0,h,l,a)}s&&Go(i)}drawTitle(){const{ctx:t,options:{position:e,title:i,reverse:s}}=this;if(!i.display)return;const r=Ct(i.font),o=qt(i.padding),a=i.align;let l=r.lineHeight/2;e==="bottom"||e==="center"||Z(e)?(l+=o.bottom,pt(i.text)&&(l+=r.lineHeight*(i.text.length-1))):l+=o.top;const{titleX:u,titleY:h,maxWidth:d,rotation:p}=d1(this,l,e,a);Jn(t,i.text,0,0,r,{color:i.color,maxWidth:d,rotation:p,textAlign:h1(a,e,s),textBaseline:"middle",translation:[u,h]})}draw(t){this._isVisible()&&(this.drawBackground(),this.drawGrid(t),this.drawBorder(),this.drawTitle(),this.drawLabels(t))}_layers(){const t=this.options,e=t.ticks&&t.ticks.z||0,i=W(t.grid&&t.grid.z,-1),s=W(t.border&&t.border.z,0);return!this._isVisible()||this.draw!==si.prototype.draw?[{z:e,draw:r=>{this.draw(r)}}]:[{z:i,draw:r=>{this.drawBackground(),this.drawGrid(r),this.drawTitle()}},{z:s,draw:()=>{this.drawBorder()}},{z:e,draw:r=>{this.drawLabels(r)}}]}getMatchingVisibleMetas(t){const e=this.chart.getSortedVisibleDatasetMetas(),i=this.axis+"AxisID",s=[];let r,o;for(r=0,o=e.length;r<o;++r){const a=e[r];a[i]===this.id&&(!t||a.type===t)&&s.push(a)}return s}_resolveTickFontOptions(t){const e=this.options.ticks.setContext(this.getContext(t));return Ct(e.font)}_maxDigits(){const t=this._resolveTickFontOptions(0).lineHeight;return(this.isHorizontal()?this.width:this.height)/t}}class Vr{constructor(t,e,i){this.type=t,this.scope=e,this.override=i,this.items=Object.create(null)}isForType(t){return Object.prototype.isPrototypeOf.call(this.type.prototype,t.prototype)}register(t){const e=Object.getPrototypeOf(t);let i;g1(e)&&(i=this.register(e));const s=this.items,r=t.id,o=this.scope+"."+r;if(!r)throw new Error("class does not have id: "+t);return r in s||(s[r]=t,f1(t,o,i),this.override&&gt.override(t.id,t.overrides)),o}get(t){return this.items[t]}unregister(t){const e=this.items,i=t.id,s=this.scope;i in e&&delete e[i],s&&i in gt[s]&&(delete gt[s][i],this.override&&delete Qn[i])}}function f1(n,t,e){const i=Us(Object.create(null),[e?gt.get(e):{},gt.get(t),n.defaults]);gt.set(t,i),n.defaultRoutes&&p1(t,n.defaultRoutes),n.descriptors&&gt.describe(t,n.descriptors)}function p1(n,t){Object.keys(t).forEach(e=>{const i=e.split("."),s=i.pop(),r=[n].concat(i).join("."),o=t[e].split("."),a=o.pop(),l=o.join(".");gt.route(r,s,l,a)})}function g1(n){return"id"in n&&"defaults"in n}class m1{constructor(){this.controllers=new Vr(An,"datasets",!0),this.elements=new Vr(He,"elements"),this.plugins=new Vr(Object,"plugins"),this.scales=new Vr(si,"scales"),this._typedRegistries=[this.controllers,this.scales,this.elements]}add(...t){this._each("register",t)}remove(...t){this._each("unregister",t)}addControllers(...t){this._each("register",t,this.controllers)}addElements(...t){this._each("register",t,this.elements)}addPlugins(...t){this._each("register",t,this.plugins)}addScales(...t){this._each("register",t,this.scales)}getController(t){return this._get(t,this.controllers,"controller")}getElement(t){return this._get(t,this.elements,"element")}getPlugin(t){return this._get(t,this.plugins,"plugin")}getScale(t){return this._get(t,this.scales,"scale")}removeControllers(...t){this._each("unregister",t,this.controllers)}removeElements(...t){this._each("unregister",t,this.elements)}removePlugins(...t){this._each("unregister",t,this.plugins)}removeScales(...t){this._each("unregister",t,this.scales)}_each(t,e,i){[...e].forEach(s=>{const r=i||this._getRegistryForType(s);i||r.isForType(s)||r===this.plugins&&s.id?this._exec(t,r,s):rt(s,o=>{const a=i||this._getRegistryForType(o);this._exec(t,a,o)})})}_exec(t,e,i){const s=Oc(t);lt(i["before"+s],[],i),e[t](i),lt(i["after"+s],[],i)}_getRegistryForType(t){for(let e=0;e<this._typedRegistries.length;e++){const i=this._typedRegistries[e];if(i.isForType(t))return i}return this.plugins}_get(t,e,i){const s=e.get(t);if(s===void 0)throw new Error('"'+t+'" is not a registered '+i+".");return s}}var ge=new m1;class y1{constructor(){this._init=void 0}notify(t,e,i,s){if(e==="beforeInit"&&(this._init=this._createDescriptors(t,!0),this._notify(this._init,t,"install")),this._init===void 0)return;const r=s?this._descriptors(t).filter(s):this._descriptors(t),o=this._notify(r,t,e,i);return e==="afterDestroy"&&(this._notify(r,t,"stop"),this._notify(this._init,t,"uninstall"),this._init=void 0),o}_notify(t,e,i,s){s=s||{};for(const r of t){const o=r.plugin,a=o[i],l=[e,s,r.options];if(lt(a,l,o)===!1&&s.cancelable)return!1}return!0}invalidate(){Y(this._cache)||(this._oldCache=this._cache,this._cache=void 0)}_descriptors(t){if(this._cache)return this._cache;const e=this._cache=this._createDescriptors(t);return this._notifyStateChanges(t),e}_createDescriptors(t,e){const i=t&&t.config,s=W(i.options&&i.options.plugins,{}),r=_1(i);return s===!1&&!e?[]:v1(t,r,s,e)}_notifyStateChanges(t){const e=this._oldCache||[],i=this._cache,s=(r,o)=>r.filter(a=>!o.some(l=>a.plugin.id===l.plugin.id));this._notify(s(e,i),t,"stop"),this._notify(s(i,e),t,"start")}}function _1(n){const t={},e=[],i=Object.keys(ge.plugins.items);for(let r=0;r<i.length;r++)e.push(ge.getPlugin(i[r]));const s=n.plugins||[];for(let r=0;r<s.length;r++){const o=s[r];e.indexOf(o)===-1&&(e.push(o),t[o.id]=!0)}return{plugins:e,localIds:t}}function b1(n,t){return!t&&n===!1?null:n===!0?{}:n}function v1(n,{plugins:t,localIds:e},i,s){const r=[],o=n.getContext();for(const a of t){const l=a.id,u=b1(i[l],s);u!==null&&r.push({plugin:a,options:w1(n.config,{plugin:a,local:e[l]},u,o)})}return r}function w1(n,{plugin:t,local:e},i,s){const r=n.pluginScopeKeys(t),o=n.getOptionScopes(i,r);return e&&t.defaults&&o.push(t.defaults),n.createResolver(o,s,[""],{scriptable:!1,indexable:!1,allKeys:!0})}function kl(n,t){const e=gt.datasets[n]||{};return((t.datasets||{})[n]||{}).indexAxis||t.indexAxis||e.indexAxis||"x"}function E1(n,t){let e=n;return n==="_index_"?e=t:n==="_value_"&&(e=t==="x"?"y":"x"),e}function T1(n,t){return n===t?"_index_":"_value_"}function cf(n){if(n==="x"||n==="y"||n==="r")return n}function x1(n){if(n==="top"||n==="bottom")return"x";if(n==="left"||n==="right")return"y"}function Dl(n,...t){if(cf(n))return n;for(const e of t){const i=e.axis||x1(e.position)||n.length>1&&cf(n[0].toLowerCase());if(i)return i}throw new Error(`Cannot determine type of '${n}' axis. Please provide 'axis' or 'position' option.`)}function uf(n,t,e){if(e[t+"AxisID"]===n)return{axis:t}}function I1(n,t){if(t.data&&t.data.datasets){const e=t.data.datasets.filter(i=>i.xAxisID===n||i.yAxisID===n);if(e.length)return uf(n,"x",e[0])||uf(n,"y",e[0])}return{}}function A1(n,t){const e=Qn[n.type]||{scales:{}},i=t.scales||{},s=kl(n.type,t),r=Object.create(null);return Object.keys(i).forEach(o=>{const a=i[o];if(!Z(a))return console.error(`Invalid scale configuration for scale: ${o}`);if(a._proxy)return console.warn(`Ignoring resolver passed as options for scale: ${o}`);const l=Dl(o,a,I1(o,n),gt.scales[a.type]),u=T1(l,s),h=e.scales||{};r[o]=Ts(Object.create(null),[{axis:l},a,h[l],h[u]])}),n.data.datasets.forEach(o=>{const a=o.type||n.type,l=o.indexAxis||kl(a,t),h=(Qn[a]||{}).scales||{};Object.keys(h).forEach(d=>{const p=E1(d,l),m=o[p+"AxisID"]||p;r[m]=r[m]||Object.create(null),Ts(r[m],[{axis:p},i[m],h[d]])})}),Object.keys(r).forEach(o=>{const a=r[o];Ts(a,[gt.scales[a.type],gt.scale])}),r}function ty(n){const t=n.options||(n.options={});t.plugins=W(t.plugins,{}),t.scales=A1(n,t)}function ey(n){return n=n||{},n.datasets=n.datasets||[],n.labels=n.labels||[],n}function S1(n){return n=n||{},n.data=ey(n.data),ty(n),n}const hf=new Map,ny=new Set;function Lr(n,t){let e=hf.get(n);return e||(e=t(),hf.set(n,e),ny.add(e)),e}const ls=(n,t,e)=>{const i=En(t,e);i!==void 0&&n.add(i)};class C1{constructor(t){this._config=S1(t),this._scopeCache=new Map,this._resolverCache=new Map}get platform(){return this._config.platform}get type(){return this._config.type}set type(t){this._config.type=t}get data(){return this._config.data}set data(t){this._config.data=ey(t)}get options(){return this._config.options}set options(t){this._config.options=t}get plugins(){return this._config.plugins}update(){const t=this._config;this.clearCache(),ty(t)}clearCache(){this._scopeCache.clear(),this._resolverCache.clear()}datasetScopeKeys(t){return Lr(t,()=>[[`datasets.${t}`,""]])}datasetAnimationScopeKeys(t,e){return Lr(`${t}.transition.${e}`,()=>[[`datasets.${t}.transitions.${e}`,`transitions.${e}`],[`datasets.${t}`,""]])}datasetElementScopeKeys(t,e){return Lr(`${t}-${e}`,()=>[[`datasets.${t}.elements.${e}`,`datasets.${t}`,`elements.${e}`,""]])}pluginScopeKeys(t){const e=t.id,i=this.type;return Lr(`${i}-plugin-${e}`,()=>[[`plugins.${e}`,...t.additionalOptionScopes||[]]])}_cachedScopes(t,e){const i=this._scopeCache;let s=i.get(t);return(!s||e)&&(s=new Map,i.set(t,s)),s}getOptionScopes(t,e,i){const{options:s,type:r}=this,o=this._cachedScopes(t,i),a=o.get(e);if(a)return a;const l=new Set;e.forEach(h=>{t&&(l.add(t),h.forEach(d=>ls(l,t,d))),h.forEach(d=>ls(l,s,d)),h.forEach(d=>ls(l,Qn[r]||{},d)),h.forEach(d=>ls(l,gt,d)),h.forEach(d=>ls(l,Pl,d))});const u=Array.from(l);return u.length===0&&u.push(Object.create(null)),ny.has(e)&&o.set(e,u),u}chartOptionScopes(){const{options:t,type:e}=this;return[t,Qn[e]||{},gt.datasets[e]||{},{type:e},gt,Pl]}resolveNamedOptions(t,e,i,s=[""]){const r={$shared:!0},{resolver:o,subPrefixes:a}=df(this._resolverCache,t,s);let l=o;if(R1(o,e)){r.$shared=!1,i=Tn(i)?i():i;const u=this.createResolver(t,i,a);l=ki(o,i,u)}for(const u of e)r[u]=l[u];return r}createResolver(t,e,i=[""],s){const{resolver:r}=df(this._resolverCache,t,i);return Z(e)?ki(r,e,void 0,s):r}}function df(n,t,e){let i=n.get(t);i||(i=new Map,n.set(t,i));const s=e.join();let r=i.get(s);return r||(r={resolver:Uc(t,e),subPrefixes:e.filter(a=>!a.toLowerCase().includes("hover"))},i.set(s,r)),r}const P1=n=>Z(n)&&Object.getOwnPropertyNames(n).some(t=>Tn(n[t]));function R1(n,t){const{isScriptable:e,isIndexable:i}=Mm(n);for(const s of t){const r=e(s),o=i(s),a=(o||r)&&n[s];if(r&&(Tn(a)||P1(a))||o&&pt(a))return!0}return!1}var k1="4.5.1";const D1=["top","bottom","left","right","chartArea"];function ff(n,t){return n==="top"||n==="bottom"||D1.indexOf(n)===-1&&t==="x"}function pf(n,t){return function(e,i){return e[n]===i[n]?e[t]-i[t]:e[n]-i[n]}}function gf(n){const t=n.chart,e=t.options.animation;t.notifyPlugins("afterRender"),lt(e&&e.onComplete,[n],t)}function M1(n){const t=n.chart,e=t.options.animation;lt(e&&e.onProgress,[n],t)}function iy(n){return jc()&&typeof n=="string"?n=document.getElementById(n):n&&n.length&&(n=n[0]),n&&n.canvas&&(n=n.canvas),n}const Qr={},mf=n=>{const t=iy(n);return Object.values(Qr).filter(e=>e.canvas===t).pop()};function O1(n,t,e){const i=Object.keys(n);for(const s of i){const r=+s;if(r>=t){const o=n[s];delete n[s],(e>0||r>t)&&(n[r+e]=o)}}}function V1(n,t,e,i){return!e||n.type==="mouseout"?null:i?t:n}class Zn{static defaults=gt;static instances=Qr;static overrides=Qn;static registry=ge;static version=k1;static getChart=mf;static register(...t){ge.add(...t),yf()}static unregister(...t){ge.remove(...t),yf()}constructor(t,e){const i=this.config=new C1(e),s=iy(t),r=mf(s);if(r)throw new Error("Canvas is already in use. Chart with ID '"+r.id+"' must be destroyed before the canvas with ID '"+r.canvas.id+"' can be reused.");const o=i.createResolver(i.chartOptionScopes(),this.getContext());this.platform=new(i.platform||ZA(s)),this.platform.updateConfig(i);const a=this.platform.acquireContext(s,o.aspectRatio),l=a&&a.canvas,u=l&&l.height,h=l&&l.width;if(this.id=Rx(),this.ctx=a,this.canvas=l,this.width=h,this.height=u,this._options=o,this._aspectRatio=this.aspectRatio,this._layers=[],this._metasets=[],this._stacks=void 0,this.boxes=[],this.currentDevicePixelRatio=void 0,this.chartArea=void 0,this._active=[],this._lastEvent=void 0,this._listeners={},this._responsiveListeners=void 0,this._sortedMetasets=[],this.scales={},this._plugins=new y1,this.$proxies={},this._hiddenIndices={},this.attached=!1,this._animationsDisabled=void 0,this.$context=void 0,this._doResize=Gx(d=>this.update(d),o.resizeDelay||0),this._dataChanges=[],Qr[this.id]=this,!a||!l){console.error("Failed to create chart: can't acquire context from the given item");return}Pe.listen(this,"complete",gf),Pe.listen(this,"progress",M1),this._initialize(),this.attached&&this.update()}get aspectRatio(){const{options:{aspectRatio:t,maintainAspectRatio:e},width:i,height:s,_aspectRatio:r}=this;return Y(t)?e&&r?r:s?i/s:null:t}get data(){return this.config.data}set data(t){this.config.data=t}get options(){return this._options}set options(t){this.config.options=t}get registry(){return ge}_initialize(){return this.notifyPlugins("beforeInit"),this.options.responsive?this.resize():Fd(this,this.options.devicePixelRatio),this.bindEvents(),this.notifyPlugins("afterInit"),this}clear(){return Vd(this.canvas,this.ctx),this}stop(){return Pe.stop(this),this}resize(t,e){Pe.running(this)?this._resizeBeforeDraw={width:t,height:e}:this._resize(t,e)}_resize(t,e){const i=this.options,s=this.canvas,r=i.maintainAspectRatio&&this.aspectRatio,o=this.platform.getMaximumSize(s,t,e,r),a=i.devicePixelRatio||this.platform.getDevicePixelRatio(),l=this.width?"resize":"attach";this.width=o.width,this.height=o.height,this._aspectRatio=this.aspectRatio,Fd(this,a,!0)&&(this.notifyPlugins("resize",{size:o}),lt(i.onResize,[this,o],this),this.attached&&this._doResize(l)&&this.render())}ensureScalesHaveIDs(){const e=this.options.scales||{};rt(e,(i,s)=>{i.id=s})}buildOrUpdateScales(){const t=this.options,e=t.scales,i=this.scales,s=Object.keys(i).reduce((o,a)=>(o[a]=!1,o),{});let r=[];e&&(r=r.concat(Object.keys(e).map(o=>{const a=e[o],l=Dl(o,a),u=l==="r",h=l==="x";return{options:a,dposition:u?"chartArea":h?"bottom":"left",dtype:u?"radialLinear":h?"category":"linear"}}))),rt(r,o=>{const a=o.options,l=a.id,u=Dl(l,a),h=W(a.type,o.dtype);(a.position===void 0||ff(a.position,u)!==ff(o.dposition))&&(a.position=o.dposition),s[l]=!0;let d=null;if(l in i&&i[l].type===h)d=i[l];else{const p=ge.getScale(h);d=new p({id:l,type:h,ctx:this.ctx,chart:this}),i[d.id]=d}d.init(a,t)}),rt(s,(o,a)=>{o||delete i[a]}),rt(i,o=>{Ht.configure(this,o,o.options),Ht.addBox(this,o)})}_updateMetasets(){const t=this._metasets,e=this.data.datasets.length,i=t.length;if(t.sort((s,r)=>s.index-r.index),i>e){for(let s=e;s<i;++s)this._destroyDatasetMeta(s);t.splice(e,i-e)}this._sortedMetasets=t.slice(0).sort(pf("order","index"))}_removeUnreferencedMetasets(){const{_metasets:t,data:{datasets:e}}=this;t.length>e.length&&delete this._stacks,t.forEach((i,s)=>{e.filter(r=>r===i._dataset).length===0&&this._destroyDatasetMeta(s)})}buildOrUpdateControllers(){const t=[],e=this.data.datasets;let i,s;for(this._removeUnreferencedMetasets(),i=0,s=e.length;i<s;i++){const r=e[i];let o=this.getDatasetMeta(i);const a=r.type||this.config.type;if(o.type&&o.type!==a&&(this._destroyDatasetMeta(i),o=this.getDatasetMeta(i)),o.type=a,o.indexAxis=r.indexAxis||kl(a,this.options),o.order=r.order||0,o.index=i,o.label=""+r.label,o.visible=this.isDatasetVisible(i),o.controller)o.controller.updateIndex(i),o.controller.linkScales();else{const l=ge.getController(a),{datasetElementType:u,dataElementType:h}=gt.datasets[a];Object.assign(l,{dataElementType:ge.getElement(h),datasetElementType:u&&ge.getElement(u)}),o.controller=new l(this,i),t.push(o.controller)}}return this._updateMetasets(),t}_resetElements(){rt(this.data.datasets,(t,e)=>{this.getDatasetMeta(e).controller.reset()},this)}reset(){this._resetElements(),this.notifyPlugins("reset")}update(t){const e=this.config;e.update();const i=this._options=e.createResolver(e.chartOptionScopes(),this.getContext()),s=this._animationsDisabled=!i.animation;if(this._updateScales(),this._checkEventBindings(),this._updateHiddenIndices(),this._plugins.invalidate(),this.notifyPlugins("beforeUpdate",{mode:t,cancelable:!0})===!1)return;const r=this.buildOrUpdateControllers();this.notifyPlugins("beforeElementsUpdate");let o=0;for(let u=0,h=this.data.datasets.length;u<h;u++){const{controller:d}=this.getDatasetMeta(u),p=!s&&r.indexOf(d)===-1;d.buildOrUpdateElements(p),o=Math.max(+d.getMaxOverflow(),o)}o=this._minPadding=i.layout.autoPadding?o:0,this._updateLayout(o),s||rt(r,u=>{u.reset()}),this._updateDatasets(t),this.notifyPlugins("afterUpdate",{mode:t}),this._layers.sort(pf("z","_idx"));const{_active:a,_lastEvent:l}=this;l?this._eventHandler(l,!0):a.length&&this._updateHoverStyles(a,a,!0),this.render()}_updateScales(){rt(this.scales,t=>{Ht.removeBox(this,t)}),this.ensureScalesHaveIDs(),this.buildOrUpdateScales()}_checkEventBindings(){const t=this.options,e=new Set(Object.keys(this._listeners)),i=new Set(t.events);(!Ad(e,i)||!!this._responsiveListeners!==t.responsive)&&(this.unbindEvents(),this.bindEvents())}_updateHiddenIndices(){const{_hiddenIndices:t}=this,e=this._getUniformDataChanges()||[];for(const{method:i,start:s,count:r}of e){const o=i==="_removeElements"?-r:r;O1(t,s,o)}}_getUniformDataChanges(){const t=this._dataChanges;if(!t||!t.length)return;this._dataChanges=[];const e=this.data.datasets.length,i=r=>new Set(t.filter(o=>o[0]===r).map((o,a)=>a+","+o.splice(1).join(","))),s=i(0);for(let r=1;r<e;r++)if(!Ad(s,i(r)))return;return Array.from(s).map(r=>r.split(",")).map(r=>({method:r[1],start:+r[2],count:+r[3]}))}_updateLayout(t){if(this.notifyPlugins("beforeLayout",{cancelable:!0})===!1)return;Ht.update(this,this.width,this.height,t);const e=this.chartArea,i=e.width<=0||e.height<=0;this._layers=[],rt(this.boxes,s=>{i&&s.position==="chartArea"||(s.configure&&s.configure(),this._layers.push(...s._layers()))},this),this._layers.forEach((s,r)=>{s._idx=r}),this.notifyPlugins("afterLayout")}_updateDatasets(t){if(this.notifyPlugins("beforeDatasetsUpdate",{mode:t,cancelable:!0})!==!1){for(let e=0,i=this.data.datasets.length;e<i;++e)this.getDatasetMeta(e).controller.configure();for(let e=0,i=this.data.datasets.length;e<i;++e)this._updateDataset(e,Tn(t)?t({datasetIndex:e}):t);this.notifyPlugins("afterDatasetsUpdate",{mode:t})}}_updateDataset(t,e){const i=this.getDatasetMeta(t),s={meta:i,index:t,mode:e,cancelable:!0};this.notifyPlugins("beforeDatasetUpdate",s)!==!1&&(i.controller._update(e),s.cancelable=!1,this.notifyPlugins("afterDatasetUpdate",s))}render(){this.notifyPlugins("beforeRender",{cancelable:!0})!==!1&&(Pe.has(this)?this.attached&&!Pe.running(this)&&Pe.start(this):(this.draw(),gf({chart:this})))}draw(){let t;if(this._resizeBeforeDraw){const{width:i,height:s}=this._resizeBeforeDraw;this._resizeBeforeDraw=null,this._resize(i,s)}if(this.clear(),this.width<=0||this.height<=0||this.notifyPlugins("beforeDraw",{cancelable:!0})===!1)return;const e=this._layers;for(t=0;t<e.length&&e[t].z<=0;++t)e[t].draw(this.chartArea);for(this._drawDatasets();t<e.length;++t)e[t].draw(this.chartArea);this.notifyPlugins("afterDraw")}_getSortedDatasetMetas(t){const e=this._sortedMetasets,i=[];let s,r;for(s=0,r=e.length;s<r;++s){const o=e[s];(!t||o.visible)&&i.push(o)}return i}getSortedVisibleDatasetMetas(){return this._getSortedDatasetMetas(!0)}_drawDatasets(){if(this.notifyPlugins("beforeDatasetsDraw",{cancelable:!0})===!1)return;const t=this.getSortedVisibleDatasetMetas();for(let e=t.length-1;e>=0;--e)this._drawDataset(t[e]);this.notifyPlugins("afterDatasetsDraw")}_drawDataset(t){const e=this.ctx,i={meta:t,index:t.index,cancelable:!0},s=Hm(this,t);this.notifyPlugins("beforeDatasetDraw",i)!==!1&&(s&&qo(e,s),t.controller.draw(),s&&Go(e),i.cancelable=!1,this.notifyPlugins("afterDatasetDraw",i))}isPointInArea(t){return Fe(t,this.chartArea,this._minPadding)}getElementsAtEventForMode(t,e,i,s){const r=DA.modes[e];return typeof r=="function"?r(this,t,i,s):[]}getDatasetMeta(t){const e=this.data.datasets[t],i=this._metasets;let s=i.filter(r=>r&&r._dataset===e).pop();return s||(s={type:null,data:[],dataset:null,controller:null,hidden:null,xAxisID:null,yAxisID:null,order:e&&e.order||0,index:t,_dataset:e,_parsed:[],_sorted:!1},i.push(s)),s}getContext(){return this.$context||(this.$context=In(null,{chart:this,type:"chart"}))}getVisibleDatasetCount(){return this.getSortedVisibleDatasetMetas().length}isDatasetVisible(t){const e=this.data.datasets[t];if(!e)return!1;const i=this.getDatasetMeta(t);return typeof i.hidden=="boolean"?!i.hidden:!e.hidden}setDatasetVisibility(t,e){const i=this.getDatasetMeta(t);i.hidden=!e}toggleDataVisibility(t){this._hiddenIndices[t]=!this._hiddenIndices[t]}getDataVisibility(t){return!this._hiddenIndices[t]}_updateVisibility(t,e,i){const s=i?"show":"hide",r=this.getDatasetMeta(t),o=r.controller._resolveAnimations(void 0,s);zs(e)?(r.data[e].hidden=!i,this.update()):(this.setDatasetVisibility(t,i),o.update(r,{visible:i}),this.update(a=>a.datasetIndex===t?s:void 0))}hide(t,e){this._updateVisibility(t,e,!1)}show(t,e){this._updateVisibility(t,e,!0)}_destroyDatasetMeta(t){const e=this._metasets[t];e&&e.controller&&e.controller._destroy(),delete this._metasets[t]}_stop(){let t,e;for(this.stop(),Pe.remove(this),t=0,e=this.data.datasets.length;t<e;++t)this._destroyDatasetMeta(t)}destroy(){this.notifyPlugins("beforeDestroy");const{canvas:t,ctx:e}=this;this._stop(),this.config.clearCache(),t&&(this.unbindEvents(),Vd(t,e),this.platform.releaseContext(e),this.canvas=null,this.ctx=null),delete Qr[this.id],this.notifyPlugins("afterDestroy")}toBase64Image(...t){return this.canvas.toDataURL(...t)}bindEvents(){this.bindUserEvents(),this.options.responsive?this.bindResponsiveEvents():this.attached=!0}bindUserEvents(){const t=this._listeners,e=this.platform,i=(r,o)=>{e.addEventListener(this,r,o),t[r]=o},s=(r,o,a)=>{r.offsetX=o,r.offsetY=a,this._eventHandler(r)};rt(this.options.events,r=>i(r,s))}bindResponsiveEvents(){this._responsiveListeners||(this._responsiveListeners={});const t=this._responsiveListeners,e=this.platform,i=(l,u)=>{e.addEventListener(this,l,u),t[l]=u},s=(l,u)=>{t[l]&&(e.removeEventListener(this,l,u),delete t[l])},r=(l,u)=>{this.canvas&&this.resize(l,u)};let o;const a=()=>{s("attach",a),this.attached=!0,this.resize(),i("resize",r),i("detach",o)};o=()=>{this.attached=!1,s("resize",r),this._stop(),this._resize(0,0),i("attach",a)},e.isAttached(this.canvas)?a():o()}unbindEvents(){rt(this._listeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._listeners={},rt(this._responsiveListeners,(t,e)=>{this.platform.removeEventListener(this,e,t)}),this._responsiveListeners=void 0}updateHoverStyle(t,e,i){const s=i?"set":"remove";let r,o,a,l;for(e==="dataset"&&(r=this.getDatasetMeta(t[0].datasetIndex),r.controller["_"+s+"DatasetHoverStyle"]()),a=0,l=t.length;a<l;++a){o=t[a];const u=o&&this.getDatasetMeta(o.datasetIndex).controller;u&&u[s+"HoverStyle"](o.element,o.datasetIndex,o.index)}}getActiveElements(){return this._active||[]}setActiveElements(t){const e=this._active||[],i=t.map(({datasetIndex:r,index:o})=>{const a=this.getDatasetMeta(r);if(!a)throw new Error("No dataset found at index "+r);return{datasetIndex:r,element:a.data[o],index:o}});!vo(i,e)&&(this._active=i,this._lastEvent=null,this._updateHoverStyles(i,e))}notifyPlugins(t,e,i){return this._plugins.notify(this,t,e,i)}isPluginEnabled(t){return this._plugins._cache.filter(e=>e.plugin.id===t).length===1}_updateHoverStyles(t,e,i){const s=this.options.hover,r=(l,u)=>l.filter(h=>!u.some(d=>h.datasetIndex===d.datasetIndex&&h.index===d.index)),o=r(e,t),a=i?t:r(t,e);o.length&&this.updateHoverStyle(o,s.mode,!1),a.length&&s.mode&&this.updateHoverStyle(a,s.mode,!0)}_eventHandler(t,e){const i={event:t,replay:e,cancelable:!0,inChartArea:this.isPointInArea(t)},s=o=>(o.options.events||this.options.events).includes(t.native.type);if(this.notifyPlugins("beforeEvent",i,s)===!1)return;const r=this._handleEvent(t,e,i.inChartArea);return i.cancelable=!1,this.notifyPlugins("afterEvent",i,s),(r||i.changed)&&this.render(),this}_handleEvent(t,e,i){const{_active:s=[],options:r}=this,o=e,a=this._getActiveElements(t,s,i,o),l=Lx(t),u=V1(t,this._lastEvent,i,l);i&&(this._lastEvent=null,lt(r.onHover,[t,a,this],this),l&&lt(r.onClick,[t,a,this],this));const h=!vo(a,s);return(h||e)&&(this._active=a,this._updateHoverStyles(a,s,e)),this._lastEvent=u,h}_getActiveElements(t,e,i,s){if(t.type==="mouseout")return[];if(!i)return e;const r=this.options.hover;return this.getElementsAtEventForMode(t,r.mode,r,s)}}function yf(){return rt(Zn.instances,n=>n._plugins.invalidate())}function L1(n,t,e){const{startAngle:i,x:s,y:r,outerRadius:o,innerRadius:a,options:l}=t,{borderWidth:u,borderJoinStyle:h}=l,d=Math.min(u/o,zt(i-e));if(n.beginPath(),n.arc(s,r,o-u/2,i+d/2,e-d/2),a>0){const p=Math.min(u/a,zt(i-e));n.arc(s,r,a+u/2,e-p/2,i+p/2,!0)}else{const p=Math.min(u/2,o*zt(i-e));if(h==="round")n.arc(s,r,p,e-et/2,i+et/2,!0);else if(h==="bevel"){const m=2*p*p,b=-m*Math.cos(e+et/2)+s,v=-m*Math.sin(e+et/2)+r,E=m*Math.cos(i+et/2)+s,C=m*Math.sin(i+et/2)+r;n.lineTo(b,v),n.lineTo(E,C)}}n.closePath(),n.moveTo(0,0),n.rect(0,0,n.canvas.width,n.canvas.height),n.clip("evenodd")}function N1(n,t,e){const{startAngle:i,pixelMargin:s,x:r,y:o,outerRadius:a,innerRadius:l}=t;let u=s/a;n.beginPath(),n.arc(r,o,a,i-u,e+u),l>s?(u=s/l,n.arc(r,o,l,e+u,i-u,!0)):n.arc(r,o,s,e+wt,i-wt),n.closePath(),n.clip()}function F1(n){return Bc(n,["outerStart","outerEnd","innerStart","innerEnd"])}function B1(n,t,e,i){const s=F1(n.options.borderRadius),r=(e-t)/2,o=Math.min(r,i*t/2),a=l=>{const u=(e-Math.min(r,l))*i/2;return Mt(l,0,Math.min(r,u))};return{outerStart:a(s.outerStart),outerEnd:a(s.outerEnd),innerStart:Mt(s.innerStart,0,o),innerEnd:Mt(s.innerEnd,0,o)}}function ci(n,t,e,i){return{x:e+n*Math.cos(t),y:i+n*Math.sin(t)}}function Ao(n,t,e,i,s,r){const{x:o,y:a,startAngle:l,pixelMargin:u,innerRadius:h}=t,d=Math.max(t.outerRadius+i+e-u,0),p=h>0?h+i+e+u:0;let m=0;const b=s-l;if(i){const K=h>0?h-i:0,ot=d>0?d-i:0,ut=(K+ot)/2,Rt=ut!==0?b*ut/(ut+i):b;m=(b-Rt)/2}const v=Math.max(.001,b*d-e/et)/d,E=(b-v)/2,C=l+E+m,P=s-E-m,{outerStart:k,outerEnd:M,innerStart:O,innerEnd:N}=B1(t,p,d,P-C),w=d-k,y=d-M,T=C+k/w,A=P-M/y,x=p+O,S=p+N,I=C+O/x,nt=P-N/S;if(n.beginPath(),r){const K=(T+A)/2;if(n.arc(o,a,d,T,K),n.arc(o,a,d,K,A),M>0){const it=ci(y,A,o,a);n.arc(it.x,it.y,M,A,P+wt)}const ot=ci(S,P,o,a);if(n.lineTo(ot.x,ot.y),N>0){const it=ci(S,nt,o,a);n.arc(it.x,it.y,N,P+wt,nt+Math.PI)}const ut=(P-N/p+(C+O/p))/2;if(n.arc(o,a,p,P-N/p,ut,!0),n.arc(o,a,p,ut,C+O/p,!0),O>0){const it=ci(x,I,o,a);n.arc(it.x,it.y,O,I+Math.PI,C-wt)}const Rt=ci(w,C,o,a);if(n.lineTo(Rt.x,Rt.y),k>0){const it=ci(w,T,o,a);n.arc(it.x,it.y,k,C-wt,T)}}else{n.moveTo(o,a);const K=Math.cos(T)*d+o,ot=Math.sin(T)*d+a;n.lineTo(K,ot);const ut=Math.cos(A)*d+o,Rt=Math.sin(A)*d+a;n.lineTo(ut,Rt)}n.closePath()}function U1(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a}=t;let l=t.endAngle;if(r){Ao(n,t,e,i,l,s);for(let u=0;u<r;++u)n.fill();isNaN(a)||(l=o+(a%ft||ft))}return Ao(n,t,e,i,l,s),n.fill(),l}function z1(n,t,e,i,s){const{fullCircles:r,startAngle:o,circumference:a,options:l}=t,{borderWidth:u,borderJoinStyle:h,borderDash:d,borderDashOffset:p,borderRadius:m}=l,b=l.borderAlign==="inner";if(!u)return;n.setLineDash(d||[]),n.lineDashOffset=p,b?(n.lineWidth=u*2,n.lineJoin=h||"round"):(n.lineWidth=u,n.lineJoin=h||"bevel");let v=t.endAngle;if(r){Ao(n,t,e,i,v,s);for(let E=0;E<r;++E)n.stroke();isNaN(a)||(v=o+(a%ft||ft))}b&&N1(n,t,v),l.selfJoin&&v-o>=et&&m===0&&h!=="miter"&&L1(n,t,v),r||(Ao(n,t,e,i,v,s),n.stroke())}class $1 extends He{static id="arc";static defaults={borderAlign:"center",borderColor:"#fff",borderDash:[],borderDashOffset:0,borderJoinStyle:void 0,borderRadius:0,borderWidth:2,offset:0,spacing:0,angle:void 0,circular:!0,selfJoin:!1};static defaultRoutes={backgroundColor:"backgroundColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"};circumference;endAngle;fullCircles;innerRadius;outerRadius;pixelMargin;startAngle;constructor(t){super(),this.options=void 0,this.circumference=void 0,this.startAngle=void 0,this.endAngle=void 0,this.innerRadius=void 0,this.outerRadius=void 0,this.pixelMargin=0,this.fullCircles=0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.getProps(["x","y"],i),{angle:r,distance:o}=Tm(s,{x:t,y:e}),{startAngle:a,endAngle:l,innerRadius:u,outerRadius:h,circumference:d}=this.getProps(["startAngle","endAngle","innerRadius","outerRadius","circumference"],i),p=(this.options.spacing+this.options.borderWidth)/2,m=W(d,l-a),b=$s(r,a,l)&&a!==l,v=m>=ft||b,E=Le(o,u+p,h+p);return v&&E}getCenterPoint(t){const{x:e,y:i,startAngle:s,endAngle:r,innerRadius:o,outerRadius:a}=this.getProps(["x","y","startAngle","endAngle","innerRadius","outerRadius"],t),{offset:l,spacing:u}=this.options,h=(s+r)/2,d=(o+a+u+l)/2;return{x:e+Math.cos(h)*d,y:i+Math.sin(h)*d}}tooltipPosition(t){return this.getCenterPoint(t)}draw(t){const{options:e,circumference:i}=this,s=(e.offset||0)/4,r=(e.spacing||0)/2,o=e.circular;if(this.pixelMargin=e.borderAlign==="inner"?.33:0,this.fullCircles=i>ft?Math.floor(i/ft):0,i===0||this.innerRadius<0||this.outerRadius<0)return;t.save();const a=(this.startAngle+this.endAngle)/2;t.translate(Math.cos(a)*s,Math.sin(a)*s);const l=1-Math.sin(Math.min(et,i||0)),u=s*l;t.fillStyle=e.backgroundColor,t.strokeStyle=e.borderColor,U1(t,this,u,r,o),z1(t,this,u,r,o),t.restore()}}function sy(n,t,e=t){n.lineCap=W(e.borderCapStyle,t.borderCapStyle),n.setLineDash(W(e.borderDash,t.borderDash)),n.lineDashOffset=W(e.borderDashOffset,t.borderDashOffset),n.lineJoin=W(e.borderJoinStyle,t.borderJoinStyle),n.lineWidth=W(e.borderWidth,t.borderWidth),n.strokeStyle=W(e.borderColor,t.borderColor)}function j1(n,t,e){n.lineTo(e.x,e.y)}function H1(n){return n.stepped?rI:n.tension||n.cubicInterpolationMode==="monotone"?oI:j1}function ry(n,t,e={}){const i=n.length,{start:s=0,end:r=i-1}=e,{start:o,end:a}=t,l=Math.max(s,o),u=Math.min(r,a),h=s<o&&r<o||s>a&&r>a;return{count:i,start:l,loop:t.loop,ilen:u<l&&!h?i+u-l:u-l}}function W1(n,t,e,i){const{points:s,options:r}=t,{count:o,start:a,loop:l,ilen:u}=ry(s,e,i),h=H1(r);let{move:d=!0,reverse:p}=i||{},m,b,v;for(m=0;m<=u;++m)b=s[(a+(p?u-m:m))%o],!b.skip&&(d?(n.moveTo(b.x,b.y),d=!1):h(n,v,b,p,r.stepped),v=b);return l&&(b=s[(a+(p?u:0))%o],h(n,v,b,p,r.stepped)),!!l}function q1(n,t,e,i){const s=t.points,{count:r,start:o,ilen:a}=ry(s,e,i),{move:l=!0,reverse:u}=i||{};let h=0,d=0,p,m,b,v,E,C;const P=M=>(o+(u?a-M:M))%r,k=()=>{v!==E&&(n.lineTo(h,E),n.lineTo(h,v),n.lineTo(h,C))};for(l&&(m=s[P(0)],n.moveTo(m.x,m.y)),p=0;p<=a;++p){if(m=s[P(p)],m.skip)continue;const M=m.x,O=m.y,N=M|0;N===b?(O<v?v=O:O>E&&(E=O),h=(d*h+M)/++d):(k(),n.lineTo(M,O),b=N,d=0,v=E=O),C=O}k()}function Ml(n){const t=n.options,e=t.borderDash&&t.borderDash.length;return!n._decimated&&!n._loop&&!t.tension&&t.cubicInterpolationMode!=="monotone"&&!t.stepped&&!e?q1:W1}function G1(n){return n.stepped?FI:n.tension||n.cubicInterpolationMode==="monotone"?BI:Fn}function K1(n,t,e,i){let s=t._path;s||(s=t._path=new Path2D,t.path(s,e,i)&&s.closePath()),sy(n,t.options),n.stroke(s)}function Y1(n,t,e,i){const{segments:s,options:r}=t,o=Ml(t);for(const a of s)sy(n,r,a.style),n.beginPath(),o(n,t,a,{start:e,end:e+i-1})&&n.closePath(),n.stroke()}const X1=typeof Path2D=="function";function Q1(n,t,e,i){X1&&!t.options.segment?K1(n,t,e,i):Y1(n,t,e,i)}class Xo extends He{static id="line";static defaults={borderCapStyle:"butt",borderDash:[],borderDashOffset:0,borderJoinStyle:"miter",borderWidth:3,capBezierPoints:!0,cubicInterpolationMode:"default",fill:!1,spanGaps:!1,stepped:!1,tension:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};static descriptors={_scriptable:!0,_indexable:t=>t!=="borderDash"&&t!=="fill"};constructor(t){super(),this.animated=!0,this.options=void 0,this._chart=void 0,this._loop=void 0,this._fullLoop=void 0,this._path=void 0,this._points=void 0,this._segments=void 0,this._decimated=!1,this._pointsUpdated=!1,this._datasetIndex=void 0,t&&Object.assign(this,t)}updateControlPoints(t,e){const i=this.options;if((i.tension||i.cubicInterpolationMode==="monotone")&&!i.stepped&&!this._pointsUpdated){const s=i.spanGaps?this._loop:this._fullLoop;RI(this._points,i,t,s,e),this._pointsUpdated=!0}}set points(t){this._points=t,delete this._segments,delete this._path,this._pointsUpdated=!1}get points(){return this._points}get segments(){return this._segments||(this._segments=WI(this,this.options.segment))}first(){const t=this.segments,e=this.points;return t.length&&e[t[0].start]}last(){const t=this.segments,e=this.points,i=t.length;return i&&e[t[i-1].end]}interpolate(t,e){const i=this.options,s=t[e],r=this.points,o=jm(this,{property:e,start:s,end:s});if(!o.length)return;const a=[],l=G1(i);let u,h;for(u=0,h=o.length;u<h;++u){const{start:d,end:p}=o[u],m=r[d],b=r[p];if(m===b){a.push(m);continue}const v=Math.abs((s-m[e])/(b[e]-m[e])),E=l(m,b,v,i.stepped);E[e]=t[e],a.push(E)}return a.length===1?a[0]:a}pathSegment(t,e,i){return Ml(this)(t,this,e,i)}path(t,e,i){const s=this.segments,r=Ml(this);let o=this._loop;e=e||0,i=i||this.points.length-e;for(const a of s)o&=r(t,this,a,{start:e,end:e+i-1});return!!o}draw(t,e,i,s){const r=this.options||{};(this.points||[]).length&&r.borderWidth&&(t.save(),Q1(t,this,i,s),t.restore()),this.animated&&(this._pointsUpdated=!1,this._path=void 0)}}function _f(n,t,e,i){const s=n.options,{[e]:r}=n.getProps([e],i);return Math.abs(t-r)<s.radius+s.hitRadius}class J1 extends He{static id="point";parsed;skip;stop;static defaults={borderWidth:1,hitRadius:1,hoverBorderWidth:1,hoverRadius:4,pointStyle:"circle",radius:3,rotation:0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.parsed=void 0,this.skip=void 0,this.stop=void 0,t&&Object.assign(this,t)}inRange(t,e,i){const s=this.options,{x:r,y:o}=this.getProps(["x","y"],i);return Math.pow(t-r,2)+Math.pow(e-o,2)<Math.pow(s.hitRadius+s.radius,2)}inXRange(t,e){return _f(this,t,"x",e)}inYRange(t,e){return _f(this,t,"y",e)}getCenterPoint(t){const{x:e,y:i}=this.getProps(["x","y"],t);return{x:e,y:i}}size(t){t=t||this.options||{};let e=t.radius||0;e=Math.max(e,e&&t.hoverRadius||0);const i=e&&t.borderWidth||0;return(e+i)*2}draw(t,e){const i=this.options;this.skip||i.radius<.1||!Fe(this,e,this.size(i)/2)||(t.strokeStyle=i.borderColor,t.lineWidth=i.borderWidth,t.fillStyle=i.backgroundColor,Rl(t,i,this.x,this.y))}getRange(){const t=this.options||{};return t.radius+t.hitRadius}}function oy(n,t){const{x:e,y:i,base:s,width:r,height:o}=n.getProps(["x","y","base","width","height"],t);let a,l,u,h,d;return n.horizontal?(d=o/2,a=Math.min(e,s),l=Math.max(e,s),u=i-d,h=i+d):(d=r/2,a=e-d,l=e+d,u=Math.min(i,s),h=Math.max(i,s)),{left:a,top:u,right:l,bottom:h}}function cn(n,t,e,i){return n?0:Mt(t,e,i)}function Z1(n,t,e){const i=n.options.borderWidth,s=n.borderSkipped,r=Dm(i);return{t:cn(s.top,r.top,0,e),r:cn(s.right,r.right,0,t),b:cn(s.bottom,r.bottom,0,e),l:cn(s.left,r.left,0,t)}}function tS(n,t,e){const{enableBorderRadius:i}=n.getProps(["enableBorderRadius"]),s=n.options.borderRadius,r=Hn(s),o=Math.min(t,e),a=n.borderSkipped,l=i||Z(s);return{topLeft:cn(!l||a.top||a.left,r.topLeft,0,o),topRight:cn(!l||a.top||a.right,r.topRight,0,o),bottomLeft:cn(!l||a.bottom||a.left,r.bottomLeft,0,o),bottomRight:cn(!l||a.bottom||a.right,r.bottomRight,0,o)}}function eS(n){const t=oy(n),e=t.right-t.left,i=t.bottom-t.top,s=Z1(n,e/2,i/2),r=tS(n,e/2,i/2);return{outer:{x:t.left,y:t.top,w:e,h:i,radius:r},inner:{x:t.left+s.l,y:t.top+s.t,w:e-s.l-s.r,h:i-s.t-s.b,radius:{topLeft:Math.max(0,r.topLeft-Math.max(s.t,s.l)),topRight:Math.max(0,r.topRight-Math.max(s.t,s.r)),bottomLeft:Math.max(0,r.bottomLeft-Math.max(s.b,s.l)),bottomRight:Math.max(0,r.bottomRight-Math.max(s.b,s.r))}}}}function ja(n,t,e,i){const s=t===null,r=e===null,a=n&&!(s&&r)&&oy(n,i);return a&&(s||Le(t,a.left,a.right))&&(r||Le(e,a.top,a.bottom))}function nS(n){return n.topLeft||n.topRight||n.bottomLeft||n.bottomRight}function iS(n,t){n.rect(t.x,t.y,t.w,t.h)}function Ha(n,t,e={}){const i=n.x!==e.x?-t:0,s=n.y!==e.y?-t:0,r=(n.x+n.w!==e.x+e.w?t:0)-i,o=(n.y+n.h!==e.y+e.h?t:0)-s;return{x:n.x+i,y:n.y+s,w:n.w+r,h:n.h+o,radius:n.radius}}class sS extends He{static id="bar";static defaults={borderSkipped:"start",borderWidth:0,borderRadius:0,inflateAmount:"auto",pointStyle:void 0};static defaultRoutes={backgroundColor:"backgroundColor",borderColor:"borderColor"};constructor(t){super(),this.options=void 0,this.horizontal=void 0,this.base=void 0,this.width=void 0,this.height=void 0,this.inflateAmount=void 0,t&&Object.assign(this,t)}draw(t){const{inflateAmount:e,options:{borderColor:i,backgroundColor:s}}=this,{inner:r,outer:o}=eS(this),a=nS(o.radius)?js:iS;t.save(),(o.w!==r.w||o.h!==r.h)&&(t.beginPath(),a(t,Ha(o,e,r)),t.clip(),a(t,Ha(r,-e,o)),t.fillStyle=i,t.fill("evenodd")),t.beginPath(),a(t,Ha(r,e)),t.fillStyle=s,t.fill(),t.restore()}inRange(t,e,i){return ja(this,t,e,i)}inXRange(t,e){return ja(this,t,null,e)}inYRange(t,e){return ja(this,null,t,e)}getCenterPoint(t){const{x:e,y:i,base:s,horizontal:r}=this.getProps(["x","y","base","horizontal"],t);return{x:r?(e+s)/2:e,y:r?i:(i+s)/2}}getRange(t){return t==="x"?this.width/2:this.height/2}}var rS=Object.freeze({__proto__:null,ArcElement:$1,BarElement:sS,LineElement:Xo,PointElement:J1});const Ol=["rgb(54, 162, 235)","rgb(255, 99, 132)","rgb(255, 159, 64)","rgb(255, 205, 86)","rgb(75, 192, 192)","rgb(153, 102, 255)","rgb(201, 203, 207)"],bf=Ol.map(n=>n.replace("rgb(","rgba(").replace(")",", 0.5)"));function ay(n){return Ol[n%Ol.length]}function ly(n){return bf[n%bf.length]}function oS(n,t){return n.borderColor=ay(t),n.backgroundColor=ly(t),++t}function aS(n,t){return n.backgroundColor=n.data.map(()=>ay(t++)),t}function lS(n,t){return n.backgroundColor=n.data.map(()=>ly(t++)),t}function cS(n){let t=0;return(e,i)=>{const s=n.getDatasetMeta(i).controller;s instanceof Wc?t=aS(e,t):s instanceof Km?t=lS(e,t):s&&(t=oS(e,t))}}function vf(n){let t;for(t in n)if(n[t].borderColor||n[t].backgroundColor)return!0;return!1}function uS(n){return n&&(n.borderColor||n.backgroundColor)}function hS(){return gt.borderColor!=="rgba(0,0,0,0.1)"||gt.backgroundColor!=="rgba(0,0,0,0.1)"}var dS={id:"colors",defaults:{enabled:!0,forceOverride:!1},beforeLayout(n,t,e){if(!e.enabled)return;const{data:{datasets:i},options:s}=n.config,{elements:r}=s,o=vf(i)||uS(s)||r&&vf(r)||hS();if(!e.forceOverride&&o)return;const a=cS(n);i.forEach(a)}};function fS(n,t,e,i,s){const r=s.samples||i;if(r>=e)return n.slice(t,t+e);const o=[],a=(e-2)/(r-2);let l=0;const u=t+e-1;let h=t,d,p,m,b,v;for(o[l++]=n[h],d=0;d<r-2;d++){let E=0,C=0,P;const k=Math.floor((d+1)*a)+1+t,M=Math.min(Math.floor((d+2)*a)+1,e)+t,O=M-k;for(P=k;P<M;P++)E+=n[P].x,C+=n[P].y;E/=O,C/=O;const N=Math.floor(d*a)+1+t,w=Math.min(Math.floor((d+1)*a)+1,e)+t,{x:y,y:T}=n[h];for(m=b=-1,P=N;P<w;P++)b=.5*Math.abs((y-E)*(n[P].y-T)-(y-n[P].x)*(C-T)),b>m&&(m=b,p=n[P],v=P);o[l++]=p,h=v}return o[l++]=n[u],o}function pS(n,t,e,i){let s=0,r=0,o,a,l,u,h,d,p,m,b,v;const E=[],C=t+e-1,P=n[t].x,M=n[C].x-P;for(o=t;o<t+e;++o){a=n[o],l=(a.x-P)/M*i,u=a.y;const O=l|0;if(O===h)u<b?(b=u,d=o):u>v&&(v=u,p=o),s=(r*s+a.x)/++r;else{const N=o-1;if(!Y(d)&&!Y(p)){const w=Math.min(d,p),y=Math.max(d,p);w!==m&&w!==N&&E.push({...n[w],x:s}),y!==m&&y!==N&&E.push({...n[y],x:s})}o>0&&N!==m&&E.push(n[N]),E.push(a),h=O,r=0,b=v=u,d=p=m=o}}return E}function cy(n){if(n._decimated){const t=n._data;delete n._decimated,delete n._data,Object.defineProperty(n,"data",{configurable:!0,enumerable:!0,writable:!0,value:t})}}function wf(n){n.data.datasets.forEach(t=>{cy(t)})}function gS(n,t){const e=t.length;let i=0,s;const{iScale:r}=n,{min:o,max:a,minDefined:l,maxDefined:u}=r.getUserBounds();return l&&(i=Mt(Ne(t,r.axis,o).lo,0,e-1)),u?s=Mt(Ne(t,r.axis,a).hi+1,i,e)-i:s=e-i,{start:i,count:s}}var mS={id:"decimation",defaults:{algorithm:"min-max",enabled:!1},beforeElementsUpdate:(n,t,e)=>{if(!e.enabled){wf(n);return}const i=n.width;n.data.datasets.forEach((s,r)=>{const{_data:o,indexAxis:a}=s,l=n.getDatasetMeta(r),u=o||s.data;if(ps([a,n.options.indexAxis])==="y"||!l.controller.supportsDecimation)return;const h=n.scales[l.xAxisID];if(h.type!=="linear"&&h.type!=="time"||n.options.parsing)return;let{start:d,count:p}=gS(l,u);const m=e.threshold||4*i;if(p<=m){cy(s);return}Y(o)&&(s._data=u,delete s.data,Object.defineProperty(s,"data",{configurable:!0,enumerable:!0,get:function(){return this._decimated},set:function(v){this._data=v}}));let b;switch(e.algorithm){case"lttb":b=fS(u,d,p,i,e);break;case"min-max":b=pS(u,d,p,i);break;default:throw new Error(`Unsupported decimation algorithm '${e.algorithm}'`)}s._decimated=b})},destroy(n){wf(n)}};function yS(n,t,e){const i=n.segments,s=n.points,r=t.points,o=[];for(const a of i){let{start:l,end:u}=a;u=Qo(l,u,s);const h=Vl(e,s[l],s[u],a.loop);if(!t.segments){o.push({source:a,target:h,start:s[l],end:s[u]});continue}const d=jm(t,h);for(const p of d){const m=Vl(e,r[p.start],r[p.end],p.loop),b=$m(a,s,m);for(const v of b)o.push({source:v,target:p,start:{[e]:Ef(h,m,"start",Math.max)},end:{[e]:Ef(h,m,"end",Math.min)}})}}return o}function Vl(n,t,e,i){if(i)return;let s=t[n],r=e[n];return n==="angle"&&(s=zt(s),r=zt(r)),{property:n,start:s,end:r}}function _S(n,t){const{x:e=null,y:i=null}=n||{},s=t.points,r=[];return t.segments.forEach(({start:o,end:a})=>{a=Qo(o,a,s);const l=s[o],u=s[a];i!==null?(r.push({x:l.x,y:i}),r.push({x:u.x,y:i})):e!==null&&(r.push({x:e,y:l.y}),r.push({x:e,y:u.y}))}),r}function Qo(n,t,e){for(;t>n;t--){const i=e[t];if(!isNaN(i.x)&&!isNaN(i.y))break}return t}function Ef(n,t,e,i){return n&&t?i(n[e],t[e]):n?n[e]:t?t[e]:0}function uy(n,t){let e=[],i=!1;return pt(n)?(i=!0,e=n):e=_S(n,t),e.length?new Xo({points:e,options:{tension:0},_loop:i,_fullLoop:i}):null}function Tf(n){return n&&n.fill!==!1}function bS(n,t,e){let s=n[t].fill;const r=[t];let o;if(!e)return s;for(;s!==!1&&r.indexOf(s)===-1;){if(!bt(s))return s;if(o=n[s],!o)return!1;if(o.visible)return s;r.push(s),s=o.fill}return!1}function vS(n,t,e){const i=xS(n);if(Z(i))return isNaN(i.value)?!1:i;let s=parseFloat(i);return bt(s)&&Math.floor(s)===s?wS(i[0],t,s,e):["origin","start","end","stack","shape"].indexOf(i)>=0&&i}function wS(n,t,e,i){return(n==="-"||n==="+")&&(e=t+e),e===t||e<0||e>=i?!1:e}function ES(n,t){let e=null;return n==="start"?e=t.bottom:n==="end"?e=t.top:Z(n)?e=t.getPixelForValue(n.value):t.getBasePixel&&(e=t.getBasePixel()),e}function TS(n,t,e){let i;return n==="start"?i=e:n==="end"?i=t.options.reverse?t.min:t.max:Z(n)?i=n.value:i=t.getBaseValue(),i}function xS(n){const t=n.options,e=t.fill;let i=W(e&&e.target,e);return i===void 0&&(i=!!t.backgroundColor),i===!1||i===null?!1:i===!0?"origin":i}function IS(n){const{scale:t,index:e,line:i}=n,s=[],r=i.segments,o=i.points,a=AS(t,e);a.push(uy({x:null,y:t.bottom},i));for(let l=0;l<r.length;l++){const u=r[l];for(let h=u.start;h<=u.end;h++)SS(s,o[h],a)}return new Xo({points:s,options:{}})}function AS(n,t){const e=[],i=n.getMatchingVisibleMetas("line");for(let s=0;s<i.length;s++){const r=i[s];if(r.index===t)break;r.hidden||e.unshift(r.dataset)}return e}function SS(n,t,e){const i=[];for(let s=0;s<e.length;s++){const r=e[s],{first:o,last:a,point:l}=CS(r,t,"x");if(!(!l||o&&a)){if(o)i.unshift(l);else if(n.push(l),!a)break}}n.push(...i)}function CS(n,t,e){const i=n.interpolate(t,e);if(!i)return{};const s=i[e],r=n.segments,o=n.points;let a=!1,l=!1;for(let u=0;u<r.length;u++){const h=r[u],d=o[h.start][e],p=o[h.end][e];if(Le(s,d,p)){a=s===d,l=s===p;break}}return{first:a,last:l,point:i}}class hy{constructor(t){this.x=t.x,this.y=t.y,this.radius=t.radius}pathSegment(t,e,i){const{x:s,y:r,radius:o}=this;return e=e||{start:0,end:ft},t.arc(s,r,o,e.end,e.start,!0),!i.bounds}interpolate(t){const{x:e,y:i,radius:s}=this,r=t.angle;return{x:e+Math.cos(r)*s,y:i+Math.sin(r)*s,angle:r}}}function PS(n){const{chart:t,fill:e,line:i}=n;if(bt(e))return RS(t,e);if(e==="stack")return IS(n);if(e==="shape")return!0;const s=kS(n);return s instanceof hy?s:uy(s,i)}function RS(n,t){const e=n.getDatasetMeta(t);return e&&n.isDatasetVisible(t)?e.dataset:null}function kS(n){return(n.scale||{}).getPointPositionForValue?MS(n):DS(n)}function DS(n){const{scale:t={},fill:e}=n,i=ES(e,t);if(bt(i)){const s=t.isHorizontal();return{x:s?i:null,y:s?null:i}}return null}function MS(n){const{scale:t,fill:e}=n,i=t.options,s=t.getLabels().length,r=i.reverse?t.max:t.min,o=TS(e,t,r),a=[];if(i.grid.circular){const l=t.getPointPositionForValue(0,r);return new hy({x:l.x,y:l.y,radius:t.getDistanceFromCenterForValue(o)})}for(let l=0;l<s;++l)a.push(t.getPointPositionForValue(l,o));return a}function Wa(n,t,e){const i=PS(t),{chart:s,index:r,line:o,scale:a,axis:l}=t,u=o.options,h=u.fill,d=u.backgroundColor,{above:p=d,below:m=d}=h||{},b=s.getDatasetMeta(r),v=Hm(s,b);i&&o.points.length&&(qo(n,e),OS(n,{line:o,target:i,above:p,below:m,area:e,scale:a,axis:l,clip:v}),Go(n))}function OS(n,t){const{line:e,target:i,above:s,below:r,area:o,scale:a,clip:l}=t,u=e._loop?"angle":t.axis;n.save();let h=r;r!==s&&(u==="x"?(xf(n,i,o.top),qa(n,{line:e,target:i,color:s,scale:a,property:u,clip:l}),n.restore(),n.save(),xf(n,i,o.bottom)):u==="y"&&(If(n,i,o.left),qa(n,{line:e,target:i,color:r,scale:a,property:u,clip:l}),n.restore(),n.save(),If(n,i,o.right),h=s)),qa(n,{line:e,target:i,color:h,scale:a,property:u,clip:l}),n.restore()}function xf(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:u}=a,h=s[l],d=s[Qo(l,u,s)];r?(n.moveTo(h.x,h.y),r=!1):(n.lineTo(h.x,e),n.lineTo(h.x,h.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(d.x,e)}n.lineTo(t.first().x,e),n.closePath(),n.clip()}function If(n,t,e){const{segments:i,points:s}=t;let r=!0,o=!1;n.beginPath();for(const a of i){const{start:l,end:u}=a,h=s[l],d=s[Qo(l,u,s)];r?(n.moveTo(h.x,h.y),r=!1):(n.lineTo(e,h.y),n.lineTo(h.x,h.y)),o=!!t.pathSegment(n,a,{move:o}),o?n.closePath():n.lineTo(e,d.y)}n.lineTo(e,t.first().y),n.closePath(),n.clip()}function qa(n,t){const{line:e,target:i,property:s,color:r,scale:o,clip:a}=t,l=yS(e,i,s);for(const{source:u,target:h,start:d,end:p}of l){const{style:{backgroundColor:m=r}={}}=u,b=i!==!0;n.save(),n.fillStyle=m,VS(n,o,a,b&&Vl(s,d,p)),n.beginPath();const v=!!e.pathSegment(n,u);let E;if(b){v?n.closePath():Af(n,i,p,s);const C=!!i.pathSegment(n,h,{move:v,reverse:!0});E=v&&C,E||Af(n,i,d,s)}n.closePath(),n.fill(E?"evenodd":"nonzero"),n.restore()}}function VS(n,t,e,i){const s=t.chart.chartArea,{property:r,start:o,end:a}=i||{};if(r==="x"||r==="y"){let l,u,h,d;r==="x"?(l=o,u=s.top,h=a,d=s.bottom):(l=s.left,u=o,h=s.right,d=a),n.beginPath(),e&&(l=Math.max(l,e.left),h=Math.min(h,e.right),u=Math.max(u,e.top),d=Math.min(d,e.bottom)),n.rect(l,u,h-l,d-u),n.clip()}}function Af(n,t,e,i){const s=t.interpolate(e,i);s&&n.lineTo(s.x,s.y)}var LS={id:"filler",afterDatasetsUpdate(n,t,e){const i=(n.data.datasets||[]).length,s=[];let r,o,a,l;for(o=0;o<i;++o)r=n.getDatasetMeta(o),a=r.dataset,l=null,a&&a.options&&a instanceof Xo&&(l={visible:n.isDatasetVisible(o),index:o,fill:vS(a,o,i),chart:n,axis:r.controller.options.indexAxis,scale:r.vScale,line:a}),r.$filler=l,s.push(l);for(o=0;o<i;++o)l=s[o],!(!l||l.fill===!1)&&(l.fill=bS(s,o,e.propagate))},beforeDraw(n,t,e){const i=e.drawTime==="beforeDraw",s=n.getSortedVisibleDatasetMetas(),r=n.chartArea;for(let o=s.length-1;o>=0;--o){const a=s[o].$filler;a&&(a.line.updateControlPoints(r,a.axis),i&&a.fill&&Wa(n.ctx,a,r))}},beforeDatasetsDraw(n,t,e){if(e.drawTime!=="beforeDatasetsDraw")return;const i=n.getSortedVisibleDatasetMetas();for(let s=i.length-1;s>=0;--s){const r=i[s].$filler;Tf(r)&&Wa(n.ctx,r,n.chartArea)}},beforeDatasetDraw(n,t,e){const i=t.meta.$filler;!Tf(i)||e.drawTime!=="beforeDatasetDraw"||Wa(n.ctx,i,n.chartArea)},defaults:{propagate:!0,drawTime:"beforeDatasetDraw"}};const Sf=(n,t)=>{let{boxHeight:e=t,boxWidth:i=t}=n;return n.usePointStyle&&(e=Math.min(e,t),i=n.pointStyleWidth||Math.min(i,t)),{boxWidth:i,boxHeight:e,itemHeight:Math.max(t,e)}},NS=(n,t)=>n!==null&&t!==null&&n.datasetIndex===t.datasetIndex&&n.index===t.index;class Cf extends He{constructor(t){super(),this._added=!1,this.legendHitBoxes=[],this._hoveredItem=null,this.doughnutMode=!1,this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this.legendItems=void 0,this.columnSizes=void 0,this.lineWidths=void 0,this.maxHeight=void 0,this.maxWidth=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.height=void 0,this.width=void 0,this._margins=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e,i){this.maxWidth=t,this.maxHeight=e,this._margins=i,this.setDimensions(),this.buildLabels(),this.fit()}setDimensions(){this.isHorizontal()?(this.width=this.maxWidth,this.left=this._margins.left,this.right=this.width):(this.height=this.maxHeight,this.top=this._margins.top,this.bottom=this.height)}buildLabels(){const t=this.options.labels||{};let e=lt(t.generateLabels,[this.chart],this)||[];t.filter&&(e=e.filter(i=>t.filter(i,this.chart.data))),t.sort&&(e=e.sort((i,s)=>t.sort(i,s,this.chart.data))),this.options.reverse&&e.reverse(),this.legendItems=e}fit(){const{options:t,ctx:e}=this;if(!t.display){this.width=this.height=0;return}const i=t.labels,s=Ct(i.font),r=s.size,o=this._computeTitleHeight(),{boxWidth:a,itemHeight:l}=Sf(i,r);let u,h;e.font=s.string,this.isHorizontal()?(u=this.maxWidth,h=this._fitRows(o,r,a,l)+10):(h=this.maxHeight,u=this._fitCols(o,s,a,l)+10),this.width=Math.min(u,t.maxWidth||this.maxWidth),this.height=Math.min(h,t.maxHeight||this.maxHeight)}_fitRows(t,e,i,s){const{ctx:r,maxWidth:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.lineWidths=[0],h=s+a;let d=t;r.textAlign="left",r.textBaseline="middle";let p=-1,m=-h;return this.legendItems.forEach((b,v)=>{const E=i+e/2+r.measureText(b.text).width;(v===0||u[u.length-1]+E+2*a>o)&&(d+=h,u[u.length-(v>0?0:1)]=0,m+=h,p++),l[v]={left:0,top:m,row:p,width:E,height:s},u[u.length-1]+=E+a}),d}_fitCols(t,e,i,s){const{ctx:r,maxHeight:o,options:{labels:{padding:a}}}=this,l=this.legendHitBoxes=[],u=this.columnSizes=[],h=o-t;let d=a,p=0,m=0,b=0,v=0;return this.legendItems.forEach((E,C)=>{const{itemWidth:P,itemHeight:k}=FS(i,e,r,E,s);C>0&&m+k+2*a>h&&(d+=p+a,u.push({width:p,height:m}),b+=p+a,v++,p=m=0),l[C]={left:b,top:m,col:v,width:P,height:k},p=Math.max(p,P),m+=k+a}),d+=p,u.push({width:p,height:m}),d}adjustHitBoxes(){if(!this.options.display)return;const t=this._computeTitleHeight(),{legendHitBoxes:e,options:{align:i,labels:{padding:s},rtl:r}}=this,o=vi(r,this.left,this.width);if(this.isHorizontal()){let a=0,l=Bt(i,this.left+s,this.right-this.lineWidths[a]);for(const u of e)a!==u.row&&(a=u.row,l=Bt(i,this.left+s,this.right-this.lineWidths[a])),u.top+=this.top+t+s,u.left=o.leftForLtr(o.x(l),u.width),l+=u.width+s}else{let a=0,l=Bt(i,this.top+t+s,this.bottom-this.columnSizes[a].height);for(const u of e)u.col!==a&&(a=u.col,l=Bt(i,this.top+t+s,this.bottom-this.columnSizes[a].height)),u.top=l,u.left+=this.left+s,u.left=o.leftForLtr(o.x(u.left),u.width),l+=u.height+s}}isHorizontal(){return this.options.position==="top"||this.options.position==="bottom"}draw(){if(this.options.display){const t=this.ctx;qo(t,this),this._draw(),Go(t)}}_draw(){const{options:t,columnSizes:e,lineWidths:i,ctx:s}=this,{align:r,labels:o}=t,a=gt.color,l=vi(t.rtl,this.left,this.width),u=Ct(o.font),{padding:h}=o,d=u.size,p=d/2;let m;this.drawTitle(),s.textAlign=l.textAlign("left"),s.textBaseline="middle",s.lineWidth=.5,s.font=u.string;const{boxWidth:b,boxHeight:v,itemHeight:E}=Sf(o,d),C=function(N,w,y){if(isNaN(b)||b<=0||isNaN(v)||v<0)return;s.save();const T=W(y.lineWidth,1);if(s.fillStyle=W(y.fillStyle,a),s.lineCap=W(y.lineCap,"butt"),s.lineDashOffset=W(y.lineDashOffset,0),s.lineJoin=W(y.lineJoin,"miter"),s.lineWidth=T,s.strokeStyle=W(y.strokeStyle,a),s.setLineDash(W(y.lineDash,[])),o.usePointStyle){const A={radius:v*Math.SQRT2/2,pointStyle:y.pointStyle,rotation:y.rotation,borderWidth:T},x=l.xPlus(N,b/2),S=w+p;km(s,A,x,S,o.pointStyleWidth&&b)}else{const A=w+Math.max((d-v)/2,0),x=l.leftForLtr(N,b),S=Hn(y.borderRadius);s.beginPath(),Object.values(S).some(I=>I!==0)?js(s,{x,y:A,w:b,h:v,radius:S}):s.rect(x,A,b,v),s.fill(),T!==0&&s.stroke()}s.restore()},P=function(N,w,y){Jn(s,y.text,N,w+E/2,u,{strikethrough:y.hidden,textAlign:l.textAlign(y.textAlign)})},k=this.isHorizontal(),M=this._computeTitleHeight();k?m={x:Bt(r,this.left+h,this.right-i[0]),y:this.top+h+M,line:0}:m={x:this.left+h,y:Bt(r,this.top+M+h,this.bottom-e[0].height),line:0},Bm(this.ctx,t.textDirection);const O=E+h;this.legendItems.forEach((N,w)=>{s.strokeStyle=N.fontColor,s.fillStyle=N.fontColor;const y=s.measureText(N.text).width,T=l.textAlign(N.textAlign||(N.textAlign=o.textAlign)),A=b+p+y;let x=m.x,S=m.y;l.setWidth(this.width),k?w>0&&x+A+h>this.right&&(S=m.y+=O,m.line++,x=m.x=Bt(r,this.left+h,this.right-i[m.line])):w>0&&S+O>this.bottom&&(x=m.x=x+e[m.line].width+h,m.line++,S=m.y=Bt(r,this.top+M+h,this.bottom-e[m.line].height));const I=l.x(x);if(C(I,S,N),x=Kx(T,x+b+p,k?x+A:this.right,t.rtl),P(l.x(x),S,N),k)m.x+=A+h;else if(typeof N.text!="string"){const nt=u.lineHeight;m.y+=dy(N,nt)+h}else m.y+=O}),Um(this.ctx,t.textDirection)}drawTitle(){const t=this.options,e=t.title,i=Ct(e.font),s=qt(e.padding);if(!e.display)return;const r=vi(t.rtl,this.left,this.width),o=this.ctx,a=e.position,l=i.size/2,u=s.top+l;let h,d=this.left,p=this.width;if(this.isHorizontal())p=Math.max(...this.lineWidths),h=this.top+u,d=Bt(t.align,d,this.right-p);else{const b=this.columnSizes.reduce((v,E)=>Math.max(v,E.height),0);h=u+Bt(t.align,this.top,this.bottom-b-t.labels.padding-this._computeTitleHeight())}const m=Bt(a,d,d+p);o.textAlign=r.textAlign(Nc(a)),o.textBaseline="middle",o.strokeStyle=e.color,o.fillStyle=e.color,o.font=i.string,Jn(o,e.text,m,h,i)}_computeTitleHeight(){const t=this.options.title,e=Ct(t.font),i=qt(t.padding);return t.display?e.lineHeight+i.height:0}_getLegendItemAt(t,e){let i,s,r;if(Le(t,this.left,this.right)&&Le(e,this.top,this.bottom)){for(r=this.legendHitBoxes,i=0;i<r.length;++i)if(s=r[i],Le(t,s.left,s.left+s.width)&&Le(e,s.top,s.top+s.height))return this.legendItems[i]}return null}handleEvent(t){const e=this.options;if(!zS(t.type,e))return;const i=this._getLegendItemAt(t.x,t.y);if(t.type==="mousemove"||t.type==="mouseout"){const s=this._hoveredItem,r=NS(s,i);s&&!r&&lt(e.onLeave,[t,s,this],this),this._hoveredItem=i,i&&!r&&lt(e.onHover,[t,i,this],this)}else i&&lt(e.onClick,[t,i,this],this)}}function FS(n,t,e,i,s){const r=BS(i,n,t,e),o=US(s,i,t.lineHeight);return{itemWidth:r,itemHeight:o}}function BS(n,t,e,i){let s=n.text;return s&&typeof s!="string"&&(s=s.reduce((r,o)=>r.length>o.length?r:o)),t+e.size/2+i.measureText(s).width}function US(n,t,e){let i=n;return typeof t.text!="string"&&(i=dy(t,e)),i}function dy(n,t){const e=n.text?n.text.length:0;return t*e}function zS(n,t){return!!((n==="mousemove"||n==="mouseout")&&(t.onHover||t.onLeave)||t.onClick&&(n==="click"||n==="mouseup"))}var $S={id:"legend",_element:Cf,start(n,t,e){const i=n.legend=new Cf({ctx:n.ctx,options:e,chart:n});Ht.configure(n,i,e),Ht.addBox(n,i)},stop(n){Ht.removeBox(n,n.legend),delete n.legend},beforeUpdate(n,t,e){const i=n.legend;Ht.configure(n,i,e),i.options=e},afterUpdate(n){const t=n.legend;t.buildLabels(),t.adjustHitBoxes()},afterEvent(n,t){t.replay||n.legend.handleEvent(t.event)},defaults:{display:!0,position:"top",align:"center",fullSize:!0,reverse:!1,weight:1e3,onClick(n,t,e){const i=t.datasetIndex,s=e.chart;s.isDatasetVisible(i)?(s.hide(i),t.hidden=!0):(s.show(i),t.hidden=!1)},onHover:null,onLeave:null,labels:{color:n=>n.chart.options.color,boxWidth:40,padding:10,generateLabels(n){const t=n.data.datasets,{labels:{usePointStyle:e,pointStyle:i,textAlign:s,color:r,useBorderRadius:o,borderRadius:a}}=n.legend.options;return n._getSortedDatasetMetas().map(l=>{const u=l.controller.getStyle(e?0:void 0),h=qt(u.borderWidth);return{text:t[l.index].label,fillStyle:u.backgroundColor,fontColor:r,hidden:!l.visible,lineCap:u.borderCapStyle,lineDash:u.borderDash,lineDashOffset:u.borderDashOffset,lineJoin:u.borderJoinStyle,lineWidth:(h.width+h.height)/4,strokeStyle:u.borderColor,pointStyle:i||u.pointStyle,rotation:u.rotation,textAlign:s||u.textAlign,borderRadius:o&&(a||u.borderRadius),datasetIndex:l.index}},this)}},title:{color:n=>n.chart.options.color,display:!1,position:"center",text:""}},descriptors:{_scriptable:n=>!n.startsWith("on"),labels:{_scriptable:n=>!["generateLabels","filter","sort"].includes(n)}}};class Gc extends He{constructor(t){super(),this.chart=t.chart,this.options=t.options,this.ctx=t.ctx,this._padding=void 0,this.top=void 0,this.bottom=void 0,this.left=void 0,this.right=void 0,this.width=void 0,this.height=void 0,this.position=void 0,this.weight=void 0,this.fullSize=void 0}update(t,e){const i=this.options;if(this.left=0,this.top=0,!i.display){this.width=this.height=this.right=this.bottom=0;return}this.width=this.right=t,this.height=this.bottom=e;const s=pt(i.text)?i.text.length:1;this._padding=qt(i.padding);const r=s*Ct(i.font).lineHeight+this._padding.height;this.isHorizontal()?this.height=r:this.width=r}isHorizontal(){const t=this.options.position;return t==="top"||t==="bottom"}_drawArgs(t){const{top:e,left:i,bottom:s,right:r,options:o}=this,a=o.align;let l=0,u,h,d;return this.isHorizontal()?(h=Bt(a,i,r),d=e+t,u=r-i):(o.position==="left"?(h=i+t,d=Bt(a,s,e),l=et*-.5):(h=r-t,d=Bt(a,e,s),l=et*.5),u=s-e),{titleX:h,titleY:d,maxWidth:u,rotation:l}}draw(){const t=this.ctx,e=this.options;if(!e.display)return;const i=Ct(e.font),r=i.lineHeight/2+this._padding.top,{titleX:o,titleY:a,maxWidth:l,rotation:u}=this._drawArgs(r);Jn(t,e.text,0,0,i,{color:e.color,maxWidth:l,rotation:u,textAlign:Nc(e.align),textBaseline:"middle",translation:[o,a]})}}function jS(n,t){const e=new Gc({ctx:n.ctx,options:t,chart:n});Ht.configure(n,e,t),Ht.addBox(n,e),n.titleBlock=e}var HS={id:"title",_element:Gc,start(n,t,e){jS(n,e)},stop(n){const t=n.titleBlock;Ht.removeBox(n,t),delete n.titleBlock},beforeUpdate(n,t,e){const i=n.titleBlock;Ht.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"bold"},fullSize:!0,padding:10,position:"top",text:"",weight:2e3},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const Nr=new WeakMap;var WS={id:"subtitle",start(n,t,e){const i=new Gc({ctx:n.ctx,options:e,chart:n});Ht.configure(n,i,e),Ht.addBox(n,i),Nr.set(n,i)},stop(n){Ht.removeBox(n,Nr.get(n)),Nr.delete(n)},beforeUpdate(n,t,e){const i=Nr.get(n);Ht.configure(n,i,e),i.options=e},defaults:{align:"center",display:!1,font:{weight:"normal"},fullSize:!0,padding:0,position:"top",text:"",weight:1500},defaultRoutes:{color:"color"},descriptors:{_scriptable:!0,_indexable:!1}};const ms={average(n){if(!n.length)return!1;let t,e,i=new Set,s=0,r=0;for(t=0,e=n.length;t<e;++t){const a=n[t].element;if(a&&a.hasValue()){const l=a.tooltipPosition();i.add(l.x),s+=l.y,++r}}return r===0||i.size===0?!1:{x:[...i].reduce((a,l)=>a+l)/i.size,y:s/r}},nearest(n,t){if(!n.length)return!1;let e=t.x,i=t.y,s=Number.POSITIVE_INFINITY,r,o,a;for(r=0,o=n.length;r<o;++r){const l=n[r].element;if(l&&l.hasValue()){const u=l.getCenterPoint(),h=Cl(t,u);h<s&&(s=h,a=l)}}if(a){const l=a.tooltipPosition();e=l.x,i=l.y}return{x:e,y:i}}};function pe(n,t){return t&&(pt(t)?Array.prototype.push.apply(n,t):n.push(t)),n}function Re(n){return(typeof n=="string"||n instanceof String)&&n.indexOf(`
`)>-1?n.split(`
`):n}function qS(n,t){const{element:e,datasetIndex:i,index:s}=t,r=n.getDatasetMeta(i).controller,{label:o,value:a}=r.getLabelAndValue(s);return{chart:n,label:o,parsed:r.getParsed(s),raw:n.data.datasets[i].data[s],formattedValue:a,dataset:r.getDataset(),dataIndex:s,datasetIndex:i,element:e}}function Pf(n,t){const e=n.chart.ctx,{body:i,footer:s,title:r}=n,{boxWidth:o,boxHeight:a}=t,l=Ct(t.bodyFont),u=Ct(t.titleFont),h=Ct(t.footerFont),d=r.length,p=s.length,m=i.length,b=qt(t.padding);let v=b.height,E=0,C=i.reduce((M,O)=>M+O.before.length+O.lines.length+O.after.length,0);if(C+=n.beforeBody.length+n.afterBody.length,d&&(v+=d*u.lineHeight+(d-1)*t.titleSpacing+t.titleMarginBottom),C){const M=t.displayColors?Math.max(a,l.lineHeight):l.lineHeight;v+=m*M+(C-m)*l.lineHeight+(C-1)*t.bodySpacing}p&&(v+=t.footerMarginTop+p*h.lineHeight+(p-1)*t.footerSpacing);let P=0;const k=function(M){E=Math.max(E,e.measureText(M).width+P)};return e.save(),e.font=u.string,rt(n.title,k),e.font=l.string,rt(n.beforeBody.concat(n.afterBody),k),P=t.displayColors?o+2+t.boxPadding:0,rt(i,M=>{rt(M.before,k),rt(M.lines,k),rt(M.after,k)}),P=0,e.font=h.string,rt(n.footer,k),e.restore(),E+=b.width,{width:E,height:v}}function GS(n,t){const{y:e,height:i}=t;return e<i/2?"top":e>n.height-i/2?"bottom":"center"}function KS(n,t,e,i){const{x:s,width:r}=i,o=e.caretSize+e.caretPadding;if(n==="left"&&s+r+o>t.width||n==="right"&&s-r-o<0)return!0}function YS(n,t,e,i){const{x:s,width:r}=e,{width:o,chartArea:{left:a,right:l}}=n;let u="center";return i==="center"?u=s<=(a+l)/2?"left":"right":s<=r/2?u="left":s>=o-r/2&&(u="right"),KS(u,n,t,e)&&(u="center"),u}function Rf(n,t,e){const i=e.yAlign||t.yAlign||GS(n,e);return{xAlign:e.xAlign||t.xAlign||YS(n,t,e,i),yAlign:i}}function XS(n,t){let{x:e,width:i}=n;return t==="right"?e-=i:t==="center"&&(e-=i/2),e}function QS(n,t,e){let{y:i,height:s}=n;return t==="top"?i+=e:t==="bottom"?i-=s+e:i-=s/2,i}function kf(n,t,e,i){const{caretSize:s,caretPadding:r,cornerRadius:o}=n,{xAlign:a,yAlign:l}=e,u=s+r,{topLeft:h,topRight:d,bottomLeft:p,bottomRight:m}=Hn(o);let b=XS(t,a);const v=QS(t,l,u);return l==="center"?a==="left"?b+=u:a==="right"&&(b-=u):a==="left"?b-=Math.max(h,p)+s:a==="right"&&(b+=Math.max(d,m)+s),{x:Mt(b,0,i.width-t.width),y:Mt(v,0,i.height-t.height)}}function Fr(n,t,e){const i=qt(e.padding);return t==="center"?n.x+n.width/2:t==="right"?n.x+n.width-i.right:n.x+i.left}function Df(n){return pe([],Re(n))}function JS(n,t,e){return In(n,{tooltip:t,tooltipItems:e,type:"tooltip"})}function Mf(n,t){const e=t&&t.dataset&&t.dataset.tooltip&&t.dataset.tooltip.callbacks;return e?n.override(e):n}const fy={beforeTitle:Ce,title(n){if(n.length>0){const t=n[0],e=t.chart.data.labels,i=e?e.length:0;if(this&&this.options&&this.options.mode==="dataset")return t.dataset.label||"";if(t.label)return t.label;if(i>0&&t.dataIndex<i)return e[t.dataIndex]}return""},afterTitle:Ce,beforeBody:Ce,beforeLabel:Ce,label(n){if(this&&this.options&&this.options.mode==="dataset")return n.label+": "+n.formattedValue||n.formattedValue;let t=n.dataset.label||"";t&&(t+=": ");const e=n.formattedValue;return Y(e)||(t+=e),t},labelColor(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{borderColor:e.borderColor,backgroundColor:e.backgroundColor,borderWidth:e.borderWidth,borderDash:e.borderDash,borderDashOffset:e.borderDashOffset,borderRadius:0}},labelTextColor(){return this.options.bodyColor},labelPointStyle(n){const e=n.chart.getDatasetMeta(n.datasetIndex).controller.getStyle(n.dataIndex);return{pointStyle:e.pointStyle,rotation:e.rotation}},afterLabel:Ce,afterBody:Ce,beforeFooter:Ce,footer:Ce,afterFooter:Ce};function Xt(n,t,e,i){const s=n[t].call(e,i);return typeof s>"u"?fy[t].call(e,i):s}class Of extends He{static positioners=ms;constructor(t){super(),this.opacity=0,this._active=[],this._eventPosition=void 0,this._size=void 0,this._cachedAnimations=void 0,this._tooltipItems=[],this.$animations=void 0,this.$context=void 0,this.chart=t.chart,this.options=t.options,this.dataPoints=void 0,this.title=void 0,this.beforeBody=void 0,this.body=void 0,this.afterBody=void 0,this.footer=void 0,this.xAlign=void 0,this.yAlign=void 0,this.x=void 0,this.y=void 0,this.height=void 0,this.width=void 0,this.caretX=void 0,this.caretY=void 0,this.labelColors=void 0,this.labelPointStyles=void 0,this.labelTextColors=void 0}initialize(t){this.options=t,this._cachedAnimations=void 0,this.$context=void 0}_resolveAnimations(){const t=this._cachedAnimations;if(t)return t;const e=this.chart,i=this.options.setContext(this.getContext()),s=i.enabled&&e.options.animation&&i.animations,r=new Wm(this.chart,s);return s._cacheable&&(this._cachedAnimations=Object.freeze(r)),r}getContext(){return this.$context||(this.$context=JS(this.chart.getContext(),this,this._tooltipItems))}getTitle(t,e){const{callbacks:i}=e,s=Xt(i,"beforeTitle",this,t),r=Xt(i,"title",this,t),o=Xt(i,"afterTitle",this,t);let a=[];return a=pe(a,Re(s)),a=pe(a,Re(r)),a=pe(a,Re(o)),a}getBeforeBody(t,e){return Df(Xt(e.callbacks,"beforeBody",this,t))}getBody(t,e){const{callbacks:i}=e,s=[];return rt(t,r=>{const o={before:[],lines:[],after:[]},a=Mf(i,r);pe(o.before,Re(Xt(a,"beforeLabel",this,r))),pe(o.lines,Xt(a,"label",this,r)),pe(o.after,Re(Xt(a,"afterLabel",this,r))),s.push(o)}),s}getAfterBody(t,e){return Df(Xt(e.callbacks,"afterBody",this,t))}getFooter(t,e){const{callbacks:i}=e,s=Xt(i,"beforeFooter",this,t),r=Xt(i,"footer",this,t),o=Xt(i,"afterFooter",this,t);let a=[];return a=pe(a,Re(s)),a=pe(a,Re(r)),a=pe(a,Re(o)),a}_createItems(t){const e=this._active,i=this.chart.data,s=[],r=[],o=[];let a=[],l,u;for(l=0,u=e.length;l<u;++l)a.push(qS(this.chart,e[l]));return t.filter&&(a=a.filter((h,d,p)=>t.filter(h,d,p,i))),t.itemSort&&(a=a.sort((h,d)=>t.itemSort(h,d,i))),rt(a,h=>{const d=Mf(t.callbacks,h);s.push(Xt(d,"labelColor",this,h)),r.push(Xt(d,"labelPointStyle",this,h)),o.push(Xt(d,"labelTextColor",this,h))}),this.labelColors=s,this.labelPointStyles=r,this.labelTextColors=o,this.dataPoints=a,a}update(t,e){const i=this.options.setContext(this.getContext()),s=this._active;let r,o=[];if(!s.length)this.opacity!==0&&(r={opacity:0});else{const a=ms[i.position].call(this,s,this._eventPosition);o=this._createItems(i),this.title=this.getTitle(o,i),this.beforeBody=this.getBeforeBody(o,i),this.body=this.getBody(o,i),this.afterBody=this.getAfterBody(o,i),this.footer=this.getFooter(o,i);const l=this._size=Pf(this,i),u=Object.assign({},a,l),h=Rf(this.chart,i,u),d=kf(i,u,h,this.chart);this.xAlign=h.xAlign,this.yAlign=h.yAlign,r={opacity:1,x:d.x,y:d.y,width:l.width,height:l.height,caretX:a.x,caretY:a.y}}this._tooltipItems=o,this.$context=void 0,r&&this._resolveAnimations().update(this,r),t&&i.external&&i.external.call(this,{chart:this.chart,tooltip:this,replay:e})}drawCaret(t,e,i,s){const r=this.getCaretPosition(t,i,s);e.lineTo(r.x1,r.y1),e.lineTo(r.x2,r.y2),e.lineTo(r.x3,r.y3)}getCaretPosition(t,e,i){const{xAlign:s,yAlign:r}=this,{caretSize:o,cornerRadius:a}=i,{topLeft:l,topRight:u,bottomLeft:h,bottomRight:d}=Hn(a),{x:p,y:m}=t,{width:b,height:v}=e;let E,C,P,k,M,O;return r==="center"?(M=m+v/2,s==="left"?(E=p,C=E-o,k=M+o,O=M-o):(E=p+b,C=E+o,k=M-o,O=M+o),P=E):(s==="left"?C=p+Math.max(l,h)+o:s==="right"?C=p+b-Math.max(u,d)-o:C=this.caretX,r==="top"?(k=m,M=k-o,E=C-o,P=C+o):(k=m+v,M=k+o,E=C+o,P=C-o),O=k),{x1:E,x2:C,x3:P,y1:k,y2:M,y3:O}}drawTitle(t,e,i){const s=this.title,r=s.length;let o,a,l;if(r){const u=vi(i.rtl,this.x,this.width);for(t.x=Fr(this,i.titleAlign,i),e.textAlign=u.textAlign(i.titleAlign),e.textBaseline="middle",o=Ct(i.titleFont),a=i.titleSpacing,e.fillStyle=i.titleColor,e.font=o.string,l=0;l<r;++l)e.fillText(s[l],u.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+a,l+1===r&&(t.y+=i.titleMarginBottom-a)}}_drawColorBox(t,e,i,s,r){const o=this.labelColors[i],a=this.labelPointStyles[i],{boxHeight:l,boxWidth:u}=r,h=Ct(r.bodyFont),d=Fr(this,"left",r),p=s.x(d),m=l<h.lineHeight?(h.lineHeight-l)/2:0,b=e.y+m;if(r.usePointStyle){const v={radius:Math.min(u,l)/2,pointStyle:a.pointStyle,rotation:a.rotation,borderWidth:1},E=s.leftForLtr(p,u)+u/2,C=b+l/2;t.strokeStyle=r.multiKeyBackground,t.fillStyle=r.multiKeyBackground,Rl(t,v,E,C),t.strokeStyle=o.borderColor,t.fillStyle=o.backgroundColor,Rl(t,v,E,C)}else{t.lineWidth=Z(o.borderWidth)?Math.max(...Object.values(o.borderWidth)):o.borderWidth||1,t.strokeStyle=o.borderColor,t.setLineDash(o.borderDash||[]),t.lineDashOffset=o.borderDashOffset||0;const v=s.leftForLtr(p,u),E=s.leftForLtr(s.xPlus(p,1),u-2),C=Hn(o.borderRadius);Object.values(C).some(P=>P!==0)?(t.beginPath(),t.fillStyle=r.multiKeyBackground,js(t,{x:v,y:b,w:u,h:l,radius:C}),t.fill(),t.stroke(),t.fillStyle=o.backgroundColor,t.beginPath(),js(t,{x:E,y:b+1,w:u-2,h:l-2,radius:C}),t.fill()):(t.fillStyle=r.multiKeyBackground,t.fillRect(v,b,u,l),t.strokeRect(v,b,u,l),t.fillStyle=o.backgroundColor,t.fillRect(E,b+1,u-2,l-2))}t.fillStyle=this.labelTextColors[i]}drawBody(t,e,i){const{body:s}=this,{bodySpacing:r,bodyAlign:o,displayColors:a,boxHeight:l,boxWidth:u,boxPadding:h}=i,d=Ct(i.bodyFont);let p=d.lineHeight,m=0;const b=vi(i.rtl,this.x,this.width),v=function(y){e.fillText(y,b.x(t.x+m),t.y+p/2),t.y+=p+r},E=b.textAlign(o);let C,P,k,M,O,N,w;for(e.textAlign=o,e.textBaseline="middle",e.font=d.string,t.x=Fr(this,E,i),e.fillStyle=i.bodyColor,rt(this.beforeBody,v),m=a&&E!=="right"?o==="center"?u/2+h:u+2+h:0,M=0,N=s.length;M<N;++M){for(C=s[M],P=this.labelTextColors[M],e.fillStyle=P,rt(C.before,v),k=C.lines,a&&k.length&&(this._drawColorBox(e,t,M,b,i),p=Math.max(d.lineHeight,l)),O=0,w=k.length;O<w;++O)v(k[O]),p=d.lineHeight;rt(C.after,v)}m=0,p=d.lineHeight,rt(this.afterBody,v),t.y-=r}drawFooter(t,e,i){const s=this.footer,r=s.length;let o,a;if(r){const l=vi(i.rtl,this.x,this.width);for(t.x=Fr(this,i.footerAlign,i),t.y+=i.footerMarginTop,e.textAlign=l.textAlign(i.footerAlign),e.textBaseline="middle",o=Ct(i.footerFont),e.fillStyle=i.footerColor,e.font=o.string,a=0;a<r;++a)e.fillText(s[a],l.x(t.x),t.y+o.lineHeight/2),t.y+=o.lineHeight+i.footerSpacing}}drawBackground(t,e,i,s){const{xAlign:r,yAlign:o}=this,{x:a,y:l}=t,{width:u,height:h}=i,{topLeft:d,topRight:p,bottomLeft:m,bottomRight:b}=Hn(s.cornerRadius);e.fillStyle=s.backgroundColor,e.strokeStyle=s.borderColor,e.lineWidth=s.borderWidth,e.beginPath(),e.moveTo(a+d,l),o==="top"&&this.drawCaret(t,e,i,s),e.lineTo(a+u-p,l),e.quadraticCurveTo(a+u,l,a+u,l+p),o==="center"&&r==="right"&&this.drawCaret(t,e,i,s),e.lineTo(a+u,l+h-b),e.quadraticCurveTo(a+u,l+h,a+u-b,l+h),o==="bottom"&&this.drawCaret(t,e,i,s),e.lineTo(a+m,l+h),e.quadraticCurveTo(a,l+h,a,l+h-m),o==="center"&&r==="left"&&this.drawCaret(t,e,i,s),e.lineTo(a,l+d),e.quadraticCurveTo(a,l,a+d,l),e.closePath(),e.fill(),s.borderWidth>0&&e.stroke()}_updateAnimationTarget(t){const e=this.chart,i=this.$animations,s=i&&i.x,r=i&&i.y;if(s||r){const o=ms[t.position].call(this,this._active,this._eventPosition);if(!o)return;const a=this._size=Pf(this,t),l=Object.assign({},o,this._size),u=Rf(e,t,l),h=kf(t,l,u,e);(s._to!==h.x||r._to!==h.y)&&(this.xAlign=u.xAlign,this.yAlign=u.yAlign,this.width=a.width,this.height=a.height,this.caretX=o.x,this.caretY=o.y,this._resolveAnimations().update(this,h))}}_willRender(){return!!this.opacity}draw(t){const e=this.options.setContext(this.getContext());let i=this.opacity;if(!i)return;this._updateAnimationTarget(e);const s={width:this.width,height:this.height},r={x:this.x,y:this.y};i=Math.abs(i)<.001?0:i;const o=qt(e.padding),a=this.title.length||this.beforeBody.length||this.body.length||this.afterBody.length||this.footer.length;e.enabled&&a&&(t.save(),t.globalAlpha=i,this.drawBackground(r,t,s,e),Bm(t,e.textDirection),r.y+=o.top,this.drawTitle(r,t,e),this.drawBody(r,t,e),this.drawFooter(r,t,e),Um(t,e.textDirection),t.restore())}getActiveElements(){return this._active||[]}setActiveElements(t,e){const i=this._active,s=t.map(({datasetIndex:a,index:l})=>{const u=this.chart.getDatasetMeta(a);if(!u)throw new Error("Cannot find a dataset at index "+a);return{datasetIndex:a,element:u.data[l],index:l}}),r=!vo(i,s),o=this._positionChanged(s,e);(r||o)&&(this._active=s,this._eventPosition=e,this._ignoreReplayEvents=!0,this.update(!0))}handleEvent(t,e,i=!0){if(e&&this._ignoreReplayEvents)return!1;this._ignoreReplayEvents=!1;const s=this.options,r=this._active||[],o=this._getActiveElements(t,r,e,i),a=this._positionChanged(o,t),l=e||!vo(o,r)||a;return l&&(this._active=o,(s.enabled||s.external)&&(this._eventPosition={x:t.x,y:t.y},this.update(!0,e))),l}_getActiveElements(t,e,i,s){const r=this.options;if(t.type==="mouseout")return[];if(!s)return e.filter(a=>this.chart.data.datasets[a.datasetIndex]&&this.chart.getDatasetMeta(a.datasetIndex).controller.getParsed(a.index)!==void 0);const o=this.chart.getElementsAtEventForMode(t,r.mode,r,i);return r.reverse&&o.reverse(),o}_positionChanged(t,e){const{caretX:i,caretY:s,options:r}=this,o=ms[r.position].call(this,t,e);return o!==!1&&(i!==o.x||s!==o.y)}}var ZS={id:"tooltip",_element:Of,positioners:ms,afterInit(n,t,e){e&&(n.tooltip=new Of({chart:n,options:e}))},beforeUpdate(n,t,e){n.tooltip&&n.tooltip.initialize(e)},reset(n,t,e){n.tooltip&&n.tooltip.initialize(e)},afterDraw(n){const t=n.tooltip;if(t&&t._willRender()){const e={tooltip:t};if(n.notifyPlugins("beforeTooltipDraw",{...e,cancelable:!0})===!1)return;t.draw(n.ctx),n.notifyPlugins("afterTooltipDraw",e)}},afterEvent(n,t){if(n.tooltip){const e=t.replay;n.tooltip.handleEvent(t.event,e,t.inChartArea)&&(t.changed=!0)}},defaults:{enabled:!0,external:null,position:"average",backgroundColor:"rgba(0,0,0,0.8)",titleColor:"#fff",titleFont:{weight:"bold"},titleSpacing:2,titleMarginBottom:6,titleAlign:"left",bodyColor:"#fff",bodySpacing:2,bodyFont:{},bodyAlign:"left",footerColor:"#fff",footerSpacing:2,footerMarginTop:6,footerFont:{weight:"bold"},footerAlign:"left",padding:6,caretPadding:2,caretSize:5,cornerRadius:6,boxHeight:(n,t)=>t.bodyFont.size,boxWidth:(n,t)=>t.bodyFont.size,multiKeyBackground:"#fff",displayColors:!0,boxPadding:0,borderColor:"rgba(0,0,0,0)",borderWidth:0,animation:{duration:400,easing:"easeOutQuart"},animations:{numbers:{type:"number",properties:["x","y","width","height","caretX","caretY"]},opacity:{easing:"linear",duration:200}},callbacks:fy},defaultRoutes:{bodyFont:"font",footerFont:"font",titleFont:"font"},descriptors:{_scriptable:n=>n!=="filter"&&n!=="itemSort"&&n!=="external",_indexable:!1,callbacks:{_scriptable:!1,_indexable:!1},animation:{_fallback:!1},animations:{_fallback:"animation"}},additionalOptionScopes:["interaction"]},tC=Object.freeze({__proto__:null,Colors:dS,Decimation:mS,Filler:LS,Legend:$S,SubTitle:WS,Title:HS,Tooltip:ZS});const eC=(n,t,e,i)=>(typeof t=="string"?(e=n.push(t)-1,i.unshift({index:e,label:t})):isNaN(t)&&(e=null),e);function nC(n,t,e,i){const s=n.indexOf(t);if(s===-1)return eC(n,t,e,i);const r=n.lastIndexOf(t);return s!==r?e:s}const iC=(n,t)=>n===null?null:Mt(Math.round(n),0,t);function Vf(n){const t=this.getLabels();return n>=0&&n<t.length?t[n]:n}class sC extends si{static id="category";static defaults={ticks:{callback:Vf}};constructor(t){super(t),this._startValue=void 0,this._valueRange=0,this._addedLabels=[]}init(t){const e=this._addedLabels;if(e.length){const i=this.getLabels();for(const{index:s,label:r}of e)i[s]===r&&i.splice(s,1);this._addedLabels=[]}super.init(t)}parse(t,e){if(Y(t))return null;const i=this.getLabels();return e=isFinite(e)&&i[e]===t?e:nC(i,t,W(e,t),this._addedLabels),iC(e,i.length-1)}determineDataLimits(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let{min:i,max:s}=this.getMinMax(!0);this.options.bounds==="ticks"&&(t||(i=0),e||(s=this.getLabels().length-1)),this.min=i,this.max=s}buildTicks(){const t=this.min,e=this.max,i=this.options.offset,s=[];let r=this.getLabels();r=t===0&&e===r.length-1?r:r.slice(t,e+1),this._valueRange=Math.max(r.length-(i?0:1),1),this._startValue=this.min-(i?.5:0);for(let o=t;o<=e;o++)s.push({value:o});return s}getLabelForValue(t){return Vf.call(this,t)}configure(){super.configure(),this.isHorizontal()||(this._reversePixels=!this._reversePixels)}getPixelForValue(t){return typeof t!="number"&&(t=this.parse(t)),t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getPixelForTick(t){const e=this.ticks;return t<0||t>e.length-1?null:this.getPixelForValue(e[t].value)}getValueForPixel(t){return Math.round(this._startValue+this.getDecimalForPixel(t)*this._valueRange)}getBasePixel(){return this.bottom}}function rC(n,t){const e=[],{bounds:s,step:r,min:o,max:a,precision:l,count:u,maxTicks:h,maxDigits:d,includeBounds:p}=n,m=r||1,b=h-1,{min:v,max:E}=t,C=!Y(o),P=!Y(a),k=!Y(u),M=(E-v)/(d+1);let O=Cd((E-v)/b/m)*m,N,w,y,T;if(O<1e-14&&!C&&!P)return[{value:v},{value:E}];T=Math.ceil(E/O)-Math.floor(v/O),T>b&&(O=Cd(T*O/b/m)*m),Y(l)||(N=Math.pow(10,l),O=Math.ceil(O*N)/N),s==="ticks"?(w=Math.floor(v/O)*O,y=Math.ceil(E/O)*O):(w=v,y=E),C&&P&&r&&zx((a-o)/r,O/1e3)?(T=Math.round(Math.min((a-o)/O,h)),O=(a-o)/T,w=o,y=a):k?(w=C?o:w,y=P?a:y,T=u-1,O=(y-w)/T):(T=(y-w)/O,xs(T,Math.round(T),O/1e3)?T=Math.round(T):T=Math.ceil(T));const A=Math.max(Pd(O),Pd(w));N=Math.pow(10,Y(l)?A:l),w=Math.round(w*N)/N,y=Math.round(y*N)/N;let x=0;for(C&&(p&&w!==o?(e.push({value:o}),w<o&&x++,xs(Math.round((w+x*O)*N)/N,o,Lf(o,M,n))&&x++):w<o&&x++);x<T;++x){const S=Math.round((w+x*O)*N)/N;if(P&&S>a)break;e.push({value:S})}return P&&p&&y!==a?e.length&&xs(e[e.length-1].value,a,Lf(a,M,n))?e[e.length-1].value=a:e.push({value:a}):(!P||y===a)&&e.push({value:y}),e}function Lf(n,t,{horizontal:e,minRotation:i}){const s=ce(i),r=(e?Math.sin(s):Math.cos(s))||.001,o=.75*t*(""+n).length;return Math.min(t/r,o)}class So extends si{constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._endValue=void 0,this._valueRange=0}parse(t,e){return Y(t)||(typeof t=="number"||t instanceof Number)&&!isFinite(+t)?null:+t}handleTickRangeOptions(){const{beginAtZero:t}=this.options,{minDefined:e,maxDefined:i}=this.getUserBounds();let{min:s,max:r}=this;const o=l=>s=e?s:l,a=l=>r=i?r:l;if(t){const l=Te(s),u=Te(r);l<0&&u<0?a(0):l>0&&u>0&&o(0)}if(s===r){let l=r===0?1:Math.abs(r*.05);a(r+l),t||o(s-l)}this.min=s,this.max=r}getTickLimit(){const t=this.options.ticks;let{maxTicksLimit:e,stepSize:i}=t,s;return i?(s=Math.ceil(this.max/i)-Math.floor(this.min/i)+1,s>1e3&&(console.warn(`scales.${this.id}.ticks.stepSize: ${i} would result generating up to ${s} ticks. Limiting to 1000.`),s=1e3)):(s=this.computeTickLimit(),e=e||11),e&&(s=Math.min(e,s)),s}computeTickLimit(){return Number.POSITIVE_INFINITY}buildTicks(){const t=this.options,e=t.ticks;let i=this.getTickLimit();i=Math.max(2,i);const s={maxTicks:i,bounds:t.bounds,min:t.min,max:t.max,precision:e.precision,step:e.stepSize,count:e.count,maxDigits:this._maxDigits(),horizontal:this.isHorizontal(),minRotation:e.minRotation||0,includeBounds:e.includeBounds!==!1},r=this._range||this,o=rC(s,r);return t.bounds==="ticks"&&Em(o,this,"value"),t.reverse?(o.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),o}configure(){const t=this.ticks;let e=this.min,i=this.max;if(super.configure(),this.options.offset&&t.length){const s=(i-e)/Math.max(t.length-1,1)/2;e-=s,i+=s}this._startValue=e,this._endValue=i,this._valueRange=i-e}getLabelForValue(t){return ar(t,this.chart.options.locale,this.options.ticks.format)}}class oC extends So{static id="linear";static defaults={ticks:{callback:Wo.formatters.numeric}};determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=bt(t)?t:0,this.max=bt(e)?e:1,this.handleTickRangeOptions()}computeTickLimit(){const t=this.isHorizontal(),e=t?this.width:this.height,i=ce(this.options.ticks.minRotation),s=(t?Math.sin(i):Math.cos(i))||.001,r=this._resolveTickFontOptions(0);return Math.ceil(e/Math.min(40,r.lineHeight/s))}getPixelForValue(t){return t===null?NaN:this.getPixelForDecimal((t-this._startValue)/this._valueRange)}getValueForPixel(t){return this._startValue+this.getDecimalForPixel(t)*this._valueRange}}const Ws=n=>Math.floor(an(n)),Vn=(n,t)=>Math.pow(10,Ws(n)+t);function Nf(n){return n/Math.pow(10,Ws(n))===1}function Ff(n,t,e){const i=Math.pow(10,e),s=Math.floor(n/i);return Math.ceil(t/i)-s}function aC(n,t){const e=t-n;let i=Ws(e);for(;Ff(n,t,i)>10;)i++;for(;Ff(n,t,i)<10;)i--;return Math.min(i,Ws(n))}function lC(n,{min:t,max:e}){t=te(n.min,t);const i=[],s=Ws(t);let r=aC(t,e),o=r<0?Math.pow(10,Math.abs(r)):1;const a=Math.pow(10,r),l=s>r?Math.pow(10,s):0,u=Math.round((t-l)*o)/o,h=Math.floor((t-l)/a/10)*a*10;let d=Math.floor((u-h)/Math.pow(10,r)),p=te(n.min,Math.round((l+h+d*Math.pow(10,r))*o)/o);for(;p<e;)i.push({value:p,major:Nf(p),significand:d}),d>=10?d=d<15?15:20:d++,d>=20&&(r++,d=2,o=r>=0?1:o),p=Math.round((l+h+d*Math.pow(10,r))*o)/o;const m=te(n.max,p);return i.push({value:m,major:Nf(m),significand:d}),i}class cC extends si{static id="logarithmic";static defaults={ticks:{callback:Wo.formatters.logarithmic,major:{enabled:!0}}};constructor(t){super(t),this.start=void 0,this.end=void 0,this._startValue=void 0,this._valueRange=0}parse(t,e){const i=So.prototype.parse.apply(this,[t,e]);if(i===0){this._zero=!0;return}return bt(i)&&i>0?i:null}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!0);this.min=bt(t)?Math.max(0,t):null,this.max=bt(e)?Math.max(0,e):null,this.options.beginAtZero&&(this._zero=!0),this._zero&&this.min!==this._suggestedMin&&!bt(this._userMin)&&(this.min=t===Vn(this.min,0)?Vn(this.min,-1):Vn(this.min,0)),this.handleTickRangeOptions()}handleTickRangeOptions(){const{minDefined:t,maxDefined:e}=this.getUserBounds();let i=this.min,s=this.max;const r=a=>i=t?i:a,o=a=>s=e?s:a;i===s&&(i<=0?(r(1),o(10)):(r(Vn(i,-1)),o(Vn(s,1)))),i<=0&&r(Vn(s,-1)),s<=0&&o(Vn(i,1)),this.min=i,this.max=s}buildTicks(){const t=this.options,e={min:this._userMin,max:this._userMax},i=lC(e,this);return t.bounds==="ticks"&&Em(i,this,"value"),t.reverse?(i.reverse(),this.start=this.max,this.end=this.min):(this.start=this.min,this.end=this.max),i}getLabelForValue(t){return t===void 0?"0":ar(t,this.chart.options.locale,this.options.ticks.format)}configure(){const t=this.min;super.configure(),this._startValue=an(t),this._valueRange=an(this.max)-an(t)}getPixelForValue(t){return(t===void 0||t===0)&&(t=this.min),t===null||isNaN(t)?NaN:this.getPixelForDecimal(t===this.min?0:(an(t)-this._startValue)/this._valueRange)}getValueForPixel(t){const e=this.getDecimalForPixel(t);return Math.pow(10,this._startValue+e*this._valueRange)}}function Ll(n){const t=n.ticks;if(t.display&&n.display){const e=qt(t.backdropPadding);return W(t.font&&t.font.size,gt.font.size)+e.height}return 0}function uC(n,t,e){return e=pt(e)?e:[e],{w:sI(n,t.string,e),h:e.length*t.lineHeight}}function Bf(n,t,e,i,s){return n===i||n===s?{start:t-e/2,end:t+e/2}:n<i||n>s?{start:t-e,end:t}:{start:t,end:t+e}}function hC(n){const t={l:n.left+n._padding.left,r:n.right-n._padding.right,t:n.top+n._padding.top,b:n.bottom-n._padding.bottom},e=Object.assign({},t),i=[],s=[],r=n._pointLabels.length,o=n.options.pointLabels,a=o.centerPointLabels?et/r:0;for(let l=0;l<r;l++){const u=o.setContext(n.getPointLabelContext(l));s[l]=u.padding;const h=n.getPointPosition(l,n.drawingArea+s[l],a),d=Ct(u.font),p=uC(n.ctx,d,n._pointLabels[l]);i[l]=p;const m=zt(n.getIndexAngle(l)+a),b=Math.round(Vc(m)),v=Bf(b,h.x,p.w,0,180),E=Bf(b,h.y,p.h,90,270);dC(e,t,m,v,E)}n.setCenterPoint(t.l-e.l,e.r-t.r,t.t-e.t,e.b-t.b),n._pointLabelItems=gC(n,i,s)}function dC(n,t,e,i,s){const r=Math.abs(Math.sin(e)),o=Math.abs(Math.cos(e));let a=0,l=0;i.start<t.l?(a=(t.l-i.start)/r,n.l=Math.min(n.l,t.l-a)):i.end>t.r&&(a=(i.end-t.r)/r,n.r=Math.max(n.r,t.r+a)),s.start<t.t?(l=(t.t-s.start)/o,n.t=Math.min(n.t,t.t-l)):s.end>t.b&&(l=(s.end-t.b)/o,n.b=Math.max(n.b,t.b+l))}function fC(n,t,e){const i=n.drawingArea,{extra:s,additionalAngle:r,padding:o,size:a}=e,l=n.getPointPosition(t,i+s+o,r),u=Math.round(Vc(zt(l.angle+wt))),h=_C(l.y,a.h,u),d=mC(u),p=yC(l.x,a.w,d);return{visible:!0,x:l.x,y:h,textAlign:d,left:p,top:h,right:p+a.w,bottom:h+a.h}}function pC(n,t){if(!t)return!0;const{left:e,top:i,right:s,bottom:r}=n;return!(Fe({x:e,y:i},t)||Fe({x:e,y:r},t)||Fe({x:s,y:i},t)||Fe({x:s,y:r},t))}function gC(n,t,e){const i=[],s=n._pointLabels.length,r=n.options,{centerPointLabels:o,display:a}=r.pointLabels,l={extra:Ll(r)/2,additionalAngle:o?et/s:0};let u;for(let h=0;h<s;h++){l.padding=e[h],l.size=t[h];const d=fC(n,h,l);i.push(d),a==="auto"&&(d.visible=pC(d,u),d.visible&&(u=d))}return i}function mC(n){return n===0||n===180?"center":n<180?"left":"right"}function yC(n,t,e){return e==="right"?n-=t:e==="center"&&(n-=t/2),n}function _C(n,t,e){return e===90||e===270?n-=t/2:(e>270||e<90)&&(n-=t),n}function bC(n,t,e){const{left:i,top:s,right:r,bottom:o}=e,{backdropColor:a}=t;if(!Y(a)){const l=Hn(t.borderRadius),u=qt(t.backdropPadding);n.fillStyle=a;const h=i-u.left,d=s-u.top,p=r-i+u.width,m=o-s+u.height;Object.values(l).some(b=>b!==0)?(n.beginPath(),js(n,{x:h,y:d,w:p,h:m,radius:l}),n.fill()):n.fillRect(h,d,p,m)}}function vC(n,t){const{ctx:e,options:{pointLabels:i}}=n;for(let s=t-1;s>=0;s--){const r=n._pointLabelItems[s];if(!r.visible)continue;const o=i.setContext(n.getPointLabelContext(s));bC(e,o,r);const a=Ct(o.font),{x:l,y:u,textAlign:h}=r;Jn(e,n._pointLabels[s],l,u+a.lineHeight/2,a,{color:o.color,textAlign:h,textBaseline:"middle"})}}function py(n,t,e,i){const{ctx:s}=n;if(e)s.arc(n.xCenter,n.yCenter,t,0,ft);else{let r=n.getPointPosition(0,t);s.moveTo(r.x,r.y);for(let o=1;o<i;o++)r=n.getPointPosition(o,t),s.lineTo(r.x,r.y)}}function wC(n,t,e,i,s){const r=n.ctx,o=t.circular,{color:a,lineWidth:l}=t;!o&&!i||!a||!l||e<0||(r.save(),r.strokeStyle=a,r.lineWidth=l,r.setLineDash(s.dash||[]),r.lineDashOffset=s.dashOffset,r.beginPath(),py(n,e,o,i),r.closePath(),r.stroke(),r.restore())}function EC(n,t,e){return In(n,{label:e,index:t,type:"pointLabel"})}class TC extends So{static id="radialLinear";static defaults={display:!0,animate:!0,position:"chartArea",angleLines:{display:!0,lineWidth:1,borderDash:[],borderDashOffset:0},grid:{circular:!1},startAngle:0,ticks:{showLabelBackdrop:!0,callback:Wo.formatters.numeric},pointLabels:{backdropColor:void 0,backdropPadding:2,display:!0,font:{size:10},callback(t){return t},padding:5,centerPointLabels:!1}};static defaultRoutes={"angleLines.color":"borderColor","pointLabels.color":"color","ticks.color":"color"};static descriptors={angleLines:{_fallback:"grid"}};constructor(t){super(t),this.xCenter=void 0,this.yCenter=void 0,this.drawingArea=void 0,this._pointLabels=[],this._pointLabelItems=[]}setDimensions(){const t=this._padding=qt(Ll(this.options)/2),e=this.width=this.maxWidth-t.width,i=this.height=this.maxHeight-t.height;this.xCenter=Math.floor(this.left+e/2+t.left),this.yCenter=Math.floor(this.top+i/2+t.top),this.drawingArea=Math.floor(Math.min(e,i)/2)}determineDataLimits(){const{min:t,max:e}=this.getMinMax(!1);this.min=bt(t)&&!isNaN(t)?t:0,this.max=bt(e)&&!isNaN(e)?e:0,this.handleTickRangeOptions()}computeTickLimit(){return Math.ceil(this.drawingArea/Ll(this.options))}generateTickLabels(t){So.prototype.generateTickLabels.call(this,t),this._pointLabels=this.getLabels().map((e,i)=>{const s=lt(this.options.pointLabels.callback,[e,i],this);return s||s===0?s:""}).filter((e,i)=>this.chart.getDataVisibility(i))}fit(){const t=this.options;t.display&&t.pointLabels.display?hC(this):this.setCenterPoint(0,0,0,0)}setCenterPoint(t,e,i,s){this.xCenter+=Math.floor((t-e)/2),this.yCenter+=Math.floor((i-s)/2),this.drawingArea-=Math.min(this.drawingArea/2,Math.max(t,e,i,s))}getIndexAngle(t){const e=ft/(this._pointLabels.length||1),i=this.options.startAngle||0;return zt(t*e+ce(i))}getDistanceFromCenterForValue(t){if(Y(t))return NaN;const e=this.drawingArea/(this.max-this.min);return this.options.reverse?(this.max-t)*e:(t-this.min)*e}getValueForDistanceFromCenter(t){if(Y(t))return NaN;const e=t/(this.drawingArea/(this.max-this.min));return this.options.reverse?this.max-e:this.min+e}getPointLabelContext(t){const e=this._pointLabels||[];if(t>=0&&t<e.length){const i=e[t];return EC(this.getContext(),t,i)}}getPointPosition(t,e,i=0){const s=this.getIndexAngle(t)-wt+i;return{x:Math.cos(s)*e+this.xCenter,y:Math.sin(s)*e+this.yCenter,angle:s}}getPointPositionForValue(t,e){return this.getPointPosition(t,this.getDistanceFromCenterForValue(e))}getBasePosition(t){return this.getPointPositionForValue(t||0,this.getBaseValue())}getPointLabelPosition(t){const{left:e,top:i,right:s,bottom:r}=this._pointLabelItems[t];return{left:e,top:i,right:s,bottom:r}}drawBackground(){const{backgroundColor:t,grid:{circular:e}}=this.options;if(t){const i=this.ctx;i.save(),i.beginPath(),py(this,this.getDistanceFromCenterForValue(this._endValue),e,this._pointLabels.length),i.closePath(),i.fillStyle=t,i.fill(),i.restore()}}drawGrid(){const t=this.ctx,e=this.options,{angleLines:i,grid:s,border:r}=e,o=this._pointLabels.length;let a,l,u;if(e.pointLabels.display&&vC(this,o),s.display&&this.ticks.forEach((h,d)=>{if(d!==0||d===0&&this.min<0){l=this.getDistanceFromCenterForValue(h.value);const p=this.getContext(d),m=s.setContext(p),b=r.setContext(p);wC(this,m,l,o,b)}}),i.display){for(t.save(),a=o-1;a>=0;a--){const h=i.setContext(this.getPointLabelContext(a)),{color:d,lineWidth:p}=h;!p||!d||(t.lineWidth=p,t.strokeStyle=d,t.setLineDash(h.borderDash),t.lineDashOffset=h.borderDashOffset,l=this.getDistanceFromCenterForValue(e.reverse?this.min:this.max),u=this.getPointPosition(a,l),t.beginPath(),t.moveTo(this.xCenter,this.yCenter),t.lineTo(u.x,u.y),t.stroke())}t.restore()}}drawBorder(){}drawLabels(){const t=this.ctx,e=this.options,i=e.ticks;if(!i.display)return;const s=this.getIndexAngle(0);let r,o;t.save(),t.translate(this.xCenter,this.yCenter),t.rotate(s),t.textAlign="center",t.textBaseline="middle",this.ticks.forEach((a,l)=>{if(l===0&&this.min>=0&&!e.reverse)return;const u=i.setContext(this.getContext(l)),h=Ct(u.font);if(r=this.getDistanceFromCenterForValue(this.ticks[l].value),u.showLabelBackdrop){t.font=h.string,o=t.measureText(a.label).width,t.fillStyle=u.backdropColor;const d=qt(u.backdropPadding);t.fillRect(-o/2-d.left,-r-h.size/2-d.top,o+d.width,h.size+d.height)}Jn(t,a.label,0,-r,h,{color:u.color,strokeColor:u.textStrokeColor,strokeWidth:u.textStrokeWidth})}),t.restore()}drawTitle(){}}const Jo={millisecond:{common:!0,size:1,steps:1e3},second:{common:!0,size:1e3,steps:60},minute:{common:!0,size:6e4,steps:60},hour:{common:!0,size:36e5,steps:24},day:{common:!0,size:864e5,steps:30},week:{common:!1,size:6048e5,steps:4},month:{common:!0,size:2628e6,steps:12},quarter:{common:!1,size:7884e6,steps:4},year:{common:!0,size:3154e7}},Jt=Object.keys(Jo);function Uf(n,t){return n-t}function zf(n,t){if(Y(t))return null;const e=n._adapter,{parser:i,round:s,isoWeekday:r}=n._parseOpts;let o=t;return typeof i=="function"&&(o=i(o)),bt(o)||(o=typeof i=="string"?e.parse(o,i):e.parse(o)),o===null?null:(s&&(o=s==="week"&&(Ri(r)||r===!0)?e.startOf(o,"isoWeek",r):e.startOf(o,s)),+o)}function $f(n,t,e,i){const s=Jt.length;for(let r=Jt.indexOf(n);r<s-1;++r){const o=Jo[Jt[r]],a=o.steps?o.steps:Number.MAX_SAFE_INTEGER;if(o.common&&Math.ceil((e-t)/(a*o.size))<=i)return Jt[r]}return Jt[s-1]}function xC(n,t,e,i,s){for(let r=Jt.length-1;r>=Jt.indexOf(e);r--){const o=Jt[r];if(Jo[o].common&&n._adapter.diff(s,i,o)>=t-1)return o}return Jt[e?Jt.indexOf(e):0]}function IC(n){for(let t=Jt.indexOf(n)+1,e=Jt.length;t<e;++t)if(Jo[Jt[t]].common)return Jt[t]}function jf(n,t,e){if(!e)n[t]=!0;else if(e.length){const{lo:i,hi:s}=Lc(e,t),r=e[i]>=t?e[i]:e[s];n[r]=!0}}function AC(n,t,e,i){const s=n._adapter,r=+s.startOf(t[0].value,i),o=t[t.length-1].value;let a,l;for(a=r;a<=o;a=+s.add(a,1,i))l=e[a],l>=0&&(t[l].major=!0);return t}function Hf(n,t,e){const i=[],s={},r=t.length;let o,a;for(o=0;o<r;++o)a=t[o],s[a]=o,i.push({value:a,major:!1});return r===0||!e?i:AC(n,i,s,e)}class Nl extends si{static id="time";static defaults={bounds:"data",adapters:{},time:{parser:!1,unit:!1,round:!1,isoWeekday:!1,minUnit:"millisecond",displayFormats:{}},ticks:{source:"auto",callback:!1,major:{enabled:!1}}};constructor(t){super(t),this._cache={data:[],labels:[],all:[]},this._unit="day",this._majorUnit=void 0,this._offsets={},this._normalized=!1,this._parseOpts=void 0}init(t,e={}){const i=t.time||(t.time={}),s=this._adapter=new SA._date(t.adapters.date);s.init(e),Ts(i.displayFormats,s.formats()),this._parseOpts={parser:i.parser,round:i.round,isoWeekday:i.isoWeekday},super.init(t),this._normalized=e.normalized}parse(t,e){return t===void 0?null:zf(this,t)}beforeLayout(){super.beforeLayout(),this._cache={data:[],labels:[],all:[]}}determineDataLimits(){const t=this.options,e=this._adapter,i=t.time.unit||"day";let{min:s,max:r,minDefined:o,maxDefined:a}=this.getUserBounds();function l(u){!o&&!isNaN(u.min)&&(s=Math.min(s,u.min)),!a&&!isNaN(u.max)&&(r=Math.max(r,u.max))}(!o||!a)&&(l(this._getLabelBounds()),(t.bounds!=="ticks"||t.ticks.source!=="labels")&&l(this.getMinMax(!1))),s=bt(s)&&!isNaN(s)?s:+e.startOf(Date.now(),i),r=bt(r)&&!isNaN(r)?r:+e.endOf(Date.now(),i)+1,this.min=Math.min(s,r-1),this.max=Math.max(s+1,r)}_getLabelBounds(){const t=this.getLabelTimestamps();let e=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;return t.length&&(e=t[0],i=t[t.length-1]),{min:e,max:i}}buildTicks(){const t=this.options,e=t.time,i=t.ticks,s=i.source==="labels"?this.getLabelTimestamps():this._generate();t.bounds==="ticks"&&s.length&&(this.min=this._userMin||s[0],this.max=this._userMax||s[s.length-1]);const r=this.min,o=this.max,a=Wx(s,r,o);return this._unit=e.unit||(i.autoSkip?$f(e.minUnit,this.min,this.max,this._getLabelCapacity(r)):xC(this,a.length,e.minUnit,this.min,this.max)),this._majorUnit=!i.major.enabled||this._unit==="year"?void 0:IC(this._unit),this.initOffsets(s),t.reverse&&a.reverse(),Hf(this,a,this._majorUnit)}afterAutoSkip(){this.options.offsetAfterAutoskip&&this.initOffsets(this.ticks.map(t=>+t.value))}initOffsets(t=[]){let e=0,i=0,s,r;this.options.offset&&t.length&&(s=this.getDecimalForValue(t[0]),t.length===1?e=1-s:e=(this.getDecimalForValue(t[1])-s)/2,r=this.getDecimalForValue(t[t.length-1]),t.length===1?i=r:i=(r-this.getDecimalForValue(t[t.length-2]))/2);const o=t.length<3?.5:.25;e=Mt(e,0,o),i=Mt(i,0,o),this._offsets={start:e,end:i,factor:1/(e+1+i)}}_generate(){const t=this._adapter,e=this.min,i=this.max,s=this.options,r=s.time,o=r.unit||$f(r.minUnit,e,i,this._getLabelCapacity(e)),a=W(s.ticks.stepSize,1),l=o==="week"?r.isoWeekday:!1,u=Ri(l)||l===!0,h={};let d=e,p,m;if(u&&(d=+t.startOf(d,"isoWeek",l)),d=+t.startOf(d,u?"day":o),t.diff(i,e,o)>1e5*a)throw new Error(e+" and "+i+" are too far apart with stepSize of "+a+" "+o);const b=s.ticks.source==="data"&&this.getDataTimestamps();for(p=d,m=0;p<i;p=+t.add(p,a,o),m++)jf(h,p,b);return(p===i||s.bounds==="ticks"||m===1)&&jf(h,p,b),Object.keys(h).sort(Uf).map(v=>+v)}getLabelForValue(t){const e=this._adapter,i=this.options.time;return i.tooltipFormat?e.format(t,i.tooltipFormat):e.format(t,i.displayFormats.datetime)}format(t,e){const s=this.options.time.displayFormats,r=this._unit,o=e||s[r];return this._adapter.format(t,o)}_tickFormatFunction(t,e,i,s){const r=this.options,o=r.ticks.callback;if(o)return lt(o,[t,e,i],this);const a=r.time.displayFormats,l=this._unit,u=this._majorUnit,h=l&&a[l],d=u&&a[u],p=i[e],m=u&&d&&p&&p.major;return this._adapter.format(t,s||(m?d:h))}generateTickLabels(t){let e,i,s;for(e=0,i=t.length;e<i;++e)s=t[e],s.label=this._tickFormatFunction(s.value,e,t)}getDecimalForValue(t){return t===null?NaN:(t-this.min)/(this.max-this.min)}getPixelForValue(t){const e=this._offsets,i=this.getDecimalForValue(t);return this.getPixelForDecimal((e.start+i)*e.factor)}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return this.min+i*(this.max-this.min)}_getLabelSize(t){const e=this.options.ticks,i=this.ctx.measureText(t).width,s=ce(this.isHorizontal()?e.maxRotation:e.minRotation),r=Math.cos(s),o=Math.sin(s),a=this._resolveTickFontOptions(0).size;return{w:i*r+a*o,h:i*o+a*r}}_getLabelCapacity(t){const e=this.options.time,i=e.displayFormats,s=i[e.unit]||i.millisecond,r=this._tickFormatFunction(t,0,Hf(this,[t],this._majorUnit),s),o=this._getLabelSize(r),a=Math.floor(this.isHorizontal()?this.width/o.w:this.height/o.h)-1;return a>0?a:1}getDataTimestamps(){let t=this._cache.data||[],e,i;if(t.length)return t;const s=this.getMatchingVisibleMetas();if(this._normalized&&s.length)return this._cache.data=s[0].controller.getAllParsedValues(this);for(e=0,i=s.length;e<i;++e)t=t.concat(s[e].controller.getAllParsedValues(this));return this._cache.data=this.normalize(t)}getLabelTimestamps(){const t=this._cache.labels||[];let e,i;if(t.length)return t;const s=this.getLabels();for(e=0,i=s.length;e<i;++e)t.push(zf(this,s[e]));return this._cache.labels=this._normalized?t:this.normalize(t)}normalize(t){return Im(t.sort(Uf))}}function Br(n,t,e){let i=0,s=n.length-1,r,o,a,l;e?(t>=n[i].pos&&t<=n[s].pos&&({lo:i,hi:s}=Ne(n,"pos",t)),{pos:r,time:a}=n[i],{pos:o,time:l}=n[s]):(t>=n[i].time&&t<=n[s].time&&({lo:i,hi:s}=Ne(n,"time",t)),{time:r,pos:a}=n[i],{time:o,pos:l}=n[s]);const u=o-r;return u?a+(l-a)*(t-r)/u:a}class SC extends Nl{static id="timeseries";static defaults=Nl.defaults;constructor(t){super(t),this._table=[],this._minPos=void 0,this._tableRange=void 0}initOffsets(){const t=this._getTimestampsForTable(),e=this._table=this.buildLookupTable(t);this._minPos=Br(e,this.min),this._tableRange=Br(e,this.max)-this._minPos,super.initOffsets(t)}buildLookupTable(t){const{min:e,max:i}=this,s=[],r=[];let o,a,l,u,h;for(o=0,a=t.length;o<a;++o)u=t[o],u>=e&&u<=i&&s.push(u);if(s.length<2)return[{time:e,pos:0},{time:i,pos:1}];for(o=0,a=s.length;o<a;++o)h=s[o+1],l=s[o-1],u=s[o],Math.round((h+l)/2)!==u&&r.push({time:u,pos:o/(a-1)});return r}_generate(){const t=this.min,e=this.max;let i=super.getDataTimestamps();return(!i.includes(t)||!i.length)&&i.splice(0,0,t),(!i.includes(e)||i.length===1)&&i.push(e),i.sort((s,r)=>s-r)}_getTimestampsForTable(){let t=this._cache.all||[];if(t.length)return t;const e=this.getDataTimestamps(),i=this.getLabelTimestamps();return e.length&&i.length?t=this.normalize(e.concat(i)):t=e.length?e:i,t=this._cache.all=t,t}getDecimalForValue(t){return(Br(this._table,t)-this._minPos)/this._tableRange}getValueForPixel(t){const e=this._offsets,i=this.getDecimalForPixel(t)/e.factor-e.end;return Br(this._table,i*this._tableRange+this._minPos,!0)}}var CC=Object.freeze({__proto__:null,CategoryScale:sC,LinearScale:oC,LogarithmicScale:cC,RadialLinearScale:TC,TimeScale:Nl,TimeSeriesScale:SC});const gy=[AA,rS,tC,CC];Zn.register(...gy);let Ga=null;function Ka(n){const t=document.getElementById("dashboard-container");if(!t)return;const{dashboard:e}=n,i=r=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(r),s=r=>`${r.toFixed(2)}%`;t.innerHTML=`
    <!-- Patrimnio -->
    <div class="card col-span-12 md-col-span-3">
      <div class="card-header">
        <span class="card-title">Patrimnio Total</span>
      </div>
      <div class="card-value">${i(e.totalBalance)}</div>
    </div>

    <!-- Lucro -->
    <div class="card col-span-12 md-col-span-3">
      <div class="card-header">
        <span class="card-title">Lucro Acumulado</span>
        <span class="badge ${e.profitPercentage>=0?"text-success":"text-danger"}" style="background: rgba(16, 185, 129, 0.1); padding: 2px 8px; border-radius: 4px; font-size: 0.8rem;">
          ${e.profitPercentage>=0?"+":""}${s(e.profitPercentage)}
        </span>
      </div>
      <div class="card-value ${e.profit>=0?"text-success":"text-danger"}">
        ${e.profit>=0?"+":""}${i(e.profit)}
      </div>
    </div>

    <!-- Meta Anual (Progress) -->
    <div class="card col-span-12 md-col-span-3">
        <div class="card-header">
             <span class="card-title">Meta Anual (1M)</span>
        </div>
        <div class="card-value">${i(e.totalBalance)}</div>
        <div style="margin-top: 0.5rem;">
             <div style="display:flex; justify-content:space-between; font-size:0.75rem; color:var(--text-secondary); margin-bottom: 2px;">
                <span>Progresso</span>
                <span>${(e.totalBalance/e.goal*100).toFixed(1)}%</span>
             </div>
             <div style="width:100%; height:8px; background-color: var(--border-color); border-radius: var(--radius-pill); overflow:hidden;">
                <div style="width: ${e.totalBalance/e.goal*100}%; height:100%; background-color: var(--primary-color);"></div>
             </div>
        </div>
    </div>

     <!-- Proventos (Dividends) -->
    <div class="card col-span-12 md-col-span-3">
        <div class="card-header">
            <span class="card-title">Proventos (Ms)</span>
        </div>
        <div class="card-value">R$ ${i(e.dividends)}</div>
         <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
            Recebidos este ms
        </div>
    </div>

    <!-- Alocao Chart -->
    <div class="card col-span-12 md-col-span-4" style="display: flex; flex-direction: column;">
       <div class="card-header"><span class="card-title">Alocao</span></div>
       <div style="flex: 1; position: relative; min-height: 250px;">
          <canvas id="allocationChart"></canvas>
       </div>
    </div>

    <!-- Top Ativos List -->
    <div class="card col-span-12 md-col-span-8">
       <div class="card-header"><span class="card-title">Top 10 - Maior Rentabilidade</span></div>
       <div style="overflow-x: auto;">
         <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
            <thead>
               <tr style="text-align: left; color: var(--text-secondary); border-bottom: 1px solid var(--border-color);">
                 <th style="padding: 0.75rem 0.5rem;">#</th>
                 <th style="padding: 0.75rem 0.5rem;">Ativo</th>
                 <th style="padding: 0.75rem 0.5rem;">Cat.</th>
                 <th style="padding: 0.75rem 0.5rem; text-align: right;">Rent.</th>
               </tr>
            </thead>
            <tbody>
              ${e.topAssets.map((r,o)=>`
                 <tr style="border-bottom: 1px solid var(--border-color);">
                   <td style="padding: 0.75rem 0.5rem; color: var(--text-secondary);">${o+1}</td>
                   <td style="padding: 0.75rem 0.5rem; font-weight: 500;">${r.name}</td>
                   <td style="padding: 0.75rem 0.5rem;">
                      <span style="background: var(--bg-color); padding: 2px 8px; border-radius: 4px; font-size: 0.75rem;">${r.ticker||"N/A"}</span>
                   </td>
                   <td style="padding: 0.75rem 0.5rem; text-align: right; color: var(--success-color); font-weight: 600;">
                     +${s(r.percentage)}
                   </td>
                 </tr>
              `).join("")}
            </tbody>
         </table>
       </div>
    </div>
  `,setTimeout(()=>{const r=document.getElementById("allocationChart");r&&(Ga&&Ga.destroy(),Ga=new Zn(r,{type:"doughnut",data:{labels:e.allocation.labels,datasets:[{data:e.allocation.data,backgroundColor:e.allocation.colors,borderWidth:0,hoverOffset:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{usePointStyle:!0,padding:20,font:{family:"'Inter', sans-serif",size:12,weight:500},color:"#64748b"}}},layout:{padding:0}}}))},0)}const qs={home:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>',scale:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3" /></svg>',shield:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" /></svg>',clipboard:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01" /></svg>',trendUp:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" /></svg>',building:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4" /></svg>',menu:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16" /></svg>',cog:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg>',plus:'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 4v16m8-8H4" /></svg>',construction:'<svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" stroke-linejoin="round" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>'};function PC(n,t){const e=document.getElementById(n);e&&(e.innerHTML=`
    <div style="
      display: flex; 
      flex-direction: column; 
      align-items: center; 
      justify-content: center; 
      height: 60vh; 
      text-align: center;
      color: var(--text-secondary);
      animation: fadeIn 0.5s ease;
    ">
      <div style="
        width: 80px; 
        height: 80px; 
        background: var(--bg-color); 
        border-radius: 50%; 
        display: flex; 
        align-items: center; 
        justify-content: center;
        margin-bottom: 1.5rem;
        color: var(--primary-color);
      ">
        ${qs.construction}
      </div>
      <h2 style="
        font-size: 1.5rem; 
        color: var(--text-primary); 
        margin-bottom: 0.5rem;
        font-weight: 700;
      ">Em desenvolvimento</h2>
      <p style="max-width: 300px;">
        O mdulo de <strong>${t}</strong> est sendo construdo para a prxima verso.
      </p>
    </div>
  `)}class Gs{constructor(t,e,i){this.container=document.getElementById(t),this.options=e,this.onSelect=i,this.value=null,this.isOpen=!1,this.render()}render(){this.container.classList.add("custom-select"),this.container.innerHTML=`
      <div class="select-trigger">
        <span>Selecione...</span>
        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" />
        </svg>
      </div>
      <div class="select-options">
        ${this.options.map(t=>`
          <div class="select-option" data-value="${t.value}">${t.label}</div>
        `).join("")}
      </div>
    `,this.trigger=this.container.querySelector(".select-trigger"),this.optionsEl=this.container.querySelector(".select-options"),this.triggerLabel=this.trigger.querySelector("span"),this.trigger.addEventListener("click",t=>{t.stopPropagation(),this.toggle()}),this.container.querySelectorAll(".select-option").forEach(t=>{t.addEventListener("click",e=>{e.stopPropagation(),this.select(t.dataset.value,t.textContent)})}),document.addEventListener("click",()=>this.close())}toggle(){this.isOpen=!this.isOpen,this.container.classList.toggle("open",this.isOpen)}close(){this.isOpen=!1,this.container.classList.remove("open")}select(t,e){this.value=t,this.triggerLabel.textContent=e,this.close(),this.onSelect&&this.onSelect(t),this.container.querySelectorAll(".select-option").forEach(i=>{i.classList.toggle("selected",i.dataset.value===t)})}getValue(){return this.value}}function RC(){console.log("openImportModal chamado!");try{const n="import-modal";let t=document.getElementById(n);t&&t.remove(),t=document.createElement("div"),t.id=n,t.className="modal-overlay",document.body.appendChild(t);let e=1,i="",s=[],r=[];const o=()=>{t.innerHTML=`
                <div class="modal-content" style="max-width: 600px; width: 90%;">
                    <div class="modal-header">
                        <h2 class="modal-title">Importar Dados</h2>
                        <span class="close-modal">&times;</span>
                    </div>
                    
                    <div class="modal-body" style="padding: 2rem;">
                        
                        <!-- Progress Bar -->
                        <div style="display: flex; justify-content: space-between; margin-bottom: 2.5rem; position: relative; max-width: 400px; margin-left: auto; margin-right: auto;">
                            <div style="position: absolute; top: 14px; left: 0; right: 0; height: 2px; background: var(--border-color); z-index: 0;"></div>
                            <div style="position: absolute; top: 14px; left: 0; width: ${a()}%; height: 2px; background: var(--primary-color); z-index: 0; transition: width 0.3s;"></div>
                            
                            ${l(1,"Seleo")}
                            ${l(2,"Validao")}
                            ${l(3,"Importao")}
                        </div>

                        <!-- Step Content -->
                        <div id="step-content">
                            ${u()}
                        </div>

                    </div>
                    
                    <div class="modal-footer" style="justify-content: flex-end; gap: 1rem; padding: 1.5rem; border-top: 1px solid var(--border-color);">
                        <button id="btn-cancel" class="btn btn-ghost" style="margin-right: auto;">Cancelar</button>
                        ${e>1&&e<3?'<button id="btn-back" class="btn btn-outline">Voltar</button>':""}
                        ${h()}
                    </div>
                </div>
            `,d(),e===1&&new Gs("module-select-container",[{value:"fixed_income",label:"Renda Fixa"},{value:"variable_income",label:"Renda Varivel"},{value:"treasury",label:"Tesouro Direto"}],P=>{i=P,o()},i)},a=()=>e===1?0:e===2?50:100,l=(P,k)=>{const M=e>=P;return`
                <div style="z-index: 1; text-align: center; background: var(--bg-card); padding: 0 5px;">
                    <div style="width: 28px; height: 28px; border-radius: 50%; background: ${M?"var(--primary-color)":"var(--bg-card)"}; border: 2px solid ${M?"var(--primary-color)":"var(--border-color)"}; color: ${M?"#fff":"var(--text-secondary)"}; display: flex; align-items: center; justify-content: center; font-weight: bold; margin: 0 auto; font-size: 0.9rem;">${P}</div>
                    <div style="font-size: 0.75rem; margin-top: 8px; color: ${M?"var(--primary-color)":"var(--text-secondary)"}; font-weight: ${M?"600":"400"};">${k}</div>
                </div>
            `},u=()=>{if(e===1){const P=i==="fixed_income"?"Renda Fixa":i==="variable_income"?"Renda Varivel":i==="treasury"?"Tesouro Direto":"Selecione...";return`
                    <div class="form-group">
                        <label class="form-label">Mdulo de Destino</label>
                        <div id="module-select-container">
                             <!-- Custom Select will be injected here -->
                             <!-- We can pre-fill the HTML structure if we want slightly better flicker handling, but JS init is fast enough -->
                        </div>
                    </div>

                    <div id="module-info" style="margin-top: 2rem; min-height: 120px;">
                        ${i==="fixed_income"?`
                            <div style="background: var(--bg-hover); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid var(--border-color);">
                                <h4 style="margin-bottom: 0.75rem; color: var(--text-primary);">Instrues</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.5;">
                                    O arquivo CSV deve conter um cabealho com as colunas exatas abaixo:
                                </p>
                                <div style="background: var(--bg-card); padding: 0.75rem; border-radius: var(--radius-sm); font-family: monospace; font-size: 0.85rem; color: var(--primary-color); border: 1px solid var(--border-color); margin-bottom: 1rem; overflow-x: auto;">
                                    date, issuer, type, indexer, rate, amount
                                </div>
                                <button id="btn-download-sample" class="btn btn-ghost btn-sm" style="padding-left: 0; color: var(--primary-color);">
                                    <span style="margin-right: 5px;"></span> Baixar modelo CSV
                                </button>
                            </div>
                        `:i&&i!=="fixed_income"?`
                            <div style="background: rgba(255, 193, 7, 0.1); padding: 1.5rem; border-radius: var(--radius-md); border: 1px solid rgba(255, 193, 7, 0.3);">
                                <h4 style="color: #d39e00; margin-bottom: 0.5rem;">Em desenvolvimento</h4>
                                <p style="font-size: 0.9rem; color: var(--text-secondary); line-height: 1.5;">
                                    A importao para o mdulo selecionado estar disponvel em breve.
                                </p>
                            </div>
                        `:`
                            <div style="text-align: center; color: var(--text-secondary); padding: 2rem; border: 2px dashed var(--border-color); border-radius: var(--radius-md);">
                                <p>Selecione um mdulo acima para ver as instrues.</p>
                            </div>
                        `}
                    </div>
                `}else{if(e===2)return`
                    <div style="text-align: center; border: 2px dashed var(--border-color); padding: 3rem 2rem; border-radius: var(--radius-lg); background: var(--bg-hover); transition: all 0.2s;">
                        <input type="file" id="file-upload" accept=".csv" style="display: none;">
                        <div style="margin-bottom: 1.5rem;">
                            <span style="font-size: 3rem; opacity: 0.5;"></span>
                        </div>
                        <h4 style="margin-bottom: 0.5rem;">Upload de Arquivo</h4>
                        <p style="color: var(--text-secondary); margin-bottom: 1.5rem; font-size: 0.9rem;">
                            Arraste seu arquivo CSV aqui ou clique para selecionar
                        </p>
                        <button class="btn btn-outline" id="btn-select-file">Selecionar Arquivo</button>
                        <div id="file-name" style="margin-top: 1rem; font-weight: 500; color: var(--primary-color);"></div>
                    </div>

                    <div id="validation-results" style="margin-top: 1.5rem;"></div>
                `;if(e===3)return r.length===0&&s.length>0?`
                    <div style="text-align: center; padding: 2rem 1rem;">
                        <div style="width: 72px; height: 72px; margin: 0 auto 1.5rem auto; display: flex; align-items: center; justify-content: center; background: rgba(16, 185, 129, 0.1); border-radius: 50%;">
                            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--success-color)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="20 6 9 17 4 12"></polyline>
                            </svg>
                        </div>
                        
                        <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">Sucesso!</h2>
                        <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 300px; margin-left: auto; margin-right: auto;">
                            A importao foi finalizada e <b>${s.length}</b> ativos foram adicionados.
                        </p>

                        <div style="background: var(--bg-hover); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 2rem; border: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: left;">
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Ativos</div>
                                <div style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary);">${s.length}</div>
                            </div>
                            <div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Mdulo</div>
                                <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">Renda Fixa</div>
                            </div>
                        </div>

                        <button id="btn-finish" class="btn btn-primary" style="width: 100%; padding: 0.875rem; font-size: 1rem; justify-content: center;">
                            Concluir Importao
                        </button>
                    </div>
                `:`
                        <div style="text-align: center; padding: 3rem 1rem;">
                            <div class="spinner" style="margin: 0 auto 1.5rem auto; width: 40px; height: 40px; border: 3px solid rgba(var(--primary-rgb), 0.1); border-top-color: var(--primary-color); border-radius: 50%; animation: spin 1s linear infinite;"></div>
                            <h3 style="margin-bottom: 0.5rem; color: var(--text-primary);">Importando Dados...</h3>
                            <p style="color: var(--text-secondary); font-size: 0.9rem; margin-bottom: 2rem;">Por favor, aguarde enquanto processamos seus arquivos.</p>
                            
                            <div class="progress-bar-container" style="height: 6px; background: var(--bg-hover); border-radius: 4px; overflow: hidden; max-width: 300px; margin: 0 auto;">
                                <div id="import-progress" class="progress-bar-fill" style="width: 0%; height: 100%; background: var(--primary-color); transition: width 0.3s ease-out; border-radius: 4px;"></div>
                            </div>
                            <style>
                                @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                            </style>
                        </div>
                    `}},h=()=>e===1?`<button id="btn-next" class="btn btn-primary" ${!i||i!=="fixed_income"?"disabled":""}>Continuar</button>`:e===2?`<button id="btn-next" class="btn btn-primary" ${s.length===0||r.length>0?"disabled":""}>Importar Dados</button>`:"",d=()=>{const P=t.querySelector(".close-modal"),k=t.querySelector("#btn-cancel"),M=t.querySelector("#btn-next"),O=t.querySelector("#btn-back"),N=t.querySelector("#file-upload"),w=t.querySelector("#btn-download-sample");P&&(P.onclick=p),k&&(k.onclick=p),w&&(w.onclick=m),N&&(N.onchange=b);const y=t.querySelector("#btn-select-file");y&&N&&(y.onclick=()=>N.click()),M&&(M.onclick=()=>{e===1?(e=2,o()):e===2&&(e=3,o(),C())}),O&&(O.onclick=()=>{e--,o()})},p=()=>{t.classList.remove("open"),setTimeout(()=>{t.remove()},300)},m=()=>{const P=`data_investimento,tipo,emissor,vencimento,indexador,taxa,valor,custos
2024-01-15,CDB,Banco XP,2026-01-15,CDI,110,5000.00,0.00
2023-12-01,LCI,Banco ABC,2025-12-01,IPCA+,6.5,10000.50,15.00`,k=new Blob([P],{type:"text/csv;charset=utf-8;"}),M=document.createElement("a"),O=URL.createObjectURL(k);M.setAttribute("href",O),M.setAttribute("download","modelo_renda_fixa_v2.csv"),document.body.appendChild(M),M.click(),document.body.removeChild(M)},b=P=>{const k=P.target.files[0];if(!k)return;const M=new FileReader;M.onload=N=>{const w=N.target.result;v(w)},M.readAsText(k);const O=document.getElementById("file-name");O&&(O.textContent=k.name)},v=P=>{s=[],r=[];const k=P.split(`
`).map(y=>y.trim()).filter(y=>y);if(k.length<2){r.push({line:0,msg:"Arquivo vazio ou sem dados."}),E();return}const M=k[0].split(",").map(y=>y.trim().toLowerCase()),N=["data_investimento","tipo","emissor","vencimento","indexador","taxa","valor","custos"].filter(y=>!M.includes(y));if(N.length>0){r.push({line:1,msg:`Colunas obrigatrias faltando: ${N.join(", ")}`}),E();return}const w=/,(?=(?:(?:[^"]*"){2})*[^"]*$)/;for(let y=1;y<k.length;y++){const A=k[y].replace("\r","").split(w).map(Et=>{let yt=Et.trim();return yt.startsWith('"')&&yt.endsWith('"')&&(yt=yt.slice(1,-1)),yt});if(A.length!==M.length){r.push({line:y+1,msg:`Nmero de colunas incorreto. Esperado: ${M.length}, Encontrado: ${A.length}`});continue}const x={};M.forEach((Et,yt)=>x[Et]=A[yt]);const S=Et=>{if(!Et)return 0;const yt=Et.replace(/\./g,"").replace(",",".");return parseFloat(yt)},I=Et=>{if(!Et)return null;if(Et.includes("-"))return Et;const yt=Et.split("/");return yt.length===3?`${yt[2]}-${yt[1]}-${yt[0]}`:null},nt=S(x.valor),K=S(x.custos),ot=S(x.taxa),ut=I(x.data_investimento),Rt=I(x.vencimento),it={date:ut,type:x.tipo,issuer:x.emissor,dueDate:Rt,indexer:x.indexador,rate:ot,amount:nt,costs:K};isNaN(it.amount)&&r.push({line:y+1,msg:`Valor 'valor' invlido: ${x.valor}`}),isNaN(it.costs)&&r.push({line:y+1,msg:`Valor 'custos' invlido: ${x.custos}`}),isNaN(it.rate)&&r.push({line:y+1,msg:`Taxa 'taxa' invlida: ${x.taxa}`}),(!it.date||isNaN(Date.parse(it.date)))&&r.push({line:y+1,msg:`Data 'data_investimento' invlida: ${x.data_investimento}`}),(!it.dueDate||isNaN(Date.parse(it.dueDate)))&&r.push({line:y+1,msg:`Data 'vencimento' invlida: ${x.vencimento}`}),r.length===0&&s.push(it)}E()},E=()=>{const P=document.getElementById("validation-results");if(!P)return;r.length>0?P.innerHTML=`
                    <div style="background: rgba(220, 53, 69, 0.1); border: 1px solid var(--danger-color); border-radius: var(--radius-sm); padding: 1rem;">
                        <h4 style="color: var(--danger-color); margin-bottom: 0.5rem; font-size: 0.95rem;">Erros Encontrados (${r.length})</h4>
                        <ul style="font-size: 0.9rem; color: var(--text-secondary); max-height: 150px; overflow-y: auto; padding-left: 1.2rem;">
                            ${r.map(M=>`<li><b>Linha ${M.line}:</b> ${M.msg}</li>`).join("")}
                        </ul>
                    </div>
                `:s.length>0&&(P.innerHTML=`
                    <div style="background: rgba(40, 167, 69, 0.1); border: 1px solid var(--success-color); border-radius: var(--radius-sm); padding: 1rem;">
                        <h4 style="color: var(--success-color); margin-bottom: 0.5rem; font-size: 0.95rem;">Validao Concluda</h4>
                        <p style="font-size: 0.9rem; color: var(--text-secondary);">
                            ${s.length} registros vlidos e prontos para importao.
                        </p>
                    </div>
                `);const k=document.getElementById("btn-next");k&&(r.length===0&&s.length>0?k.disabled=!1:k.disabled=!0)},C=async()=>{const P=document.getElementById("import-progress"),M=jt.getState().user;if(!M){alert("Erro: Usurio no autenticado.");return}let O=0;const N=s.length;for(const w of s){const y=w.amount,T=w.costs,A=y+T,x={type:w.type,issuer:w.issuer,indexer:w.indexer,rate:w.rate,investedValue:y,costs:T,totalInvested:A,currentBalance:A,startDate:w.date,dueDate:w.dueDate,lastUpdate:new Date().toISOString(),history:[{date:w.date,type:"buy",value:A}]};try{await rx(M.uid,x),O++;const S=Math.round(O/N*100);P&&(P.style.width=`${S}%`)}catch(S){console.error("Import error for item:",w,S)}}setTimeout(()=>{const w=`
            <div style="text-align: center; padding: 2rem 1rem;">
                <div style="width: 72px; height: 72px; margin: 0 auto 1.5rem auto; display: flex; align-items: center; justify-content: center; background: rgba(16, 185, 129, 0.1); border-radius: 50%;">
                    <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="var(--success-color)" stroke-width="3" stroke-linecap="round" stroke-linejoin="round">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                </div>
                
                <h2 style="font-size: 1.5rem; font-weight: 700; color: var(--text-primary); margin-bottom: 0.5rem;">Sucesso!</h2>
                <p style="color: var(--text-secondary); margin-bottom: 2rem; max-width: 300px; margin-left: auto; margin-right: auto;">
                    A importao foi finalizada e <b>${O}</b> ativos foram adicionados.
                </p>

                <div style="background: var(--bg-hover); border-radius: var(--radius-lg); padding: 1.5rem; margin-bottom: 2rem; border: 1px solid var(--border-color); display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; text-align: left;">
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Ativos</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--text-primary);">${O}</div>
                    </div>
                    <div>
                        <div style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Mdulo</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: var(--primary-color);">Renda Fixa</div>
                    </div>
                </div>

                <button id="btn-finish" class="btn btn-primary" style="width: 100%; padding: 0.875rem; font-size: 1rem; justify-content: center;">
                    Concluir Importao
                </button>
            </div>
        `,y=document.getElementById("import-modal");if(y&&y.querySelector(".modal-content")){y.innerHTML='<div class="modal-content" style="max-width: 500px;">'+w+"</div>";const A=y.querySelector("#btn-finish");A&&(A.onclick=p)}},1e3)};o(),setTimeout(()=>{t.classList.add("open")},10)}catch(n){console.error("Critical error in openImportModal:",n),alert("Erro ao abrir importao: "+n.message)}}function Ya(n){const t=document.getElementById(n);if(!t)return;const i=jt.getState().user,s=document.documentElement.classList.contains("dark-mode");t.innerHTML=`
    <div style="max-width: 600px; margin: 0 auto;">
      
      <!-- Account Section -->
      <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-header">
          <span class="card-title">Conta</span>
        </div>
        <div style="display: flex; flex-direction: column; gap: 1rem; align-items: flex-start;">
            ${i?`
                <div style="display: flex; align-items: center; gap: 1rem;">
                    ${i.photo?`<img src="${i.photo}" style="width: 48px; height: 48px; border-radius: 50%;">`:""}
                    <div>
                        <div style="font-weight: 600; font-size: 1rem;">${i.name}</div>
                        <div style="font-size: 0.85rem; color: var(--text-secondary);">${i.email}</div>
                    </div>
                </div>
                <button class="btn" id="btnLogout" style="border: 1px solid var(--danger-color); color: var(--danger-color); width: auto; align-self: flex-start; padding: 0.5rem 1rem; font-size: 0.9rem;">
                    Sair
                </button>
            `:`
               <p style="color: var(--text-secondary); font-size: 0.9rem;">
                 Faa login para sincronizar seus dados em todos os dispositivos.
               </p>
               <button id="btnLogin" class="btn btn-primary" style="background-color: #fff; color: #757575; border: 1px solid #ddd; display: flex; align-items: center; gap: 10px; padding: 10px 16px; border-radius: 4px; font-family: 'Roboto', sans-serif; font-weight: 500; cursor: pointer;">
                 <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" width="18" height="18" alt="G">
                 <span>Entrar com Google</span>
               </button>
            `}
        </div>
      </div>

      <!-- Preferences Section -->
      <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-header">
          <span class="card-title">Preferncias</span>
        </div>
        
        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.5rem 0;">
           <div>
             <div style="font-weight: 500;">Modo Escuro</div>
             <div style="font-size: 0.8rem; color: var(--text-secondary);">Alterar aparncia do aplicativo</div>
           </div>
           
           <label class="switch">
             <input type="checkbox" id="darkModeToggle" ${s?"checked":""}>
             <span class="slider round"></span>
           </label>
        </div>
      </div>

      <!-- Data Section -->
      <div class="card" style="margin-bottom: 1.5rem;">
        <div class="card-header">
          <span class="card-title">Dados</span>
        </div>
        
        <div style="margin-bottom: 1.5rem;">
          <div style="font-weight: 500; margin-bottom: 0.5rem; color: var(--text-primary);">Exportar Dados</div>
          <button class="btn btn-outline" disabled style="opacity: 0.6; cursor: not-allowed; border: 1px solid var(--border-color); color: var(--text-secondary); width: 100%; justify-content: space-between; padding: 0.75rem 1rem;">
             <div style="display: flex; align-items: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Exportar CSV
             </div>
             <span style="font-size: 0.75rem; background: var(--bg-hover); padding: 2px 8px; border-radius: 12px; font-weight: 500;">Em Breve</span>
          </button>
        </div>

       <div style="border-top: 1px solid var(--border-color); padding-top: 1rem;">
           <div style="font-weight: 500; margin-bottom: 0.5rem; color: var(--text-primary);">Importar Dados</div>
           <p style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 1rem; line-height: 1.5;">
             Importe seus ativos via planilha CSV. Suporta Renda Fixa (e em breve Renda Varivel).
           </p>
           <button id="btnImportWizard" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 0.75rem 1rem;">
              <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="margin-right: 8px;">
                 <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path>
                 <polyline points="14 2 14 8 20 8"></polyline>
                 <line x1="12" y1="18" x2="12" y2="12"></line>
                 <line x1="9" y1="15" x2="15" y2="15"></line>
              </svg>
              Assistente de Importao
           </button>
        </div>
      </div>

      <!-- About Section -->
      <div style="text-align: center; color: var(--text-secondary); margin-top: 2rem;">
        <div style="font-weight: 600; font-size: 0.9rem;">Meus Investimentos</div>
        <div style="font-size: 0.8rem;">Verso 2.1.0</div>
      </div>

    </div>
  `;const r=document.getElementById("btnLogin");r&&r.addEventListener("click",async()=>{try{await V0()}catch(u){console.error(u),alert("Erro ao fazer login. Verifique o console.")}});const o=document.getElementById("btnLogout");o&&o.addEventListener("click",async()=>{await L0()});const a=document.getElementById("darkModeToggle");a&&a.addEventListener("change",u=>{u.target.checked?(document.documentElement.classList.add("dark-mode"),localStorage.setItem("theme","dark")):(document.documentElement.classList.remove("dark-mode"),localStorage.setItem("theme","light"))});const l=document.getElementById("btnImportWizard");l?(console.log("Boto Importar encontrado. Adicionando listener."),l.addEventListener("click",()=>{console.log("Boto Importar clicado!");try{RC()}catch(u){console.error("Erro ao chamar openImportModal:",u),alert(u.message)}})):console.error("Boto Importar NO encontrado no DOM.")}class lr{constructor(){this.createOverlay()}createOverlay(){this.overlay=document.createElement("div"),this.overlay.className="modal-overlay",this.overlay.innerHTML=`
      <div class="modal-content">
        <header class="modal-header">
          <h2 class="modal-title"></h2>
          <button class="modal-close">&times;</button>
        </header>
        <div class="modal-body"></div>
      </div>
    `,document.body.appendChild(this.overlay),this.overlay.addEventListener("click",t=>{t.target===this.overlay&&this.close()}),this.overlay.querySelector(".modal-close").addEventListener("click",()=>this.close())}open(t,e){this.overlay.querySelector(".modal-title").textContent=t,this.overlay.querySelector(".modal-body").innerHTML=e,this.overlay.classList.add("open")}close(){this.overlay.classList.remove("open")}}let Xa=new lr;function kC(n){const e=DC(new Date,new Date(n.dueDate))<=0,i=`
        <div style="display: flex; flex-direction: column; gap: 1.25rem;">
             <div style="background: var(--bg-color); padding: 1rem; border-radius: var(--radius-md); border-left: 4px solid var(--primary-color);">
                <div style="font-size: 0.85rem; color: var(--text-secondary);">Ativo</div>
                <div style="font-weight: 600; font-size: 1rem;">${n.type} - ${n.issuer}</div>
                <div style="font-size: 0.85rem; color: var(--text-secondary); margin-top: 0.5rem;">Saldo Atual</div>
                <div style="font-weight: 700; font-size: 1.1rem;">R$ ${n.currentBalance.toLocaleString("pt-BR",{minimumFractionDigits:2})}</div>
            </div>

            ${e?`<div style="padding: 1rem; background: rgba(239, 68, 68, 0.1); color: var(--danger-color); font-size: 0.9rem; border-radius: var(--radius-md); font-weight: 500;">
                    Este ttulo venceu. Apenas o resgate total  permitido.
                   </div>`:""}

            <div class="form-group">
                <label class="form-label" for="sell-date">Data do Resgate</label>
                <input type="date" id="sell-date" class="form-input" value="${new Date().toISOString().split("T")[0]}">
            </div>

            <div class="form-group">
                <div style="display:flex; justify-content:space-between; align-items:center;">
                    <label class="form-label" for="sell-value">Valor do Resgate (R$)</label>
                    ${e?"":'<button id="btn-sell-all" class="btn btn-ghost" style="padding: 0; height: auto; font-size: 0.75rem; color: var(--primary-color);">Resgatar Tudo</button>'}
                </div>
                <input type="number" step="0.01" id="sell-value" class="form-input" placeholder="0,00" ${e?`value="${n.currentBalance}" readonly style="background-color: var(--bg-color); cursor: not-allowed;"`:""}>
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                <button class="btn btn-ghost" style="flex: 1;" id="btn-cancel-sell">Cancelar</button>
                <button id="confirm-sell" class="btn btn-primary" style="flex: 1; justify-content: center;">
                    Confirmar Resgate
                </button>
            </div>
        </div>
    `;Xa.open("Resgatar Ttulo",i),e||document.getElementById("btn-sell-all").addEventListener("click",()=>{const s=document.getElementById("sell-value");s.value=n.currentBalance,s.focus()}),document.getElementById("btn-cancel-sell").addEventListener("click",()=>{Xa.close(),setTimeout(()=>Ks(n.id),200)}),document.getElementById("confirm-sell").addEventListener("click",()=>{const s=parseFloat(document.getElementById("sell-value").value),r=document.getElementById("sell-date").value;if(!s||s<=0){alert("Digite um valor vlido.");return}if(s>n.currentBalance){alert("O valor no pode ser maior que o saldo atual.");return}jt.sellAsset(n.id,s,r),alert("Resgate realizado com sucesso!"),Xa.close(),s<n.currentBalance&&setTimeout(()=>Ks(n.id),300)})}function DC(n,t){const e=t.getTime()-n.getTime();return Math.ceil(e/864e5)}let Qa=new lr;function MC(n){const t=`
        <div style="display: flex; flex-direction: column; gap: 1.25rem;">
            
            <!-- Emissor -->
            <div class="form-group">
                <label class="form-label" for="edit-issuer">Emissor</label>
                <input type="text" id="edit-issuer" class="form-input" value="${n.issuer}" placeholder="Ex: Banco XP">
            </div>

            <!-- Row 1: Type & Date -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                <div class="form-group">
                    <label class="form-label">Tipo</label>
                    <div id="select-type-container"></div>
                </div>
                <div class="form-group">
                     <label class="form-label" for="edit-dueDate">Vencimento</label>
                     <input type="date" id="edit-dueDate" class="form-input" value="${n.dueDate}">
                </div>
            </div>

            <!-- Row 2: Indexer & Rate -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                 <div class="form-group">
                    <label class="form-label">Indexador</label>
                    <div id="select-indexer-container"></div>
                 </div>
                 <div class="form-group">
                     <label class="form-label" for="edit-rate">Taxa (%)</label>
                     <input type="number" id="edit-rate" step="0.01" class="form-input" value="${n.rate}" placeholder="0.00">
                 </div>
            </div>

            <!-- Actions -->
            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                 <button class="btn btn-ghost" style="flex: 1;" id="btn-cancel-edit">Cancelar</button>
                 <button id="btn-save-edit" class="btn btn-primary" style="flex: 1; justify-content: center;">Salvar Alteraes</button>
            </div>
        </div>
    `;Qa.open("Editar Ttulo",t);const e=new Gs("select-type-container",[{value:"CDB",label:"CDB"},{value:"LCI",label:"LCI"},{value:"LCA",label:"LCA"},{value:"RDB",label:"RDB"},{value:"LC",label:"LC"},{value:"Debnture",label:"Debnture"},{value:"CRI",label:"CRI"},{value:"CRA",label:"CRA"}]);e.select(n.type,n.type);const i=new Gs("select-indexer-container",[{value:"CDI",label:"CDI"},{value:"IPCA+",label:"IPCA+"},{value:"Pr-fixado",label:"Pr-fixado"}]);i.select(n.indexer,n.indexer),document.getElementById("btn-cancel-edit").addEventListener("click",()=>{Qa.close(),setTimeout(()=>Ks(n.id),200)}),document.getElementById("btn-save-edit").addEventListener("click",()=>{const s={issuer:document.getElementById("edit-issuer").value,type:e.getValue(),dueDate:document.getElementById("edit-dueDate").value,indexer:i.getValue(),rate:parseFloat(document.getElementById("edit-rate").value)};if(!s.issuer||!s.dueDate||!s.type||!s.indexer){alert("Preencha os campos obrigatrios.");return}jt.editAsset(n.id,s),alert("Alteraes salvas!"),Qa.close(),setTimeout(()=>Ks(n.id),300)})}let wi=new lr,Ze=null,ke=1;const Ja=5;function Ks(n){ke=1,Mi(n)}function Mi(n){const t=jt.getState().fixedIncome.assets.find(d=>d.id===n);if(!t)return;const e=NC(new Date,new Date(t.dueDate)),i=t.currentBalance-t.investedValue,s=i/t.investedValue*100,r=[...t.history].sort((d,p)=>new Date(p.date)-new Date(d.date)),o=Math.ceil(r.length/Ja),a=(ke-1)*Ja,l=r.slice(a,a+Ja),u=`
        <div style="display: flex; flex-direction: column; gap: 1.5rem;">
            <!-- Header Info -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; background: var(--bg-color); padding: 1.25rem; border-radius: var(--radius-md);">
                <div>
                   <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Valor Atual</div>
                   <div style="font-size: 1.5rem; font-weight: 700;">R$ ${Za(t.currentBalance)}</div>
                </div>
                 <div style="text-align: right;">
                   <div style="font-size: 0.85rem; color: var(--text-secondary); margin-bottom: 0.25rem;">Rentabilidade</div>
                   <div style="font-size: 1.5rem; font-weight: 700; color: ${i>=0?"var(--success-color)":"var(--danger-color)"};">
                      ${s.toFixed(2)}%
                   </div>
                </div>
            </div>

            <!-- Details Grid -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.25rem; font-size: 0.95rem;">
                <div><strong>Emissor:</strong><br><span style="color: var(--text-secondary);">${t.issuer}</span></div>
                <div><strong>Tipo:</strong><br><span style="color: var(--text-secondary);">${t.type}</span></div>
                <div><strong>Taxa:</strong><br><span style="color: var(--text-secondary);">${t.indexer} ${t.rate}%</span></div>
                <div><strong>Vencimento:</strong><br><span style="color: var(--text-secondary);">${Jr(t.dueDate)} (${e} d)</span></div>
                <div><strong>Incio:</strong><br><span style="color: var(--text-secondary);">${Jr(t.startDate)}</span></div>
                <div><strong>Investido:</strong><br><span style="color: var(--text-secondary);">R$ ${Za(t.investedValue)}</span></div>
            </div>

            <!-- Chart -->
            <div>
               <h4 style="margin-bottom: 0.75rem; font-size: 0.95rem; color: var(--text-secondary); font-weight: 600;">Evoluo</h4>
               <div style="height: 220px;"><canvas id="assetEvolutionChart"></canvas></div>
            </div>

            <!-- History -->
            <div>
                <h4 style="margin-bottom: 0.75rem; font-size: 0.95rem; color: var(--text-secondary); font-weight: 600;">Histrico</h4>
                <div style="border: 1px solid var(--border-color); border-radius: var(--radius-md); overflow: hidden;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9rem;">
                       ${l.map(d=>{const p=t.history.indexOf(d);return`
                          <tr style="border-bottom: 1px solid var(--border-color);">
                             <td style="padding: 0.75rem 1rem;">${Jr(d.date)}</td>
                             <td style="padding: 0.75rem 1rem;">${FC(d.type)}</td>
                             <td style="padding: 0.75rem 1rem; text-align: right;">R$ ${Za(d.value)}</td>
                             <td style="padding: 0.75rem 1rem; text-align: center; width: 40px;">
                                <button class="btn-icon-delete" data-index="${p}" style="color: var(--text-secondary); padding: 0.25rem; cursor: pointer;">
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                                    </svg>
                                </button>
                             </td>
                          </tr>
                          `}).join("")}
                    </table>
                    
                    ${o>1?`
                        <div style="display: flex; justify-content: space-between; align-items: center; padding: 0.75rem 1rem; background: var(--bg-color);">
                            <button class="btn btn-ghost" id="btn-prev-page" ${ke===1?'disabled style="opacity:0.5; cursor: default;"':""}>&lt; Anterior</button>
                            <span style="font-size: 0.85rem; color: var(--text-secondary);">Pgina ${ke} de ${o}</span>
                            <button class="btn btn-ghost" id="btn-next-page" ${ke===o?'disabled style="opacity:0.5; cursor: default;"':""}>Prxima &gt;</button>
                        </div>
                    `:""}
                </div>
            </div>

            <!-- Actions -->
            <div style="display: flex; gap: 0.75rem; margin-top: 1rem;">
                <button class="btn btn-primary" style="flex: 1; padding: 0.85rem;" id="btn-detail-sell">Vender</button>
                <button class="btn" style="flex: 1; border: 1px solid var(--border-color); padding: 0.85rem;" id="btn-detail-edit">Editar</button>
                <button class="btn" style="flex: 1; border: 1px solid var(--danger-color); color: var(--danger-color); padding: 0.85rem;" id="btn-detail-delete">Excluir</button>
            </div>
        </div>
    `;wi.open(`${t.type} - ${t.issuer}`,u),LC(t),document.getElementById("btn-detail-sell").addEventListener("click",()=>{wi.close(),setTimeout(()=>kC(t),100)}),document.getElementById("btn-detail-edit").addEventListener("click",()=>{wi.close(),setTimeout(()=>MC(t),100)}),document.getElementById("btn-detail-delete").addEventListener("click",()=>{VC(t)}),document.querySelectorAll(".btn-icon-delete").forEach(d=>{d.addEventListener("click",p=>{const m=parseInt(p.currentTarget.dataset.index);OC(t,m)})}),o>1&&(document.getElementById("btn-prev-page").addEventListener("click",()=>{ke>1&&(ke--,Mi(n))}),document.getElementById("btn-next-page").addEventListener("click",()=>{ke<o&&(ke++,Mi(n))}))}function OC(n,t){wi.open("Confirmao",`
        <div style="text-align: center; padding: 1.5rem;">
            <div style="font-size: 3rem; color: var(--warning-color); margin-bottom: 1rem; display: flex; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                </svg>
            </div>
            <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 700; color: var(--text-primary);">Excluir Histrico?</h3>
            <p style="color: var(--text-secondary); margin-bottom: 2rem; font-size: 0.95rem; line-height: 1.5;">
                Deseja realmente remover este registro?<br>
                Isso pode alterar o saldo atual se for a ltima atualizao.
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="btn" style="flex: 1; border: 1px solid var(--border-color); padding: 0.85rem;" id="btn-cancel-del-hist">Cancelar</button>
                <button class="btn" style="flex: 1; background-color: var(--danger-color); color: white; padding: 0.85rem;" id="btn-confirm-del-hist">Excluir</button>
            </div>
        </div>
    `),document.getElementById("btn-cancel-del-hist").addEventListener("click",()=>{Mi(n.id)}),document.getElementById("btn-confirm-del-hist").addEventListener("click",()=>{jt.removeHistoryItem(n.id,t),Mi(n.id)})}function VC(n){const t=`
        <div style="text-align: center; padding: 1.5rem;">
            <div style="font-size: 3rem; color: var(--danger-color); margin-bottom: 1rem; display: flex; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </div>
            <h3 style="margin-bottom: 0.5rem; font-size: 1.25rem; font-weight: 700; color: var(--text-primary);">Excluir Ttulo?</h3>
            <p style="color: var(--text-secondary); margin-bottom: 2rem; font-size: 0.95rem; line-height: 1.5;">
                Tem certeza que deseja excluir <strong>${n.type} - ${n.issuer}</strong>?<br> 
                Esta ao  irreversvel e remover todo o histrico deste ativo.
            </p>
            <div style="display: flex; gap: 1rem;">
                <button class="btn" style="flex: 1; border: 1px solid var(--border-color); padding: 0.85rem;" id="btn-cancel-delete">Cancelar</button>
                <button class="btn" style="flex: 1; background-color: var(--danger-color); color: white; padding: 0.85rem;" id="btn-confirm-delete">Sim, Excluir</button>
            </div>
        </div>
    `;wi.open("Confirmao",t),document.getElementById("btn-cancel-delete").addEventListener("click",()=>{Mi(n.id)}),document.getElementById("btn-confirm-delete").addEventListener("click",()=>{jt.deleteAsset(n.id),wi.close()})}function LC(n){const t=document.getElementById("assetEvolutionChart");if(!t)return;Ze&&Ze.destroy();const e=[...n.history].sort((l,u)=>new Date(l.date)-new Date(u.date)),i=e.map(l=>Jr(l.date)),s=e.map(l=>l.value);Ze=new Zn(t,{type:"line",data:{labels:i,datasets:[{label:"Valor",data:s,borderColor:"#004aad",backgroundColor:"rgba(0, 74, 173, 0.1)",fill:!0,tension:.4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{x:{display:!0,grid:{display:!1},ticks:{color:"var(--text-secondary)",font:{size:10},maxRotation:45,minRotation:0}},y:{beginAtZero:!1,grace:"5%",grid:{display:!0,color:"rgba(0,0,0,0.05)"},ticks:{display:!0,color:"var(--text-secondary)",font:{size:10},callback:function(l){return"R$ "+l.toLocaleString("pt-BR",{notation:"compact"})}}}},layout:{padding:{top:10,bottom:10,left:0,right:10}}}});const r=Math.min(...s),o=Math.max(...s);let a=o-r;if(a===0){const l=Math.abs(r)*.02||1;Ze.options.scales.y.min=r-l,Ze.options.scales.y.suggestedMax=o+l*3}else Ze.options.scales.y.min=r-a*.05,Ze.options.scales.y.suggestedMax=o+a*.2;Ze.update()}function Za(n){return n.toLocaleString("pt-BR",{minimumFractionDigits:2})}function Jr(n){return new Date(n).toLocaleDateString("pt-BR")}function NC(n,t){const e=t.getTime()-n.getTime();return Math.ceil(e/864e5)}function FC(n){return{buy:"Compra",sell:"Venda",update:"Atualizao"}[n]||n}let Ss=new lr,tn="ALL";function BC(){Cs()}function Cs(){let t=[...jt.getState().fixedIncome.assets].sort((s,r)=>s.type.localeCompare(r.type)||s.issuer.localeCompare(r.issuer));tn==="CDB_RDB"?t=t.filter(s=>["CDB","RDB","LC"].includes(s.type)):tn==="LCI_LCA"&&(t=t.filter(s=>["LCI","LCA"].includes(s.type)));const e=`
        <div style="display: flex; flex-direction: column; gap: 1rem;">
            <p style="color: var(--text-secondary); font-size: 0.9rem;">
                Atualize o valor (bruto) dos seus ttulos. O sistema salva a data/hora automaticamente se houver mudana.
            </p>

            <!-- Filters -->
            <div style="display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem;">
                <button class="btn ${tn==="ALL"?"btn-primary":"btn-ghost"}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;" id="filter-all">Todos</button>
                <button class="btn ${tn==="CDB_RDB"?"btn-primary":"btn-ghost"}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;" id="filter-cdb">CDB/RDB/LC</button>
                 <button class="btn ${tn==="LCI_LCA"?"btn-primary":"btn-ghost"}" style="font-size: 0.8rem; padding: 0.4rem 0.8rem;" id="filter-lci">LCI/LCA</button>
            </div>

            <div style="max-height: 400px; overflow-y: auto; padding-right: 0.5rem; display: flex; flex-direction: column; gap: 0.5rem;">
                ${t.map(s=>{const r=s.lastUpdate?new Date(s.lastUpdate).toLocaleString("pt-BR"):"Nunca atualizado",o=s.currentBalance.toLocaleString("pt-BR",{minimumFractionDigits:2});return`
                    <div style="padding: 1rem; border: 1px solid var(--border-color); border-radius: var(--radius-md); background: var(--bg-color);">
                        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 0.75rem;">
                            <div>
                                <div style="font-weight: 600; font-size: 0.95rem;">${s.type} - ${s.issuer}</div>
                                <div style="font-size: 0.8rem; color: var(--text-secondary); margin-top: 0.25rem;">
                                    ${s.indexer} ${s.rate}%  Vence: ${new Date(s.dueDate).toLocaleDateString("pt-BR")}
                                </div>
                            </div>
                            <div style="text-align: right;">
                                <div style="font-size: 0.7rem; color: var(--text-secondary);">ltima atualizao</div>
                                <div style="font-size: 0.75rem; font-weight: 500;">${r}</div>
                            </div>
                        </div>
                        
                        <div class="form-group" style="margin-bottom: 0;">
                            <label style="font-size: 0.75rem; color: var(--text-secondary); display: block; margin-bottom: 0.25rem;">Saldo Atual (R$)</label>
                            <input type="text" 
                                   class="form-input input-balance-mask" 
                                   data-id="${s.id}" 
                                   data-original="${s.currentBalance}"
                                   value="${o}"
                                   style="text-align: right; font-weight: 600; color: var(--primary-color);"
                            >
                        </div>
                    </div>
                `}).join("")}
            </div>

            <div style="display: flex; gap: 1rem; margin-top: 0.5rem;">
                 <button class="btn btn-ghost" style="flex: 1;" id="btn-cancel-update">Cancelar</button>
                 <button class="btn btn-primary" style="flex: 1;" id="btn-confirm-updates">Salvar Tudo</button>
            </div>
        </div>
    `;Ss.open("Atualizar Saldos",e),document.getElementById("filter-all").addEventListener("click",()=>{tn="ALL",Cs()}),document.getElementById("filter-cdb").addEventListener("click",()=>{tn="CDB_RDB",Cs()}),document.getElementById("filter-lci").addEventListener("click",()=>{tn="LCI_LCA",Cs()}),document.getElementById("btn-cancel-update").addEventListener("click",()=>Ss.close()),document.getElementById("btn-confirm-updates").addEventListener("click",()=>{UC()}),document.querySelectorAll(".input-balance-mask").forEach(s=>{s.addEventListener("input",r=>{let o=r.target.value.replace(/\D/g,"");if(!o){r.target.value="0,00";return}o=(parseFloat(o)/100).toLocaleString("pt-BR",{minimumFractionDigits:2}),r.target.value=o})})}function UC(){const n=document.querySelectorAll(".input-balance-mask");let t=0;const e=[];if(n.forEach(s=>{const r=s.dataset.id,o=s.value.replace(/\./g,"").replace(",","."),a=parseFloat(o),l=parseFloat(s.dataset.original);!isNaN(a)&&Math.abs(a-l)>.001&&(t++,e.push({id:r,val:a}))}),t===0){Ss.close();return}const i=`
        <div style="text-align: center; padding: 1rem;">
             <div style="font-size: 3rem; color: var(--primary-color); margin-bottom: 0.5rem; display: flex; justify-content: center;">
                <svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
            </div>
            <h3 style="margin-bottom: 0.5rem; color: var(--text-primary); font-size: 1.25rem; font-weight: 700;">Confirmar Atualizao</h3>
            <p style="color: var(--text-secondary); margin-bottom: 1.5rem;">
                Voc editou o saldo de <strong>${t}</strong> ttulos.<br>Deseja salvar as alteraes?
            </p>
             <div style="display: flex; gap: 1rem;">
                <button class="btn btn-ghost" style="flex: 1; border: 1px solid var(--border-color);" id="btn-back-update">Voltar</button>
                <button class="btn btn-primary" style="flex: 1;" id="btn-exec-update">Confirmar</button>
            </div>
        </div>
    `;Ss.open("Confirmao",i),document.getElementById("btn-back-update").addEventListener("click",()=>{Cs()}),document.getElementById("btn-exec-update").addEventListener("click",()=>{e.forEach(s=>jt.updateAssetBalance(s.id,s.val)),Ss.close()})}Zn.register(...gy);let tl=null,el=null;function zC(n){const t=document.getElementById(n);t&&(Wf(t),jt.subscribe(()=>{document.getElementById(n)&&Wf(document.getElementById(n))}))}function Wf(n){const e=[...jt.getState().fixedIncome.assets].sort((u,h)=>new Date(u.dueDate)-new Date(h.dueDate)),i=e.reduce((u,h)=>u+h.investedValue,0),s=e.reduce((u,h)=>u+h.currentBalance,0),r=s-i,o=i>0?r/i*100:0;n.innerHTML=`
        <div class="dashboard-grid">
            <!-- Summary Cards -->
            <div class="card md-col-span-6">
                <div class="card-header">
                   <div style="display:flex; gap:0.5rem; align-items:center;">
                      <div style="color:var(--primary-color)">${qs.clipboard}</div>
                      <span class="card-title">Patrimnio Renda Fixa</span>
                   </div>
                </div>
                <div class="card-value">R$ ${Fl(s)}</div>
            </div>

            <div class="card md-col-span-6">
                <div class="card-header">
                     <span class="card-title">Rentabilidade Total</span>
                </div>
                <div class="card-value" style="color: ${r>=0?"var(--success-color)":"var(--danger-color)"}">
                    R$ ${Fl(r)}
                    <span style="font-size: 0.9rem; font-weight: 500; margin-left: 0.5rem;">
                       (${o.toFixed(2)}%)
                    </span>
                </div>
            </div>

            <!-- Charts -->
            <div class="card md-col-span-6">
                 <div class="card-header"><span class="card-title">Bond Ladder (Vencimentos)</span></div>
                 <div style="height: 200px;"><canvas id="bondLadderChart"></canvas></div>
            </div>
            
            <div class="card md-col-span-6">
                 <div class="card-header"><span class="card-title">Alocao por Indexador</span></div>
                 <div style="height: 200px; display:flex; justify-content:center;"><canvas id="fiAllocationChart"></canvas></div>
            </div>

            <!-- Asset List -->
            <div class="card col-span-12">
                <div class="card-header">
                    <span class="card-title">Meus Ttulos</span>
                    <button class="btn btn-primary" id="btn-update-balances" style="font-size: 0.85rem; padding: 0.5rem 1rem;">
                        Atualizar Saldos
                    </button>
                </div>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; min-width: 600px;">
                        <thead>
                            <tr style="text-align: left; border-bottom: 1px solid var(--border-color); color: var(--text-secondary); font-size: 0.85rem;">
                                <th style="padding: 1rem;">ATIVO</th>
                                <th style="padding: 1rem;">EMISSOR</th>
                                <th style="padding: 1rem;">VALOR ATUAL</th>
                                <th style="padding: 1rem;">RENTAB.</th>
                                <th style="padding: 1rem;">VENCIMENTO</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${e.map(u=>$C(u)).join("")}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    `,jC(e),n.querySelectorAll(".asset-row").forEach(u=>{u.addEventListener("click",()=>{Ks(u.dataset.id)})});const l=document.getElementById("btn-update-balances");l&&l.addEventListener("click",u=>{u.stopPropagation(),BC()})}function $C(n){const t=WC(new Date,new Date(n.dueDate)),e=t<=0,i=t>0&&t<15;let s="";e?s="background-color: rgba(239, 68, 68, 0.1); border-left: 4px solid var(--danger-color);":i&&(s="background-color: rgba(245, 158, 11, 0.1); border-left: 4px solid var(--warning-color);");const r=n.currentBalance-n.investedValue,o=r/n.investedValue*100;return`
        <tr class="asset-row" data-id="${n.id}" style="border-bottom: 1px solid var(--border-color); cursor: pointer; transition: background 0.2s; ${s}">
            <td style="padding: 1rem;">
                <div style="font-weight: 600; color: var(--primary-color);">${n.type}</div>
                <div style="font-size: 0.8rem; color: var(--text-secondary);">${n.indexer} ${n.rate}%</div>
            </td>
            <td style="padding: 1rem;">${n.issuer}</td>
            <td style="padding: 1rem; font-weight: 500;">R$ ${Fl(n.currentBalance)}</td>
             <td style="padding: 1rem; color: ${r>=0?"var(--success-color)":"var(--danger-color)"}">
                ${o.toFixed(2)}%
            </td>
            <td style="padding: 1rem;">
                <div>${HC(n.dueDate)}</div>
                <div style="font-size: 0.75rem; color: ${e?"var(--danger-color)":i?"var(--warning-color)":"var(--text-secondary)"}; font-weight: 500;">
                   ${e?"Vencido":`${t} dias`}
                </div>
            </td>
        </tr>
    `}function jC(n){const t=document.getElementById("bondLadderChart").getContext("2d"),e=document.getElementById("fiAllocationChart").getContext("2d");tl&&tl.destroy(),el&&el.destroy();const i=new Date().getFullYear(),s={};[0,1,2].forEach(o=>s[i+o]=0),n.forEach(o=>{const a=new Date(o.dueDate).getFullYear();s.hasOwnProperty(a)&&(s[a]+=o.currentBalance)});const r={};n.forEach(o=>{r[o.indexer]=(r[o.indexer]||0)+o.currentBalance}),tl=new Zn(t,{type:"bar",data:{labels:Object.keys(s),datasets:[{label:"Vencimentos (R$)",data:Object.values(s),backgroundColor:"#004aad",borderRadius:4}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1}},scales:{y:{display:!1},x:{grid:{display:!1}}}}}),el=new Zn(e,{type:"doughnut",data:{labels:Object.keys(r),datasets:[{data:Object.values(r),backgroundColor:["#004aad","#4d82d1","#10b981","#f59e0b"],borderWidth:0}]},options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"right",labels:{font:{family:"'Inter', sans-serif"}}}}}})}function Fl(n){return n.toLocaleString("pt-BR",{minimumFractionDigits:2})}function HC(n){return new Date(n).toLocaleDateString("pt-BR")}function WC(n,t){const e=t.getTime()-n.getTime();return Math.ceil(e/(1e3*60*60*24))}let xn=null;const my=[{id:"fixed",label:"Renda Fixa",icon:"clipboard"},{id:"variable",label:"Renda Varivel",icon:"trendUp"},{id:"treasury",label:"Tesouro Direto",icon:"building"},{id:"reserve",label:"Reserva",icon:"shield"}];function qC(n){xn||(xn=new lr);const e={fixed:"fixed",variable:"variable",treasury:"treasury",reserve:"reserve"}[n];e?yy(e):GC()}function GC(){const n=`
      <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
         ${my.map(t=>`
            <button class="btn btn-category" data-id="${t.id}" style="
                flex-direction: column; 
                padding: 1.5rem; 
                border: 1px solid var(--border-color);
                border-radius: var(--radius-md);
                background: var(--bg-color);
                gap: 0.5rem;
                height: 100%;
            ">
               <div style="color: var(--primary-color);">${qs[t.icon]}</div>
               <span>${t.label}</span>
            </button>
         `).join("")}
      </div>
    `;xn.open("Novo Aporte",n),xn.overlay.querySelectorAll(".btn-category").forEach(t=>{t.addEventListener("click",()=>{yy(t.dataset.id)})})}function yy(n){const t=my.find(i=>i.id===n)?.label||"Aporte";if(n!=="fixed"){xn.open(`Novo Aporte - ${t}`,`
           <div style="text-align: center; padding: 2rem;">
              <div style="font-size: 3rem; margin-bottom: 1rem;"></div>
              <h3>Em Breve</h3>
              <p style="color: var(--text-secondary);">O formulrio de ${t} est em desenvolvimento.</p>
           </div>
        `);return}const e=`
      <form id="contribution-form" style="display: flex; flex-direction: column; gap: 1rem;">
         
         <!-- Row 1 -->
         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
             <div class="form-group">
                <label class="form-label">Data</label>
                <input type="date" class="form-input" id="inp-date" value="${new Date().toISOString().split("T")[0]}">
             </div>
             <div class="form-group">
                <label class="form-label">Vencimento</label>
                <input type="date" class="form-input" id="inp-due">
             </div>
         </div>

         <!-- Row 2 -->
         <div class="form-group">
            <label class="form-label">Banco Emissor</label>
            <input type="text" class="form-input" id="inp-issuer" placeholder="Ex: Banco XP">
         </div>

         <!-- Row 3 -->
         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
             <div class="form-group">
                <label class="form-label">Tipo</label>
                <div id="sel-type"></div>
             </div>
             <div class="form-group">
                <label class="form-label">Indexador</label>
                <div id="sel-indexer"></div>
             </div>
         </div>

         <!-- Row 4 -->
         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
            <div class="form-group">
                <label class="form-label">Taxa (%)</label>
                <input type="text" class="form-input money-input" id="inp-rate" placeholder="0,00">
            </div>
             <div class="form-group">
                <label class="form-label">Valor Investido</label>
                <input type="text" class="form-input money-input" id="inp-value" placeholder="0,00">
             </div>
         </div>

         <!-- Row 5 -->
         <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
             <div class="form-group">
                <label class="form-label">Outros Custos</label>
                <input type="text" class="form-input money-input" id="inp-costs" placeholder="0,00">
             </div>
             <div class="form-group">
                <label class="form-label">Total</label>
                <input type="text" class="form-input" id="inp-total" readonly style="background: var(--bg-color); font-weight: 700;">
             </div>
         </div>

         <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center; padding: 1rem; margin-top: 1rem;">
            Salvar Aporte
         </button>

      </form>
    `;xn.open(`Novo Aporte - ${t}`,e),new Gs("sel-type",[{value:"cdb",label:"CDB"},{value:"rdb",label:"RDB"},{value:"lci",label:"LCI"},{value:"lca",label:"LCA"}]),new Gs("sel-indexer",[{value:"cdi",label:"CDI"},{value:"cdi_plus",label:"CDI +"},{value:"ipca_plus",label:"IPCA +"},{value:"pre",label:"Pr-fixado"}]),KC(),document.getElementById("contribution-form").addEventListener("submit",i=>{i.preventDefault(),QC()})}function KC(){document.querySelectorAll(".money-input").forEach(t=>{t.addEventListener("input",e=>{let i=e.target.value.replace(/\D/g,"");i=(Number(i)/100).toFixed(2)+"",i=i.replace(".",","),i=i.replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1."),e.target.value=i,YC()})})}function YC(){const n=document.getElementById("inp-value").value||"0",t=document.getElementById("inp-costs").value||"0",e=Ps(n),i=Ps(t),s=e+i;document.getElementById("inp-total").value=XC(s)}function Ps(n){return Number(n.replace(/\./g,"").replace(",","."))||0}function XC(n){return n.toLocaleString("pt-BR",{minimumFractionDigits:2,maximumFractionDigits:2})}async function QC(){const n=document.getElementById("sel-type").dataset.value||"cdb",t=document.getElementById("sel-indexer").dataset.value||"cdi",e={type:n.toUpperCase(),issuer:document.getElementById("inp-issuer").value,indexer:t.toUpperCase(),rate:parseFloat(document.getElementById("inp-rate").value.replace(",","."))||0,startDate:document.getElementById("inp-date").value,dueDate:document.getElementById("inp-due").value,investedValue:Ps(document.getElementById("inp-value").value),currentBalance:Ps(document.getElementById("inp-value").value),status:"active",history:[{date:document.getElementById("inp-date").value,type:"buy",value:Ps(document.getElementById("inp-value").value)}]};try{await jt.addFixedIncomeAsset(e),xn.open("Sucesso",`
          <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem; text-align: center;">
             <div style="
                width: 60px; height: 60px; 
                background: var(--success-color); 
                border-radius: 50%; 
                display: flex; align-items: center; justify-content: center;
                color: white; font-size: 2rem; margin-bottom: 1rem;
             "></div>
             <h3 style="margin-bottom: 0.5rem; font-weight: 700;">Salvo com sucesso!</h3>
             <p style="color: var(--text-secondary);">O ativo foi adicionado  sua carteira.</p>
          </div>
        `),setTimeout(()=>{xn.close()},2e3)}catch(i){alert("Erro ao salvar: "+i.message)}}console.log("App initialized");window.onerror=function(n,t,e,i,s){document.body.innerHTML=`<div style="color: red; padding: 2rem;">
      <h1>Application Error</h1>
      <p>${n}</p>
      <p>${t}:${e}:${i}</p>
      <pre>${s?.stack}</pre>
   </div>`};try{let n=function(i){if(!jt.getState().user&&i!=="settings"){document.querySelectorAll(".nav-item").forEach(l=>l.classList.remove("active")),document.querySelectorAll(".bottom-nav-item").forEach(l=>l.classList.remove("active")),document.querySelectorAll('[data-page="settings"]').forEach(l=>l.classList.add("active"));const o=document.getElementById("page-title");o&&(o.textContent="Configuraes");const a=document.getElementById("content-area");a.innerHTML='<div id="settings-container"></div>',Ya("settings-container");return}const r=document.getElementById("content-area");r&&(i==="home"?(r.innerHTML='<div id="dashboard-container" class="dashboard-grid"></div>',Ka(jt.getState())):i==="settings"?(r.innerHTML='<div id="settings-container"></div>',Ya("settings-container")):i==="fixed"?(r.innerHTML='<div id="fixed-income-container"></div>',zC("fixed-income-container")):(r.innerHTML='<div id="generic-container"></div>',PC("generic-container",{rebalance:"Rebalanceamento",reserve:"Reserva de Emergncia",fixed:"Renda Fixa",variable:"Renda Varivel",treasury:"Tesouro Direto",menu:"Menu",settings:"Configuraes"}[i]||"Funcionalidade")))};var ZC=n;document.querySelectorAll("[data-icon]").forEach(i=>{const s=i.dataset.icon;qs[s]&&(i.innerHTML=qs[s])}),Ka(jt.getState()),jt.subscribe(i=>{const s=document.querySelector(".nav-item.active"),r=s?s.dataset.page:"home";document.getElementById("content-area")&&(r==="home"?Ka(i):r==="settings"&&document.getElementById("settings-container")&&Ya("settings-container"))});const t=document.querySelectorAll(".nav-item, .bottom-nav-item");t.forEach(i=>{i.addEventListener("click",s=>{s.preventDefault(),t.forEach(l=>l.classList.remove("active"));const r=i.dataset.page;document.querySelectorAll(`[data-page="${r}"]`).forEach(l=>l.classList.add("active"));const o={home:"Viso Geral",rebalance:"Rebalanceamento",reserve:"Reserva de Emergncia",fixed:"Renda Fixa",variable:"Renda Varivel",treasury:"Tesouro Direto",menu:"Menu",settings:"Configuraes"},a=document.getElementById("page-title");a&&o[r]&&(a.textContent=o[r]),n(r)})});const e=document.querySelector(".fab");e&&e.addEventListener("click",()=>{const i=document.querySelector(".nav-item.active"),s=i?i.dataset.page:"home";qC(s)})}catch(n){console.error(n),document.body.innerHTML=`<div style="color: red; padding: 2rem;">
      <h1>Critical Init Error</h1>
      <p>${n.message}</p>
      <pre>${n.stack}</pre>
   </div>`}
